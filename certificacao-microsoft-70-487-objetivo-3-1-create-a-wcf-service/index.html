<!doctype html>
	<!--[if !IE]>
	<html class="no-js non-ie" lang="pt-BR" prefix="og: http://ogp.me/ns#"> <![endif]-->
	<!--[if IE 7 ]>
	<html class="no-js ie7" lang="pt-BR" prefix="og: http://ogp.me/ns#"> <![endif]-->
	<!--[if IE 8 ]>
	<html class="no-js ie8" lang="pt-BR" prefix="og: http://ogp.me/ns#"> <![endif]-->
	<!--[if IE 9 ]>
	<html class="no-js ie9" lang="pt-BR" prefix="og: http://ogp.me/ns#"> <![endif]-->
	<!--[if gt IE 9]><!-->
<html class="no-js" lang="pt-BR" prefix="og: http://ogp.me/ns#"> <!--<![endif]-->
<head>
<base href="https://edneypitta.github.io/old-blog" />

<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1">



<title>Certifica√ß√£o Microsoft 70-487: Objetivo 3.1 ‚Äì Create a WCF service - Edney Pitta</title>

<!-- This site is optimized with the Yoast SEO plugin v3.0.7 - https://yoast.com/wordpress/plugins/seo/ -->
<meta name="description" content="O objetivo Create a WCF service √© um dos maiores objetivos da certifica√ß√£o. Esse objetivo fala sobre conceitos de SOA, como criar contratos, implementar Message Inspectors e opera√ß√µes ass√≠ncronas no servi√ßo."/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-1-create-a-wcf-service/" />
<meta property="og:locale" content="pt_BR" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Certifica√ß√£o Microsoft 70-487: Objetivo 3.1 ‚Äì Create a WCF service - Edney Pitta" />
<meta property="og:description" content="O objetivo Create a WCF service √© um dos maiores objetivos da certifica√ß√£o. Esse objetivo fala sobre conceitos de SOA, como criar contratos, implementar Message Inspectors e opera√ß√µes ass√≠ncronas no servi√ßo." />
<meta property="og:url" content="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-1-create-a-wcf-service/" />
<meta property="og:site_name" content="Edney Pitta" />
<meta property="article:publisher" content="https://www.facebook.com/edneypitta" />
<meta property="article:tag" content="70-487" />
<meta property="article:section" content="Certifica√ß√£o" />
<meta property="article:published_time" content="2016-02-03T21:42:31+00:00" />
<meta property="article:modified_time" content="2016-03-01T16:57:13+00:00" />
<meta property="og:updated_time" content="2016-03-01T16:57:13+00:00" />
<meta property="og:image" content="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/print.png" />
<meta property="og:image" content="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/print2.png" />
<meta property="og:image" content="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/print3.png" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:description" content="O objetivo Create a WCF service √© um dos maiores objetivos da certifica√ß√£o. Esse objetivo fala sobre conceitos de SOA, como criar contratos, implementar Message Inspectors e opera√ß√µes ass√≠ncronas no servi√ßo."/>
<meta name="twitter:title" content="Certifica√ß√£o Microsoft 70-487: Objetivo 3.1 ‚Äì Create a WCF service - Edney Pitta"/>
<meta name="twitter:site" content="@edneypitta"/>
<meta name="twitter:image" content="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/print.png"/>
<meta name="twitter:creator" content="@edneypitta"/>
<!-- / Yoast SEO plugin. -->

<link rel='dns-prefetch' href='//fonts.googleapis.com' />
<link rel='dns-prefetch' href='//s.w.org' />



		<script type="text/javascript">
			
			
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='sparkling-bootstrap-css'  href='https://edneypitta.github.io/old-blog/wp-content/themes/sparkling/inc/css/bootstrap.min.css?ver=4.8.2' type='text/css' media='all' />
<link rel='stylesheet' id='sparkling-icons-css'  href='https://edneypitta.github.io/old-blog/wp-content/themes/sparkling/inc/css/font-awesome.min.css?ver=4.8.2' type='text/css' media='all' />
<link rel='stylesheet' id='sparkling-fonts-css'  href='//fonts.googleapis.com/css?family=Open+Sans%3A400italic%2C400%2C600%2C700%7CRoboto+Slab%3A400%2C300%2C700&#038;ver=4.8.2' type='text/css' media='all' />
<link rel='stylesheet' id='sparkling-style-css'  href='https://edneypitta.github.io/old-blog/wp-content/themes/sparkling/style.css?ver=4.8.2' type='text/css' media='all' />
<script type='text/javascript' src='https://edneypitta.github.io/old-blog/wp-includes/js/jquery/jquery.js?ver=1.12.4'></script>
<script type='text/javascript' src='https://edneypitta.github.io/old-blog/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<script type='text/javascript' src='https://edneypitta.github.io/old-blog/wp-content/themes/sparkling/inc/js/modernizr.min.js?ver=4.8.2'></script>
<script type='text/javascript' src='https://edneypitta.github.io/old-blog/wp-content/themes/sparkling/inc/js/bootstrap.min.js?ver=4.8.2'></script>
<script type='text/javascript' src='https://edneypitta.github.io/old-blog/wp-content/themes/sparkling/inc/js/functions.min.js?ver=4.8.2'></script>
<link rel='https://api.w.org/' href='https://edneypitta.github.io/old-blog/wp-json/' />

 

<link rel='shortlink' href='https://edneypitta.github.io/old-blog/?p=372' />


<script data-cfasync="false" src="//load.sumome.com/" data-sumo-site-id="025f16b2b72012bef5c86b74ea4d0bd0652e8245a2df8c61ed302458c0f98f3b" async></script><style type="text/css">.entry-content {font-family: Open Sans; font-size:14px; font-weight: normal; color:#6B6B6B;}.navbar > .container .navbar-brand {
font-size: 35px;
margin-top: 7px;
}

#menu-social i{
font-size:17px;
}
#menu-social-1 i {
font-size:22px;
}

article ul {
    list-style: none;
    padding:0;
    margin:0;
margin-bottom: 10px;
}

article li { 
    padding-left: 1em; 
    text-indent: -.7em;
}

article li:before {
    content: "\2022";
    color: rgb(191, 66, 78); 
padding-right:7px;
font-size: 15px;
}

#logo {
margin: 10px 0px;
}

.textwidget a:hover h2{
color:#c9302c;
}</style>	<style type="text/css">
			.navbar > .container .navbar-brand {
			color: #ffffff;
		}
		</style>
	<link rel="icon" href="https://edneypitta.github.io/old-blog/wp-content/uploads/2015/08/cropped-cropped-edneypitta-oficialissimo-fundo-branco-32x32.png" sizes="32x32" />
<link rel="icon" href="https://edneypitta.github.io/old-blog/wp-content/uploads/2015/08/cropped-cropped-edneypitta-oficialissimo-fundo-branco-192x192.png" sizes="192x192" />
<link rel="apple-touch-icon-precomposed" href="https://edneypitta.github.io/old-blog/wp-content/uploads/2015/08/cropped-cropped-edneypitta-oficialissimo-fundo-branco-180x180.png" />
<meta name="msapplication-TileImage" content="https://edneypitta.github.io/old-blog/wp-content/uploads/2015/08/cropped-cropped-edneypitta-oficialissimo-fundo-branco-270x270.png" />

<script type="text/javascript">
jQuery(document).ready(function()
{
jQuery('.fa-linkedin-square').parent().attr('target', '_blank').attr('title', 'LinkedIn');
jQuery('.fa-facebook-square').parent().attr('target', '_blank').attr('title', 'Facebook');
jQuery('.fa-twitter-square').parent().attr('target', '_blank').attr('title', 'Twitter');
jQuery('.fa-rss').parent().attr('target', '_blank').attr('title', 'RSS');

jQuery('.fa-info-circle').parent().attr('title', 'Sobre');
});
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-66613004-1', 'auto');
  ga('send', 'pageview');

</script>
</head>

<body class="post-template-default single single-post postid-372 single-format-standard">
<div id="page" class="hfeed site">

	<header id="masthead" class="site-header" role="banner">
		<nav class="navbar navbar-default" role="navigation">
			<div class="container">
				<div class="row">
					<div class="site-navigation-inner col-sm-12">
						<div class="navbar-header">
							<button type="button" class="btn navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
								<span class="sr-only">Toggle navigation</span>
								<span class="icon-bar"></span>
								<span class="icon-bar"></span>
								<span class="icon-bar"></span>
							</button>

							
							<div id="logo">
								<a href="https://edneypitta.github.io/old-blog/"><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2015/08/cropped-edneypitta-oficialissimo-fundo-branco.png"  height="84" width="411" alt="Edney Pitta"/></a>
							</div><!-- end of #logo -->

							
							
						</div>
						<div class="collapse navbar-collapse navbar-ex1-collapse"><ul id="menu-social" class="nav navbar-nav"><li id="menu-item-20" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-20"><a title="&lt;i class=&quot;fa fa-linkedin-square&quot;&gt;&lt;/i&gt;" href="https://br.linkedin.com/in/edneypitta"><i class="fa fa-linkedin-square"></i></a></li>
<li id="menu-item-22" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-22"><a title="&lt;i class=&quot;fa fa-facebook-square&quot;&gt;&lt;/i&gt;" href="https://www.facebook.com/edneypitta"><i class="fa fa-facebook-square"></i></a></li>
<li id="menu-item-23" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-23"><a title="&lt;i class=&quot;fa fa-twitter-square&quot;&gt;&lt;/i&gt;" href="https://twitter.com/edneypitta"><i class="fa fa-twitter-square"></i></a></li>
<li id="menu-item-24" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-24"><a title="&lt;i class=&quot;fa fa-rss&quot;&gt;&lt;/i&gt;" href="https://edneypitta.github.io/old-blog/feed/"><i class="fa fa-rss"></i></a></li>
<li id="menu-item-27" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-27"><a title="&lt;i class=&quot;fa fa-info-circle&quot;&gt;&lt;/i&gt;" href="https://edneypitta.github.io/old-blog/sobre/"><i class="fa fa-info-circle"></i></a></li>
</ul></div>					</div>
				</div>
			</div>
		</nav><!-- .site-navigation -->
	</header><!-- #masthead -->

	<div id="content" class="site-content">

		<div class="top-section">
								</div>

		<div class="container main-content-area">
			<div class="row">
				<div class="main-content-inner col-sm-12 col-md-8 pull-left">

	<div id="primary" class="content-area">
		<main id="main" class="site-main" role="main">

		
			
<article id="post-372" class="post-372 post type-post status-publish format-standard hentry category-certificacao tag-70-487">
		<div class="post-inner-content">
		<header class="entry-header page-header">

			<h1 class="entry-title ">Certifica√ß√£o Microsoft 70-487: Objetivo 3.1 ‚Äì Create a WCF service</h1>

			<div class="entry-meta">
				<span class="posted-on"><i class="fa fa-calendar"></i> <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-1-create-a-wcf-service/" rel="bookmark"><time class="entry-date published" datetime="2016-02-03T21:42:31+00:00">03/02/2016</time><time class="updated" datetime="2016-03-01T16:57:13+00:00">01/03/2016</time></a></span><span class="byline"> <i class="fa fa-user"></i> <span class="author vcard"><a class="url fn n" href="https://edneypitta.github.io/old-blog/author/admin/">Edney Pitta</a></span></span>
								<span class="cat-links"><i class="fa fa-folder-open-o"></i>
					 <a href="https://edneypitta.github.io/old-blog/category/certificacao/" rel="category tag">Certifica√ß√£o</a>				</span>
								
			</div><!-- .entry-meta -->
		</header><!-- .entry-header -->

		<div class="entry-content">
			<p>Ol√° pessoal! Chegamos ao cap√≠tulo 3 da certifica√ß√£o que fala sobre WCF, a tecnologia prim√°ria da Microsoft para o desenvolvimento de aplica√ß√µes SOA. Esse √© o componente com mais conte√∫do na certifica√ß√£o e que tem o maior n√∫mero de objetivos (9). </p>
<p>O primeiro objetivo, <strong>Create a WCF service</strong>, √© a introdu√ß√£o ao assunto e um dos maiores objetivos da certifica√ß√£o. Esse objetivo fala sobre conceitos de SOA, como criar contratos, implementar Message Inspectors e opera√ß√µes ass√≠ncronas no servi√ßo.</p>
<h2>Conceitos de SOA</h2>
<p>Antes de entrar na discuss√£o sobre como construir ou manter servi√ßos, alguns componente de SOA precisam ser definidos. S√£o eles:</p>
<ul>
<li><strong>Service</strong>: um componente que √© capaz de fazer uma ou mais tarefas;</li>
<li><strong>Service definition</strong>: um contrato que define uma feature do servi√ßo. O uso de contratos √© uma caracter√≠stica determinante de SOA.</li>
<li><strong>Binding</strong>: item que especifica o transporte, encoding e detalhes do protocolo necess√°rios para se realizar uma conex√£o cliente-servidor;</li>
<li><strong>Serialization</strong>: Como SOA envolve comunica√ß√£o entre diferentes processos, a serializa√ß√£o √© necess√°ria para que os dados sejam transferidos e consumidos entre esses processos.</li>
</ul>
<p>Alguns conceitos universais de SOA s√£o tamb√©m importantes:</p>
<ul>
<li><strong>Fronteiras s√£o expl√≠citas</strong>: para se comunicar com um servi√ßo, voc√™ precisa saber algumas coisas dele. Qual √© o ponto de entrada do servi√ßo? Quais opera√ß√µes ele suporta? Quais mecanismos de comunica√ß√£o s√£o aceitas?</li>
<li><strong>Servi√ßos s√£o aut√¥nomos</strong>: o servi√ßo e quaisquer depend√™ncias devem ser independentemente deployados, versionados e configurados;</li>
<li><strong>Servi√ßos compartilham schemas e contratos, n√£o classes</strong>: para se comunicar com um servi√ßo, o client precisa saber a URI, o protocolo de comunica√ß√£o e quais opera√ß√µes s√£o suportadas. N√£o √© necess√°ria uma c√≥pia das classes ou biblioteca que prov√™ as opera√ß√µes;</li>
<li><strong>A compatibilidade de servi√ßos √© baseada na pol√≠tica</strong>: apesar da WSDL (Web Service Definition Language) prover bastante informa√ß√£o sobre o servi√ßo, √© imposs√≠vel informar todos os requisitos que um servi√ßo pode ter.</li>
</ul>
<h2>Criando Contratos</h2>
<p>Como visto acima, um elemento cr√≠tico de um servi√ßo SOA √© o contrato, para que clients e servers possam se comunicar de forma flex√≠vel. H√° v√°rios atributos que definem o contrato de um servi√ßo WCF, sendo eles:</p>
<ul>
<li><strong>Atributo ServiceContract</strong>: √© o que de fato faz um tipo em .NET se tornar um servi√ßo WCF. Sem ServiceContract, n√£o h√° servi√ßo;</li>
<li><strong>Atributo OperationContract</strong>: marca uma fun√ß√£o como uma opera√ß√£o de um servi√ßo;</li>
<li><strong>Atributo DataContract</strong>: informa ao runtime que o tipo √© serializ√°vel;</li>
<li><strong>Atributo FaultContract</strong>: prov√™ informa√ß√µes de exceptions de uma forma universal.</li>
</ul>
<h4>Criando Um Projeto WCF</h4>
<p>Um servi√ßo WCF √© basicamente um compilado de classes. Voc√™ pode criar um projeto comum, adicionar algumas refer√™ncias, definir o contrato com os atributos acima e pronto; temos um servi√ßo WCF. Outra forma, mais recomendada, √© criar um projeto WCF diretamente no Visual Studio, que vai adicionar as refer√™ncias necess√°rias e construir a aplica√ß√£o de host (com os bindings e muitas configura√ß√µes feitas por padr√£o).</p>
<p>Fazendo pelo Visual Studio, voc√™ tem as seguintes op√ß√µes:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/print.png" alt="WCF Options" width="813" height="593" class="aligncenter size-full wp-image-378" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/print.png 813w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/print-300x219.png 300w" sizes="(max-width: 813px) 100vw, 813px" /></p>
<p>As duas op√ß√µes mais comuns s√£o <strong>WCF Service Library </strong>e <strong>WCF Service Application</strong>. A principal diferen√ßa entre elas √© que WCF Service Library permite que voc√™ crie um servi√ßo independente de hospedagem. WCF Service Application inclui um host IIS ou WAS (Windows Activation Service).</p>
<p>Criando um WCF Service Library, o Visual Studio criar√° um projeto com as refer√™ncias necess√°rias, uma classe de servi√ßo e uma interface de servi√ßo com os atributos ServiceContract e OperationContract. Isso √© o b√°sico para que um assembly se torne um servi√ßo WCF.</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/print2.png" alt="Project" width="369" height="429" class="aligncenter size-full wp-image-379" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/print2.png 369w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/print2-258x300.png 258w" sizes="(max-width: 369px) 100vw, 369px" /></p>
<p>Note as refer√™ncias √† <em>System.Runtime.Serialization</em> e <em>System.ServiceModel</em>, al√©m do arquivo App.config com as configura√ß√µes do servi√ßo (detalhes em outros objetivos).</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/print3.png" alt="Project Properties" width="709" height="250" class="aligncenter size-full wp-image-381" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/print3.png 709w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/print3-300x106.png 300w" sizes="(max-width: 709px) 100vw, 709px" /></p>
<p>Os dois itens de distin√ß√£o s√£o que o <strong>Output type</strong> √© definido como <em>class library</em>, refor√ßando que um servi√ßo WCF √© como um assembly normal, e que <strong>Startup project</strong> n√£o √© definido pois √© poss√≠vel ter v√°rios servi√ßos em uma solution, e todos eles s√£o independentes.</p>
<h4>Definindo O Servi√ßo</h4>
<p>Como visto acima, ao se criar um projeto WCF, o Visual Studio cria por padr√£o uma interface que define o contrato e uma classe que faz a implementa√ß√£o do servi√ßo. A interface deve ser marcada com o atributo ServiceContract, enquanto os m√©todos devem ter o atributo OperationContract. √â poss√≠vel ter os atributos diretamente na classe que faz a implementa√ß√£o, mas como a classe vai herdar da interface, faz sentido deixar tudo l√° (al√©m de facilitar o reuso e desacoplar o contrato da implementa√ß√£o). Para usar tipos complexos, as classes precisam ter o atributo DataContract. Vamos ao c√≥digo:</p>
<p><script src="https://gist.github.com/edneypitta/594c616233b27a1f85f4.js"></script></p>
<p><script src="https://gist.github.com/edneypitta/264ca12d090683b6651c.js"></script></p>
<h4>Endpoints</h4>
<p>Endpoints s√£o essenciais para um servi√ßo WCF, j√° que a principal caracter√≠stica de um servi√ßo WCF √© a exposi√ß√£o dos dados para v√°rios clientes. O termo &#8220;ABC&#8221; √© frequentemente usado na literatura sobre WCF, que significa:</p>
<ul>
<li><strong>A</strong>: significa &#8220;address&#8221;, geralmente uma URI;</li>
<li><strong>B</strong>: significa &#8220;binding&#8221;, que define como o transporte dos dados ser√° feito. Bindings s√£o definidos para cada servi√ßo, e um servi√ßo pode ser exposto por v√°rios bindings ao mesmo tempo;</li>
<li><strong>C</strong>: &#8220;contrato&#8221;, a interface definida no servi√ßo.</li>
</ul>
<p>A lista completa dos bindings (que cont√©m v√°rios m√©todos para HTTP, TCP, etc.) est√° dispon√≠vel em <a href="http://msdn.microsoft.com/en-us/library/ms730879.aspx" target="_blank">http://msdn.microsoft.com/en-us/library/ms730879.aspx</a>.</p>
<h4>Pipeline De Processamento WCF</h4>
<p>No consumo de um servi√ßo WCF, voc√™ sabe que de um lado h√° um servi√ßo exposto, e do outro lado um client consumindo. Mas o que acontece entre esses processos?</p>
<p>Direta ou indiretamente, uma classe proxy √© criada para o client, e essa classe o habilita a interagir com os m√©todos do servi√ßo. O request √© serializado e transferido pelo protocolo definido no binding. Todas as informa√ß√µes precisam ser desserializadas para o servi√ßo consumir, e vice-versa. </p>
<p>Esse processo de serializa√ß√£o e desserializa√ß√£o precisa ser independente de plataforma, j√° que o servi√ßo pode ser consumido de qualquer linguagem. Por exemplo, uma aplica√ß√£o Java ou Python n√£o sabe o que √© a classe <em>System.Data.SqlClient.SqlDataAdapter</em>. Arrays, pilhas e filas s√£o conhecidas pela maioria das linguagens, n√£o <em>System.Collections.Generic.List</em>, espec√≠fico para .NET. Isso foi pensado na cria√ß√£o do WCF, ent√£o h√° v√°rios mecanismos para lidar com esse problema. ServiceContract e OperationContract s√£o a primeira parte dessa equa√ß√£o, mas existem v√°rias outras. </p>
<p>Vamos olhar a implementa√ß√£o de um servi√ßo e comentar todos os aspectos que voc√™ precisa saber para o exame:</p>
<p><script src="https://gist.github.com/edneypitta/ce1c18a7a715cdbf577b.js"></script></p>
<p><script src="https://gist.github.com/edneypitta/c779b7e3b92dd6630502.js"></script></p>
<p><script src="https://gist.github.com/edneypitta/d7aa0f531ce6d978c6b4.js"></script></p>
<h4>DataContract</h4>
<p>Se voc√™ olhar para as classes AnswerSet, AnswerDetails, e TestQuestion, vai notar que todas elas t√™m o atributo DataContract. Esse atributo cont√©m todas as informa√ß√µes sobre como os dados ser√£o serializados.</p>
<p>Para a maioria dos casos, colocar esse atributo j√° ser√° suficiente para sua classe ser serializada e desserializada pelo WCF e pelo client. Mas h√° algumas exce√ß√µes:</p>
<ul>
<li>Se o item sendo enviado deriva de um DataContract, mas n√£o √© um DataContract;</li>
<li>Se o tipo da informa√ß√£o transmitida for uma interface ou classe abstrata;</li>
<li>Se o tipo for um Object.</li>
</ul>
<p>Nesses 3 casos, geralmente haver√° um erro na desserializa√ß√£o da classe. Para deixar a engine de serializa√ß√£o saber sobre um tipo, o atributo KnownType deve ser usado em conjunto com o DataContract.</p>
<p>Vamos ver um exemplo na pr√°tica. Suponha que voc√™ tenha uma classe base <em>QuestionBase</em> e as derivadas <em>MathQuestion </em>e <em>EnglishQuestion</em>:</p>
<p><code>[DataContract(Name="English" Namespace="487Samples")]<br />
public class EnglishQuestion : QuestionBase<br />
{}<br />
[DataContract(Name="Math" Namespace="487Samples")]<br />
public class MathQuestion : QuestionBase<br />
{}</code></p>
<p>Agora suponha que voc√™ tenha a seguinte classe que deve ser serializada:</p>
<p><code>[DataContract(Namespace="487Sample")]<br />
public class QuestionManager<br />
{<br />
[DataMember]<br />
private Guid QuestionSetId;<br />
[DataMember]<br />
private QuestionBase ExamQuestion;<br />
}</code></p>
<p>Por n√£o saber quais os poss√≠veis tipos para a classe abstrata QuestionBase, ao desserializar essa classe uma exception √© lan√ßada. Para resolver esse problema, como dito, o atributo KnownType deve ser usado para indicar quais tipos podem ser usados em uma QuestionBase:</p>
<p><code>[DataContract]<br />
[KnownType(typeof(EnglishQuestion))]<br />
[KnownType(typeof(MathQuestion))]<br />
public class QuestionManager{}</code></p>
<p>Tirando as exce√ß√µes acima, todos os tipos primitivos e algumas classes .NET s√£o serializadas sem problemas pelo DataContractSerializer. A lista completa pode ser vista <a href="http://msdn.microsoft.com/en-us/library/ms731923.aspx" target="_blank">aqui</a>.</p>
<p>A propriedade <strong>Name</strong>, n√£o obrigat√≥ria, especifica um nome diferente da classe vis√≠vel para os clients. AnswerSet, por exemplo, tem o Name <em>Answers</em>, e todos os clients enxergar√£o essa classe como Answers. A propriedade Namespace, tamb√©m n√£o obrigat√≥ria, serve para evitar conflitos de classes com o mesmo Name.</p>
<p>Al√©m do atributo DataContract, √© necess√°rio colocar o atributo DataMember (ou EnumMember, no caso de um enum) em cada propriedade a ser serializada.</p>
<h4>DataMember</h4>
<p>DataMember indica uma propriedade a ser serializada. Se voc√™ marcar uma classe com DataContract mas nenhuma propriedade com DataMember, nada ser√° serializado. </p>
<p>H√° algumas propriedades opcionais que voc√™ pode setar:</p>
<ul>
<li><strong>EmitDefaultValue</strong>: indica se, quando uma propriedade tiver o valor default, ela deve ser serializada ou n√£o. O valor padr√£o √© true. Deve ser marcada false para minimizar o tamanho da mensagem a ser serializada (dica para o exame);</li>
<li><strong>Name</strong>: identifica uma propriedade com um nome diferente para os clients;</li>
<li><strong>IsRequired</strong>: indica se a propriedade deve ter um valor ao serializar, resultando numa exception caso o valor seja default. O valor padr√£o √© false;</li>
<li><strong>Order</strong>: especifica a ordem de serializa√ß√£o do membro;</li>
<li><strong>TypeId</strong>: caso definido numa classe derivada, retorna um identificador √∫nico para o atributo.</li>
</ul>
<h4>EnumMember</h4>
<p>Funciona exatamente como DataMember, mas se aplica a enums. As propriedades opcionais s√£o:</p>
<ul>
<li><strong>Name</strong>: retorna o nome do membro;</li>
<li><strong>Value</strong>: retorna o valor do membro;</li>
<li><strong>BuiltInTypeKind</strong>: retorna o tipo;</li>
<li><strong>Documentation</strong>: obt√©m ou seta o objeto de documenta√ß√£o, se especificado.</li>
</ul>
<p>O comportamento de Value √© interessante. No caso do enum AnswerDetails, os valores serializados por padr√£o s√£o A, B, C, D e All. Se voc√™ especificar o Value, esse valor ser√° retornado no lugar. Por exemplo:</p>
<p><code>[DataContract(Namespace="http://www.williamgryan.mobi/Book/70-487")]<br />
[Flags]<br />
public enum AnswerDetails : int<br />
{<br />
[EnumMember(Value="1")]<br />
A = 0x0,<br />
[EnumMember(Value = "2")]<br />
B = 0x1,<br />
[EnumMember(Value = "3")]<br />
C = 0x2,<br />
[EnumMember(Value = "Bill")]<br />
D = 0x4,<br />
[EnumMember(Value = "Ryan")]<br />
All = 0x8<br />
}</code></p>
<h4>FaultContracts</h4>
<p>A classe base de exce√ß√µes do .NET, <em>System.Exception</em>, n√£o √© conhecida por potenciais clients de um WCF, como Java ou Python. Cada framework tem sua maneira de lidar com exceptions, mas num cen√°rio distribu√≠do como o consumo de um servi√ßo WCF, todos eles devem se comunicar igualmente tratando-se de erros. Outro problema frequente √© que, em um cen√°rio de exception, voc√™ provavelmente n√£o gostaria de enviar todo o stack do erro para seus clients por v√°rios motivos. <strong>FaultContracts </strong>resolvem esses dois problemas de maneira simples. Voc√™ pode definir quando e quais informa√ß√µes ser√£o enviadas da exception sem expor seu servi√ßo abertamente.</p>
<p>O m√©todo GetQuestionText mostrado anteriormente lan√ßava uma exce√ß√£o se o n√∫mero da quest√£o passado fosse igual ou menor a 0:</p>
<p><code>public String GetQuestionText(Int32 questionNumber)<br />
{<br />
 if (questionNumber <= 0)
 {
 String OutOfRangeMessage = "Question Ids must be a positive value greater than 0";
 IndexOutOfRangeException InvalidQuestionId = new IndexOutOfRangeException(OutOfRangeMessage);
 throw new FaultException<IndexOutOfRangeException>(InvalidQuestionId, OutOfRangeMessage);<br />
 }<br />
 String AnswerText = null;<br />
 // Method implementation<br />
 return AnswerText;<br />
}</code></p>
<p>Para o client saber que uma exce√ß√£o pode ser lan√ßada por um servi√ßo, isso deve estar definido no contrato do m√©todo:</p>
<p><code>[FaultContract(typeof(IndexOutOfRangeException))]<br />
[OperationContract]<br />
String GetQuestionText(Int32 questionNumber);</code></p>
<p>Com isso, exce√ß√µes podem ser enviadas para o client sem problemas de compatibilidade. Se voc√™ quiser incluir detalhes sobre o erro, voc√™ pode setar a propriedade Reason que aceita um FaultReason.</p>
<p>FaultException tem outra propriedade chamada FaultCode. Com ela √© poss√≠vel especificar erros no n√≠vel de SOAP. SOAP 1.1, por exemplo, aceita os erros VersionMismatch, MustUnderstand, Client e Server. SOAP 1.2 prov√™ os erros VersionMismatch, MustUnderstand, DataEncodingUnknown, Sender, e Receiver. Voc√™ deve levar em conta o binding do servi√ßo, j√° que a especifica√ß√£o de mensagem de erro pode ser espec√≠fico em SOAP 1.1 ou SOAP 1.2.</p>
<p>Ainda outra op√ß√£o √© usar a classe MessageFault, que te d√° uma representa√ß√£o da falha em mem√≥ria, o que permite que voc√™ especifique o erro o quanto quiser.</p>
<p>Para o exame, √© recomend√°vel se familiarizar com os construtores da classe FaultException. S√£o eles:</p>
<ul>
<li><strong>FaultException()</strong>: cria uma FaultException;</li>
<li><strong>FaultException(FaultReason)</strong>: cria e especifica uma Reason;</li>
<li><strong>FaultException(MessageFault)</strong>: cria e especifica uma MessageFault;</li>
<li><strong>FaultException(String)</strong>: cria e usa a string para criar uma FaultReason com o texto;</li>
<li><strong>FaultException(FaultReason, FaultCode)</strong>: cria especificando uma FaultReason e um FaultCode;</li>
<li><strong>FaultException(MessageFault, String)</strong>: cria especificando uma MessageFault e uma string para a action SOAP fault;</li>
<li><strong>FaultException(SerializationInfo, StreamingContext)</strong>: cria especificando informa√ß√µes de serializa√ß√£o e um contexto em que a FaultException ser√° desserializada. Pouco prov√°vel de ter no exame;</li>
<li><strong>FaultException(String, FaultCode)</strong>: cria especificando uma FaultReason e um FaultCode;</li>
<li><strong>FaultException(FaultReason, FaultCode, String)</strong>: cria especificando uma FaultReason, um FaultCode e uma string para a action SOAP fault;</li>
<li><strong>FaultException(String, FaultCode, String)</strong>: o mesmo que o anterior, mas a primeira string √© transformada em uma FaultReason.</li>
</ul>
<p>Resumindo, foque em como definir um FaultContract, como lan√ßar uma FaultException e as principais propriedades dela (FaultReason e FaultCode). Tenha em mente tamb√©m que FaultException herda de CommunicationException.</p>
<h2>Implementando Inspectors</h2>
<p>Voc√™ pode implementar inspectors que estendem o comportamento do WCF.</p>
<p>O primeiro deles √© o <strong>Parameter Inspector</strong>. Com a interface <em>IParameterInspector</em> voc√™ consegue validar se os par√¢metros atendem √† condi√ß√µes customizadas antes que o servi√ßo seja de fato chamado. Por exemplo, se um servi√ßo recebe um par√¢metro userName e este deve ser o tamanho maior que 7, um Parameter Inspector poderia ser implementado para evitar chamadas desnecess√°rias ao servi√ßo.</p>
<p>A interface IParameterInspector tem dois m√©todos bem intuitivos: <em>BeforeCall </em>e <em>AfterCall</em>. No exemplo acima, fica claro que nossa l√≥gica precisa estar em BeforeCall.</p>
<p>O client precisa ter uma refer√™ncia √† classe que implementa IParameterInspector e adicionar na cole√ß√£o Behaviors da propriedade Operations da classe proxy:</p>
<p><code>ProxyInstance.Endpoint.Contract.Operations[0].Behaviors.Add(new UserNameInspector());</code></p>
<p>Feito isso, √© necess√°rio criar o atributo (que herda de <em>Attribute </em>e <em>IOperationBehavior</em>) a ser inserido no contrato e a classe que implementa a interface IParameterInspector:</p>
<p><script src="https://gist.github.com/edneypitta/fc1d3c917f88428b4818.js"></script></p>
<p>Outro inspector √© o <strong>Message Inspector</strong>. O prop√≥sito dele √© voc√™ interceptar processamentos dado algum evento. Digamos que seu servi√ßo processa uma compra de um e-commerce. Voc√™ dispara uma verifica√ß√£o do cart√£o de cr√©dito informado e inicia o processamento de salvar todos os dados. No meio do processamento, a operadora do cart√£o de cr√©dito retornou que este √© inv√°lido. Com um Message Inspector, voc√™ conseguiria interromper e cancelar o processo que estava ocorrendo de salvar todas as informa√ß√µes. </p>
<p>Para implementar um Message Inspector do lado do server, voc√™ usa a interface <em>IDispatchMessageInspector</em>. Ela possui dois m√©todos:</p>
<ul>
<li><strong>AfterReceiveRequest</strong>: chamado ap√≥s receber um request, mas antes da mensagem ser encaminhada para o m√©todo;</li>
<li><strong>BeforeSendReply</strong>: chamado ap√≥s o retorno do m√©todo mas antes que o retorno seja enviado de fato para o client.</li>
</ul>
<p>Uma vantagem do Message Inspector √© que voc√™ o adiciona no pipeline do WCF via arquivo de configura√ß√£o, evitando que o servi√ßo inteiro seja deployado para que um inspector seja adicionado. Assumindo que a classe <em>ServerInspector </em>implementa a interface IDispatchMessageInspector, voc√™ o habilita com a seguinte configura√ß√£o:</p>
<p><code>&lt;extensions&gt;<br />
 &lt;behaviorExtensions&gt;<br />
 &lt;add name=&quot;clientSample&quot; type=&quot;Samples.WCF.Services.ServerInspector, ClientHost, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null&quot;/&gt;<br />
 &lt;/behaviorExtensions&gt;<br />
&lt;/extensions&gt;</code></p>
<p>√â poss√≠vel implementar Message Inspectors do lado do client tamb√©m, de forma bem parecida com a do server. A interface respons√°vel se chama <em>IClientMessageInspector</em> e tem os seguintes m√©todos:</p>
<ul>
<li><strong>BeforeSendRequest</strong>: chamado antes de um request ser enviado ao servi√ßo;</li>
<li><strong>AfterReceiveReply</strong>: chamado ap√≥s o response do server, mas antes de ser encaminhado ao m√©todo que o chamou.</li>
</ul>
<p>Para adicion√°-lo no WCF, a configura√ß√£o √© exatamente igual √† do server. Para o exame voc√™ deve saber que MessageInspectors existem, quais interfaces devem ser implementadas e onde especific√°-los no arquivo de configura√ß√£o.</p>
<p>A <strong>finalmente </strong>terminamos üôÇ</p>
<p>Fique ligado no post do pr√≥ximo objetivo, <strong><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-2-configure-wcf-services-by-using-configuration-settings/">Configure WCF services by using configuration settings</a></strong>.<br />
At√© mais!</p>
					</div><!-- .entry-content -->

		<footer class="entry-meta">

	    		      <!-- tags -->
	      <div class="tagcloud">

	          <a href="https://edneypitta.github.io/old-blog/tag/70-487/">70-487</a> 
	      </div>
	      <!-- end tags -->
	      
		</footer><!-- .entry-meta -->
	</div>

	
</article><!-- #post-## -->

			
<div id="disqus_thread">
            <div id="dsq-content">


            <ul id="dsq-comments">
                    <li class="post pingback">
        <p>Pingback: <a href='https://blog.lambda3.com.br/2016/03/certificacao-microsoft-70-487-developing-microsoft-azure-and-web-services/' rel='external nofollow' class='url'>Certifica√ß√£o Microsoft 70-487: Developing Microsoft Azure and Web Services | Blogs da Lambda3</a>()</p>
    </li>
    </li><!-- #comment-## -->
            </ul>


        </div>

    </div>


				<nav class="navigation post-navigation" role="navigation">
		<h1 class="screen-reader-text">Navega√ß√£o de Post</h1>
		<div class="nav-links">
			<div class="nav-previous"><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-5-create-an-entity-framework-data-model/" rel="prev"><i class="fa fa-chevron-left"></i> Certifica√ß√£o Microsoft 70-487: Objetivo 2.5 ‚Äì Create an Entity Framework data model</a></div><div class="nav-next"><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-2-configure-wcf-services-by-using-configuration-settings/" rel="next">Certifica√ß√£o Microsoft 70-487: Objetivo 3.2 ‚Äì Configure WCF services by using configuration settings <i class="fa fa-chevron-right"></i></a></div>		</div><!-- .nav-links -->
	</nav><!-- .navigation -->
	
		
		</main><!-- #main -->
	</div><!-- #primary -->
<script type="text/javascript">

  jQuery(document).ready(function(){
	jQuery('.esconderTextoPagina').remove();
	
  });
</script>

</div>
	<div id="secondary" class="widget-area col-sm-12 col-md-4" role="complementary">
		<div class="well">
						<aside id="text-3" class="widget widget_text">			<div class="textwidget"><a href="https://edneypitta.github.io/old-blog/sobre/"><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2015/08/IMG-20150829-WA00012-e1440915174271-150x150.jpg"  width="150" height="150" class="aligncenter size-thumbnail wp-image-93" style="border-radius: 80px;" />
<h2 style="text-align:center;">Edney Pitta</h2></a>
<div style="text-align: center;">Desenvolvedor de Software @ Lambda3</div>
<div style="margin-top:20px;text-align:center;"><a href="https://edneypitta.github.io/old-blog/sobre/"><button class="btn btn-danger btn-lg " >SOBRE MIM</button></a></div></div>
		</aside><aside id="search-2" class="widget widget_search">
<form role="search" method="get" class="form-search" action="https://edneypitta.github.io/old-blog/">
  <div class="input-group">
  	<label class="screen-reader-text" for="s">Search for:</label>
    <input type="text" class="form-control search-query" placeholder="Procurar&hellip;" value="" name="s" title="Search for:" />
    <span class="input-group-btn">
      <button type="submit" class="btn btn-default" name="submit" id="searchsubmit" value="Search"><span class="glyphicon glyphicon-search"></span></button>
    </span>
  </div>
</form></aside>		<aside id="recent-posts-3" class="widget widget_recent_entries">		<h3 class="widget-title">Posts recentes</h3>		<ul>
					<li>
				<a href="https://edneypitta.github.io/old-blog/migrando-um-projeto-asp-net-core-rc-1-para-rc-2/">Migrando um projeto ASP.NET Core RC 1 para RC 2</a>
						</li>
					<li>
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-486-developing-asp-net-mvc-web-applications/">Certifica√ß√£o Microsoft 70-486: Developing ASP.NET MVC Web Applications</a>
						</li>
					<li>
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-480-programming-in-html5-with-javascript-and-css3/">Certifica√ß√£o Microsoft 70-480: Programming in HTML5 with JavaScript and CSS3</a>
						</li>
					<li>
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-resultado/">Certifica√ß√£o Microsoft 70-487 &#8211; Resultado</a>
						</li>
					<li>
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-6-share-assemblies-between-multiple-applications-and-servers/">Certifica√ß√£o Microsoft 70-487: Objetivo 5.6 ‚Äì Share assemblies between multiple applications and servers</a>
						</li>
				</ul>
		</aside>		<aside id="annual_archive_widget-2" class="widget Annual_Archive_Widget"><h3 class="widget-title">Arquivo</h3>	<ul>
		<li><a href='https://edneypitta.github.io/old-blog/2016/06/'>junho 2016</a>&nbsp;(1)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2016/05/'>maio 2016</a>&nbsp;(1)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2016/04/'>abril 2016</a>&nbsp;(1)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2016/03/'>mar√ßo 2016</a>&nbsp;(10)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2016/02/'>fevereiro 2016</a>&nbsp;(11)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2016/01/'>janeiro 2016</a>&nbsp;(10)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2015/12/'>dezembro 2015</a>&nbsp;(3)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2015/11/'>novembro 2015</a>&nbsp;(3)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2015/10/'>outubro 2015</a>&nbsp;(1)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2015/09/'>setembro 2015</a>&nbsp;(5)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2015/08/'>agosto 2015</a>&nbsp;(2)</li>
	</ul>
	</aside>		</div>
	</div><!-- #secondary -->
			</div><!-- close .*-inner (main-content or sidebar, depending if sidebar is used) -->
		</div><!-- close .row -->
	</div><!-- close .container -->
</div><!-- close .site-content -->

	<div id="footer-area">
		<div class="container footer-inner">
			<div class="row">
				
				</div>
		</div>

		<footer id="colophon" class="site-footer" role="contentinfo">
			<div class="site-info container">
				<div class="row">
										<nav role="navigation" class="col-md-6">
						<ul id="menu-social-1" class="nav footer-nav clearfix"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-20"><a href="https://br.linkedin.com/in/edneypitta"><i class="fa fa-linkedin-square"></i></a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-22"><a href="https://www.facebook.com/edneypitta"><i class="fa fa-facebook-square"></i></a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-23"><a href="https://twitter.com/edneypitta"><i class="fa fa-twitter-square"></i></a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-24"><a href="https://edneypitta.github.io/old-blog/feed/"><i class="fa fa-rss"></i></a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-27"><a href="https://edneypitta.github.io/old-blog/sobre/"><i class="fa fa-info-circle"></i></a></li>
</ul>					</nav>
					<div class="copyright col-md-6">
						<a rel="license" href="http://creativecommons.org/licenses/by/2.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/2.0/80x15.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/2.0/">Creative Commons Attribution 2.0 Generic License</a>.						Theme by <a href="http://colorlib.com/" target="_blank">Colorlib</a> Powered by <a href="http://wordpress.org/" target="_blank">WordPress</a>					</div>
				</div>
			</div><!-- .site-info -->
			<div class="scroll-to-top"><i class="fa fa-angle-up"></i></div><!-- .scroll-to-top -->
		</footer><!-- #colophon -->
	</div>
</div><!-- #page -->

<script type='text/javascript' src='https://edneypitta.github.io/old-blog/wp-content/themes/sparkling/inc/js/skip-link-focus-fix.js?ver=20140222'></script>
<script type='text/javascript' src='https://edneypitta.github.io/old-blog/wp-includes/js/comment-reply.min.js?ver=4.8.2'></script>
<script type='text/javascript' src='https://edneypitta.github.io/old-blog/wp-includes/js/wp-embed.min.js?ver=4.8.2'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var embedVars = {"disqusConfig":{"platform":"wordpress@4.8.2","language":""},"disqusIdentifier":"372 http:\/\/edneypitta.github.io\/?p=372","disqusShortname":"edneypitta","disqusTitle":"Certifica\u00e7\u00e3o Microsoft 70-487: Objetivo 3.1 \u2013 Create a WCF service","disqusUrl":"http:\/\/edneypitta.github.io\/certificacao-microsoft-70-487-objetivo-3-1-create-a-wcf-service\/","options":{"manualSync":false},"postId":"372"};
/* ]]> */
</script>
<script type='text/javascript' src='https://edneypitta.github.io/old-blog/wp-content/plugins/disqus-comment-system/media/js/disqus.js?ver=4.8.2'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var countVars = {"disqusShortname":"edneypitta"};
/* ]]> */
</script>
<script type='text/javascript' src='https://edneypitta.github.io/old-blog/wp-content/plugins/disqus-comment-system/media/js/count.js?ver=4.8.2'></script>

</body>
</html>