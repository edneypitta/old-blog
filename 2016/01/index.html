<!doctype html>
	<!--[if !IE]>
	<html class="no-js non-ie" lang="pt-BR" prefix="og: http://ogp.me/ns#"> <![endif]-->
	<!--[if IE 7 ]>
	<html class="no-js ie7" lang="pt-BR" prefix="og: http://ogp.me/ns#"> <![endif]-->
	<!--[if IE 8 ]>
	<html class="no-js ie8" lang="pt-BR" prefix="og: http://ogp.me/ns#"> <![endif]-->
	<!--[if IE 9 ]>
	<html class="no-js ie9" lang="pt-BR" prefix="og: http://ogp.me/ns#"> <![endif]-->
	<!--[if gt IE 9]><!-->
<html class="no-js" lang="pt-BR" prefix="og: http://ogp.me/ns#"> <!--<![endif]-->
<head>
<base href="https://edneypitta.github.io/old-blog" />

<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1">



<title>janeiro 2016 - Edney Pitta</title>

<!-- This site is optimized with the Yoast SEO plugin v3.0.7 - https://yoast.com/wordpress/plugins/seo/ -->
<meta name="robots" content="noindex,follow"/>
<link rel="canonical" href="https://edneypitta.github.io/old-blog/2016/01/" />
<meta property="og:locale" content="pt_BR" />
<meta property="og:type" content="object" />
<meta property="og:title" content="janeiro 2016 - Edney Pitta" />
<meta property="og:url" content="https://edneypitta.github.io/old-blog/2016/01/" />
<meta property="og:site_name" content="Edney Pitta" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="janeiro 2016 - Edney Pitta"/>
<meta name="twitter:site" content="@edneypitta"/>
<!-- / Yoast SEO plugin. -->

<link rel='dns-prefetch' href='//fonts.googleapis.com' />
<link rel='dns-prefetch' href='//s.w.org' />


		<script type="text/javascript">
			
			
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='sparkling-bootstrap-css'  href='https://edneypitta.github.io/old-blog/wp-content/themes/sparkling/inc/css/bootstrap.min.css?ver=4.8.2' type='text/css' media='all' />
<link rel='stylesheet' id='sparkling-icons-css'  href='https://edneypitta.github.io/old-blog/wp-content/themes/sparkling/inc/css/font-awesome.min.css?ver=4.8.2' type='text/css' media='all' />
<link rel='stylesheet' id='sparkling-fonts-css'  href='//fonts.googleapis.com/css?family=Open+Sans%3A400italic%2C400%2C600%2C700%7CRoboto+Slab%3A400%2C300%2C700&#038;ver=4.8.2' type='text/css' media='all' />
<link rel='stylesheet' id='sparkling-style-css'  href='https://edneypitta.github.io/old-blog/wp-content/themes/sparkling/style.css?ver=4.8.2' type='text/css' media='all' />
<script type='text/javascript' src='https://edneypitta.github.io/old-blog/wp-includes/js/jquery/jquery.js?ver=1.12.4'></script>
<script type='text/javascript' src='https://edneypitta.github.io/old-blog/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<script type='text/javascript' src='https://edneypitta.github.io/old-blog/wp-content/themes/sparkling/inc/js/modernizr.min.js?ver=4.8.2'></script>
<script type='text/javascript' src='https://edneypitta.github.io/old-blog/wp-content/themes/sparkling/inc/js/bootstrap.min.js?ver=4.8.2'></script>
<script type='text/javascript' src='https://edneypitta.github.io/old-blog/wp-content/themes/sparkling/inc/js/functions.min.js?ver=4.8.2'></script>
<link rel='https://api.w.org/' href='https://edneypitta.github.io/old-blog/wp-json/' />

 

<script data-cfasync="false" src="//load.sumome.com/" data-sumo-site-id="025f16b2b72012bef5c86b74ea4d0bd0652e8245a2df8c61ed302458c0f98f3b" async></script><style type="text/css">.entry-content {font-family: Open Sans; font-size:14px; font-weight: normal; color:#6B6B6B;}.navbar > .container .navbar-brand {
font-size: 35px;
margin-top: 7px;
}

#menu-social i{
font-size:17px;
}
#menu-social-1 i {
font-size:22px;
}

article ul {
    list-style: none;
    padding:0;
    margin:0;
margin-bottom: 10px;
}

article li { 
    padding-left: 1em; 
    text-indent: -.7em;
}

article li:before {
    content: "\2022";
    color: rgb(191, 66, 78); 
padding-right:7px;
font-size: 15px;
}

#logo {
margin: 10px 0px;
}

.textwidget a:hover h2{
color:#c9302c;
}</style>	<style type="text/css">
			.navbar > .container .navbar-brand {
			color: #ffffff;
		}
		</style>
	<link rel="icon" href="https://edneypitta.github.io/old-blog/wp-content/uploads/2015/08/cropped-cropped-edneypitta-oficialissimo-fundo-branco-32x32.png" sizes="32x32" />
<link rel="icon" href="https://edneypitta.github.io/old-blog/wp-content/uploads/2015/08/cropped-cropped-edneypitta-oficialissimo-fundo-branco-192x192.png" sizes="192x192" />
<link rel="apple-touch-icon-precomposed" href="https://edneypitta.github.io/old-blog/wp-content/uploads/2015/08/cropped-cropped-edneypitta-oficialissimo-fundo-branco-180x180.png" />
<meta name="msapplication-TileImage" content="https://edneypitta.github.io/old-blog/wp-content/uploads/2015/08/cropped-cropped-edneypitta-oficialissimo-fundo-branco-270x270.png" />

<script type="text/javascript">
jQuery(document).ready(function()
{
jQuery('.fa-linkedin-square').parent().attr('target', '_blank').attr('title', 'LinkedIn');
jQuery('.fa-facebook-square').parent().attr('target', '_blank').attr('title', 'Facebook');
jQuery('.fa-twitter-square').parent().attr('target', '_blank').attr('title', 'Twitter');
jQuery('.fa-rss').parent().attr('target', '_blank').attr('title', 'RSS');

jQuery('.fa-info-circle').parent().attr('title', 'Sobre');
});
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-66613004-1', 'auto');
  ga('send', 'pageview');

</script>
</head>

<body class="archive date">
<div id="page" class="hfeed site">

	<header id="masthead" class="site-header" role="banner">
		<nav class="navbar navbar-default" role="navigation">
			<div class="container">
				<div class="row">
					<div class="site-navigation-inner col-sm-12">
						<div class="navbar-header">
							<button type="button" class="btn navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
								<span class="sr-only">Toggle navigation</span>
								<span class="icon-bar"></span>
								<span class="icon-bar"></span>
								<span class="icon-bar"></span>
							</button>

							
							<div id="logo">
								<a href="https://edneypitta.github.io/old-blog/"><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2015/08/cropped-edneypitta-oficialissimo-fundo-branco.png"  height="84" width="411" alt="Edney Pitta"/></a>
							</div><!-- end of #logo -->

							
							
						</div>
						<div class="collapse navbar-collapse navbar-ex1-collapse"><ul id="menu-social" class="nav navbar-nav"><li id="menu-item-20" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-20"><a title="&lt;i class=&quot;fa fa-linkedin-square&quot;&gt;&lt;/i&gt;" href="https://br.linkedin.com/in/edneypitta"><i class="fa fa-linkedin-square"></i></a></li>
<li id="menu-item-22" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-22"><a title="&lt;i class=&quot;fa fa-facebook-square&quot;&gt;&lt;/i&gt;" href="https://www.facebook.com/edneypitta"><i class="fa fa-facebook-square"></i></a></li>
<li id="menu-item-23" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-23"><a title="&lt;i class=&quot;fa fa-twitter-square&quot;&gt;&lt;/i&gt;" href="https://twitter.com/edneypitta"><i class="fa fa-twitter-square"></i></a></li>
<li id="menu-item-24" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-24"><a title="&lt;i class=&quot;fa fa-rss&quot;&gt;&lt;/i&gt;" href="https://edneypitta.github.io/old-blog/feed/"><i class="fa fa-rss"></i></a></li>
<li id="menu-item-27" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-27"><a title="&lt;i class=&quot;fa fa-info-circle&quot;&gt;&lt;/i&gt;" href="https://edneypitta.github.io/old-blog/sobre/"><i class="fa fa-info-circle"></i></a></li>
</ul></div>					</div>
				</div>
			</div>
		</nav><!-- .site-navigation -->
	</header><!-- #masthead -->

	<div id="content" class="site-content">

		<div class="top-section">
								</div>

		<div class="container main-content-area">
			<div class="row">
				<div class="main-content-inner col-sm-12 col-md-8 pull-left">

	<section id="primary" class="content-area">
		<main id="main" class="site-main" role="main">

		
			<header class="page-header">
				<h1 class="page-title">
					M√™s: <span>janeiro 2016</span>				</h1>
							</header><!-- .page-header -->

						
				
<article id="post-363" class="post-363 post type-post status-publish format-standard hentry category-certificacao tag-70-487">
	<div class="blog-item-wrap">
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-5-create-an-entity-framework-data-model/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 2.5 ‚Äì Create an Entity Framework data model" >
			 				</a>
		<div class="post-inner-content">
			<header class="entry-header page-header">

				<h1 class="entry-title"><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-5-create-an-entity-framework-data-model/" rel="bookmark">Certifica√ß√£o Microsoft 70-487: Objetivo 2.5 ‚Äì Create an Entity Framework data model</a></h1>

								<div class="entry-meta">
					<span class="posted-on"><i class="fa fa-calendar"></i> <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-5-create-an-entity-framework-data-model/" rel="bookmark"><time class="entry-date published" datetime="2016-01-27T23:22:43+00:00">27/01/2016</time><time class="updated" datetime="2016-03-01T16:57:07+00:00">01/03/2016</time></a></span><span class="byline"> <i class="fa fa-user"></i> <span class="author vcard"><a class="url fn n" href="https://edneypitta.github.io/old-blog/author/admin/">Edney Pitta</a></span></span>				<span class="comments-link"><i class="fa fa-comment-o"></i><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-5-create-an-entity-framework-data-model/#respond"><span class="dsq-postid" data-dsqidentifier="363 https://edneypitta.github.io/old-blog/?p=363">Deixe um coment√°rio</span></a></span>
				
				
				</div><!-- .entry-meta -->
							</header><!-- .entry-header -->

						<div class="entry-content">

				<p>Ol√°!</p>
<p>O objetivo 2.5 da certifica√ß√£o, Create an Entity Framework data model, √© o √∫ltimo objetivo do segundo t√≥pico da certifica√ß√£o, <strong>Querying and manipulating data by using the Entity Framework</strong>. Finalmente vamos ver como construir um Entity Model, al√©m de recordar alguns conceitos e componentes do EF cobertos no objetivo 1.1.</p>
<p>Esse objetivo cobre como: 1) estruturar o model usando as heran√ßas Table-per-Type e Table-per-Hierarchy, 2) escolher e implementar um m√©todo de data model (Model First ou Database First), 3) implementar objetos POCO e 4) descrever um data model usando Conceptual Schema Definitions, Storage Schema Definition, e Mapping Language (CSDL, SSDL, MSL). Vamos l√°?</p>
<h2>Estruturando o Data Model Usando as Heran√ßas Table-per-Type e Table-per-Hierarchy</h2>
<p>Voc√™ pode tratar os casos de heran√ßa de duas formas: Table-per-Type (tabela por tipo) e Table-per-Hierarchy (tabela por hierarquia). </p>
<p>Basicamente, a diferen√ßa entre as duas √© que, em tabela por tipo, cada classe herdeira vira uma tabela no banco de dados. Em tabela por hierarquia, tanto a classe pai quanto as filhas ficar√£o guardadas na mesma tabela, geralmente com uma coluna indicando qual √© o tipo.</p>
<p>Para o exame, voc√™ deve saber quais s√£o as vantagens e desvantagens das duas formas:</p>
<h4>Tabela Por Tipo</h4>
<p>Vantagens:</p>
<ul>
<li>Os dados n√£o s√£o guardados redundantemente;</li>
<li>Os dados s√£o armazenados na terceira norma formal, aumentando a integridade;</li>
<li>A implementa√ß√£o √© mais simples. Para adicionar ou remover uma entidade herdeira, basta deletar a tabela no banco de dados e atualizar o Entity Model.</li>
</ul>
<p>Desvantagens:</p>
<ul>
<li>A performance √© afetada em opera√ß√µes b√°sicas (CRUD);</li>
<li>Complica a administra√ß√£o do banco de dados pelas tabelas adicionais.</li>
</ul>
<h4>Tabela Por Hierarquia</h4>
<p>Vantagens:</p>
<ul>
<li>Deixa o schema do banco simplificado por conter menos tabelas;</li>
<li>Opera√ß√µes de CRUD otimizadas por trabalhar em uma s√≥ tabela.</li>
</ul>
<p>Desvantagens:</p>
<ul>
<li>H√° redund√¢ncia dos dados por n√£o seguir a terceira normal formal;</li>
<li>Pode haver problemas com a integridade dos dados devido a redund√¢ncia;</li>
<li>O Entity Model fica mais complexo pela tabela conter mais campos.</li>
</ul>
<h2>Escolher e Implementar um M√©todo de Data Model (Model First ou Database First)</h2>
<p>Escolher um modelo de EDM √© um conceito importante, mas n√£o h√° muito o que aprender aqui.</p>
<p><strong>Model First</strong> acontece quando voc√™ cria um modelo vazio e vai criando os recursos necess√°rios, como as entidades, os relacionamentos entre elas e o comportamento das propriedades. Depois disso tudo, voc√™ gera o schema do banco de dados do EDM; e o Entity Framework cuida da cria√ß√£o do banco de dados e o mapeamento entre o banco e o modelo.</p>
<p><strong>Database First</strong>, como esperado, assume que voc√™ j√° tem o schema do banco de dados pronto e escolhe criar o EDM a partir dele. Nesse caso, o Entity Framework cuida da cria√ß√£o dos itens do EDM e o mapeamento entre eles.</p>
<p>Outro ponto importante nesse assunto s√£o as propriedades que voc√™ pode setar diretamente no EDM, escolhendo qualquer um dos dois m√©todos. Clicando com o bot√£o direito no designer e indo em Properties, voc√™ pode controlar algumas propriedades que t√™m o nome bem sugestivo, como se o Lazy Loading deve ser utilizado, o nome do namespace desejado, o n√≠vel de acesso dos containers, etc. </p>
<p>Indo nas propriedades de cada entidade ou em alguma propriedade, h√° alguns comportamentos e configura√ß√µes que podem ser alterados:</p>
<ul>
<li>A classe base da entidade;</li>
<li>Se a propriedade √© Nullable;</li>
<li>Visibilidade dos getters e setters;</li>
<li>Um valor default para uma propriedade;</li>
<li>Essa √© bem interessante: a propriedade <strong>Concurrency Mode</strong>, quando setada para <em>Fixed</em>, assegura que o valor no banco de dados n√£o foi alterado quando voc√™ vai atualiz√°-lo. Por exemplo, se voc√™ obteve uma entidade do banco com uma propriedade no valor &#8220;x&#8221; e vai alter√°-la para &#8220;y&#8221;, o Entity Framework vai validar se o valor ainda √© &#8220;x&#8221; antes de voc√™ atualiz√°-lo para &#8220;y&#8221;. Isso pode ser bem √∫til em alguns cen√°rios, mas carrega uma piora na performance pela valida√ß√£o. Outro ponto √© que, embora esse comportamento seja definido no n√≠vel de propriedade, se voc√™ tiver 50 campos setados para Fixed, apenas uma query ser√° feita no banco para comparar os 50 valores.</li>
</ul>
<h2>Implementar Objetos POCO</h2>
<p>Ao criar uma entidade no EDM, o Entity Framework vai gerar a classe .NET automaticamente. Caso desejado, voc√™ pode desabilitar esse comportamento nas Properties do designer e criar voc√™ mesmo um POCO (<em>plain old common object</em>), tendo mais controle sobre suas classes.</p>
<p>Para usar suas classes POCO no contexto do EF, alguns passos s√£o necess√°rios. A primeira coisa √© que as classes devem ser decoradas com o atributo Table, especificando o nome da tabela no banco de dados:</p>
<p><code>[Table("Account")]<br />
public class Account{}<br />
[Table("Customers")]<br />
public class Customers{}<br />
[Table("TransactionDetails")]<br />
public class TransactionDetail{}<br />
Table("Transactions")]<br />
public class Transaction{}</code></p>
<p>O modo de vincular as classes no contexto depende se voc√™ estiver utilizando DbContext ou ObjectContext.</p>
<p>Com DbContext, basta definir as classes usando a classe gen√©rica DbSet e passando o tipo de cada POCO:</p>
<p><code>public partial class EntityFrameworkSamplesEntitiesDb : DbContext<br />
{<br />
 public EntityFrameworkSamplesEntitiesDb(): base("name=EntityFrameworkSamplesEntities1")<br />
{}<br />
public DbSet<Account> Accounts { get; set; }<br />
public DbSet<Customer> Customers { get; set; }<br />
public DbSet<TransactionDetail> TransactionDetails { get; set; }<br />
public DbSet<Transaction> Transactions { get; set; }<br />
}</code></p>
<p>Com ObjectContext n√£o √© muito diferente. A classe gen√©rica ObjectSet deve ser usada e as propriedades devem ser inicializadas no construtor:</p>
<p><code>public partial class EntityFrameworkSamplesEntitiesSample : ObjectContext<br />
{<br />
 public EntityFrameworkSamplesEntitiesSample(): base("name=EntityFrameworkSamplesEntities1")<br />
{<br />
 Accounts = new ObjectSet<Account>();<br />
 Customers = new ObjectSet<Customer>();<br />
 TransactionDetails = new ObjectSet<TransactionDetail>();<br />
 Transactions = new ObjectSet<Transaction>();<br />
}<br />
 public ObjectSet<Account> Accounts { get; set; }<br />
 public ObjectSet<Customer> Customers { get; set; }<br />
 public ObjectSet<TransactionDetail> TransactionDetails { get; set; }<br />
 public ObjectSet<Transaction> Transactions { get; set; }<br />
}</code></p>
<h2>Descrever um Data Model Usando Conceptual Schema Definitions, Storage Schema Definition, e Mapping Language (CSDL, SSDL, MSL)</h2>
<p>O Entity Framework junta cada um desses componentes no arquivo .edmx, mas para o exame √© importante entender qual o papel de cada um. Basicamente, o CSDL √© o conceito do schema do banco traduzido para objetos; o SSDL representa o pr√≥prio schema do banco de dados e o MSL √© o respons√°vel por juntar os dois e mapear o schema do banco com os objetos.</p>
<p>N√£o h√° muito o que ir mais fundo sobre o CSDL e o SSDL, a n√£o ser que s√£o XMLs representando informa√ß√µes &#8211; objetos e modelos relacionais de banco de dados. O MSL, que unifica os dois, √© um pouco mais complexo e merece um entendimento maior.</p>
<p>O MSL, junto com o .edmx, cont√©m v√°rios outros arquivos gerados automaticamente. S√£o eles:</p>
<ul>
<li>Um arquivo .edmx que serve como container para tudo;</li>
<li>Um arquivo <em>ModelName.Context.tt</em> para gera√ß√£o de templates das classes .NET especificadas no model do respectivo contexto;</li>
<li>O arquivo <em>ModelName.Context.cs</em> que cont√©m as classes do contexto;</li>
<li>O arquivo <em>ModelName.Designer.cs</em> que prov√™ suporte para o designer do EDM;</li>
<li> Um arquivo <em>ModelName.edmx.Diagram</em> que cont√©m um XML parecido com o seguinte:<br />
<code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;<br /> &lt;edmx:Edmx Version=&quot;2.0&quot; xmlns:edmx=&quot;http://schemas.microsoft.com/ado/2008/10/edmx&quot;&gt;<br /> &lt;!-- EF Designer content (DO NOT EDIT MANUALLY BELOW HERE) --&gt;<br /> &lt;edmx:Designer xmlns=&quot;http://schemas.microsoft.com/ado/2008/10/edmx&quot;&gt;<br /> &lt;!-- Diagram content (shape and connector positions) --&gt;<br /> &lt;edmx:Diagrams&gt;<br />&lt;Diagram DiagramId=&quot;8576b1de6991436caba647ac89886831&quot; Name=&quot;Diagram1&quot;&gt;<br />&lt;EntityTypeShape EntityType=&quot;EntityFrameworkSamplesModel1.Account&quot; Width=&quot;1.5&quot; PointX=&quot;7.5&quot; PointY=&quot;0.875&quot; IsExpanded=&quot;true&quot; /&gt;<br />&lt;EntityTypeShape EntityType=&quot;EntityFrameworkSamplesModel1.Customer&quot; Width=&quot;1.5&quot; PointX=&quot;9.75&quot; PointY=&quot;0.875&quot; IsExpanded=&quot;true&quot; /&gt;<br />&lt;EntityTypeShape EntityType=&quot;EntityFrameworkSamplesModel1.TransactionDetail&quot; Width=&quot;1.5&quot; PointX=&quot;14.25&quot; PointY=&quot;0.875&quot; IsExpanded=&quot;true&quot; /&gt;<br />&lt;EntityTypeShape EntityType=&quot;EntityFrameworkSamplesModel1.Transaction&quot; Width=&quot;1.5&quot; PointX=&quot;12&quot; PointY=&quot;0.875&quot; IsExpanded=&quot;true&quot; /&gt;<br />&lt;AssociationConnector Association=&quot;EntityFrameworkSamplesModel1.FK_Account_Account&quot; ManuallyRouted=&quot;false&quot; /&gt;<br />&lt;AssociationConnector Association=&quot;EntityFrameworkSamplesModel1.FK_Customer_Account&quot; ManuallyRouted=&quot;false&quot; /&gt;<br />&lt;AssociationConnector Association=&quot;EntityFrameworkSamplesModel1.FK_Transactions_Customer&quot; ManuallyRouted=&quot;false&quot; /&gt;<br />&lt;AssociationConnector Association=&quot;EntityFrameworkSamplesModel1.FK_TransactionDetails_Transactions&quot; ManuallyRouted=&quot;false&quot; /&gt;<br />&lt;/Diagram&gt;<br />&lt;/edmx:Diagrams&gt;<br />&lt;/edmx:Designer&gt;<br />&lt;/edmx:Edmx&gt;</code>
</li>
<li>Por √∫ltimo, o arquivo <em>ModelName.tt</em> que tem as informa√ß√µes de template para gera√ß√£o das classes de dados.</li>
</ul>
<p>Uma olhada no arquivo .edmx pode ajudar na visualiza√ß√£o de todos esses artefatos:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/01/edmx.png" alt="edmx" width="426" height="878" class="aligncenter size-full wp-image-367" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/01/edmx.png 426w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/01/edmx-146x300.png 146w" sizes="(max-width: 426px) 100vw, 426px" /></p>
<p>Isso √© tudo para esse objetivo. O pr√≥ximo post cobrir√° o primeiro objetivo do cap√≠tulo 3 da certifica√ß√£o, <strong><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-1-create-a-wcf-service/">Designing and implementing WCF Services</a></strong>.</p>
<p>Nos vemos l√°!</p>

				<p><a class="btn btn-default read-more" href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-5-create-an-entity-framework-data-model/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 2.5 ‚Äì Create an Entity Framework data model">Leia Mais</a></p>

							</div><!-- .entry-content -->
					</div>
	</div>
</article><!-- #post-## -->

			
				
<article id="post-349" class="post-349 post type-post status-publish format-standard hentry category-certificacao tag-70-487">
	<div class="blog-item-wrap">
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-4-query-and-manipulate-data-by-using-ado-net/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 2.4 ‚Äì Query and manipulate data by using ADO.NET" >
			 				</a>
		<div class="post-inner-content">
			<header class="entry-header page-header">

				<h1 class="entry-title"><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-4-query-and-manipulate-data-by-using-ado-net/" rel="bookmark">Certifica√ß√£o Microsoft 70-487: Objetivo 2.4 ‚Äì Query and manipulate data by using ADO.NET</a></h1>

								<div class="entry-meta">
					<span class="posted-on"><i class="fa fa-calendar"></i> <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-4-query-and-manipulate-data-by-using-ado-net/" rel="bookmark"><time class="entry-date published" datetime="2016-01-22T22:24:19+00:00">22/01/2016</time><time class="updated" datetime="2016-03-01T16:57:01+00:00">01/03/2016</time></a></span><span class="byline"> <i class="fa fa-user"></i> <span class="author vcard"><a class="url fn n" href="https://edneypitta.github.io/old-blog/author/admin/">Edney Pitta</a></span></span>				<span class="comments-link"><i class="fa fa-comment-o"></i><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-4-query-and-manipulate-data-by-using-ado-net/#respond"><span class="dsq-postid" data-dsqidentifier="349 https://edneypitta.github.io/old-blog/?p=349">Deixe um coment√°rio</span></a></span>
				
				
				</div><!-- .entry-meta -->
							</header><!-- .entry-header -->

						<div class="entry-content">

				<p>Ol√° pessoal! Esse post ser√° sobre objetivo 2.4 da certifica√ß√£o Microsoft 40-487, <strong>Query and manipulate data by using ADO.NET</strong>. Embora j√° coberto no <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-1-1-choose-data-access-technologies/" target="_blank">objetivo 1.1</a>, esse objetivo √© bem espec√≠fico sobre o ADO.NET e suas classes, assim como m√©todos ass√≠ncronos.</p>
<h2>Fazendo Queries com Connection, DataReader, Command, DataAdapter e DataSet</h2>
<h4>SqlConnection</h4>
<p>N√£o h√° muito segredo sobre a classe SqlConnection. Ela herda de <em>IDbConnection</em> e voc√™ deve instanci√°-la passando uma connection string, seja inline ou de um arquivo de configura√ß√£o (web.config).</p>
<p>Todas as connections precisam ser abertas com o m√©todo Open e fechadas explicitamente com Close ou num bloco using.</p>
<p><code>using (SqlConnection connection = new SqlConnection("ConnectionStringName"))<br />
{<br />
connection.Open();<br />
}</code></p>
<p>Sempre abra uma conex√£o num bloco try/catch, pois fatores fora do seu alcan√ßa podem impedir que isso aconte√ßa.</p>
<h4>SqlCommand</h4>
<p>A classe SqlCommand, herdeira de <em>IDbCommand</em>, √© a respons√°vel por fazer comandos ao banco de dados. Algumas de suas caracter√≠sticas s√£o:</p>
<ul>
<li>Uma SqlCommand precisa de uma SqlConnection aberta para operar;</li>
<li>Al√©m da propriedade Connection, o √∫nico outro item importante √© setar a propriedade CommandText, que √© o SQL a ser executado. √â poss√≠vel tamb√©m passar somente o nome de uma stored procedure no lugar do SQL, sendo necess√°rio nesse caso setar a propriedade CommandType para StoredProcedure;</li>
<li>Voc√™ nunca deve concatenar valores como string numa query SQL. Instancie a classe SqlParameter e o adicione na propriedade Parameters;</li>
<li>H√° muito debate entre stored procedures e &#8220;SQLs din√¢micos&#8221; (queries na propriedade CommandText). O fato √© que, sendo parametrizados corretamente, o plano de execu√ß√£o dos SQLs din√¢micos √© cacheado, o que pode aumentar a performance e ser menos vulner√°vel √† ataques;</li>
<li>H√° v√°rias maneiras de executar um SqlCommand. Voc√™ pode us√°-lo como input da propriedade SelectCommand de um SqlDataAdapter, chamar ExecuteScalar para retornar um valor ou ExecuteReader para retornar um SqlDataReader;</li>
<li>Cada m√©todo de execu√ß√£o tem seu par ass√≠ncrono, indicados pelo nome come√ßando com Begin;</li>
<li>√â bom chamar o m√©todo Dispose de um SqlCommand. Fa√ßa isso explicitamente ou fa√ßa uso de um bloco using.</li>
</ul>
<p><script src="https://gist.github.com/edneypitta/02cea8020c58df13674d.js"></script></p>
<h4>SqlDataReader</h4>
<p>A classe SqlDataReader, invocada pelo m√©todo ExecuteReader de um SqlCommand, √© respons√°vel pela obten√ß√£o de dados. Voc√™ deve fechar explicitamente quaisquer SqlDataReader abertos.</p>
<p>SqlDataReader tem uma caracter√≠stica que voc√™ deve ter em mente: ao obter um SqlDataReader pelo m√©todo ExecuteReader, o buffer √© carregado do banco de dados, mas o stream dos dados <strong>n√£o √© feito</strong> at√© voc√™ iterar pelos itens com o m√©todo Read. √â poss√≠vel saber se h√° itens no buffer com a propriedade HasRows, mas n√£o h√° como saber quantos itens existem sem iterar pelos dados, o que esvazia o buffer no processo. Isso significa que voc√™ s√≥ pode iterar pelos dados uma √∫nica vez.</p>
<p><script src="https://gist.github.com/edneypitta/667e197b6cc90f8e5569.js"></script></p>
<h4>SqlDataAdapter</h4>
<p>SqlDataAdapter √© uma classe designada para fazer todas as opera√ß√µes no banco de dados (CRUD).</p>
<p>Na leitura, ela funciona bem diferente do SqlDataReader: um <em>DataSet </em>√© populado (com uma mais <em>DataTables</em>), permitindo que voc√™ itere quantas vezes quiser &#8211; at√© com LINQ. Outra diferen√ßa √© que voc√™ pode obter facilmente a quantidade de registros retornados com o Count de uma DataTable.</p>
<p>O m√©todo <strong>Fill </strong>√© o jeito mais b√°sico de carregar um SqlDataAdapter. Passando um SqlCommand v√°lido, o m√©todo conecta ao banco de dados, executa o comando e cria uma DataTable para cada query SELECT. </p>
<p>Cada coluna gera uma DataColumn na DataTable sendo constru√≠da. O pr√≥prio adapter infere o tipo da DataColumn, de acordo com o schema no banco de dados. Se houver mais de uma coluna com o mesmo nome ou alias, o adapter adiciona um n√∫mero no final do nome (<em>FirstName1, FirstName2, FirstName3</em>). √â poss√≠vel tamb√©m chamar o m√©todo Fill especificando o valor AddWithKey do enum MissingSchemaAction, resultando na adi√ß√£o de uma primary key e outras contraints existentes no banco de dados. Caso haja mais de uma primary key numa query, voc√™ pode criar uma manualmente na DataTable. Com a DataTable e as DataColumns criadas, o adapter cria uma DataRow para cada registro retornado do banco de dados.</p>
<p>Outro m√©todo importante √© o <strong>Update</strong>. Ele funciona assim: todas as DataRows, quando retornadas, tem o RowState como Unchanged. Voc√™ pode alterar o RowState de uma DataRow para Added, Modified ou Deleted. Basicamente, quando o m√©todo Update √© chamado, ele varre todas as DataRows e, dependendo do RowState, chama o SqlCommand correspondente (InsertCommand, UpdateCommand ou DeleteCommand) do SqlDataAdapter. Para funcionar corretamente, voc√™ precisa setar todas essas propriedades. Caso o command n√£o seja encontrado, uma exce√ß√£o √© lan√ßada.</p>
<p>A sintaxe do SqlDataAdapter √© assim: (note que o pr√≥prio m√©todo Fill chama o m√©todo Open da SqlConnection, e ele se encarrega de fech√°-la. Caso voc√™ a abra, a responsabilidade de fech√°-la √© sua)</p>
<p><script src="https://gist.github.com/edneypitta/687ebc27faa2d2c3ac3f.js"></script></p>
<p>Por √∫ltimo, voc√™ pode definir o comportamento de um SqlDataAdapter com algumas propriedades:</p>
<ul>
<li><strong>AcceptChangesDuringFill</strong>: por padr√£o, o m√©todo Fill carrega todas as DataRows com o RowState Unchanged. Se voc√™ setar essa propriedade como false, todas as DataRows ter√£o o RowState <strong>Added</strong>;</li>
<li><strong>AcceptChangesDuringUpdate</strong>: como dito anteriormente, o m√©todo Update examina o RowState de cada DataRow para saber qual Command invocar. Ao final do m√©todo, todos os RowStates s√£o retornados para Unchanged. Setar essa propriedade como false n√£o reseta o RowState; mant√©m o estado que estava antes do m√©todo Fill ser chamado;</li>
<li><strong>UpdateBatchSize</strong>: por padr√£o, o SqlDataAdapter atualiza uma DataRow por vez. Setando essa propriedade, as atualiza√ß√µes s√£o feitas em grupos, o que diminui as chamadas ao banco de dados;</li>
<li><strong>OnRowUpdating/OnRowUpdated</strong>: eventos na atualiza√ß√£o de uma DataRow;</li>
<li><strong>ContinueUpdateOnError</strong>: por padr√£o, quando h√° v√°rios comandos a serem executados e um deles lan√ßa uma Exception, todos os outros comandos n√£o s√£o feitos. Setando essa propriedade como true, o comando que deu erro √© ignorado e os outros comandos s√£o executados normalmente;</li>
<li><strong>FillSchema</strong>: FillSchema usa o SelectCommand para construir o schema do DataTable correspondente, sem popular a tabela.</li>
</ul>
<h2>Fazendo Opera√ß√µes S√≠ncronas e Ass√≠ncronas</h2>
<p>H√° tr√™s m√©todos de um SqlCommand que t√™m suas partes ass√≠ncronas: BeginExecuteReader, BeginExecuteXmlReader e BeginExecuteNonQuery. Eles s√£o bem f√°ceis de usar. Basta examinar a propriedade IsCompleted e, quando completo, chamar o m√©todo End correspondente:</p>
<p><script src="https://gist.github.com/edneypitta/9e93908367aa1738bfc3.js"></script></p>
<p>Obrigado pela leitura e fiquem ligados no post do objetivo 2.5, <strong><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-5-create-an-entity-framework-data-model/">Create an Entity Framework data model</a></strong>.</p>
<p>At√© mais!</p>

				<p><a class="btn btn-default read-more" href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-4-query-and-manipulate-data-by-using-ado-net/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 2.4 ‚Äì Query and manipulate data by using ADO.NET">Leia Mais</a></p>

							</div><!-- .entry-content -->
					</div>
	</div>
</article><!-- #post-## -->

			
				
<article id="post-343" class="post-343 post type-post status-publish format-standard hentry category-certificacao tag-70-487">
	<div class="blog-item-wrap">
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-3-query-data-by-using-linq-to-entities/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 2.3 ‚Äì Query data by using LINQ to Entities" >
			 				</a>
		<div class="post-inner-content">
			<header class="entry-header page-header">

				<h1 class="entry-title"><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-3-query-data-by-using-linq-to-entities/" rel="bookmark">Certifica√ß√£o Microsoft 70-487: Objetivo 2.3 ‚Äì Query data by using LINQ to Entities</a></h1>

								<div class="entry-meta">
					<span class="posted-on"><i class="fa fa-calendar"></i> <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-3-query-data-by-using-linq-to-entities/" rel="bookmark"><time class="entry-date published" datetime="2016-01-18T17:18:06+00:00">18/01/2016</time><time class="updated" datetime="2016-03-01T16:56:54+00:00">01/03/2016</time></a></span><span class="byline"> <i class="fa fa-user"></i> <span class="author vcard"><a class="url fn n" href="https://edneypitta.github.io/old-blog/author/admin/">Edney Pitta</a></span></span>				<span class="comments-link"><i class="fa fa-comment-o"></i><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-3-query-data-by-using-linq-to-entities/#respond"><span class="dsq-postid" data-dsqidentifier="343 https://edneypitta.github.io/old-blog/?p=343">Deixe um coment√°rio</span></a></span>
				
				
				</div><!-- .entry-meta -->
							</header><!-- .entry-header -->

						<div class="entry-content">

				<p>Ol√° pessoal! Chegamos ao objetivo 2.3 da certifica√ß√£o Developing Microsoft Azure and Web Services, o <strong>Query data by using LINQ to Entities</strong>. </p>
<p>Esse objetivo cobre como 1) fazer queries usando LINQ, 2) IQueryable vs. IEnumerable e 3) logar queries. Vamos l√°?</p>
<h4>Fazendo queries usando LINQ</h4>
<p>O objetivo desse ponto √© mostrar que √© poss√≠vel utilizar LINQ to Entities de vers√µes antigas do Entity Framework com ObjectContext, assim como se faz com DbContext. </p>
<p>Com ObjectContext, voc√™ cria um ObjectQuery que √© virtualmente id√™ntico √† aqueles do DbContext. Por exemplo:</p>
<p><code>IQueryable<Account> query = from acct in Context.Accounts<br />
where acct.AccountAlias == "Primary"<br />
select acct;</code></p>
<p>√â importante tamb√©m saber que o ObjectQuery implementa IQueryable, IEnumerable e IListSource.</p>
<h4>IQueryable vs. IEnumerable</h4>
<p>IEnumerable √© caracterizado por:</p>
<ul>
<li>Uso em LINQ to Objects e LINQ to XML;</li>
<li>S√£o performados em mem√≥ria;</li>
<li>S√£o performados no heap.</li>
</ul>
<p>IQueryable s√£o notavelmente diferente na maioria dos casos:</p>
<ul>
<li>Rodam fora do processo;</li>
<li>Suportam diferentes datasources, incluindo remotos;</li>
<li>S√£o usados em LINQ to Entities e LINQ to DataServices.</li>
</ul>
<h4>Logando Queries</h4>
<p>Usando Entity Framework, √†s vezes se torna necess√°rio voc√™ saber exatamente qual a query SQL o framework gerou automaticamente. Por exemplo:</p>
<p><code>IQueryable<Account> Query = from Acct in Context.Accounts<br />
where Acct.AccountAlias == "Primary"<br />
select Acct;</code></p>
<p>Com ObjectQuery (ObjectContext), voc√™ pode obter a query fazendo um cast expl√≠cito para ObjectQuery e usar o m√©todo ToTraceString:</p>
<p><code>String Tracer = (Query as ObjectQuery).ToTraceString();</code></p>
<p>Com DbContext, √© poss√≠vel de maneira similar:</p>
<p><code>String Output = (from Acct in ContextName.ContextSet select Acct).ToString();</code></p>
<p>Isso √© tudo para o conte√∫do desse objetivo.<br />
Obrigado pela leitura e acompanhe a continua√ß√£o das postagens da certifica√ß√£o Microsoft 70-487, que ser√° sobre o pr√≥ximo objetivo <strong>Query and manipulate data by using ADO.NET</strong>.</p>
<p>At√© mais!<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-4-query-and-manipulate-data-by-using-ado-net/">Query and manipulate data by using ADO.NET</a></p>

				<p><a class="btn btn-default read-more" href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-3-query-data-by-using-linq-to-entities/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 2.3 ‚Äì Query data by using LINQ to Entities">Leia Mais</a></p>

							</div><!-- .entry-content -->
					</div>
	</div>
</article><!-- #post-## -->

			
				
<article id="post-334" class="post-334 post type-post status-publish format-standard hentry category-certificacao tag-70-487">
	<div class="blog-item-wrap">
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-2-query-and-manipulate-data-by-using-data-provider-for-entity-framework/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 2.2 ‚Äì Query and manipulate data by using Data Provider for Entity Framework" >
			 				</a>
		<div class="post-inner-content">
			<header class="entry-header page-header">

				<h1 class="entry-title"><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-2-query-and-manipulate-data-by-using-data-provider-for-entity-framework/" rel="bookmark">Certifica√ß√£o Microsoft 70-487: Objetivo 2.2 ‚Äì Query and manipulate data by using Data Provider for Entity Framework</a></h1>

								<div class="entry-meta">
					<span class="posted-on"><i class="fa fa-calendar"></i> <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-2-query-and-manipulate-data-by-using-data-provider-for-entity-framework/" rel="bookmark"><time class="entry-date published" datetime="2016-01-18T09:01:02+00:00">18/01/2016</time><time class="updated" datetime="2016-03-01T16:56:46+00:00">01/03/2016</time></a></span><span class="byline"> <i class="fa fa-user"></i> <span class="author vcard"><a class="url fn n" href="https://edneypitta.github.io/old-blog/author/admin/">Edney Pitta</a></span></span>				<span class="comments-link"><i class="fa fa-comment-o"></i><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-2-query-and-manipulate-data-by-using-data-provider-for-entity-framework/#comments"><span class="dsq-postid" data-dsqidentifier="334 https://edneypitta.github.io/old-blog/?p=334">1 Coment√°rio</span></a></span>
				
				
				</div><!-- .entry-meta -->
							</header><!-- .entry-header -->

						<div class="entry-content">

				<p>Ol√° pessoal! Continuando a s√©rie de posts sobre a certifica√ß√£o Microsoft 70-487, vamos ao objetivo 2.2, <strong>Query and manipulate data by using Data Provider for Entity Framework</strong>. Esse √© um objetivo bem curto que fala sobre como fazer queries usando o namespace System.Data.EntityClient.</p>
<p>O namespace System.Data.EntityClient √© um superset do namespace System.Data, e suas classes operam de forma bem similar. As diferen√ßas se referem ao Entity Framework.</p>
<p>Em todos os cen√°rios de acesso ao banco de dados, uma conex√£o √© necess√°ria. No namespace SqlClient, h√° a classe SqlConnection. Para o EntityClient, a classe de conex√£o √© a <strong>EntityConnection</strong>. Ela tem tr√™s construtores: um vazio (<em>new EntityConnection()</em>), um que recebe uma connection string normal e o terceiro em que voc√™ deve especificar informa√ß√µes (metadados) para o EDM. Para fazer isso, a melhor maneira √© usar a classe <em>EntityConnectionStringBuilder </em>em conjunto com a classe SqlConnectionStringBuilder:</p>
<p><code>String provider = "System.Data.SqlClient";<br />
String serverName = "localhost";<br />
String databaseName = "dbname";</code></p>
<p><code>SqlConnectionStringBuilder connBuilder = new SqlConnectionStringBuilder();<br />
connBuilder.DataSource = serverName;<br />
connBuilder.InitialCatalog = databaseName;</code></p>
<p><code>EntityConnectionStringBuilder efBuilder = new EntityConnectionStringBuilder();<br />
efBuilder.Provider = Provider;<br />
efBuilder.ProviderConnectionString = connBuilder.ToString();<br />
efBuilder.Metadata = @"*csdl, *ssdl, *msl";<br />
EntityConnection Connection = new EntityConnection(efBuilder.ToString());</code></p>
<p>O resto opera de forma bem igual √† uma SqlConnection, como os m√©todos Open, Close e BeginTransaction.</p>
<p>O <strong>EntityCommand</strong> tamb√©m trabalha como o SqlCommand. H√° os m√©todos CreateParameter, ExecuteNonQuery, ExecuteReader e ExecuteScalar, por exemplo, e todos eles funcionam como sugerido. Todos eles tamb√©m t√™m suas vers√µes Async, onde a √∫nica diferen√ßa √© a presen√ßa da propriedade CancellationToken.</p>
<p>H√° tamb√©m a classe <strong>EntityTransaction</strong>, que funciona tamb√©m de forma id√™ntica √† TransactionScope (explicada <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-1-3-implement-transactions/" target="_blank">aqui</a>).</p>
<h4>Fazendo Transa√ß√µes</h4>
<p>H√° duas op√ß√µes para se fazer transa√ß√µes diretamente.</p>
<p>A primeira √© usando a classe <strong>DbTransaction</strong>. Voc√™ a obt√©m pelo DbContext, no m√©todo Database.Connection.BeginTransaction():</p>
<p><code>EntityFrameworkSamplesEntities Context = new EntityFrameworkSamplesEntities();<br />
IDbTransaction TransactionInstance = Context.Database.Connection.BeginTransaction();<br />
try<br />
{<br />
 // Do Something<br />
 Context.SaveChanges();<br />
 TransactionInstance.Commit();<br />
}<br />
catch (EntityCommandExecutionException)<br />
{<br />
 TransactionInstance.Rollback();<br />
}</code></p>
<p>O pr√≥ximo m√©todo, bem mais prov√°vel de se encontrar no exame, √© pela classe <strong>TransactionScope</strong>. A vantagem dela √© que voc√™ s√≥ precisa chamar o m√©todo Complete ap√≥s SaveChanges; n√£o √© necess√°rio nenhum tratamento especial em caso de falha:</p>
<p><code>EntityFrameworkSamplesEntities Context = new EntityFrameworkSamplesEntities();<br />
using (TransactionScope CurrentScope = new TransactionScope())<br />
{<br />
 try<br />
 {<br />
 Context.SaveChanges();<br />
 CurrentScope.Complete();<br />
 }<br />
 catch (EntityCommandExecutionException)<br />
 {<br />
 //Handle the exception as you normally would<br />
 //It won't be committed so transaction wise you're done<br />
 }<br />
 }</code></p>
<p>E isso √© tudo para esse objetivo üôÇ O pr√≥ximo post ser√° sobre o objetivo 2.3, <strong><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-3-query-data-by-using-linq-to-entities/">Query data by using LINQ to Entities</a></strong>.</p>
<p>At√© mais!</p>

				<p><a class="btn btn-default read-more" href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-2-query-and-manipulate-data-by-using-data-provider-for-entity-framework/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 2.2 ‚Äì Query and manipulate data by using Data Provider for Entity Framework">Leia Mais</a></p>

							</div><!-- .entry-content -->
					</div>
	</div>
</article><!-- #post-## -->

			
				
<article id="post-321" class="post-321 post type-post status-publish format-standard hentry category-certificacao tag-70-487">
	<div class="blog-item-wrap">
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-1-query-and-manipulate-data-by-using-the-entity-framework/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 2.1 ‚Äì Query and manipulate data by using the Entity Framework" >
			 				</a>
		<div class="post-inner-content">
			<header class="entry-header page-header">

				<h1 class="entry-title"><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-1-query-and-manipulate-data-by-using-the-entity-framework/" rel="bookmark">Certifica√ß√£o Microsoft 70-487: Objetivo 2.1 ‚Äì Query and manipulate data by using the Entity Framework</a></h1>

								<div class="entry-meta">
					<span class="posted-on"><i class="fa fa-calendar"></i> <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-1-query-and-manipulate-data-by-using-the-entity-framework/" rel="bookmark"><time class="entry-date published" datetime="2016-01-15T03:01:48+00:00">15/01/2016</time><time class="updated" datetime="2016-03-01T16:56:36+00:00">01/03/2016</time></a></span><span class="byline"> <i class="fa fa-user"></i> <span class="author vcard"><a class="url fn n" href="https://edneypitta.github.io/old-blog/author/admin/">Edney Pitta</a></span></span>				<span class="comments-link"><i class="fa fa-comment-o"></i><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-1-query-and-manipulate-data-by-using-the-entity-framework/#respond"><span class="dsq-postid" data-dsqidentifier="321 https://edneypitta.github.io/old-blog/?p=321">Deixe um coment√°rio</span></a></span>
				
				
				</div><!-- .entry-meta -->
							</header><!-- .entry-header -->

						<div class="entry-content">

				<p>Ol√° pessoal! Esse ser√° o post do primeiro objetivo do segundo grande t√≥pico da certifica√ß√£o, o <strong>Querying and manipulating data by using the Entity Framework</strong>. Esse t√≥pico foca especificamente em LINQ e Entity Framework e cobre aproximadamente 20% das quest√µes do exame. Esse primeiro objetivo, <em>Query and manipulate data by using the Entity Framework</em> (que recebe quase o mesmo nome do t√≥pico), cobre aspectos espec√≠ficos do EF e os componentes que o comp√µe. Vamos l√°?</p>
<h2>Fazendo Queries, Updates e Deletes Usando DbContext</h2>
<p>Fazer queries usando DbContext √© bem direto e simples, usando LINQ:</p>
<p><code>var query = (from acct in context.Accounts<br />
 where acct.AccountAlias == "Primary"<br />
 select acct).FirstOrDefault();</code></p>
<p>Ap√≥s uma entidade ser retornada de uma query, voc√™ pode interagir com o objeto como qualquer outro. Voc√™ faz quaisquer modifica√ß√µes necess√°rias e chama o m√©todo SaveChanges do context para fazer um update das informa√ß√µes alteradas.</p>
<p>√â poss√≠vel tamb√©m atualizar um item que voc√™ criou usando o m√©todo Add ou Attach e chamando o mesmo m√©todo SaveChanges para persistir as altera√ß√µes. √â importante entender bem a diferen√ßa entre os dois m√©todos: incluir uma entidade usando Add faz o item ter o EntityState como <em>Added</em>. Pelo objeto n√£o ter valores originais no ObjectStateEntry, quando SaveChanges √© chamado, o contexto vai tentar <strong>inserir</strong> a entidade no banco de dados. Attach, por outro lado, cria o item com o EntityState <em>Unchanged</em>. Ent√£o o momento que voc√™ faz o Attach √© muito importante. Se voc√™ fizer depois de todas as altera√ß√µes, <strong>nada vai acontecer</strong>, pois o EntityState vai continuar como Unchanged. Se voc√™ fizer o Attach e depois fazer as modifica√ß√µes na entidade, a√≠ sim o context vai fazer o update das propriedades no banco na chamada do SaveChanges.</p>
<p>Para deletar uma entidade do banco, voc√™ deve especificar o tipo da entidade usando o m√©todo Set e depois chamar o m√©todo Remove passando uma query. O item ser√° deletado ap√≥s a chamada ao SaveChanges.</p>
<p><code>context.Set<Account>().Remove(query);</code></p>
<h2>Deferred Execution e Lazy Loading</h2>
<p>Esse assunto pode ser bem extenso, por isso vamos simplificar bastante aqui.</p>
<p>Veja o seguinte c√≥digo:</p>
<p><code>var query = from acct in context.Accounts<br />
 where acct.AccountAlias == "Primary"<br />
 select acct;</code></p>
<p>Suponha que no banco de dados h√° 20 registros com o nome da conta Primary. √â l√≥gico pensar que na pr√≥xima linha o count da query ser√° 20, certo? <strong>Errado</strong>. Nesse ponto, nada aconteceu em termos de banco de dados. A ess√™ncia de <em>Deferred Execution</em> (execu√ß√£o adiada) √© que somente quando voc√™ pede o dado, explicitamente referenciando-o, que o acesso ao banco de dados √© de fato feito. O c√≥digo abaixo, por exemplo, potencialmente dispara muitas idas ao banco de dados:</p>
<p><code>var query = from acct in Context.Accounts<br />
 where acct.AccountAlias == "Primary"<br />
 select acct;<br />
foreach (var currentAccount in query)<br />
{<br />
 Console.WriteLine("Current Account Alias: {0}", currentAccount.AccountAlias);<br />
}</code></p>
<p>J√° o c√≥digo abaixo, por exemplo, ao inv√©s de retornar uma cole√ß√£o de itens, retorna somente um valor (count). Como √© imposs√≠vel obter esse valor sem ir ao banco de dados, ao chamar Count (ou qualquer fun√ß√£o Aggregate como Average e Max), o acesso ao banco de dados √© feito imediatamente:</p>
<p><code>var query = (from acct in context.Accounts<br />
 where acct.AccountAlias == "Primary"<br />
 select acct).Count();</code></p>
<p>Resumindo: no conceito de Deferred Execution, usado pelo EF, dados s√≥ s√£o recuperados quando necess√°rio.</p>
<p>O Lazy Loading √© um conceito parecido com o Deferred Execution, mas aplicado para relacionamentos no banco de dados. </p>
<p>Imagine uma estrutura onde um Bank tem v√°rios Customers, um Customer tem v√°rias Accounts, uma Account tem v√°rias Transactions e uma Transaction tem v√°rias TransactionDetails. Ao obter um Customer para uma atualiza√ß√£o simples de dados, voc√™ iria querer que todas as Accounts (com todas as Transactions e as TransactionsDetails) fossem retornadas? Provavelmente n√£o.</p>
<p>As op√ß√µes de Loading s√£o:</p>
<ul>
<li><strong>Lazy Loading</strong>: quando uma query √© executada, somente os dados da entidade alvo s√£o retornados. Por exemplo, se houver um relacionamento entre Account e Contact, uma query para Account retornaria inicialmente os dados da Account. Informa√ß√µes da Contact associada seriam retornadas quando uma NavigationProperty fosse acessada ou se voc√™ explicitamente pedisse;</li>
<li><strong>Eager Loading</strong>: todos os dados relacionados s√£o retornados. Nesse exemplo, ao fazer uma query para uma Account, os dados da Contact j√° seriam retornados. Essencialmente, √© o oposto de Lazy Loading;</li>
<li><strong>Explicit Loading</strong>: quando Lazy Loading est√° desabilitado, voc√™ pode us√°-lo para carregar entidades de forma Lazy explicitamente. O m√©todo Load permite que voc√™ execute queries individualmente.</li>
</ul>
<p>Voc√™ pode achar que Lazy Loading sempre √© a melhor op√ß√£o, mas n√£o se engane. Se voc√™ <strong>sabe </strong> quais dados vai usar, o Lazy Loading pode afetar a performance por fazer v√°rias idas as banco de dados ao inv√©s de uma. Se por outro lado voc√™ n√£o tiver certeza do n√∫mero de requisi√ß√µes ao banco de dados e provavelmente n√£o vai utilizar todos os dados retornados, a√≠ sim o Lazy Loading √© a melhor op√ß√£o.</p>
<p>√â poss√≠vel habilitar ou desabilitar o Lazy Loading visualmente ou por c√≥digo. Pelo Designer, basta ir ao EF Model, depois Properties, e escolher True ou False na propriedade Lazy Loading Enabled. Por c√≥digo, o DbContext possui uma propriedade Configuration.LazyLoadingEnabled: <code>context.Configuration.LazyLoadingEnabled = true;</code>.</p>
<p>D√™ uma olhada no c√≥digo abaixo:</p>
<p><script src="https://gist.github.com/edneypitta/d7d52d6753dfed406347.js"></script></p>
<p>Se voc√™ colocar um breakpoint na linha do primeiro foreach, vai perceber bem a diferen√ßa do Lazy Loading. Caso esteja desabilitado, toda a cascata de relacionamento ser√° carregada na primeira ida ao banco de dados. Caso habilitado, voc√™ vai notar que as propriedades Customers, Transactions e TransactionDetails n√£o ser√£o carregadas. Elas ir√£o sendo carregadas conforme forem usadas (foreach). Algumas outras opera√ß√µes tamb√©m fazem com que os relacionamentos sejam carregados, como ToList, ToArray ou ToDictionary.<br />
√â importante notar tamb√©m que se uma fun√ß√£o Aggregate for chamada, uma query ser√° executada imediatamente para retornar aquele valor. Ent√£o se voc√™ chamar o m√©todo Count de query.Customers e depois iterar pela lista (foreach), duas chamadas ao banco de dados ser√£o feitas. Iterando primeiro (ou chamando o m√©todo ToList), voc√™ j√° saberia o tamanho da lista e n√£o seriam necess√°rias duas chamadas.</p>
<h2>Criando Compiled Queries</h2>
<p>Usando LINQ, o EF cuida de traduzir a query para a linguagem SQL em tempo de execu√ß√£o, o que leva algum tempo. Por isso, o EF suporta <em>compiled queries</em>, onde ele cacheia o SQL de uma determinada query e somente muda os par√¢metros na hora de execut√°-la. A partir do .NET 4.5, isso √© feito automaticamente, mas voc√™ pode ainda fazer esse processo manualmente:</p>
<p><code>static readonly Func<MyObjectContext, string, Person> compiledQuery =<br />
            CompiledQuery.Compile<MyObjectContext, string, Person>(<br />
                (ctx, email) => (from p in ctx.People<br />
                                 where p.EmailAddress == email<br />
                                 select p).FirstOrDefault());</code></p>
<p>E usar a query assim: <code>Person p = compiledQuery.Invoke(context, "foo@bar");</code>. √â importante o m√©todo ser est√°tico para evitar a compila√ß√£o a cada chamada. Outro ponto √© que se a query for modificada, o EF vai precisar recompil√°-la. Ent√£o o ganho de performance ser√° perdido se voc√™ adicionar um Count ou ToList numa query compilada.</p>
<h2>Usando Entity SQL</h2>
<p>O EF permite que voc√™ execute queries SQL diretamente no DbContext, com todo o conhecimento do seu model. Outro benef√≠cio √© o maior controle sobre a query SQL que ser√° executada no banco de dados. Voc√™ pode fazer uso do Entity Framework Object Services assim:</p>
<p><code>var queryString = "SELECT VALUE p " +<br />
 "FROM MyEntities.People AS p " +<br />
 "WHERE p.FirstName='John'";<br />
ObjectQuery<Person> people = context.CreateQuery<Person>(queryString);</code></p>
<p>Outro cen√°rio √© quando voc√™ n√£o precisa do objeto inteiro ou quer trabalhar somente com os valores retornados para ganho de performance. Isso √© efetuado atrav√©s da classe EntityDataReader, bem parecida com a classe DataReader do System.Data. Segue um c√≥digo de exemplo:</p>
<p><script src="https://gist.github.com/edneypitta/6a77be2cfb173d51c053.js"></script></p>
<p>Isso √© tudo para esse objetivo. Obrigado pela leitura e fique de olho no pr√≥ximo post, que ser√° sobre o objetivo 2.2 da certifica√ß√£o Microsoft 70-487: <strong><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-2-query-and-manipulate-data-by-using-data-provider-for-entity-framework/">Query and manipulate data by using Data Provider for Entity Framework</a></strong>.</p>
<p>At√© mais!</p>

				<p><a class="btn btn-default read-more" href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-1-query-and-manipulate-data-by-using-the-entity-framework/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 2.1 ‚Äì Query and manipulate data by using the Entity Framework">Leia Mais</a></p>

							</div><!-- .entry-content -->
					</div>
	</div>
</article><!-- #post-## -->

			
				
<article id="post-298" class="post-298 post type-post status-publish format-standard hentry category-certificacao tag-70-487">
	<div class="blog-item-wrap">
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-1-6-manipulate-xml-data-structures/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 1.6 ‚Äì Manipulate XML data structures" >
			 				</a>
		<div class="post-inner-content">
			<header class="entry-header page-header">

				<h1 class="entry-title"><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-1-6-manipulate-xml-data-structures/" rel="bookmark">Certifica√ß√£o Microsoft 70-487: Objetivo 1.6 ‚Äì Manipulate XML data structures</a></h1>

								<div class="entry-meta">
					<span class="posted-on"><i class="fa fa-calendar"></i> <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-1-6-manipulate-xml-data-structures/" rel="bookmark"><time class="entry-date published" datetime="2016-01-14T01:06:12+00:00">14/01/2016</time><time class="updated" datetime="2016-03-01T16:56:32+00:00">01/03/2016</time></a></span><span class="byline"> <i class="fa fa-user"></i> <span class="author vcard"><a class="url fn n" href="https://edneypitta.github.io/old-blog/author/admin/">Edney Pitta</a></span></span>				<span class="comments-link"><i class="fa fa-comment-o"></i><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-1-6-manipulate-xml-data-structures/#respond"><span class="dsq-postid" data-dsqidentifier="298 https://edneypitta.github.io/old-blog/?p=298">Deixe um coment√°rio</span></a></span>
				
				
				</div><!-- .entry-meta -->
							</header><!-- .entry-header -->

						<div class="entry-content">

				<p>Ol√° pessoal! </p>
<p>Continuando a <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-developing-microsoft-azure-and-web-services/" target="_blank">s√©rie sobre a certifica√ß√£o Microsoft 70-487</a>, esse post ser√° sobre o objetivo 1.6, <em>Manipulate XML data structures</em>, o √∫ltimo do primeiro t√≥pico da certifica√ß√£o, <em>Accessing data</em>. Vamos l√°?</p>
<h2>Lendo, Filtrando, Criando e Modificando Estruturas XML</h2>
<p>XML √© um arquivo que estrutura dados em formato de texto baseado em elementos e atributos. Elementos s√£o estruturas que representam um componente de dados, enquanto atributos s√£o propriedades dos elementos.</p>
<p>O primeiro componente de um documento XML √© o <em>XML declaration</em>. Esse elemento n√£o √© obrigat√≥rio e geralmente inclui a vers√£o do XML e o encoding:</p>
<p><code>&lt;?xml version="1.0" encoding="utf-8" ?&gt;</code> </p>
<p>Um XML v√°lido tem os seguintes requerimentos:</p>
<ul>
<li>Deve ter somente um elemento raiz;</li>
<li>Elementos que s√£o abertos devem ser fechados na ordem que foram abertos;</li>
<li>Todos os elementos precisam ser v√°lidos ou bem formados.</li>
</ul>
<p>Considere o seguinte XML. Name, FirstName, MiddleInitial e LastName s√£o elementos, enquanto MiddleName √© um atributo do elemento MiddleInitial:</p>
<p><code>&lt;?xml version="1.0" encoding="utf-8" ?&gt;<br />
&lt;Name&gt;<br />
 &lt;FirstName&gt;John&lt;/FirstName&gt;<br />
 &lt;MiddleInitial MiddleName="Quartz"&gt;Q&lt;/MiddleInitial&gt;<br />
 &lt;LastName&gt;Public&lt;/LastName&gt;<br />
&lt;/Name&gt;</code></p>
<p>Existem mais dois elementos que voc√™ deve conhecer para o exame: coment√°rios e namespaces. Coment√°rios s√£o definidos dessa forma:</p>
<p><code>&lt;!-- this is a comment about the Name element. Blah blah blah--&gt;</code></p>
<p>Namespaces servem para identificar quem escreveu o XML, geralmente uma empresa. Voc√™ pode definir o namespace no elemento raiz como o seguinte:</p>
<p><code>xmlns:Prefix="SomeValueUsuallyACompanyUrl"</code></p>
<p><em>xmlns</em> √© a abrevia√ß√£o de XML NameSpace. </p>
<p>Voc√™ pode definir tamb√©m dois namespaces no elemento raiz. Isso √© √∫til quando duas ou mais pessoas (ou empresas) est√£o escrevendo o mesmo XML, talvez com elementos com o mesmo nome. Por exemplo:</p>
<p><code>&lt;DocumentCore xmlns:johnco=&quot;http://www.yourcompany.com/Companies&quot; xmlns:billco=&quot;http://<br />www.mycompany.com/Customers&quot;&gt;<br /> &lt;johnco:Name&gt;<br /> &lt;johnco:Company&gt;JohnCo&lt;/johnco:Company&gt;<br /> &lt;/johnco:Name&gt;<br /> &lt;billco:Name&gt;<br /> &lt;billco:FirstName&gt;John&lt;/billco:FirstName&gt;<br /> &lt;billco:MiddleInitial&gt;Q&lt;/billco:MiddleInitial&gt;<br /> &lt;billco:LastName&gt;Public&lt;/billco:LastName&gt;<br /> &lt;/billco:Name&gt;<br />&lt;/DocumentCore&gt;</code></p>
<p>Outra op√ß√£o √© definir o namespace no n√≠vel de cada elemento:</p>
<p><code>&lt;DocumentCore&gt;<br /> &lt;johnco:Name xmlns:johnco=&quot;http://www.yourcompany.com/Companies&quot;&gt;<br /> &lt;johnco:Company&gt;JohnCo&lt;/johnco:Company&gt;<br /> &lt;/johnco:Name&gt;<br /> &lt;billco:Name xmlns:billco=&quot;http://www.mycompany.com/Customers&quot;&gt;<br /> &lt;billco:FirstName&gt;John&lt;/billco:FirstName&gt;<br /> &lt;billco:MiddleInitial&gt;Q&lt;/billco:MiddleInitial&gt;<br /> &lt;billco:LastName&gt;Public&lt;/billco:LastName&gt;<br /> &lt;/billco:Name&gt;<br />&lt;/DocumentCore&gt;</code></p>
<h2>Manipulando Dados em XML</h2>
<p>Para o exame, voc√™ deve se familiarizar com 5 classes que manipulam XML no .NET Framework: <em>XmlWriter</em>, <em>XmlReader</em>, <em>XmlDocument</em>, <em>XPath </em>e <em>LINQ-to-XML</em> (XElement e XDocument). O exame foca mais em LINQ-to-XML por ser mais recente e elegante, ent√£o d√™ aten√ß√£o especial a esse t√≥pico.</p>
<h4>XmlWriter</h4>
<p>XmlWriter √© uma classe f√°cil, antiga e intuitiva de se entender. Voc√™ obt√©m uma inst√¢ncia pelo m√©todo est√°tico Create passando um nome de arquivo e chama os m√©todos WriteStartDocument, WriteStartElement ou WriteElementString, WriteEndElement e WriteEndDocument. Entenda rapidamente como a classe funciona e o XML gerado:</p>
<p><script src="https://gist.github.com/edneypitta/50ab5e50be3fd99761bb.js"></script></p>
<p><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;<br />&lt;Customers&gt;<br /> &lt;Customer&gt;<br /> &lt;FirstName&gt;John&lt;/FirstName&gt;<br /> &lt;MiddleInitial&gt;Q&lt;/MiddleInitial&gt;<br /> &lt;LastName&gt;Public&lt;/LastName&gt;<br />&lt;/Customer&gt;<br />&lt;Customer&gt;<br /> &lt;FirstName&gt;Bill&lt;/FirstName&gt;<br /> &lt;MiddleInitial&gt;G&lt;/MiddleInitial&gt;<br /> &lt;LastName&gt;Ryan&lt;/LastName&gt;<br />&lt;/Customer&gt;<br />&lt;Customer&gt;<br /> &lt;FirstName&gt;William&lt;/FirstName&gt;<br /> &lt;MiddleInitial&gt;G&lt;/MiddleInitial&gt;<br /> &lt;LastName&gt;Gates&lt;/LastName&gt;<br /> &lt;/Customer&gt;<br />&lt;/Customers&gt;</code></p>
<h4>XmlReader</h4>
<p>XmlReader √© a contraparte do XmlWriter, e √© tamb√©m simples de usar. Voc√™ cria um XmlReader passando o nome do arquivo que quer ler, faz um while chamando o m√©todo Read e faz sua opera√ß√£o olhando para a propriedade NodeType. Uma r√°pida olhada no c√≥digo vai deixar as coisas mais claras:</p>
<p><script src="https://gist.github.com/edneypitta/c881dedae77fc5f78f09.js"></script></p>
<h4>XmlDocument</h4>
<p>XmlDocument √© o &#8220;pai&#8221; dos antigos XmlWriter e XmlReader, ainda mais f√°cil de usar. Para ler um XML, voc√™ instancia um novo XmlDocument, chama o m√©todo Load apontando para um arquivo ou stream, extrai a lista de nodos (elementos) e itera por eles.</p>
<p><script src="https://gist.github.com/edneypitta/fec394611dd3a2df0d28.js"></script></p>
<p>Para escrever um arquivo XML, basta criar elementos com o m√©todo CreateElement e dar AppendChild neles, respeitando a regra de que os elementos abertos primeiro devem ser fechados por √∫ltimo.</p>
<p><script src="https://gist.github.com/edneypitta/aedd2a9c8c8acccd1770.js"></script></p>
<h4>XPath</h4>
<p>XPath, que significa XML Path Language, √© um tipo de query para documentos XML. Voc√™ obt√©m a classe XPathNavigator chamando o m√©todo CreateNavigator de um XmlDocument. </p>
<p>Considere o seguinte XML:</p>
<p><code>&lt;?xml&#x00a0;version=&quot;1.0&quot;&#x00a0;encoding=&quot;utf-8&quot;&#x00a0;?&gt;<br />&lt;People&gt;<br />&#x00a0;&#x00a0;&lt;Person&#x00a0;firstName=&quot;John&quot;&#x00a0;lastName=&quot;Doe&quot;&gt;<br />&#x00a0;&#x00a0;&#x00a0;&#x00a0;&lt;ContactDetals&gt;<br />&#x00a0;&#x00a0;&#x00a0;&#x00a0;&#x00a0;&#x00a0;&lt;EmailAddress&gt;john@unknown.com&lt;/EmailAddress&gt;<br />&#x00a0;&#x00a0;&#x00a0;&#x00a0;&lt;/ContactDetals&gt;<br />&#x00a0;&#x00a0;&lt;/Person&gt;<br />&#x00a0;&#x00a0;&lt;Person&#x00a0;firstName=&quot;Jane&quot;&#x00a0;lastName=&quot;Doe&quot;&gt;<br />&#x00a0;&#x00a0;&#x00a0;&#x00a0;&lt;ContactDetals&gt;<br /> &#x00a0;&#x00a0;&#x00a0;&#x00a0;&#x00a0;&lt;EmailAddress&gt;jane@unknown.com&lt;/EmailAddress&gt;<br />&#x00a0;&#x00a0;&#x00a0;&#x00a0;&#x00a0;&#x00a0;&lt;PhoneNunmber&gt;001122334455&lt;/PhoneNunmber&gt;<br />&#x00a0;&#x00a0;&#x00a0;&#x00a0;&lt;/ContactDetals&gt;<br />&#x00a0;&#x00a0;&lt;/Person&gt;<br />&lt;/People&gt;</code></p>
<p>Para obter os elementos Person pelo firstName, voc√™ usaria o seguinte c√≥digo:</p>
<p><script src="https://gist.github.com/edneypitta/e37b577bfd3564176a98.js"></script></p>
<h4>LINQ-to-XML</h4>
<p>LINQ-to-XML ser√° bastante coberto no exame pois usa bastante os recursos modernos do .NET Framework como m√©todo an√¥nimos, gen√©ricos, tipos nullable e a sem√¢ntica de query LINQ. √â bem importante que voc√™ conhe√ßa bem a sintaxe do LINQ para o exame como um todo.</p>
<p>As classes est√£o no namespace System.Xml.Linq. Uma das mais importantes √© a classe <em>XElement</em>, que tem 5 construtores:</p>
<ul>
<li>public XElement(XName someName);
</li>
<li>public XElement(XElement someElement);
</li>
<li>public XElement(XName someName, Object someValue);
</li>
<li>public XElement(XName someName, params Object[] someValueset);
</li>
<li>public XElement(XStreamingElement other);<br />
/li>
</ul>
<p>Lembra de como voc√™ cria um elemento Customer dentro de Customers com XmlDocument? Veja como se faz com XElement:</p>
<p><code>XElement customers = new XElement("Customers", new XElement("Customer",<br />
 new XElement("FirstName", "John"), new XElement("MiddleInitial", "Q"),<br />
 new XElement("LastName", "Public")));</code></p>
<p>Outra vantagem √© que XElement faz o escape automaticamente de caracteres usados na sem√¢ntica do XML como &lt;, &gt; e &amp;.</p>
<p>H√° tamb√©m a classe <em>XDocument</em>, que representa o documento XML por inteiro. Ela cont√©m as seguintes caracter√≠sticas:</p>
<ul>
<li>Um objeto <em>XDeclaration </em>quer permite a especifica√ß√£o da vers√£o do XML e do encoding;</li>
<li>Um objeto XElement que serve como raiz;</li>
<li>Objetos de <em>XProcessingInstruction</em> que representam instru√ß√µes de processamento do XML;</li>
<li>Objetos de <em>XComment</em> que representam coment√°rios.</li>
</ul>
<p>Voc√™ pode instanciar um XAttribute da seguinte forma: <code>XAttribute sampleAttribute = new XAttribute("FirstName", "John");</code>.</p>
<p>Namespaces, representados pela classe <em>XNamespace </em>, s√£o usados assim:</p>
<p><code>XNamespace billCo = "http://www.billco.com/Samples";<br />
XElement firstNameBillCo = new XElement(billCo + "FirstName", "John");</code></p>
<p>As coisas come√ßam a ficar mais dif√≠ceis nas queries com LINQ, e isso √© uma coisa que &#8220;can&#8217;t be emphasized enough&#8221;: √© <strong>muito</strong> importante saber LINQ e suas nuances, n√£o s√≥ para esse objetivo.</p>
<p>Uma caracter√≠stica √© entender a diferen√ßa entre os m√©todos <em>Descendants </em>e <em>Elements </em>de um XContainer. Considere o seguinte c√≥digo:</p>
<p><script src="https://gist.github.com/edneypitta/afa484f80b713478bb5b.js"></script></p>
<p>O output de ambos os casos √© 3. Inicialmente eles podem parecer id√™nticos, mas eles t√™m uma grande diferen√ßa. O m√©todo Descendants nesse caso procura por elementos Customer em <strong>qualquer n√≠vel abaixo do XContainer que o chamou</strong>, nesse exemplo o Root. J√° o Elements procura por elementos Customer apenas <strong>um n√≠vel abaixo do XContainer</strong>. Nesse caso ele encontra os tr√™s elementos Customer pois o Root √© o elemento Customers. Se a estrutura fosse como abaixo, por exemplo, o m√©todo Elements n√£o encontraria nenhum elemento Customer:</p>
<p><code>&lt;Root&gt;<br />&lt;Customers&gt;<br />&lt;Customer&gt;&lt;FirstName&gt;John&lt;/FirstName&gt;&lt;/Customer&gt;<br /> &lt;Customer&gt;&lt;FirstName&gt;Bill&lt;/FirstName&gt;&lt;/Customer&gt;<br /> &lt;Customer&gt;&lt;FirstName&gt;Joe&lt;/FirstName&gt;&lt;/Customer&gt;<br />&lt;/Customers&gt;<br />&lt;/Root&gt;</code></p>
<h4>Manipula√ß√£o Avan√ßada de XML</h4>
<p>Nessa se√ß√£o do objetivo, a ideia √© ter mais quest√µes de manipula√ß√µes e queries com LINQ-to-XML. </p>
<p>Um ponto a destacar √© que voc√™ deve conhecer a classe <em>XmlConvert</em> para dar escape de caracteres especiais se voc√™ n√£o estiver usando uma classe que faz isso para voc√™, como XElement. XmlConvert √© irm√£ da classe Convert, focada para XML. Ela automaticamente faz o escape de caracteres reservados e prov√™ v√°rios m√©todos de convers√£o para arquivos XML. </p>
<p>A lista abaixo cont√©m os m√©todos n√£o √≥bvios como ToInt32, ToDateTime, etc. e seus comportamentos:</p>
<ul>
<li><strong>DecodeName</strong>: faz o decode de um nome encodado;</li>
<li><strong>EncodeName</strong>: faz o encode de uma string para que possa ser usada como um nome de nodo XML;</li>
<li><strong>EncodeLocalName</strong>: faz o mesmo de EncodeName, com uma diferen√ßa: encoda tamb√©m o caracter &#8220;:&#8221;, assegurando que o nome pode ser usado em elementos que contenham namespace;</li>
<li><strong>EncodeNmToken</strong>: retorna um nome v√°lido para um nodo de acordo com a <em>XML Language Spec</em>;</li>
<li><strong>IsStartNCNameChar</strong>: determina se o par√¢metro n√£o √© o caracter &#8220;:&#8221;;</li>
<li><strong>IsPublicIdChar</strong>: determina se o par√¢metro √© um identificador XML p√∫blico (algumas magic strings que existem por legado);</li>
<li><strong>ToDateTimeOffset</strong>: converte para DateTimeOffset, um DateTime com identificador em rela√ß√£o ao UTC.</li>
</ul>
<p>Segue um c√≥digo de aplica√ß√£o dos m√©todos mais relevantes da classe XmlConvert (DecodeName, EncodeName e EncodeLocalName):</p>
<p><script src="https://gist.github.com/edneypitta/f7c1bfb759cc0d8bce0a.js"></script></p>
<p>Um √∫ltimo ponto desse objetivo como um todo √© que voc√™ pode usar diferentes classes do .NET Framework para lidar com o mesmo XML. Voc√™ pode juntar implementa√ß√µes onde julgar necess√°rio; usar uma metodologia n√£o te for√ßa a us√°-la at√© o fim.</p>
<p>Esse foi o √∫ltimo objetivo do primeiro grande t√≥pico da certifica√ß√£o, <em>Accessing Data</em>. O pr√≥ximo post ser√° sobre o primeiro objetivo do segundo t√≥pico da certifica√ß√£o, <strong><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-1-query-and-manipulate-data-by-using-the-entity-framework/">Querying and manipulating data by using the Entity Framework</a></strong>.</p>
<p>Obrigado pela leitura e at√© mais!</p>

				<p><a class="btn btn-default read-more" href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-1-6-manipulate-xml-data-structures/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 1.6 ‚Äì Manipulate XML data structures">Leia Mais</a></p>

							</div><!-- .entry-content -->
					</div>
	</div>
</article><!-- #post-## -->

			
				
<article id="post-285" class="post-285 post type-post status-publish format-standard hentry category-certificacao tag-70-487">
	<div class="blog-item-wrap">
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-1-5-create-and-implement-wcf-data-services-service/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 1.5 ‚Äì Create and implement a WCF Data Services service" >
			 				</a>
		<div class="post-inner-content">
			<header class="entry-header page-header">

				<h1 class="entry-title"><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-1-5-create-and-implement-wcf-data-services-service/" rel="bookmark">Certifica√ß√£o Microsoft 70-487: Objetivo 1.5 ‚Äì Create and implement a WCF Data Services service</a></h1>

								<div class="entry-meta">
					<span class="posted-on"><i class="fa fa-calendar"></i> <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-1-5-create-and-implement-wcf-data-services-service/" rel="bookmark"><time class="entry-date published" datetime="2016-01-13T01:05:30+00:00">13/01/2016</time><time class="updated" datetime="2016-03-01T16:56:26+00:00">01/03/2016</time></a></span><span class="byline"> <i class="fa fa-user"></i> <span class="author vcard"><a class="url fn n" href="https://edneypitta.github.io/old-blog/author/admin/">Edney Pitta</a></span></span>				<span class="comments-link"><i class="fa fa-comment-o"></i><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-1-5-create-and-implement-wcf-data-services-service/#respond"><span class="dsq-postid" data-dsqidentifier="285 https://edneypitta.github.io/old-blog/?p=285">Deixe um coment√°rio</span></a></span>
				
				
				</div><!-- .entry-meta -->
							</header><!-- .entry-header -->

						<div class="entry-content">

				<p>A discuss√£o sobre WCF Data Services no <a href="https://edneypitta.github.io/old-blog/certificao-microsoft-70-487-objetivo-1-1-choose-data-access-technologies-parte-3-wcf-data-services/" target="_blank">objetivo 1.1</a> foi curta porque h√° um objetivo espec√≠fico para ele, o Create and implement a WCF Data Services service, que ser√° coberto nesse post. </p>
<p>Esse objetivo cobre como endere√ßar recursos, criar uma query, acessar formatos de carga (incluindo JSON) e trabalhar com interceptores e operadores de servi√ßo. Vamos l√°?</p>
<h2>Endere√ßando Recursos</h2>
<p>Para criar um WCF Data Service, basicamente voc√™ deve seguir os seguintes passos:</p>
<ul>
<li>Criar uma aplica√ß√£o ASP.NET (para hostear o Data Service);</li>
<li>Usar o EF para criar seu EntityModel;</li>
<li>Adicionar um WCF Data Service;</li>
<li>Especificar um tipo para o servi√ßo (que √© o nome do model container do projeto do EF);</li>
<li>Habilitar acesso ao Data Service configurando explicitamente algumas propriedades do <em>DataServiceConfiguration</em> (SetEntitySetAccessRule, SetServiceOperationAccessRule e DataServiceBehavior)</li>
</ul>
<p>Quando voc√™ adicionar um WCF Data Service, voc√™ ver√° classes geradas assim: <code>public class ExamSampleService : DataService<Nome do Model></code>. Essas classes herdam de <em> System.Data. Services.DataService</em>, que recebem um tipo gen√©rico. O c√≥digo gerado ter√° tamb√©m o m√©todo <em>InitializeService</em> com alguns coment√°rios que ajudam na sua configura√ß√£o:</p>
<p><code>// This method is called only once to initialize service-wide policies.<br />
public static void InitializeService(DataServiceConfiguration config) {<br />
// TODO: set rules to indicate which entity sets and service operations are visible, updatable, etc.<br />
// Examples:<br />
// config.SetEntitySetAccessRule("MyEntityset", EntitySetRights.AllRead);<br />
// config.SetServiceOperationAccessRule("MyServiceOperation", ServiceOperationRights.All);  config.DataServiceBehavior.MaxProtocolVersion = DataServiceProtocolVersion.V2;<br />
}</code></p>
<p>Como j√° citado, √© importante se familiarizar com os m√©todos <em>SetEntitySetAccessRule </em>e <em>SetServiceOperationAccessRule </em>e a propriedade <em>DataServiceBehavior.MaxProtocolVersion</em>.</p>
<h4>SetEntitySetAccessRule</h4>
<p>Esse m√©todo recebe dois par√¢metros: uma string com o nome do EntitySet e um enum EntitySetRights. Como o enum √© decorado com Flags, voc√™ pode passar mais de um valor dessa forma: <code>config.SetEntitySetAccessRule("Courses", EntitySetRights.AllRead | EntitySetRights.WriteMerge);</code>. Os poss√≠veis valores desse enum s√£o:</p>
<ul>
<li><strong>None</strong>: todos os acessos s√£o revogados;</li>
<li><strong>ReadSingle</strong>: um item pode ser lido;</li>
<li><strong>ReadMultiple</strong>: sets de dados podem ser lidos;</li>
<li><strong>WriteAppend</strong>: novos itens podem ser adicionados;</li>
<li><strong>WriteReplace</strong>: dados podem ser atualizados;</li>
<li><strong>WriteDelete</strong>: dados podem ser deletados;</li>
<li><strong>WriteMerge</strong>: dados podem ser mergeados;</li>
<li><strong>AllRead</strong>: tudo pode ser lido;</li>
<li><strong>AllWrite</strong>: tudo pode ser escrito;</li>
<li><strong>All</strong>: todas as opera√ß√µes s√£o permitidas.</li>
</ul>
<h4>SetServiceOperationAccessRule</h4>
<p>Esse m√©todo d√° permiss√µes para uma ServiceOperation e funciona da mesma forma que o m√©todo SetEntitySetAccessRule, mas o enum √© um ServiceOperationRights. Os valores desse enum s√£o:</p>
<ul>
<li><strong>None</strong>: todos os acessos s√£o revogados;</li>
<li><strong>ReadSingle</strong>: um item pode ser lido;</li>
<li><strong>ReadMultiple</strong>: sets de dados podem ser lidos;</li>
<li><strong>AllRead</strong>: um e v√°rios itens podem ser lidos;</li>
<li><strong>All</strong>: todos os direitos s√£o garantidos;</li>
<li><strong>OverrideEntitySetRights</strong>: indica se sobrescreve os valores configurados em SetEntitySetAccessRule.</li>
</ul>
<h4>DataServiceBehavior.MaxProtocolVersion</h4>
<p>Essa propriedade indica qual vers√£o do protocolo OData ser√° usado no servi√ßo. Os poss√≠veis valores do enum DataServiceProtocolVersion s√£o V1 e V2.</p>
<h2>Criando Uma Query</h2>
<p>Uma das principais vantagens do WCF Data Services √© que seus recursos s√£o endere√ß√°veis por URIs via OData, e voc√™ pode fazer queries nas URIs de uma forma bem simples.</p>
<p>Suponha que voc√™ criou um WCF Data Service com o nome ExamPrepService baseado num Entity Model que tem t√≥picos, quest√µes e respostas como entidades.</p>
<p>Para obter todos os registros de uma entidade, a query <em>Service/EntitySetName</em> pode ser usada. Para obter todos os t√≥picos do servi√ßo, por exemplo, a seguinte query pode ser usada:<br />
<code>http://servicehost/ExamPrepService.svc/Topics</code></p>
<p>A query <em>Service/EntitySetName(&#8216;KeyValue&#8217;)</em> retorna a entidade que tem uma key com o valor passado. Por exemplo, para obter o t√≥pico que tem o nome First, a query fica <code>http://servicehost/ExamPrepService.svc/Topics('First')</code>.</p>
<p>Se voc√™ precisa somente da propriedade Description, a query fica <code>http://servicehost/ExamPrepService.svc/Topics('First')/Description</code>. Se quiser somente o valor primitivo e n√£o o XML, basta adicionar /$value no final: <code>http://servicehost/ExamPrepService.svc/Topics('First')/Description/$value</code>.</p>
<p>As queries funcionam bem com relacionamentos, se esses estiverem definidos no Entity Model. Para obter todas as Answers da Question com a key 1, por exemplo, a seguinte query deve ser usada:<br />
<code>http://servicehost/ExamPrepService.svc/Questions('1')/Answers</code></p>
<p>O caminho inverso tamb√©m √© poss√≠vel: <code>http://servicehost/ExamPrepService.svc/Answers('1:4')/Question</code>.</p>
<p>At√© agora, s√≥ filtramos os resultados pela key da entidade. Mas o protocolo OData e o WCF Data Service oferecem v√°rias op√ß√µes de query que se traduzem em queries SQL. √â bem importante entender o efeito de todos eles no resultado.</p>
<ul>
<li><strong>$orderby</strong>: define uma ordem para o resultado. Uma ou mais propriedades podem ser usadas, separadas por v√≠rgula: <code>/Questions?$orderby=Id,Description</code>;</li>
<li><strong>$top</strong>: define quantos resultados ser√£o retornados: <code>/Questions?$top=5</code></li>
<li><strong>$skip</strong>: indica quantos registros devem ser ignorados. Suponha que h√° 30 t√≥picos, mas voc√™ quer ignorar os 10 primeiros e os 10 √∫ltimos. A query fica assim: <code>/Questions?$skip=10&$top=10</code>;</li>
<li><strong>$filter</strong>: especifica uma ou mais condi√ß√µes: <code>/Questions?$filter=Id gt 5</code>;</li>
<li><strong>$expand</strong>: indica quais entidades relacionadas ser√£o retornadas: <code>/Questions?$expand=Answers</code>;</li>
<li><strong>$select</strong>: por padr√£o, todas as propriedades de uma entidade s√£o retornadas. Usando $select, voc√™ pode especificar quais propriedades ser√£o retornadas separando por v√≠rgula: <code>/Questions&$select=Id,Text,Description,Author</code>;</li>
<li><strong>$inlinecount</strong>: retorna o n√∫mero de registros retornados no elemento &lt;count&gt;: <code>/Questions?$inlinecount=allpages</code>.</li>
</ul>
<p>Voc√™ tamb√©m pode executar queries por meio de c√≥digo usando a classe <em>DataServiceQuery</em>:</p>
<p><code>String ServiceUri = "http://servicehost/ExamPrepService.svc";<br />
ExamServiceContext ExamContext = new ExamServiceContext(new Uri(ServiceUri); DataServiceQuery<Questions> = ExamContext.Question<br />
.AddQueryOptions("$filter", "id gt 5")<br />
.AddQueryOptions("$expand", "Answers");</code></p>
<h4>Acessando Formatos De Carga</h4>
<p>o WCF Data Service d√° suporte aos formatos Atom e JSON de forma f√°cil. </p>
<p>Basta usar a op√ß√£o $format na query com o valor atom ou json. Caso esteja consultando via WebClient ou queira especificar isso em um request header, funciona da mesma maneira. Para JSON, coloque o header Content-Type para <em>application/json</em>. Para Atom, <em>application/atom+xml</em>.</p>
<h4>Trabalhando Com Interceptor e Service Operator</h4>
<p>O WCF Data Service permite que voc√™ intercepte um request para prover uma l√≥gica customizada. </p>
<p>H√° dois tipos de Interceptors: <em>ChangeInterceptor</em>, que serve para interceptar opera√ß√µes NON-Query, e <em>QueryInterceptor</em>, que intercepta opera√ß√µes de Query.</p>
<p>ChangeInterceptors t√™m retorno nulo e aceitam dois par√¢metros: o tipo da entidade e um UpdateOperations, que referencia o request. A defini√ß√£o de um m√©todo ChangeInterceptor fica assim:</p>
<p><code>[ChangeInterceptor("Topics")]<br />
public void OnChangeTopics(Topic topic, UpdateOperations operations)<br />
</code></p>
<p>QueryInterceptors s√£o decorados com QueryInterceptor e retornam uma Expression<Func<T, Boolean>>, que servem como filtro para a entidade. A assinatura fica assim:</p>
<p><code>[QueryInterceptor("Topics")]<br />
public Expression<Func<Topic, bool>> FilterTopics(){}</code></p>
<p>A dica para o exame √© que, para identificar se um m√©todo √© ChangeInterceptor ou QueryInterceptor, basta olhar para o tipo do retorno.<br />
Para saber qual Interceptor deve ser implementado para fazer alguma coisa, √© necess√°rio saber o comportamento e determinar se √© uma opera√ß√£o NON-Query ou Query. Por exemplo, <em>DeleteTopics </em>seria um ChangeInterceptor; j√° um m√©todo <em>GetAdvancedTopics </em>seria um QueryInterceptor.</p>
<p>Qualquer d√∫vida, fique √† vontade para faz√™-la nos coment√°rios.<br />
Fique ligado para o post do pr√≥ximo objetivo, <strong><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-1-6-manipulate-xml-data-structures/">Manipulate XML data structures</a></strong>.</p>
<p>At√© mais!</p>

				<p><a class="btn btn-default read-more" href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-1-5-create-and-implement-wcf-data-services-service/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 1.5 ‚Äì Create and implement a WCF Data Services service">Leia Mais</a></p>

							</div><!-- .entry-content -->
					</div>
	</div>
</article><!-- #post-## -->

			
				
<article id="post-268" class="post-268 post type-post status-publish format-standard hentry category-certificacao tag-70-487">
	<div class="blog-item-wrap">
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-1-4-implement-data-storage-in-windows-azure/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 1.4 &#8211; Implement data storage in Windows Azure" >
			 				</a>
		<div class="post-inner-content">
			<header class="entry-header page-header">

				<h1 class="entry-title"><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-1-4-implement-data-storage-in-windows-azure/" rel="bookmark">Certifica√ß√£o Microsoft 70-487: Objetivo 1.4 &#8211; Implement data storage in Windows Azure</a></h1>

								<div class="entry-meta">
					<span class="posted-on"><i class="fa fa-calendar"></i> <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-1-4-implement-data-storage-in-windows-azure/" rel="bookmark"><time class="entry-date published" datetime="2016-01-10T16:59:54+00:00">10/01/2016</time><time class="updated" datetime="2016-03-01T16:55:54+00:00">01/03/2016</time></a></span><span class="byline"> <i class="fa fa-user"></i> <span class="author vcard"><a class="url fn n" href="https://edneypitta.github.io/old-blog/author/admin/">Edney Pitta</a></span></span>				<span class="comments-link"><i class="fa fa-comment-o"></i><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-1-4-implement-data-storage-in-windows-azure/#comments"><span class="dsq-postid" data-dsqidentifier="268 https://edneypitta.github.io/old-blog/?p=268">1 Coment√°rio</span></a></span>
				
				
				</div><!-- .entry-meta -->
							</header><!-- .entry-header -->

						<div class="entry-content">

				<p>Ol√° pessoal! Vamos ao primeiro (e um dos poucos) objetivo que fala de Azure na certifica√ß√£o de Azure, o Implement data storage in Windows Azure. Para acompanhar os objetivos j√° postados, <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-developing-microsoft-azure-and-web-services/" target="_blank">clique aqui</a>.</p>
<p>O primeiro t√≥pico desse objetivo √© sobre armazenamento de dados. Comparado com mecanismos de armazenamento de dados tradicionais, as solu√ß√µes do Azure oferecem um suporte bem parecido com o que j√° existe. Mas √© claro que coisas novas geram mudan√ßas, ainda mais com um paradigma mais recente que √© a nuvem. Por exemplo, acesso √† internet √© fundamental para que qualquer armazenamento no Azure funcione.</p>
<p>As op√ß√µes de armazenamento de dados no Azure s√£o: <strong>Local Storage</strong>; <strong>Blob</strong>, <strong>Table </strong>e <strong>Queue </strong>(fazendo parte do Windows Azure Storage); e <strong>SQL Database</strong>. Para o exame, √© bem prov√°vel que voc√™ encontre alguma pergunta onde um cen√°rio √© dado e voc√™ deve escolher quais desses itens resolveriam o problema. Vamos √†s explica√ß√µes b√°sicas: quando voc√™ ler v√≠deo, √°udio ou imagem, a pergunta est√° se tratando de Blob. Quando √© algum dado estruturado, pode ser Table ou SQL Database, se a estrutura for relacional. Queue se trata de garantir um mecanismo de envio de mensagens em fila. Local Storage √© um armazenamento tempor√°rio igual a um sistema de arquivos. Vamos nos aprofundar na implementa√ß√£o desses itens.</p>
<h2>Blob Storage</h2>
<p>A estrutura de Blob foi feita para armazenamento de dados bin√°rios, como os j√° mencionados v√≠deo, √°udio e imagem. √â poss√≠vel tamb√©m armazenar um arquivo Excel como bin√°rio sem nenhum problema. Um dos principais benef√≠cios √© que as informa√ß√µes s√£o acess√≠veis via HTTP. Basta ter a URL e voc√™ pode acessar uma imagem, por exemplo. Os arquivos podem ter o tamanho de at√© 100 TB. Acho que j√° deu para entender o conceito, mas as coisas ideais de serem armazenadas em Blob s√£o: imagens que podem ser vistas diretamente no browser, documentos, backups de banco de dados, v√≠deos e √°udios.</p>
<p>A estrutura do Blob funciona assim: no n√≠vel mais alto est√° a Storage Account. Dentro dela temos Containers e, dentro dos Containers, Blobs. H√° o limite de 100 TB em uma Storage Account, por√©m ela pode ter quantos Containers forem necess√°rios. Pense em um Container como um subdiret√≥rio para organizar os blobs (a diferen√ßa √© que Containers n√£o podem conter Containers). Um Blob √© um arquivo, sem restri√ß√£o de formato. H√° duas categorias de Blobs: Block (limite de 200 GB) e Page (limite de 1 TB).</p>
<p>Voc√™ pode acessar um Blob de duas formas. A primeira, como citado, √© por uma URL HTTP. A URL tem o seguinte formato: <em>http://<storage account name>.blob.core.windows.net/{container}/{blob}</em>. </p>
<p>A segunda maneira √© pela API do Azure SDK. Voc√™ deve adicionar uma refer√™ncia ao assembly <em>Microsoft.WindowsAzure.Storage.dll</em>. A Storage Account √© representada pela classe <em>CloudStorageAccount</em>. Para instanci√°-la, voc√™ pode usar um de seus dois construtores. O primeiro recebe uma <em>StorageCredentials </em>e tr√™s URIs representando o endpoint do Blob, Queue e Storage, nessa ordem. O segundo construtor recebe uma StorageCredentials e um bool que indica se ser√° utilizado HTTPS. Vamos ao c√≥digo:</p>
<p><script src="https://gist.github.com/edneypitta/9c363220a2822b98be39.js"></script></p>
<p>Outra maneira (bem melhor) de instanciar a classe CloudStorageAccount √© usando o m√©todo est√°tico <em>Parse </em>ou <em>TryParse</em>, que possui dois overloads: √© poss√≠vel usar a classe <em>CloudConfigurationManager </em>e chamar o m√©todo GetSetting(), que obt√©m a informa√ß√£o do arquivo .CSCFG do seu projeto Windows Azure Cloud, ou passar somente uma connection string no formato certo (<em>&lt;add name=&#8221;StorageConnection&#8221; connectionString=&#8221;DefaultEndpointsProtocol=https;AccountName=ACCOUNT_NAME_GOES_HERE;AccountKey=ACCOUNT_KEY_GOES_HERE&#8221; /&gt;</em>).</p>
<p><script src="https://gist.github.com/edneypitta/b7f3c27b8c5292495305.js"></script></p>
<p>Depois de instanciada a classe CloudStorageAccount, voc√™ precisa criar um <em>CloudBlobClient </em>e obter uma refer√™ncia ao <em>CloudBlobContainer</em>. Lembre-se de que h√° dois tipos de Blobs e cada um tem seu m√©todo para obter a refer√™ncia (<em>GetBlockBlobReference </em>e <em>GetPageBlobReference</em>). </p>
<p>Do Container √© poss√≠vel obter a refer√™ncia para o blob desejado e salvar o conte√∫do do arquivo chamando o m√©todo <em>UploadFromStream</em>. H√° outros dois m√©todos para realizar o upload (<em>UploadFromByteArray </em>e <em>UploadFromFile</em>). Todos eles sobrescrevem os dados se eles j√° existirem e t√™m sua vers√£o ass√≠ncrona (com Async no final do nome), o que √© ideal para fazer o upload de Blobs grandes. √â tamb√©m recomendado envolver a chamada de qualquer Upload em um try/catch para tratar quaisquer erros de rede. Para fazer o download de um Blob, basta chamar o m√©todo <em>DownloadToStream</em>. Para deletar um Blob, h√° os m√©todos <em>Delete </em>e <em>DeleteIfExists</em>.</p>
<p>A cria√ß√£o padr√£o de um Container √© com acesso privado. Voc√™ pode mudar a permiss√£o chamando o m√©todo <em>SetPermissions </em>de um CloudBlobContainer, passando um <em>BlobContainerPermissions </em>com <em>PublicAccess </em>habilitado, por exemplo. Voc√™ pode tamb√©m distribuir assinaturas de acesso tempor√°rias com o m√©todo <em>GetSharedAccessSignature</em>, tanto de um Container quanto de um Blob.</p>
<h2>Table e Queue Storage</h2>
<p>Uma Table storage serve armazenar dados n√£o relacionais, como os bancos de dados NoSQL (CouchDB ou MongoDB, por exemplo). Uma Queue storage serve para armazenar mensagens no esquema de fila, onde o primeiro item que entra √© o primeiro a sair (FIFO, First In First Out). Queues s√£o √∫teis em sistemas de entrega de mensagens ou longos processamentos.</p>
<p>As APIs de Table e Queue s√£o bem parecidas com as do Blob. Voc√™ instancia a classe CloudStorageAccount, chama o m√©todo CreateCloudTableClient ou CreateCloudQueueClient e <em>voil√†</em>. Tables e Queues s√£o sempre privadas.</p>
<p>Queues s√£o mais simples porque n√£o h√° m√©todos de busca. Al√©m de poder obter uma quantidade aproximada de itens na fila, basicamente h√° m√©todos para colocar e obter mensagens da fila (push-and-pop). Um aspecto interessante √© que obter uma mensagem da fila n√£o a remove completamente, s√≥ a deixa invis√≠vel por um per√≠odo de tempo (1 minuto por padr√£o). Se seu processamento demorar mais do que esse tempo, voc√™ deve atualizar o status da mensagem como escondida para que outros processos n√£o a vejam na fila. Ap√≥s terminar seu processamento, a√≠ sim voc√™ pode deletar a mensagem da fila.</p>
<p>Tables s√£o um pouco mais interessantes pois √© poss√≠vel interagir com os dados. O jeito principal de obter um registro √© executar uma <em>TableOperation</em>, mas voc√™ pode obter v√°rios registros com uma <em>TableQuery</em>. Vamos a um trecho de c√≥digo que adiciona um registro, obt√©m esse registro e o deleta. Note que a classe <em>Record </em>herda de <em>TableEntity</em>, sendo poss√≠vel criar classes que representam os dados na Table.</p>
<p><script src="https://gist.github.com/edneypitta/fc10682479610341beea.js"></script></p>
<h2>Distribui√ß√£o de Dados Usando Windows Azure Content Delivery Network (CDN)</h2>
<p>O Windows Azure Content Delivery Network (CDN) √© uma maneira de cachear conte√∫dos est√°ticos (Blobs). A ideia √© usar uma localidade pr√≥xima ao client para melhorar a performance e largura de banda. Os dois principais benef√≠cios, segundo a MSDN, s√£o:</p>
<ul>
<li>Melhorar a performance para usu√°rios que est√£o longe da fonte de conte√∫do e est√£o utilizando aplica√ß√µes que necessitam de muitas requisi√ß√µes;</li>
<li>Escalar a distribui√ß√£o para lidar melhor com uma alta carga instant√¢nea, como um lan√ßamento de produto.</li>
</ul>
<p>Para usar o CDN, voc√™ deve habilitar no portal do Azure. Depois, o CDN vai funcionar assim: quando um request for feito para um Blob, ele vai redirecionar transparentemente o request para a localiza√ß√£o mais pr√≥xima, para evitar uma viagem muito grande. O primeiro request ser√° feito normalmente, mas os pr√≥ximos ser√£o cacheados naquela regi√£o. O tempo de expira√ß√£o √© importante, pois como os itens s√£o cacheados, alguns problemas podem acontecer caso o item seja atualizado frequentemente. O que controla o tempo de expira√ß√£o √© a configura√ß√£o Time To Live (TTL) no portal.</p>
<p>Para deixar um conte√∫do dispon√≠vel para CDN, ele deve estar em um container p√∫blico e dispon√≠vel para acesso an√¥nimo. Containers p√∫blicos podem ser setados via API, como citado acima. A propriedade PublicAccess deve ser configurada como <em>BlobContainerPublicAccessType.Container</em>.</p>
<p>Com tudo configurado, basta acessar o Blob. A URL tradicional vai funcionar normalmente (<em>http://<storage account name>.blob.core.windows.net/{container}/{blob}</em>), mas uma nova URL ficar√° dispon√≠vel pelo CDN: <em>http://<storage account name>.vo.msecnd.net/{container}/{blob}</em>.</p>
<p>S√≥ relembrando: quanto mais um item for din√¢mico, menos prov√°vel que ele seja um bom candidato para usar CDN, por causa do cache.</p>
<h2>Windows Azure Caching</h2>
<p>Cacheamento no n√≠vel do Windows Azure √© bem diferente do que temos em n√≠vel de aplica√ß√£o, como <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-1-2-implement-caching/" target="_blank">nesse objetivo</a>. Esse cacheamento √© <em>role-based</em>, ou seja, dispon√≠vel em qualquer role no Windows Azure.</p>
<p>H√° dois mecanismos: <em>dedicated topology</em> e <em>co-located topology</em>. Em uma dedicated topology, voc√™ define uma role que ser√° especificamente designada para lidar com cache, por exemplo, toda a mem√≥ria de uma Worker Role. Em um cen√°rio de co-located topology, apenas parte dos recursos podem ser utilizado para cache. Caso voc√™ tenha 4 Worker Roles, por exemplo, pode usar 25% de cada para lidar com cache.</p>
<p>Existe tamb√©m um servi√ßo opcional chamado Windows Azure Shared Caching. Diferente dos anteriores, ele existe em n√≠vel de servi√ßo, e n√£o de role.</p>
<h2>Lidando Com Exce√ß√µes Usando Retries (SQL Database)</h2>
<p>SQL Database, sendo um banco de dados na nuvem, tem v√°rios benef√≠cios como escalabilidade e facilidade de configura√ß√£o. Uma desvantagem √© que, com a dist√¢ncia f√≠sica entre o servidor de aplica√ß√£o e o de banco de dados, a lat√™ncia aumenta, podendo causar timeouts na conex√£o com o banco. Como esse erro √© tempor√°rio, faz sentido ter uma l√≥gica de retentativa (retry) nas conex√µes com o banco de dados.</p>
<p>O Azure oferece um framework para implementa√ß√£o de l√≥gicas de retentativa. Segue um c√≥digo de retentativa em deadlocks e timeouts com ADO.NET:</p>
<p><script src="https://gist.github.com/edneypitta/00283d023902f079210e.js"></script></p>
<p>Isso √© tudo para esse objetivo üôÇ Obrigado pela leitura e fique ligado no post do pr√≥ximo objetivo, <strong><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-1-5-create-and-implement-wcf-data-services-service/">Create and implement a WCF Data Services service</a></strong>.<br />
At√© l√°!</p>

				<p><a class="btn btn-default read-more" href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-1-4-implement-data-storage-in-windows-azure/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 1.4 &#8211; Implement data storage in Windows Azure">Leia Mais</a></p>

							</div><!-- .entry-content -->
					</div>
	</div>
</article><!-- #post-## -->

			
				
<article id="post-255" class="post-255 post type-post status-publish format-standard hentry category-certificacao tag-70-487">
	<div class="blog-item-wrap">
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-1-3-implement-transactions/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 1.3 ‚Äì Implement transactions" >
			 				</a>
		<div class="post-inner-content">
			<header class="entry-header page-header">

				<h1 class="entry-title"><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-1-3-implement-transactions/" rel="bookmark">Certifica√ß√£o Microsoft 70-487: Objetivo 1.3 ‚Äì Implement transactions</a></h1>

								<div class="entry-meta">
					<span class="posted-on"><i class="fa fa-calendar"></i> <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-1-3-implement-transactions/" rel="bookmark"><time class="entry-date published" datetime="2016-01-07T22:43:42+00:00">07/01/2016</time><time class="updated" datetime="2016-03-01T16:55:48+00:00">01/03/2016</time></a></span><span class="byline"> <i class="fa fa-user"></i> <span class="author vcard"><a class="url fn n" href="https://edneypitta.github.io/old-blog/author/admin/">Edney Pitta</a></span></span>				<span class="comments-link"><i class="fa fa-comment-o"></i><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-1-3-implement-transactions/#respond"><span class="dsq-postid" data-dsqidentifier="255 https://edneypitta.github.io/old-blog/?p=255">Deixe um coment√°rio</span></a></span>
				
				
				</div><!-- .entry-meta -->
							</header><!-- .entry-header -->

						<div class="entry-content">

				<p>Ol√° pessoal! Nesse post vou falar sobre o objetivo 1.3 do exame de certifica√ß√£o Microsoft 40-487, Implement transactions. Para acompanhar desde o come√ßo e ver os primeiros posts, <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-developing-microsoft-azure-and-web-services/" target="_blank">clique aqui</a>.</p>
<p>Para o exame, √© necess√°rio que voc√™ saiba caracter√≠sticas gerais de transa√ß√µes e como implement√°-las com ADO.NET e Entity Framework. Vamos l√°?</p>
<h2>Entendendo Transa√ß√µes</h2>
<p>Basicamente, transa√ß√µes servem para fazer os dados do banco de dados serem consistentes. Elas s√£o necess√°rias em caso de falha no meio de uma execu√ß√£o de comandos, servindo para que <strong>todos </strong>eles sejam revertidos. Por exemplo, ao tentar fazer a inser√ß√£o de uma <em>Account</em> e depois uma <em>AccountDetails</em>, as duas inser√ß√µes devem ser feitas com sucesso para que n√£o haja um registro de AccountDetails sem Account e vice-versa. Entender esse conceito √© fundamental para esse objetivo.</p>
<p>Outro aspecto importante de transa√ß√µes √© se elas s√£o <strong>simples</strong> ou <strong>distribu√≠das</strong>. Essencialmente, uma transa√ß√£o simples envolve apenas um banco de dados, enquanto uma distribu√≠da envolve diversos bancos de dados, provavelmente de aplica√ß√µes diferentes. Uma limita√ß√£o da classe System.Data.SqlClient.SqlTransaction √© que ela s√≥ trabalha com bancos de dados SQL Server.</p>
<p>H√° tamb√©m o conceito de <strong>n√≠vel de isolamento</strong> (<em>isolation level</em>) de uma transa√ß√£o. O enum <em>IsolationLevel</em> serve para controlar o comportamento de lock na execu√ß√£o de um comando. Esse enum existe em dois namespaces (System.Data e System.Transaction), mas ambos fazem a mesma coisa e t√™m os mesmos valores. A diferen√ßa apenas √© que eles trabalham com as classes dos seus respectivos namespaces. O IsolationLevel pode ser mudado durante a execu√ß√£o da transa√ß√£o sem problemas. Vamos ao valores e comportamento deles:</p>
<ul>
<li><strong>Unspecified</strong>: N√£o determinado. O n√≠vel de isolamento ser√° determinado pelo driver do banco de dados.</li>
<li><strong>Chaos</strong>: As altera√ß√µes pendentes de transa√ß√µes mais altamente isoladas n√£o podem ser substitu√≠das. Esse valor n√£o √© suportado no SQL Server ou Oracle, por isso tem uma utiliza√ß√£o bem limitada.</li>
<li><strong>ReadUncommitted</strong>: Nenhum <em>shared lock</em> √© emitido. Isso implica que a leitura pode ser imprecisa, o que geralmente n√£o √© desejado.</li>
<li><strong>ReadCommitted</strong>: Emite shared locks nas leituras. Isso evita leituras imprecisas, mas os dados ainda podem ser mudados antes do fim da execu√ß√£o da transa√ß√£o. Pode resultar em <a href="http://stackoverflow.com/questions/11043712/what-is-difference-between-non-repeatable-read-and-phantom-read" target="_blank"><em>nonrepeatable reads</em> ou <em>phantom data</em></a>.</li>
<li><strong>RepeatableRead</strong>: Locks s√£o colocados em todos os dados usados na query, o que previne quaisquer altera√ß√µes durante a execu√ß√£o da transa√ß√£o. Isso acaba com o problema de nonrepeatable read, mas phantom data ainda pode ocorrer.</li>
<li><strong>Serializable</strong>: Um <em>range lock</em> √© colocado em um espec√≠fico DataSet, o que previne quaisquer inser√ß√µes ou altera√ß√µes at√© que a transa√ß√£o termine. Deve ser usado rapidamente.</li>
<li><strong>Snapshot</strong>: Uma c√≥pia dos dados √© feita, ent√£o uma execu√ß√£o de transa√ß√£o pode ler enquanto outra pode modificar os mesmos dados. N√£o √© poss√≠vel ver os dados de outras execu√ß√µes de transa√ß√µes, mesmo rodando a query novamente. O tamanho disso pode tamb√©m causar problemas se n√£o for usado rapidamente.</li>
</ul>
<h2>Implementando Transa√ß√µes com TransactionScope (System.Transactions)</h2>
<p><em>TransactionScope</em> √© simples e poderoso. Vamos ao c√≥digo e algumas caracter√≠sticas importantes:</p>
<p><script src="https://gist.github.com/edneypitta/4301d7d19b837bdb4c87.js"></script></p>
<ul>
<li>O m√©todo Complete() faz com que todas as altera√ß√µes sejam comitadas. Se n√£o for chamado, todas elas s√£o desfeitas.</li>
<li>Caso alguma Exception seja lan√ßada dentro do bloco using, todas as altera√ß√µes ser√£o desfeitas tamb√©m.</li>
<li>A transa√ß√£o √© promovida de simples para distribu√≠da automaticamente quando a segunda SqlConnection √© aberta.</li>
<li>Mesmo numa transa√ß√£o distribu√≠da, h√° algumas limita√ß√µes √≥bvias. C√≥pias de arquivos e chamadas para web services, por exemplo, n√£o s√£o revertidas (alguns web services podem at√© suportar transa√ß√µes, mas isso n√£o acontece automaticamente). H√° tamb√©m o requerimento de que o banco de dados suporte transa√ß√µes, o que n√£o acontece com todos.</li>
</ul>
<h2>Implementando Transa√ß√µes com EntityTransaction</h2>
<p>Voc√™ pode implementar transa√ß√µes com a classe EntityTransaction para as classes EntityCommand e EntityConnection. Ela tem duas principais propriedades: Connection e IsolationLevel. Tem tamb√©m dois m√©todos importantes e √≥bvios: Commit() e Rollback().</p>
<p>Um ponto n√£o √≥bvio e important√≠ssimo √© que, usando DbContext ou ObjectContext (explicados <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-1-1-choose-data-access-technologies-parte-2-entity-framework/" target="_blank">aqui</a>), n√£o √© necess√°rio usar a classe EntityTransaction. Em qualquer DbContext.SaveChanges(), por exemplo, o Entity Framework usa uma transa√ß√£o para salvar todas as modifica√ß√µes feitas. Caso aconte√ßa algum erro, uma Exception √© lan√ßada e todas as altera√ß√µes s√£o desfeitas.</p>
<p>Caso queira usar a classe EntityTransaction para explicitamente fazer uma transa√ß√£o, o caminho √© bem simples. Basta criar uma EntityCoonnection, declarar uma Entity Transaction chamando BeginTransaction() e, no final, chamar o m√©todo Commit() ou Rollback(). Segue o c√≥digo:</p>
<p><script src="https://gist.github.com/edneypitta/bb94e2e8539641cd452c.js"></script></p>
<h2>Implementando Transa√ß√µes com SqlTransaction</h2>
<p>O comportamento de uma SqlTransaction √© quase id√™ntico ao de uma EntityTransaction. As mudan√ßas est√£o nos nomes dos objetos e seus tipos.</p>
<p>Voc√™ deve criar uma SqlConnection, chamar o m√©todo BeginTransaction() passando um IsolationLevel e criar um ou mais SqlCommands passando como par√¢metro o CommandText, a SqlConnection e a SqlTransaction. Ao inv√©s de um CommandText, tamb√©m √© poss√≠vel passar o nome de uma Stored Procedure e mudar o tipo do CommandType para StoredProcedure.</p>
<p>Depois de toda a l√≥gica feita, basta chamar o m√©todo Commit() ou Rollback().</p>
<p>Uma √∫ltima dica para o exame: se voc√™ for perguntado qual √© o melhor cen√°rio para aplicar uma transa√ß√£o entre uma query longa que envolve v√°rias tabelas e uma query r√°pida que envolve uma tabela, escolha a √∫ltima op√ß√£o. Embora aparentemente uma query que envolve v√°rias tabelas pare√ßa o ideal, o livro alega que a dura√ß√£o e complexidade geraria colocaria problemas de lock e conten√ß√£o. Ent√£o t√°, n√©?</p>
<p>O pr√≥ximo post ser√° sobre o objetivo 1.4, <strong><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-1-4-implement-data-storage-in-windows-azure/">Implement data storage in Windows Azure</a></strong>.<br />
At√© l√°!</p>

				<p><a class="btn btn-default read-more" href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-1-3-implement-transactions/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 1.3 ‚Äì Implement transactions">Leia Mais</a></p>

							</div><!-- .entry-content -->
					</div>
	</div>
</article><!-- #post-## -->

			
				
<article id="post-244" class="post-244 post type-post status-publish format-standard hentry category-certificacao tag-70-487">
	<div class="blog-item-wrap">
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-1-2-implement-caching/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 1.2 ‚Äì Implement caching" >
			 				</a>
		<div class="post-inner-content">
			<header class="entry-header page-header">

				<h1 class="entry-title"><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-1-2-implement-caching/" rel="bookmark">Certifica√ß√£o Microsoft 70-487: Objetivo 1.2 ‚Äì Implement caching</a></h1>

								<div class="entry-meta">
					<span class="posted-on"><i class="fa fa-calendar"></i> <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-1-2-implement-caching/" rel="bookmark"><time class="entry-date published" datetime="2016-01-06T02:45:14+00:00">06/01/2016</time><time class="updated" datetime="2016-03-01T16:55:40+00:00">01/03/2016</time></a></span><span class="byline"> <i class="fa fa-user"></i> <span class="author vcard"><a class="url fn n" href="https://edneypitta.github.io/old-blog/author/admin/">Edney Pitta</a></span></span>				<span class="comments-link"><i class="fa fa-comment-o"></i><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-1-2-implement-caching/#respond"><span class="dsq-postid" data-dsqidentifier="244 https://edneypitta.github.io/old-blog/?p=244">Deixe um coment√°rio</span></a></span>
				
				
				</div><!-- .entry-meta -->
							</header><!-- .entry-header -->

						<div class="entry-content">

				<p>O objetivo 1.2 do exame 70-487: Developing Microsoft Azure and Web Services, <strong>Implement caching</strong>, trata-se de implementa√ß√µes de cache. Nesse objetivo, √© necess√°rio que voc√™ se familiarize com dois objetos de cache: <em>ObjectCache</em> e o <em>HttpContext.Cache</em>.</p>
<h2>ObjectCache</h2>
<p>O ObjectCache prov√™ a funcionalidade de cache com extrema facilidade. Basta obter a inst√¢ncia dele usando MemoryCache.Default e usar os m√©todos que t√™m nomes amig√°veis como Add, AddOrGetExisting, Get e Set. Pode n√£o ser f√°cil memorizar todos os overloads, mas j√° chegamos l√°. Primeiro d√™ uma olhada num uso simples do ObjectCache:</p>
<p><script src="https://gist.github.com/edneypitta/fa87c7423cb6e330f6e9.js"></script></p>
<p>Note que √© necess√°rio primeiro remover o item do cache antes de chamar o m√©todo Add. Isso ocorre porque internamente o m√©todo Add usa o m√©todo AddOrGetExisting, ent√£o ele n√£o substitui o valor anterior. Para obter um valor, voc√™ pode usar o m√©todo Get ou chamar diretamente o indexador (<em>cache[key]</em>).</p>
<p>Vamos √†s diferentes formas de adicionar um item no cache:</p>
<ul>
<li>Add(CacheItem, CacheItemPolicy)</li>
<li>Add(String key, Object value, DateTimeOffset absoluteExpiration)</li>
<li>Add(String key, Object value, CacheItemPolicy policy, String regionName)</li>
<li>AddOrGetExisting(CacheItem, CacheItemPolicy)</li>
<li>AddOrGetExisting(String key, Object value, DateTimeOffset absoluteExpiration)</li>
<li>AddOrGetExisting(String key, Object value, CacheItemPolicy policy, String regionName)</li>
<li>Set(CacheItem, CacheItemPolicy)</li>
<li>Set(String key, Object value, CacheItemPolicy policy, String regionName)</li>
</ul>
<p>Embora numerosos, esses overloads s√£o bem parecidos. Certifique-se de memoriz√°-los. </p>
<p>O efeito de todos eles √© bem parecido. A principal diferen√ßa √© que o m√©todo Add, por internamente usar o m√©todo AddOrGetExisting, retorna um bool indicando se o item foi inserido no cache ou se ele j√° existia. J√° o m√©todo Set n√£o tem retorno e atualiza o valor se o item j√° estiver no cache.</p>
<p>O objeto <em>CacheItem</em> tem tr√™s propriedades: Key, Value e RegionName. </p>
<p>No objeto <em>CacheItemPolicy</em>, voc√™ pode setar a pol√≠tica de expira√ß√£o usando a propriedade <strong>AbsoluteExpiration </strong>ou a <strong>SlidingExpiration</strong>. A diferen√ßa entre as duas √© que, com AbsoluteExpiration, voc√™ determina exatamente a data em que o item vai ser removido do cache. J√° com SlidingExpiration, o item √© removido do cache se n√£o for utilizado ap√≥s o tempo (TimeSpan) determinado.</p>
<p>Ainda no CacheItemPolicy, voc√™ pode configurar tamb√©m a propriedade Priority com o enum <em>CacheItemPriority</em>. No System.Runtime.Caching (ObjectCache), ele tem dois poss√≠veis valores: <strong>Default </strong>(que √© o marcado por padr√£o) e <strong>NotRemovable</strong>. A propriedade Priority funciona assim: quando os recursos de processamento est√£o baixos, o runtime pode limpar algumas coisas da mem√≥ria para melhorar o processamento. Os itens do cache est√£o inclu√≠dos nessa limpeza. Esse √© o comportamento padr√£o, adotado quando a Priority est√° com o valor Default. Os itens do cache adicionados com o valor NotRemovable na propriedade Prority nunca s√£o removidos do cache pelo runtime. Isso √© perigoso pois a aplica√ß√£o pode <em>crashar</em> devido √† falta de mem√≥ria.</p>
<p>O objeto CacheItemPolicy conta ainda com uma lista de <em>ChangeMonitor</em>. Esse objeto, como o nome sugere, lida com mudan√ßas (eventos) que causam atualiza√ß√£o do cache. ChangeMonitor √© uma classe base que tem v√°rias implementa√ß√µes:</p>
<ul>
<li><em>CacheEntryChangeMonitor</em>: serve como base para a constru√ß√£o de classes derivadas que monitoram os CacheItems</li>
<li><em>FileChangeMonitor</em>: monitora um arquivo checando se h√° mudan√ßas para atualizar o cache</li>
<li><em>HostFileChangeMonitor</em>: monitora mudan√ßas em diret√≥rios e caminhos de arquivos, como o nome ou tamanho de um arquivo.</li>
</ul>
<h2>HttpContext.Cache</h2>
<p>O HttpContext.Cache foi criado para ser usado especificamente numa aplica√ß√£o web ASP.NET (fica em System.Web.Caching). Tome cuidado para n√£o confundir os dois no exame. Se alguma quest√£o mencionar o objeto HttpContext.Cache, Page.Cache ou somente Cache, voc√™ <strong>deve</strong> assumir que se trata de uma aplica√ß√£o ASP.NET. Quaisquer outras men√ß√µes √† cache, pode se assumir que se trata do ObjectCache.</p>
<p>O jeito mais simples de adicionar ou atualizar um item no HttpContext.Cache √© assim: <code>Cache["FullNameKey"] = "John Q. Public";</code>. H√° tamb√©m os m√©todos Add e Insert, que cont√™m v√°rias sobrecargas (e infelizmente voc√™ tamb√©m deve memorizar todas elas):</p>
<ul>
<li>Insert(String Key, Object Value)</li>
<li>Insert(String Key, Object Value, CacheDependency dependencyItem)</li>
<li>Insert(String Key, Object Value, CacheDependency dependencyItem, DateTime absoluteExpiration, TimeSpan slidingExpiration)</li>
<li>Insert(String Key, Object Value, CacheDependency dependencyItem, DateTime absoluteExpiration, TimeSpan slidingExpiration, CacheItemUpdateCallback updateCallback)</li>
<li>Insert(String Key, Object Value, CacheDependency dependencyItem, DateTime absoluteExpiration, TimeSpan slidingExpiration, CacheItemPriority priority, CacheItemRemovedCallback removeCallback)</li>
<li>Add(string key, object value, CacheDependency dependencies, DateTime absoluteExpiration, TimeSpan slidingExpiration, CacheItemPriority priority, CacheItemRemovedCallback onRemoveCallback)</li>
</ul>
<p>O m√©todo Add e a √∫ltima forma do m√©todo Insert s√£o virtualmente id√™nticos. A principal diferen√ßa est√° no m√©todo Insert que usa um <em>CacheItemUpdateCallback</em>, ao contr√°rio do m√©todo Add que usa um <em>CacheItemRemovedCallback</em>. Em RemoveCallback √© chamado quando o item √© removido do cache, enquanto UpdateCallback √© invocado <em>um pouco</em> antes do item ser removido do cache. Para a maioria das aplica√ß√µes isso n√£o faz muita diferen√ßa, mas a ideia √© que se voc√™ precisa se certificar que um item nunca seja removido do cache, por exemplo, use UpdateCallback.</p>
<p>Assim como no ObjectCache, temos aqui tamb√©m o enum <em>CacheItemPriority</em>, que funciona da mesma forma. A diferen√ßa √© que aqui h√° mais op√ß√µes de valores, com nomes bem sugestivos: <strong>Low</strong>, <strong>BelowNormal</strong>, <strong>Normal</strong>, <strong>AboveNormal</strong>, <strong>High</strong>, <strong>NotRemovable </strong>e <strong>Default</strong>. O valor padr√£o √© Normal, que funciona da mesma forma que Default.</p>
<p>Para finalizar, h√° o par√¢metro <em>CacheDependency</em>, que lida com cache de arquivos (como o HostFileChangeMonitor). Voc√™ pode passar tamb√©m um objeto bem importante, o <em>SqlCacheDependency</em>. Ele tem dois construtores: um que aceita um SqlCommand e outro que aceita duas strings, a primeira sendo o nome do banco definido no web.config e a segunda √© o nome da tabela que o cache ser√° associado. H√° muitos requisitos para se usar SqlCacheDependency, e alguns cuidados devem ser tomados.<br />
Para o primeiro construtor, o banco de dados deve ser SQL Server 2005 ou superior. Dentro do SqlCommand, as tabelas devem ser referenciadas com o owner (<em>dbo.Customer</em>, por exemplo). <em>SELECT *</em> √© proibido e a p√°gina n√£o pode ter output caching.<br />
O segundo √© ainda mais complicado. Deve haver uma connection string no web.config da aplica√ß√£o (obviamente). O banco de dados e a tabela devem ter notifica√ß√µes habilitadas no SQL Server e n√£o √© poss√≠vel associar o cache com mais de uma tabela.</p>
<p>E <strong>√© isso</strong>. O conte√∫do desse objetivo foi bem simples, apesar de ser dif√≠cil decorar todos os overloads dos m√©todos de inser√ß√£o.</p>
<p>Nos vemos no post do pr√≥ximo objetivo, <strong><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-1-3-implement-transactions/">Implement transactions</a></strong>.<br />
At√© mais!</p>

				<p><a class="btn btn-default read-more" href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-1-2-implement-caching/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 1.2 ‚Äì Implement caching">Leia Mais</a></p>

							</div><!-- .entry-content -->
					</div>
	</div>
</article><!-- #post-## -->

			
			
		
		</main><!-- #main -->
	</section><!-- #primary -->

</div>
	<div id="secondary" class="widget-area col-sm-12 col-md-4" role="complementary">
		<div class="well">
						<aside id="text-3" class="widget widget_text">			<div class="textwidget"><a href="https://edneypitta.github.io/old-blog/sobre/"><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2015/08/IMG-20150829-WA00012-e1440915174271-150x150.jpg"  width="150" height="150" class="aligncenter size-thumbnail wp-image-93" style="border-radius: 80px;" />
<h2 style="text-align:center;">Edney Pitta</h2></a>
<div style="text-align: center;">Desenvolvedor de Software @ Lambda3</div>
<div style="margin-top:20px;text-align:center;"><a href="https://edneypitta.github.io/old-blog/sobre/"><button class="btn btn-danger btn-lg " >SOBRE MIM</button></a></div></div>
		</aside><aside id="search-2" class="widget widget_search">
<form role="search" method="get" class="form-search" action="https://edneypitta.github.io/old-blog/">
  <div class="input-group">
  	<label class="screen-reader-text" for="s">Search for:</label>
    <input type="text" class="form-control search-query" placeholder="Procurar&hellip;" value="" name="s" title="Search for:" />
    <span class="input-group-btn">
      <button type="submit" class="btn btn-default" name="submit" id="searchsubmit" value="Search"><span class="glyphicon glyphicon-search"></span></button>
    </span>
  </div>
</form></aside>		<aside id="recent-posts-3" class="widget widget_recent_entries">		<h3 class="widget-title">Posts recentes</h3>		<ul>
					<li>
				<a href="https://edneypitta.github.io/old-blog/migrando-um-projeto-asp-net-core-rc-1-para-rc-2/">Migrando um projeto ASP.NET Core RC 1 para RC 2</a>
						</li>
					<li>
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-486-developing-asp-net-mvc-web-applications/">Certifica√ß√£o Microsoft 70-486: Developing ASP.NET MVC Web Applications</a>
						</li>
					<li>
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-480-programming-in-html5-with-javascript-and-css3/">Certifica√ß√£o Microsoft 70-480: Programming in HTML5 with JavaScript and CSS3</a>
						</li>
					<li>
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-resultado/">Certifica√ß√£o Microsoft 70-487 &#8211; Resultado</a>
						</li>
					<li>
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-6-share-assemblies-between-multiple-applications-and-servers/">Certifica√ß√£o Microsoft 70-487: Objetivo 5.6 ‚Äì Share assemblies between multiple applications and servers</a>
						</li>
				</ul>
		</aside>		<aside id="annual_archive_widget-2" class="widget Annual_Archive_Widget"><h3 class="widget-title">Arquivo</h3>	<ul>
		<li><a href='https://edneypitta.github.io/old-blog/2016/06/'>junho 2016</a>&nbsp;(1)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2016/05/'>maio 2016</a>&nbsp;(1)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2016/04/'>abril 2016</a>&nbsp;(1)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2016/03/'>mar√ßo 2016</a>&nbsp;(10)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2016/02/'>fevereiro 2016</a>&nbsp;(11)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2016/01/'>janeiro 2016</a>&nbsp;(10)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2015/12/'>dezembro 2015</a>&nbsp;(3)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2015/11/'>novembro 2015</a>&nbsp;(3)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2015/10/'>outubro 2015</a>&nbsp;(1)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2015/09/'>setembro 2015</a>&nbsp;(5)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2015/08/'>agosto 2015</a>&nbsp;(2)</li>
	</ul>
	</aside>		</div>
	</div><!-- #secondary -->
			</div><!-- close .*-inner (main-content or sidebar, depending if sidebar is used) -->
		</div><!-- close .row -->
	</div><!-- close .container -->
</div><!-- close .site-content -->

	<div id="footer-area">
		<div class="container footer-inner">
			<div class="row">
				
				</div>
		</div>

		<footer id="colophon" class="site-footer" role="contentinfo">
			<div class="site-info container">
				<div class="row">
										<nav role="navigation" class="col-md-6">
						<ul id="menu-social-1" class="nav footer-nav clearfix"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-20"><a href="https://br.linkedin.com/in/edneypitta"><i class="fa fa-linkedin-square"></i></a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-22"><a href="https://www.facebook.com/edneypitta"><i class="fa fa-facebook-square"></i></a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-23"><a href="https://twitter.com/edneypitta"><i class="fa fa-twitter-square"></i></a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-24"><a href="https://edneypitta.github.io/old-blog/feed/"><i class="fa fa-rss"></i></a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-27"><a href="https://edneypitta.github.io/old-blog/sobre/"><i class="fa fa-info-circle"></i></a></li>
</ul>					</nav>
					<div class="copyright col-md-6">
						<a rel="license" href="http://creativecommons.org/licenses/by/2.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/2.0/80x15.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/2.0/">Creative Commons Attribution 2.0 Generic License</a>.						Theme by <a href="http://colorlib.com/" target="_blank">Colorlib</a> Powered by <a href="http://wordpress.org/" target="_blank">WordPress</a>					</div>
				</div>
			</div><!-- .site-info -->
			<div class="scroll-to-top"><i class="fa fa-angle-up"></i></div><!-- .scroll-to-top -->
		</footer><!-- #colophon -->
	</div>
</div><!-- #page -->

<script type='text/javascript' src='https://edneypitta.github.io/old-blog/wp-content/themes/sparkling/inc/js/skip-link-focus-fix.js?ver=20140222'></script>
<script type='text/javascript' src='https://edneypitta.github.io/old-blog/wp-includes/js/wp-embed.min.js?ver=4.8.2'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var countVars = {"disqusShortname":"edneypitta"};
/* ]]> */
</script>
<script type='text/javascript' src='https://edneypitta.github.io/old-blog/wp-content/plugins/disqus-comment-system/media/js/count.js?ver=4.8.2'></script>

</body>
</html>