<!doctype html>
	<!--[if !IE]>
	<html class="no-js non-ie" lang="pt-BR" prefix="og: http://ogp.me/ns#"> <![endif]-->
	<!--[if IE 7 ]>
	<html class="no-js ie7" lang="pt-BR" prefix="og: http://ogp.me/ns#"> <![endif]-->
	<!--[if IE 8 ]>
	<html class="no-js ie8" lang="pt-BR" prefix="og: http://ogp.me/ns#"> <![endif]-->
	<!--[if IE 9 ]>
	<html class="no-js ie9" lang="pt-BR" prefix="og: http://ogp.me/ns#"> <![endif]-->
	<!--[if gt IE 9]><!-->
<html class="no-js" lang="pt-BR" prefix="og: http://ogp.me/ns#"> <!--<![endif]-->
<head>
<base href="https://edneypitta.github.io/old-blog" />

<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1">



<title>mar√ßo 2016 - Edney Pitta</title>

<!-- This site is optimized with the Yoast SEO plugin v3.0.7 - https://yoast.com/wordpress/plugins/seo/ -->
<meta name="robots" content="noindex,follow"/>
<link rel="canonical" href="https://edneypitta.github.io/old-blog/2016/03/" />
<meta property="og:locale" content="pt_BR" />
<meta property="og:type" content="object" />
<meta property="og:title" content="mar√ßo 2016 - Edney Pitta" />
<meta property="og:url" content="https://edneypitta.github.io/old-blog/2016/03/" />
<meta property="og:site_name" content="Edney Pitta" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="mar√ßo 2016 - Edney Pitta"/>
<meta name="twitter:site" content="@edneypitta"/>
<!-- / Yoast SEO plugin. -->

<link rel='dns-prefetch' href='//fonts.googleapis.com' />
<link rel='dns-prefetch' href='//s.w.org' />


		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/svg\/","svgExt":".svg","source":{"concatemoji":"http:\/\/edneypitta.github.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.8.2"}};
			!function(a,b,c){function d(a){var b,c,d,e,f=String.fromCharCode;if(!k||!k.fillText)return!1;switch(k.clearRect(0,0,j.width,j.height),k.textBaseline="top",k.font="600 32px Arial",a){case"flag":return k.fillText(f(55356,56826,55356,56819),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,56826,8203,55356,56819),0,0),c=j.toDataURL(),b!==c&&(k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447),0,0),c=j.toDataURL(),b!==c);case"emoji4":return k.fillText(f(55358,56794,8205,9794,65039),0,0),d=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55358,56794,8203,9794,65039),0,0),e=j.toDataURL(),d!==e}return!1}function e(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i,j=b.createElement("canvas"),k=j.getContext&&j.getContext("2d");for(i=Array("flag","emoji4"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='sparkling-bootstrap-css'  href='https://edneypitta.github.io/old-blog/wp-content/themes/sparkling/inc/css/bootstrap.min.css?ver=4.8.2' type='text/css' media='all' />
<link rel='stylesheet' id='sparkling-icons-css'  href='https://edneypitta.github.io/old-blog/wp-content/themes/sparkling/inc/css/font-awesome.min.css?ver=4.8.2' type='text/css' media='all' />
<link rel='stylesheet' id='sparkling-fonts-css'  href='//fonts.googleapis.com/css?family=Open+Sans%3A400italic%2C400%2C600%2C700%7CRoboto+Slab%3A400%2C300%2C700&#038;ver=4.8.2' type='text/css' media='all' />
<link rel='stylesheet' id='sparkling-style-css'  href='https://edneypitta.github.io/old-blog/wp-content/themes/sparkling/style.css?ver=4.8.2' type='text/css' media='all' />
<script type='text/javascript' src='https://edneypitta.github.io/old-blog/wp-includes/js/jquery/jquery.js?ver=1.12.4'></script>
<script type='text/javascript' src='https://edneypitta.github.io/old-blog/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<script type='text/javascript' src='https://edneypitta.github.io/old-blog/wp-content/themes/sparkling/inc/js/modernizr.min.js?ver=4.8.2'></script>
<script type='text/javascript' src='https://edneypitta.github.io/old-blog/wp-content/themes/sparkling/inc/js/bootstrap.min.js?ver=4.8.2'></script>
<script type='text/javascript' src='https://edneypitta.github.io/old-blog/wp-content/themes/sparkling/inc/js/functions.min.js?ver=4.8.2'></script>
<link rel='https://api.w.org/' href='https://edneypitta.github.io/old-blog/wp-json/' />

 

<script data-cfasync="false" src="//load.sumome.com/" data-sumo-site-id="025f16b2b72012bef5c86b74ea4d0bd0652e8245a2df8c61ed302458c0f98f3b" async></script><style type="text/css">.entry-content {font-family: Open Sans; font-size:14px; font-weight: normal; color:#6B6B6B;}.navbar > .container .navbar-brand {
font-size: 35px;
margin-top: 7px;
}

#menu-social i{
font-size:17px;
}
#menu-social-1 i {
font-size:22px;
}

article ul {
    list-style: none;
    padding:0;
    margin:0;
margin-bottom: 10px;
}

article li { 
    padding-left: 1em; 
    text-indent: -.7em;
}

article li:before {
    content: "\2022";
    color: rgb(191, 66, 78); 
padding-right:7px;
font-size: 15px;
}

#logo {
margin: 10px 0px;
}

.textwidget a:hover h2{
color:#c9302c;
}</style>	<style type="text/css">
			.navbar > .container .navbar-brand {
			color: #ffffff;
		}
		</style>
	<link rel="icon" href="https://edneypitta.github.io/old-blog/wp-content/uploads/2015/08/cropped-cropped-edneypitta-oficialissimo-fundo-branco-32x32.png" sizes="32x32" />
<link rel="icon" href="https://edneypitta.github.io/old-blog/wp-content/uploads/2015/08/cropped-cropped-edneypitta-oficialissimo-fundo-branco-192x192.png" sizes="192x192" />
<link rel="apple-touch-icon-precomposed" href="https://edneypitta.github.io/old-blog/wp-content/uploads/2015/08/cropped-cropped-edneypitta-oficialissimo-fundo-branco-180x180.png" />
<meta name="msapplication-TileImage" content="https://edneypitta.github.io/old-blog/wp-content/uploads/2015/08/cropped-cropped-edneypitta-oficialissimo-fundo-branco-270x270.png" />

<script type="text/javascript">
jQuery(document).ready(function()
{
jQuery('.fa-linkedin-square').parent().attr('target', '_blank').attr('title', 'LinkedIn');
jQuery('.fa-facebook-square').parent().attr('target', '_blank').attr('title', 'Facebook');
jQuery('.fa-twitter-square').parent().attr('target', '_blank').attr('title', 'Twitter');
jQuery('.fa-rss').parent().attr('target', '_blank').attr('title', 'RSS');

jQuery('.fa-info-circle').parent().attr('title', 'Sobre');
});
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-66613004-1', 'auto');
  ga('send', 'pageview');

</script>
</head>

<body class="archive date">
<div id="page" class="hfeed site">

	<header id="masthead" class="site-header" role="banner">
		<nav class="navbar navbar-default" role="navigation">
			<div class="container">
				<div class="row">
					<div class="site-navigation-inner col-sm-12">
						<div class="navbar-header">
							<button type="button" class="btn navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
								<span class="sr-only">Toggle navigation</span>
								<span class="icon-bar"></span>
								<span class="icon-bar"></span>
								<span class="icon-bar"></span>
							</button>

							
							<div id="logo">
								<a href="https://edneypitta.github.io/old-blog/"><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2015/08/cropped-edneypitta-oficialissimo-fundo-branco.png"  height="84" width="411" alt="Edney Pitta"/></a>
							</div><!-- end of #logo -->

							
							
						</div>
						<div class="collapse navbar-collapse navbar-ex1-collapse"><ul id="menu-social" class="nav navbar-nav"><li id="menu-item-20" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-20"><a title="&lt;i class=&quot;fa fa-linkedin-square&quot;&gt;&lt;/i&gt;" href="https://br.linkedin.com/in/edneypitta"><i class="fa fa-linkedin-square"></i></a></li>
<li id="menu-item-22" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-22"><a title="&lt;i class=&quot;fa fa-facebook-square&quot;&gt;&lt;/i&gt;" href="https://www.facebook.com/edneypitta"><i class="fa fa-facebook-square"></i></a></li>
<li id="menu-item-23" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-23"><a title="&lt;i class=&quot;fa fa-twitter-square&quot;&gt;&lt;/i&gt;" href="https://twitter.com/edneypitta"><i class="fa fa-twitter-square"></i></a></li>
<li id="menu-item-24" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-24"><a title="&lt;i class=&quot;fa fa-rss&quot;&gt;&lt;/i&gt;" href="https://edneypitta.github.io/old-blog/feed/"><i class="fa fa-rss"></i></a></li>
<li id="menu-item-27" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-27"><a title="&lt;i class=&quot;fa fa-info-circle&quot;&gt;&lt;/i&gt;" href="https://edneypitta.github.io/old-blog/sobre/"><i class="fa fa-info-circle"></i></a></li>
</ul></div>					</div>
				</div>
			</div>
		</nav><!-- .site-navigation -->
	</header><!-- #masthead -->

	<div id="content" class="site-content">

		<div class="top-section">
								</div>

		<div class="container main-content-area">
			<div class="row">
				<div class="main-content-inner col-sm-12 col-md-8 pull-left">

	<section id="primary" class="content-area">
		<main id="main" class="site-main" role="main">

		
			<header class="page-header">
				<h1 class="page-title">
					M√™s: <span>mar√ßo 2016</span>				</h1>
							</header><!-- .page-header -->

						
				
<article id="post-617" class="post-617 post type-post status-publish format-standard hentry category-certificacao tag-70-487">
	<div class="blog-item-wrap">
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-resultado/" title="Certifica√ß√£o Microsoft 70-487 &#8211; Resultado" >
			 				</a>
		<div class="post-inner-content">
			<header class="entry-header page-header">

				<h1 class="entry-title"><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-resultado/" rel="bookmark">Certifica√ß√£o Microsoft 70-487 &#8211; Resultado</a></h1>

								<div class="entry-meta">
					<span class="posted-on"><i class="fa fa-calendar"></i> <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-resultado/" rel="bookmark"><time class="entry-date published" datetime="2016-03-18T18:05:14+00:00">18/03/2016</time><time class="updated" datetime="2016-03-23T16:56:48+00:00">23/03/2016</time></a></span><span class="byline"> <i class="fa fa-user"></i> <span class="author vcard"><a class="url fn n" href="https://edneypitta.github.io/old-blog/author/admin/">Edney Pitta</a></span></span>				<span class="comments-link"><i class="fa fa-comment-o"></i><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-resultado/#comments"><span class="dsq-postid" data-dsqidentifier="617 https://edneypitta.github.io/old-blog/?p=617">9 Coment√°rios</span></a></span>
				
				
				</div><!-- .entry-meta -->
							</header><!-- .entry-header -->

						<div class="entry-content">

				<p>Ol√° pessoal, tudo bem?</p>
<p>Em novembro do ano passado decidi tirar a certifica√ß√£o da Microsoft MCSD em Web Applications, come√ßando pelo exame 70-487: Developing Microsoft Azure and Web Services. Fiz um post contando a minha estrat√©gia de estudos, que seria escrever um post sobre cada t√≥pico da prova baseado no livro Exam Ref da Microsoft (voc√™ pode ver os links <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-developing-microsoft-azure-and-web-services/">aqui</a>).</p>
<p>No dia que terminei o √∫ltimo dos 31 posts (que totalizaram 32697 palavras üòÆ ), marquei a prova j√° para o dia seguinte. Estudei algum conte√∫do sobre as atualiza√ß√µes da prova de 2014 e o resultado foi: <strong>aprovado!</strong></p>
<p>Para quem quiser tamb√©m passar na prova, alguns pontos de aten√ß√£o:<br />
 <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-resultado/#more-617" class="more-link"><span aria-label="Continue lendo Certifica√ß√£o Microsoft 70-487 &#8211; Resultado">(mais&hellip;)</span></a></p>

				<p><a class="btn btn-default read-more" href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-resultado/" title="Certifica√ß√£o Microsoft 70-487 &#8211; Resultado">Leia Mais</a></p>

							</div><!-- .entry-content -->
					</div>
	</div>
</article><!-- #post-## -->

			
				
<article id="post-570" class="post-570 post type-post status-publish format-standard hentry category-certificacao tag-70-487">
	<div class="blog-item-wrap">
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-6-share-assemblies-between-multiple-applications-and-servers/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 5.6 ‚Äì Share assemblies between multiple applications and servers" >
			 				</a>
		<div class="post-inner-content">
			<header class="entry-header page-header">

				<h1 class="entry-title"><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-6-share-assemblies-between-multiple-applications-and-servers/" rel="bookmark">Certifica√ß√£o Microsoft 70-487: Objetivo 5.6 ‚Äì Share assemblies between multiple applications and servers</a></h1>

								<div class="entry-meta">
					<span class="posted-on"><i class="fa fa-calendar"></i> <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-6-share-assemblies-between-multiple-applications-and-servers/" rel="bookmark"><time class="entry-date published" datetime="2016-03-09T17:32:39+00:00">09/03/2016</time><time class="updated" datetime="2016-03-09T17:50:52+00:00">09/03/2016</time></a></span><span class="byline"> <i class="fa fa-user"></i> <span class="author vcard"><a class="url fn n" href="https://edneypitta.github.io/old-blog/author/admin/">Edney Pitta</a></span></span>				<span class="comments-link"><i class="fa fa-comment-o"></i><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-6-share-assemblies-between-multiple-applications-and-servers/#comments"><span class="dsq-postid" data-dsqidentifier="570 https://edneypitta.github.io/old-blog/?p=570">3 Coment√°rios</span></a></span>
				
				
				</div><!-- .entry-meta -->
							</header><!-- .entry-header -->

						<div class="entry-content">

				<blockquote><p>Esse √© o √∫ltimo post da s√©rie sobre a certifica√ß√£o Microsoft 70-487. Os links para todos os posts est√£o <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-developing-microsoft-azure-and-web-services/">aqui</a>.</p></blockquote>
<p>Ol√° pessoal, tudo bem?<br />
Vamos ao √∫ltimo objetivo da certifica√ß√£o, o <strong>Share assemblies between multiple applications and servers</strong>.</p>
<p>Esse objetivo cobre como preparar o ambiente para usar assemblies entre m√∫ltiplos servidores, assinar assemblies com um strong name, fazer o deploy de assemblies para o GAC (global assembly cache), implementar versionamento de assemblies e criar um assembly manifest. Vamos l√°?</p>
<h2>Preparando O Ambiente Para Usar Assemblies Entre M√∫ltiplos Servidores</h2>
<p>Quando voc√™ faz o deploy da sua aplica√ß√£o, todo o c√≥digo (inclusive o .NET Framework) √© compilado para assemblies (DLLs) que s√£o lidos e carregados na mem√≥ria pelo IIS. Em casos onde um servidor hospeda v√°rias aplica√ß√µes, v√°rios assemblies ser√£o deployados redundantemente. Por exemplo, se existem 3 aplica√ß√µes MVC, o assembly <em>System.Web.Mvc</em> ser√° carregado 3 vezes na mem√≥ria. Isso aumenta o tempo de inicializa√ß√£o e o uso da mem√≥ria do seu servidor.</p>
<p>Para essa se√ß√£o, voc√™ deve entender 2 conceitos que o ASP.NET utiliza na hospedagem de aplica√ß√µes para resolver esse problema: <em>Shadow Copying</em> e <em>Assembly Interning</em>.</p>
<p>Shadow Copying √© √∫til no momento de atualiza√ß√£o dos assemblies. Normalmente, o CLR (Commom Language Runtime) trava os assemblies quando eles est√£o em execu√ß√£o. Isso significa que voc√™ n√£o pode simplesmente copiar uma nova vers√£o em cima da atual. O Shadow Copying atua nesses cen√°rios copiando o assembly original para a pasta de arquivos tempor√°rios do ASP.NET, travando a c√≥pia e liberando a atualiza√ß√£o do assembly na localiza√ß√£o original. Isso √© habilitado por padr√£o nas pastas de assemblies (bin).</p>
<p>O Assembly Interning, dispon√≠vel a partir do ASP.NET 4.5, analisa essa pasta tempor√°ria procurando por assemblies duplicados (usados 3 vezes ou mais), como no caso de 3 aplica√ß√µes MVC no mesmo servidor. Esses assemblies s√£o ent√£o movidos para uma localiza√ß√£o especial, e todas as refer√™ncias originais s√£o substitu√≠das com &#8220;links simb√≥licos&#8221;, que apontam para essa nova localiza√ß√£o quando as aplica√ß√µes fazem requisi√ß√µes aos assemblies que foram compartilhados. Dessa forma, todos esses assemblies s√£o carregados apenas uma vez na mem√≥ria, economizando tempo e recursos.</p>
<p>Voc√™ usa o Assembly Interning pela ferramenta <em>aspnet_intern.exe</em>, na linha de comando. Ela pode ser usada assim:</p>
<p><code>aspnet_intern -mode exec -sourcedir "C:\Windows\Microsoft.NET\Framework64\v4.0.30319\Temporary ASP.NET Files" -interndir C:\CommonAssemblies</code></p>
<p>H√° tamb√©m um modo de an√°lise, onde a ferramenta mostra quais assemblies podem ser compartilhados:</p>
<p><code>aspnet_intern -mode analyze -sourcedir "C:\Windows\Microsoft.NET\Framework64\v4.0.30319\Temporary ASP.NET Files" -v</code></p>
<h2>Assinando Assemblies Com Um Strong Name</h2>
<p>O CLR suporta dois tipos de assemblies: os regulares e os com strong name (<em>&#8220;nome forte&#8221;</em>). Ambos t√™m a mesma estrutura, mas os fortemente nomeados t√™m chaves p√∫blicas e privadas que identificam o publicador e o conte√∫do do assembly. </p>
<p>Isso garante singularidade, pois nenhum assembly pode ter o mesmo nome forte que o seu (o nome √© baseado na chave privada). Os outros benef√≠cios s√£o que somente voc√™ pode publicar atualiza√ß√µes para o assembly e que o .NET consegue checar a integridade do assembly desde o momento que ele foi assinado.</p>
<p>Voc√™ pode assinar um assembly via linha de comando ou pelo Visual Studio. O primeiro passo √© gerar as chaves privada e p√∫blica por meio de um arquivo <em>.snk</em>. O seguinte comando gera esse arquivo:</p>
<p><code>sn -k myKey.snk</code></p>
<p>Pelo Visual Studio, isso √© feito na p√°gina de Properties do projeto, na aba Signing:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/26.png" alt="signing" width="715" height="554" class="alignnone size-full wp-image-604" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/26.png 715w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/26-300x232.png 300w" sizes="(max-width: 715px) 100vw, 715px" /></p>
<p>Habilitando a op√ß√£o Sign the assembly, o Visual Studio gera o arquivo com a chave e assina o assembly no momento da compila√ß√£o.</p>
<p>Assemblies assinados s√≥ podem referenciar assemblies que tamb√©m s√£o assinados por motivos de seguran√ßa. Caso voc√™ referencie um assembly n√£o assinado, ao invocar qualquer c√≥digo desse assembly o erro <em>Assembly generation failed &#8212; Referenced assembly &#8216;MyLib&#8217; does not have a strong name</em> √© lan√ßado.</p>
<p>Ap√≥s assinar um assembly, voc√™ pode ver a chave p√∫blica pela ferramenta <em>Sn.exe</em>, instalada no Visual Studio. O seguinte comando pode ser usado:</p>
<p><code>sn -Tp C:\Windows\Microsoft.NET\Framework\v4.0.30319\System.Data.dll</code></p>
<p>O resultado √© o seguinte, onde o <em>Public key token</em> representa a chave p√∫blica:</p>
<p><em>Microsoft (R) .NET Framework Strong Name Utility Version 4.0.30319.17929 Copyright (c)<br />
Microsoft Corporation. All rights reserved.<br />
Identity public key (hash algorithm: Unknown): 00000000000000000400000000000000<br />
Signature public key (hash algorithm: sha256): 002400000c800000<br />
140100000602000000240000525341310008000001000100613399aff18ef1<br />
a2c2514a273a42d9042b72321f1757102df9ebada69923e2738406c21e5b801552ab8d200a65a2<br />
35e001ac9adc25f2d811eb09496a4c6a59d4619589c69f5baf0c4179a47311d92555cd006acc8b<br />
5959f2bd6e10e360c34537a1d266da8085856583c85d81da7f3ec01ed9564c58d93d713cd0172c<br />
8e23a10f0239b80c96b07736f5d8b022542a4e74251a5f432824318b3539a5a087f8e53d2f135f<br />
9ca47f3bb2e10aff0af0849504fb7cea3ff192dc8de0edad64c68efde34c56d302ad55fd6e80f3<br />
02d5efcdeae953658d3452561b5f36c542efdbdd9f888538d374cef106acf7d93a4445c3c73cd9<br />
11f0571aaf3d54da12b11ddec375b3<br />
Public key token is b77a5c561934e089</em></p>
<p>Para empresas, √© importante manter a chave privada segura, pois algu√©m pode roub√°-la e distribuir assemblies alterados que parecem leg√≠timos. Por√©m, sem a chave privada, os desenvolvedores n√£o conseguem assinar o assembly para construir a aplica√ß√£o. </p>
<p>Para evitar esse problema, o conceito de <em>delay/partial signing</em> foi criado. Com isso, os desenvolvedores conseguem assinar o assembly somente com a chave p√∫blica, deixando para assinar o assembly com a chave privada somente no momento da publica√ß√£o. Na figura acima no Visual Studio, a op√ß√£o Delay sign only faz isso.</p>
<p>Lembre-se para o exame dos benef√≠cios de assinar um assembly e quando usar delayed signing.</p>
<h2>Fazendo O Deploy De Assemblies Para O GAC (Global Assembly Cache)</h2>
<p>GAC (Global Assembly Cache) √© uma biblioteca especializada em guardar assemblies. Fazer o deploy de um assembly para o GAC significa que ele estar√° dispon√≠vel para todas as aplica√ß√µes hospedadas naquele servidor.</p>
<p>Usar o GAC √© √∫til quando um assembly √© compartilhado entre m√∫ltiplas aplica√ß√µes. Outra raz√£o √© para melhoria de seguran√ßa, visto que normalmente somente administradores conseguem alterar o GAC. O GAC tamb√©m √© conveniente para fazer o deploy de m√∫ltiplas vers√µes do mesmo assembly.</p>
<p>Para o servidor de produ√ß√£o, voc√™ pode fazer o deploy de um assembly para o GAC por meio de alguma ferramenta como o Windows Installer 2.0 ou com o Web Deploy configurado com um provider para fazer a instala√ß√£o do arquivo no GAC. </p>
<p>No ambiente de desenvolvimento, voc√™ usa uma ferramenta chamada <em>Gacutil.exe</em>. Os seguintes comandos podem ser utilizados:</p>
<ul>
<li><code>gacutil -l</code> lista o conte√∫do do GAC;</li>
<li><code>gacutil -i [assembly name]</code> instala um assembly no GAC;</li>
<li><code>gacutil -u [assembly name]</code> remove um assembly do GAC.</li>
</ul>
<p>Ao referenciar um assembly no seu projeto, voc√™ pode adicionar uma refer√™ncia ao arquivo no GAC ou uma c√≥pia local. Quando o Visual Studio detecta que h√° um assembly do GAC referenciado, ele adiciona a refer√™ncia ao GAC.</p>
<h2>Implementando Versionamento De Assemblies</h2>
<p>Cada assembly carrega no seu manifesto o n√∫mero da sua vers√£o no seguinte formato: <em>{Major}.{Minor}.{Build}.{Revision}</em>.</p>
<p>Ao fazer o build de um assembly, h√° 2 n√∫meros de vers√£o que voc√™ deve levar em conta: a vers√£o do arquivo e a vers√£o do assembly .NET. Quando um projeto √© criado no Visual Studio, o arquivo <em>AssemblyInfo.cs</em> √© automaticamente criado contendo as seguintes linhas:</p>
<p><code>[assembly:¬†AssemblyVersion("1.0.0.0")]<br />
[assembly:¬†AssemblyFileVersion("1.0.0.0")]</code></p>
<p><em>AssemblyFileVersionAttribute</em> √© o que deve ser incrementado a cada build no seu processo de build. <em>AssemblyVersionAttribute</em> deve ser incrementado manualmente a cada deploy para produ√ß√£o.</p>
<p>Como dito anteriormente, m√∫ltiplas vers√µes de um mesmo assembly podem ser deployados para o GAC. Isso √© chamado <em>side-by-side hosting</em>.</p>
<p>O processo de encontrar o assembly correto para ser carregado pelo CLR come√ßa no n√∫mero da vers√£o mencionado no manifesto. Mas isso pode ser influenciado por alguns arquivos de configura√ß√£o, como o da aplica√ß√£o, do Publisher Policy ou da Machine Configuration.</p>
<p>Vamos supor que voc√™ tem um assembly carregado no GAC e v√°rias aplica√ß√µes dependem dele. Caso voc√™ publique uma nova vers√£o e queira for√ßar as aplica√ß√µes a usarem essa nova vers√£o, voc√™ pode publicar um Publisher Policy para o GAC com a seguinte configura√ß√£o:</p>
<p><script src="https://gist.github.com/edneypitta/c6daa1121fc7ecc03430.js"></script></p>
<p>Nesse exemplo, quando o CLR procura o assembly com a vers√£o 1.0.0.0, √© redirecionado para o 2.0.0.0.</p>
<p>Caso todos os assemblies estejam privados dentro da aplica√ß√£o, voc√™ pode adicionar a se√ß√£o de <em>probing </em>no arquivo web.config para o CLR procurar em outro diret√≥rio. Exemplo:</p>
<p><script src="https://gist.github.com/edneypitta/ea4c8abba64f5a633227.js"></script></p>
<p>Outra op√ß√£o √© usar o elemento <em>codeBase</em> para especificar uma localiza√ß√£o fora do diret√≥rio da aplica√ß√£o, podendo ser outro computador da rede ou algum lugar na internet. </p>
<p>Dois detalhes: os assemblies precisam ser fortemente nomeados (assinados) se estiverem fora da pasta da aplica√ß√£o e os assemblies localizados em outro computador s√£o baixados para uma pasta especial no GAC. </p>
<p>Um exemplo de configura√ß√£o do codeBase:</p>
<p><script src="https://gist.github.com/edneypitta/627d66ca08e8b271f8fe.js"></script></p>
<p>Para o exame, lembre-se que a op√ß√£o de probing s√≥ pode ser usada para localiza√ß√µes dentro do caminho da aplica√ß√£o, enquanto o codeBase permite outras localiza√ß√µes.</p>
<h2>Criando Um Assembly Manifest</h2>
<p>O Assembly Manifest √© o lugar que cont√©m os metadados do assembly e de todos os assemblies que ele depende.</p>
<p>A ferramenta <em>ILDasm </em>analisa o conte√∫do de assemblies compilados. Ela mostra da seguinte forma:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/8.png" alt="ildasm" width="562" height="301" class="alignnone size-full wp-image-607" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/8.png 562w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/8-300x161.png 300w" sizes="(max-width: 562px) 100vw, 562px" /></p>
<p>Note a presen√ßa do Assembly Manifest. Ele tem as seguintes fun√ß√µes:</p>
<ul>
<li>Enumera os arquivos do assembly;</li>
<li>Governa como as refer√™ncias ao tipo do assembly s√£o mapeadas para os arquivos que cont√©m a implementa√ß√£o;</li>
<li>Enumera os assemblies que o assembly depende;</li>
<li>Prov√™ um n√≠vel de separa√ß√£o entre os consumidores do assembly e os detalhes da implementa√ß√£o;</li>
<li>Renderiza a descri√ß√£o do assembly.</li>
</ul>
<p>Ele ainda cont√©m a identidade do assembly, como o nome, o n√∫mero da vers√£o, cultura e informa√ß√µes da assinatura. Voc√™ pode alterar esses valores no arquivo <em>AssemblyInfo.cs</em>, com os atributos <em>AssemblyCultureAttribute</em>, <em>AssemblyTitleAttribute </em>e <em>AssemblyDescriptionAttribute</em>.</p>
<p>Por √∫ltimo, o Assembly Manifest normalmente est√° no Portable Executable (PE), como uma DLL ou .exe junto com o Intermediate Language (IL) que descreve o assembly. Voc√™ pode criar um assembly em m√∫ltiplos arquivos com um Assembly Manifest ou com o Assembly Manifest incorporado dentro de cada PE.</p>
<hr />
<p>E finalmente, terminamos <strong>todos </strong>os objetivos da certifica√ß√£o üòÄ</p>
<p>Logo fa√ßo um post com algumas informa√ß√µes da prova, como as atualiza√ß√µes que vieram em abril de 2014 e algumas dicas a mais.</p>
<p>Obrigado por acompanhar essa jornada e at√© mais!</p>

				<p><a class="btn btn-default read-more" href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-6-share-assemblies-between-multiple-applications-and-servers/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 5.6 ‚Äì Share assemblies between multiple applications and servers">Leia Mais</a></p>

							</div><!-- .entry-content -->
					</div>
	</div>
</article><!-- #post-## -->

			
				
<article id="post-568" class="post-568 post type-post status-publish format-standard hentry category-certificacao tag-70-487">
	<div class="blog-item-wrap">
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-5-create-configure-and-publish-a-web-package/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 5.5 ‚Äì Create, configure, and publish a web package" >
			 				</a>
		<div class="post-inner-content">
			<header class="entry-header page-header">

				<h1 class="entry-title"><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-5-create-configure-and-publish-a-web-package/" rel="bookmark">Certifica√ß√£o Microsoft 70-487: Objetivo 5.5 ‚Äì Create, configure, and publish a web package</a></h1>

								<div class="entry-meta">
					<span class="posted-on"><i class="fa fa-calendar"></i> <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-5-create-configure-and-publish-a-web-package/" rel="bookmark"><time class="entry-date published" datetime="2016-03-09T07:45:46+00:00">09/03/2016</time><time class="updated" datetime="2016-03-09T17:33:45+00:00">09/03/2016</time></a></span><span class="byline"> <i class="fa fa-user"></i> <span class="author vcard"><a class="url fn n" href="https://edneypitta.github.io/old-blog/author/admin/">Edney Pitta</a></span></span>				<span class="comments-link"><i class="fa fa-comment-o"></i><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-5-create-configure-and-publish-a-web-package/#respond"><span class="dsq-postid" data-dsqidentifier="568 https://edneypitta.github.io/old-blog/?p=568">Deixe um coment√°rio</span></a></span>
				
				
				</div><!-- .entry-meta -->
							</header><!-- .entry-header -->

						<div class="entry-content">

				<p>Ol√° pessoal, tudo bem?<br />
O objetivo <strong>Create, configure, and publish a web package</strong>, pen√∫ltimo da certifica√ß√£o, cobre aspectos do Web Deployment Framework, ou Web Deploy.</p>
<p>Vamos ver como criar um IIS Install Package, configurar o processo de build para fazer o output de um Web Package e aplicar condi√ß√µes pr√© e p√≥s deploy.</p>
<h2>Criando Um IIS Install Package</h2>
<p>Nessa se√ß√£o, vamos cobrir as 4 principais maneiras de se criar um pacote Web Deploy: Visual Studio, IIS, prompt de comando e Windows PowerShell.</p>
<h4>Visual Studio</h4>
<p>No Visual Studio, voc√™ pode usar a ferramenta Publish para criar um pacote Web Deploy. Ela permite que voc√™ adicione scripts de banco de dados ou execute Migrations do EF e mude connection strings do web.config.</p>
<p>Voc√™ come√ßa o processo no menu Build > Publish {nome do projeto} ou com o bot√£o direito no projeto > Publish. A seguinte tela √© mostrada:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/21.png" alt="publish web" width="765" height="603" class="alignnone size-full wp-image-594" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/21.png 765w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/21-300x236.png 300w" sizes="(max-width: 765px) 100vw, 765px" /></p>
<p>Na se√ß√£o Profile, voc√™ precisa criar um Publish Profile, que √© guardado na solution para futuros publishs. Voc√™ pode criar um Publish Profile para cada ambiente que vai fazer o deploy da aplica√ß√£o, como desenvolvimento, homologa√ß√£o e produ√ß√£o.</p>
<p>Se voc√™ est√° fazendo deploy no Azure Websites, voc√™ pode fazer o download do Publish Profile diretamente do portal.</p>
<p>Na segunda p√°gina da janela, voc√™ escolhe o m√©todo do deploy. No nosso caso, escolhemos <strong>Web Deploy</strong> ou W<strong>eb Deploy Package</strong>.</p>
<p>Web Deploy faz o deploy diretamente para um servidor remoto que tem o servi√ßo Web Deploy instalado. Voc√™ precisa colocar o endere√ßo do servidor e as credenciais. O Web Deploy Package cria um pacote Web Deploy que voc√™ pode fazer a instala√ß√£o manualmente. Voc√™ s√≥ precisa entrar com uma localiza√ß√£o para o pacote e o nome do site, que pode ser mudado no momento do deploy:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/22.png" alt="publish web" width="763" height="601" class="alignnone size-full wp-image-595" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/22.png 763w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/22-300x236.png 300w" sizes="(max-width: 763px) 100vw, 763px" /></p>
<p>Na terceira parte voc√™ pode configurar op√ß√µes como a configura√ß√£o do build (Release por padr√£o), precompile do site, excluir arquivos do App_Data e configurar o banco de dados:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/23.png" alt="publish web" width="765" height="601" class="alignnone size-full wp-image-596" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/23.png 765w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/23-300x236.png 300w" sizes="(max-width: 765px) 100vw, 765px" /></p>
<p>Ap√≥s clicar em Publish, o Visual Studio vai gerar um pacote Web Deploy que voc√™ pode usar para fazer o deploy no IIS via IIS Manager ou linha de comando.</p>
<p>H√° algumas op√ß√µes extras na p√°gina de Properties do seu projeto, nas p√°ginas <strong>Package/Publish Web</strong> e <strong>Package/Publish SQL</strong>.</p>
<p>Em Package/Publish Web, voc√™ seleciona os arquivos que quer fazer o deploy nas seguintes op√ß√µes: somente os arquivos obrigat√≥rios, todos os arquivos do projeto ou todos os arquivos na pasta do projeto. Voc√™ pode tamb√©m selecionar uma op√ß√£o para incluir as configura√ß√µes do IIS Express para garantir que os servidores est√£o configurados corretamente.</p>
<p>A p√°gina Package/Publish SQL √© desabilitada por padr√£o, mostrando uma mensagem que voc√™ pode fazer as configura√ß√µes na janela de Publish. Mas voc√™ pode habilit√°-la e fazer as configura√ß√µes para o banco de dados.</p>
<h4>IIS</h4>
<p>Ap√≥s a instala√ß√£o do Web Deploy, o IIS Manager suporta tanto a cria√ß√£o de pacotes Web Deploy como a importa√ß√£o deles para instala√ß√£o. </p>
<p>√â poss√≠vel criar pacotes para uma aplica√ß√£o, site ou o servidor completo. Nesse √∫ltimo caso, o pacote cont√©m todas as configura√ß√µes do servidor como o applicationHost.config, registros do IIS, certificados SSL e o conte√∫do de todas as aplica√ß√µes hospedadas.</p>
<p>Voc√™ exporta um pacote abrindo o IIS Manager, selecionando a aplica√ß√£o, site ou servidor a ser exportado e indo em Export Application. A seguinte tela √© mostrada:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/24.png" alt="export application package" width="730" height="556" class="alignnone size-full wp-image-597" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/24.png 730w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/24-300x228.png 300w" sizes="(max-width: 730px) 100vw, 730px" /></p>
<p>Na op√ß√£o Manage Components, voc√™ pode configurar providers para configura√ß√µes de registro, fazer o deploy de assemblies no GAC ou um banco de dados no pacote.</p>
<p>O pr√≥ximo passo no wizard permite que voc√™ configure par√¢metros para os providers, como o nome do site ou a localiza√ß√£o do banco de dados.</p>
<p>Para fazer a importa√ß√£o de um pacote, voc√™ seleciona o servidor ou site e clica em Import Package. Esse pacote pode ter sido criado via exporta√ß√£o do IIS, Visual Studio ou linha de comando. Ap√≥s selecionar a localiza√ß√£o do pacote, uma janela √© aberta para a sele√ß√£o dos arquivos que voc√™ quer fazer o deploy. Voc√™ pode tamb√©m especificar os valores dos par√¢metros criados na exporta√ß√£o do pacote.</p>
<p>Na importa√ß√£o, h√° uma op√ß√£o chamada <em>whatif</em> que mostra as a√ß√µes que ser√£o feitas no deploy sem que elas sejam feitas de fato.</p>
<h4>Prompt De Comando</h4>
<p>A ferramenta usada na linha de comando √© a <em>MSDeploy</em>. Voc√™ pode us√°-la para sincronizar servidores, criar e fazer o deploy de pacotes. O comando a seguir, por exemplo, faz a sincroniza√ß√£o de 2 servidores com a op√ß√£o whatif:</p>
<p><code>msdeploy -whatif -verb:sync -source:iisApp="Default Web Site/MyApp" -dest:iisApp="Default Web Site/MyApp", computerName=Server2</code></p>
<p>Alguns segmentos importantes s√£o:</p>
<ul>
<li><strong>verb</strong>: especifica a opera√ß√£o a ser feita (delete, dump, getDependencies, getSystemInfo ou sync);</li>
<li><strong>source</strong>: especifica a fonte dos dados;</li>
<li><strong>dest</strong>: especifica o destino da opera√ß√£o;</li>
<li><strong>whatif</strong>: indica que o comando deve rodar sem fazer as altera√ß√µes de fato.</li>
</ul>
<p>Para fazer um deploy com MSDeploy, voc√™ pode usar o <em>.cmd</em> gerado pelo Visual Studio na cria√ß√£o do pacote. O comando √© o seguinte:</p>
<p><code>ProjectName.deploy.cmd /y /m:https://DestinationServerName:8172/MSDeploy.axd</code></p>
<p>N√£o √© necess√°rio memorizar todas as op√ß√µes do Web Deploy para o exame. Saiba apenas a sintaxe b√°sica, como a flag whatif. A lista completa das op√ß√µes do MSDeploy pode ser vista <a href="https://technet.microsoft.com/en-us/library/dd569106.aspx" target="_blank">aqui</a>.</p>
<h4>Windows PowerShell</h4>
<p>O Windows PowerShell √© uma ferramenta de linha de comando com capacidades extras. Como no prompt, voc√™ pode sincronizar servidores, criar e fazer o deploy de pacotes.</p>
<p>Para usar o Web Deploy do PowerShell, voc√™ precisa instalar o snap-in <em>WDeploySnapin3.0</em> com o comando <code>Add-PSSnapin WDeploySnapin3.0</code>.</p>
<p>Depois, voc√™ pode obter a lista dos comandos do Web Deploy com o comando <code>Get-Command -module WDeploySnapin3.0</code>. O resultado √©:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/25.png" alt="powershell" width="680" height="487" class="alignnone size-full wp-image-599" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/25.png 680w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/25-300x215.png 300w" sizes="(max-width: 680px) 100vw, 680px" /></p>
<p>Para fazer um deploy, voc√™ primeiro precisa de um arquivo Publish Settings (o mesmo gerado pelo Visual Studio quando voc√™ cria ou importa um Publish Profile). O comando <em>New-WDPublishSettings</em> pode ser usado:</p>
<p><code>$cred = Get-Credential<br />
New-WDPublishSettings -ComputerName WebServer -Site WebSite1 -Credentials $cred<br />
-AllowUntrusted -SiteUrl "http://www.mywebsite.com" -FileName C:\temp\mywebsite.<br />
publishsettings -AgentType wmsvc</code></p>
<p>O seguinte arquivo √© criado ap√≥s esse comando:</p>
<p><script src="https://gist.github.com/edneypitta/28a592f72f0ba15893f6.js"></script></p>
<p>Depois, o comando <em>Sync-WDApp</em> pode ser usado para fazer o deploy:</p>
<p><code>Sync-WDApp "MyApp" "MyAppDeployedWithPowerShell" -DestinationPublishSettings "C:\temp\mywebsite.publishsettings"</code></p>
<h2>Configurando O Processo De Build</h2>
<p>Voc√™ pode configurar o processo de build no TFS para fazer o deploy da sua aplica√ß√£o.</p>
<p>Editando o template da build com o seguinte comando, voc√™ pode criar um pacote em Release para fazer o deploy manualmente:</p>
<p><code>MSBuild "MyProjectName.csproj" /T:Package /P:Configuration=Release</code></p>
<p>Tamb√©m √© poss√≠vel especificar o par√¢metro <code>/p:DeployOnBuild=True</code>, que com o publish settings correto, faz o deploy da sua aplica√ß√£o automaticamente.</p>
<h2>Aplicando Condi√ß√µes Pr√© e P√≥s Deploy</h2>
<p>Com Web Deploy, voc√™ pode tamb√©m executar a√ß√µes antes e depois de fazer o deploy da aplica√ß√£o.</p>
<p>Voc√™ faz isso com as op√ß√µes <em>preSync</em> e <em>postSync</em> em conjunto com <em>runcommand</em>:</p>
<p><code>msdeploy -verb:sync -source:contentPath="C:\Test1" -dest:contentPath="C:\Test2"<br />
<strong>-preSync</strong>:runcommand="c:\MyBatchFile.bat"</code></p>
<hr />
<p>Terminamos mais um objetivo üòÄ</p>
<p>Fique de olho no pr√≥ximo post que ser√° sobre o <strong>√∫ltimo</strong> objetivo da certifica√ß√£o, <strong><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-6-share-assemblies-between-multiple-applications-and-servers/">Share assemblies between multiple applications and servers</a></strong>.</p>
<p>At√© l√°!</p>

				<p><a class="btn btn-default read-more" href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-5-create-configure-and-publish-a-web-package/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 5.5 ‚Äì Create, configure, and publish a web package">Leia Mais</a></p>

							</div><!-- .entry-content -->
					</div>
	</div>
</article><!-- #post-## -->

			
				
<article id="post-566" class="post-566 post type-post status-publish format-standard hentry category-certificacao tag-70-487">
	<div class="blog-item-wrap">
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-4-manage-packages-by-using-nuget/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 5.4 ‚Äì Manage packages by using NuGet" >
			 				</a>
		<div class="post-inner-content">
			<header class="entry-header page-header">

				<h1 class="entry-title"><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-4-manage-packages-by-using-nuget/" rel="bookmark">Certifica√ß√£o Microsoft 70-487: Objetivo 5.4 ‚Äì Manage packages by using NuGet</a></h1>

								<div class="entry-meta">
					<span class="posted-on"><i class="fa fa-calendar"></i> <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-4-manage-packages-by-using-nuget/" rel="bookmark"><time class="entry-date published" datetime="2016-03-08T10:54:27+00:00">08/03/2016</time><time class="updated" datetime="2016-03-09T07:46:29+00:00">09/03/2016</time></a></span><span class="byline"> <i class="fa fa-user"></i> <span class="author vcard"><a class="url fn n" href="https://edneypitta.github.io/old-blog/author/admin/">Edney Pitta</a></span></span>				<span class="comments-link"><i class="fa fa-comment-o"></i><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-4-manage-packages-by-using-nuget/#respond"><span class="dsq-postid" data-dsqidentifier="566 https://edneypitta.github.io/old-blog/?p=566">Deixe um coment√°rio</span></a></span>
				
				
				</div><!-- .entry-meta -->
							</header><!-- .entry-header -->

						<div class="entry-content">

				<p>Ol√° pessoal!<br />
O objetivo 5.4, <strong>Manage packages by using NuGet</strong>, cobre todos os aspectos do NuGet: como instalar e atualizar um pacote, criar e configurar um pacote e preparar um reposit√≥rio de pacotes. Vamos l√°?</p>
<h2>Instalando E Atualizando Um Pacote NuGet Existente</h2>
<p>O NuGet permite que voc√™ instale bibliotecas para usar no seu c√≥digo. Caso veja no exame alguma coisa sobre referenciar bibliotecas populares, pense em NuGet. Um pacote NuGet, al√©m de ter uma s√©rie de assemblies que voc√™ pode referenciar, pode conter arquivos, como JavaScripts e CSSs. Tamb√©m podem alterar seu arquivo de configura√ß√£o ou adicionar c√≥digo no seu projeto. A grande vantagem √© que, ao inv√©s de voc√™ ter que manualmente baixar assemblies ou arquivos, o NuGet faz isso automaticamente para voc√™.</p>
<p>A partir do Visual Studio 2012, os templates de projetos s√£o baseados no NuGet. Se voc√™ criar uma aplica√ß√£o ASP.NET MVC com o template de Internet, por exemplo, um arquivo chamado <em>packages.config</em> √© criado contendo todas as refer√™ncias ao pacotes utilizados. Esse arquivo √© parecido com isso:</p>
<p><script src="https://gist.github.com/edneypitta/b0337d6edfc55f24fb7c.js"></script></p>
<h4>Janela Manage NuGet Packages</h4>
<p>A janela Manage NuGet Packages serve para voc√™ gerenciar os pacotes instalados no seu projeto e instalar novos pacotes.</p>
<p>Voc√™ pode acess√°-la pelo Visual Studio no menu Tools > Library Package Manager > Manage NuGet Packages. Desse modo, os pacotes da solution inteira s√£o abertos:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/19.png" alt="manage nuget packages" width="850" height="568" class="alignnone size-full wp-image-579" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/19.png 850w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/19-300x200.png 300w" sizes="(max-width: 850px) 100vw, 850px" /></p>
<p>Indo na se√ß√£o Online, voc√™ pode procurar os pacotes dispon√≠veis e instal√°-los diretamente do Visual Studio. Na parte Update, o Visual Studio detecta todas as atualiza√ß√µes dispon√≠veis e voc√™ pode instal√°-las com 1 clique.</p>
<p>Voc√™ pode abrir os pacotes instalados apenas para 1 projeto, clicando com o bot√£o direito em References > Manage NuGet Packages. A tela funciona exatamente igual.</p>
<p>Outra grande vantagem do NuGet √© que, ao instalar ou atualizar um pacote, ele detecta automaticamente todas as depend√™ncias e as instala juntamente com o pacote.</p>
<h4>Package Manager Console</h4>
<p>Para instalar, atualizar ou remover pacotes, voc√™ pode tamb√©m usar o Package Manager Console, que √© um Windows PowerShell integrado ao Visual Studio. Ele √© assim:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/20.png" alt="package manager console" width="835" height="319" class="alignnone size-full wp-image-580" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/20.png 835w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/20-300x115.png 300w" sizes="(max-width: 835px) 100vw, 835px" /></p>
<p>Para instalar um pacote, o comando <em>Install-Package</em> pode ser usado. Exemplo: <code>Install-Package Ninject</code>.</p>
<p>Com isso, o assembly do Ninject √© baixado para a pasta <em>packages</em> da solution e uma refer√™ncia √© adicionada ao projeto. </p>
<p>Uma feature interessante do console √© o auto complete, acionado quando voc√™ aperta a tecla Tab. Ele funciona para os nomes dos comandos e dos pacotes.</p>
<p>Para desinstalar um pacote, o comando √© o <em>Uninstall-Package</em>: <code>Uninstall-Package Ninject</code>.</p>
<p>Esse comando remove o pacote do packages.config, remove a refer√™ncia do projeto e deleta a pasta da packages. Todas as altera√ß√µes aos arquivos de configura√ß√£o tamb√©m s√£o revertidas. Por√©m, as depend√™ncias instaladas n√£o s√£o automaticamente removidas.</p>
<p>Para atualizar um pacote, o comando √© <em>Update-Package</em>: <code>Update-Package Ninject</code>.</p>
<p>Caso voc√™ n√£o especifique um pacote para o comando Update-Package, todos os pacotes da solution s√£o atualizados. Para atualizar todos os pacotes de apenas um projeto, o par√¢metro <em>-Project</em> pode ser usado: <code>Update-Package -Project NuGetTest</code>.</p>
<p>Alguns pacotes oferecem comandos que s√£o integrados ao console. Ap√≥s instalar o pacote do Entity Framework, por exemplo, voc√™ pode usar os comandos <em>Enable-Migrations</em>, <em>Add-Migration</em> e <em>Update-Database</em> para usar Code First Migrations.</p>
<p>O √∫ltimo detalhe √© que os comandos s√£o executados por padr√£o para o primeiro projeto da solution. Isso pode ser alterado no drop-down <em>Default project</em>.</p>
<h4>Compartilhando Pacotes</h4>
<p>Incluir os pacotes no controle de vers√£o n√£o √© uma boa pr√°tica, pois todos eles ser√£o guardados e baixados para cada pessoa que acessar o projeto. Se voc√™ esquecer de adicionar um pacote no controle de vers√£o, tamb√©m vai haver problemas para os outros usu√°rios.</p>
<p>Ao clicar com o bot√£o direito na solution no Visual Studio, voc√™ pode habilitar a op√ß√£o <em>Enable Package Restore On Build</em>. Ao fazer isso, uma pasta <em>.nuget</em> √© adicionada na solution com um arquivo <em>NuGet.exe</em>. Dessa forma, no build do projeto o NuGet vai validar se todos os pacotes est√£o instalados e, se algum estiver faltando, vai fazer o download automaticamente. Isso permite que voc√™ n√£o precise colocar os pacotes no controle de vers√£o.</p>
<p>Se voc√™ quer mudar a localiza√ß√£o dos pacotes instalados, basta adicionar um arquivo <em>nuget.config</em> na solution com o seguinte conte√∫do:</p>
<p><script src="https://gist.github.com/edneypitta/601c40aa7b91a12e374d.js"></script></p>
<h2>Criando E Configurando Um Pacote NuGet</h2>
<p>Qualquer pessoa pode adicionar um pacote NuGet na galeria, tornando-o dispon√≠vel a todos. Essa se√ß√£o explica como criar e configurar um pacote para disponibiliz√°-lo na galeria.</p>
<h4>Conte√∫do Do Pacote</h4>
<p>Um pacote NuGet √© descrito pelo arquivo <em>.nuspec</em>, contendo um XML que descreve seu pacote. Ele √© mais ou menos assim:</p>
<p><script src="https://gist.github.com/edneypitta/f61b190e57772dadb1e3.js"></script></p>
<p>Em seguida, voc√™ vai colocar seus arquivos. A conven√ß√£o √© distribu√≠-los em 3 pastas: <em>\lib</em>, <em>\content</em> e <em>\tools</em>.</p>
<p>A pasta lib cont√©m os assemblies. Se seu pacote for multiplataforma, voc√™ pode usar subpastas para separar essas vers√µes.</p>
<p>A pasta content tem arquivos de configura√ß√£o, imagens, JavaScript, CSS, etc. Todos os arquivos nessa pasta ser√£o inclu√≠dos no projeto. Isso significa que se voc√™ tiver uma imagem em <em>\content\images\myimg.png</em>, ela ser√° adicionada no projeto em <em>\images\myimg.png</em>.<br />
Arquivos de transforma√ß√£o tamb√©m podem ser colocados nessa pasta. Se houver um arquivo <em>app.config.transformation</em> ou <em>web.config.transformation</em>, o NuGet vai colocar os elementos desses arquivos que n√£o estiverem no arquivo de configura√ß√£o do projeto.<br />
Isso tamb√©m √© poss√≠vel via c√≥digo com arquivos <em>.cs.pp</em> quando voc√™ quer adicionar c√≥digo no Global.asax ou alguma classe, por exemplo. H√° alguns tokens que podem ser usados, como o <em>$rootnamespace$</em>, que insere o namespace correto: <code>namespace $rootnamespace$.Models</code>.</p>
<p>Por fim, na pasta tools podem ser colocados scripts Windows PowerShell para rodar quando seu pacote √© carregado, instalado e desinstalado, com os nomes <em>Init.ps1</em>, <em>Install.ps1</em> e <em>Uninstall.ps1</em>, respectivamente.</p>
<p>Um √∫ltimo detalhe √© que se seu pacote n√£o tiver nada dentro das pastas content e lib ele √© considerado um pacote a n√≠vel de solution. Voc√™ usa isso se seu objetivo for adicionar comandos ao Package Manager Console, como o pacote do Entity Framework.</p>
<h4>Criando Seu Pacote NuGet</h4>
<p>Voc√™ pode criar seu pacote NuGet via linha de comando ou usando a ferramenta <em>NuGet Package Explorer</em>.</p>
<p>Para usar a linha de comando, voc√™ deve ter o arquivo <em>NuGet.exe</em> e adicionar a localiza√ß√£o dele no PATH.</p>
<p>O primeiro comando que voc√™ deve utilizar √© o <code>NuGet Update -self</code>, que atualiza o NuGet para a √∫ltima vers√£o.</p>
<p>Para criar um pacote NuGet a partir de um assembly, o comando √© o <code>nuget spec MyAssembly.dll</code>. Com isso o arquivo <em>MyAssembly.nuspec</em> √© criado contendo o manifesto para voc√™ editar o nome, descri√ß√£o, depend√™ncias, etc.</p>
<p>Depois disso, o comando <code>nuget pack MyAssembly.nuspec</code> cria de fato seu pacote no arquivo <em>MyAssembly.dll.1.0.0.nupkg</em>. Voc√™ pode test√°-lo no Visual Studio abrindo o Package Manager Console e digitando o comando <code>Install-Package MyAssembly.dll -Source "C:\{location_of_your_package}"</code>. </p>
<p>Voc√™ pode tamb√©m criar um pacote NuGet a partir de um projeto do Visual Studio. Basta ir para a pasta do projeto (onde est√° o arquivo <em>.csproj</em>) e rodar o comando <code>nuget spec</code>. O arquivo <em>.nuspec</em> vai ser criado obtendo os tokens de id, vers√£o, autor e descri√ß√£o do arquivo <em>AssemblyInfo.cs</em> do projeto. Depois o comando <code>nuget pack MyProject.csproj</code> cria o pacote completo.</p>
<p>Para criar um pacote complexo que contenha as pastas lib, content e tools, voc√™ precisa criar seu pacote manualmente com o comando <code>nuget spec</code>, editar o arquivo <em>.nuspec</em> como desejado, adicionar os arquivos nas pastas e criar o pacote com <code>nuget pack YourPackage.nuspec</code>.</p>
<p>Com seu pacote pronto, voc√™ vai public√°-lo no NuGet. Com a API Key gerada no site do NuGet, voc√™ deve primeiro rodar o comando <code>NuGet SetApiKey Your-API-Key</code>. Depois, a publica√ß√£o √© feita com <code>NuGet Push YourPackage.nupkg</code>.</p>
<p>A outra op√ß√£o para criar e publicar um pacote √© usando o programa <em>NuGet Package Explorer</em>. Essa ferramenta permite que voc√™ crie o manifesto com um editor gr√°fico, adicione arquivos nas pastas lib, content e tools e publique o pacote para o NuGet com 1 clique. Voc√™ pode tamb√©m abrir pacotes, tanto locais quanto do feed, para explorar o conte√∫do.</p>
<h2>Preparando Um Reposit√≥rio De Pacotes</h2>
<p>Por padr√£o, o Visual Studio configura o reposit√≥rio oficial do NuGet para obter pacotes. Voc√™ pode adicionar reposit√≥rios adicionais, tanto locais quanto remotos.</p>
<p>Para criar um reposit√≥rio local, voc√™ vai em Tools > Library Package Manager > Package Manager Settings. Na aba Package Source, a seguinte tela √© mostrada:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/7.png" alt="options" width="803" height="470" class="alignnone size-full wp-image-583" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/7.png 803w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/7-300x176.png 300w" sizes="(max-width: 803px) 100vw, 803px" /></p>
<p>Depois √© s√≥ clicar o bot√£o Add, colocar um nome e um caminho. Todos os arquivos <em>.nupkg</em> ser√£o listados na aba Online da janela Manage NuGet Packages e no Package Manager Console, no drop-down Package-source.</p>
<p>Voc√™ pode tamb√©m criar um feed remoto que roda no IIS. Voc√™ deve criar uma web application vazia no Visual Studio e instalar o pacote <em>NuGet.Server</em>. Esse pacote adiciona todo o c√≥digo necess√°rio para a exposi√ß√£o dos seus pacotes como ATOM. Os pacotes dentro da pasta <em>Packages </em>ser√£o disponibilizados (podendo ser configurado via web.config). </p>
<p>√â poss√≠vel habilitar publica√ß√µes para seu reposit√≥rio remoto, como se fosse a galeria oficial do NuGet. Para isso basta adicionar a API Key no web.config.</p>
<p>Depois, basta hospedar sua aplica√ß√£o no IIS e acessar o feed na URL <em>http://{locationofyoursite}/nuget/</em>. Adicionando essa URL no Package Source, √© poss√≠vel instalar pacotes desse reposit√≥rio normalmente.</p>
<hr />
<p>E isso √© tudo üôÇ</p>
<p>Obrigado pela leitura e aguarde o pr√≥ximo post, que ser√° sobre o objetivo <strong><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-5-create-configure-and-publish-a-web-package/">Create, configure, and publish a web package</a></strong>.</p>
<p>At√© mais!</p>

				<p><a class="btn btn-default read-more" href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-4-manage-packages-by-using-nuget/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 5.4 ‚Äì Manage packages by using NuGet">Leia Mais</a></p>

							</div><!-- .entry-content -->
					</div>
	</div>
</article><!-- #post-## -->

			
				
<article id="post-564" class="post-564 post type-post status-publish format-standard hentry category-certificacao tag-70-487">
	<div class="blog-item-wrap">
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-3-configure-a-web-application-for-deployment/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 5.3 ‚Äì Configure a web application for deployment" >
			 				</a>
		<div class="post-inner-content">
			<header class="entry-header page-header">

				<h1 class="entry-title"><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-3-configure-a-web-application-for-deployment/" rel="bookmark">Certifica√ß√£o Microsoft 70-487: Objetivo 5.3 ‚Äì Configure a web application for deployment</a></h1>

								<div class="entry-meta">
					<span class="posted-on"><i class="fa fa-calendar"></i> <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-3-configure-a-web-application-for-deployment/" rel="bookmark"><time class="entry-date published" datetime="2016-03-05T12:07:44+00:00">05/03/2016</time><time class="updated" datetime="2016-03-08T10:56:09+00:00">08/03/2016</time></a></span><span class="byline"> <i class="fa fa-user"></i> <span class="author vcard"><a class="url fn n" href="https://edneypitta.github.io/old-blog/author/admin/">Edney Pitta</a></span></span>				<span class="comments-link"><i class="fa fa-comment-o"></i><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-3-configure-a-web-application-for-deployment/#respond"><span class="dsq-postid" data-dsqidentifier="564 https://edneypitta.github.io/old-blog/?p=564">Deixe um coment√°rio</span></a></span>
				
				
				</div><!-- .entry-meta -->
							</header><!-- .entry-header -->

						<div class="entry-content">

				<p>Ol√° pessoal!<br />
Vamos ao objetivo 5.3, <strong>Configure a web application for deployment</strong>. Esse objetivo cobre como trocar de release para debug, transformar web.config com XSLT, usar SetParameters e configurar o Windows Azure.</p>
<h2>Mudando De Release Para Debug</h2>
<p>Ao fazer o build de um projeto, voc√™ usa uma <em>build configuration</em>. Duas configura√ß√µes existem por padr√£o: <em>release </em>e <em>debug</em>.</p>
<p>Em release, o c√≥digo √© otimizado para rodar o mais r√°pido poss√≠vel, o que voc√™ com certeza deseja no ambiente de produ√ß√£o.</p>
<p>O modo debug √© o ideal para o ambiente de desenvolvimento, pois instru√ß√µes extra s√£o adicionadas no c√≥digo compilado, permitindo que ela seja debugado.</p>
<p>Al√©m da build configuration, h√° uma configura√ß√£o no web.config que diz respeito a compila√ß√£o. Mudando o valor do atributo debug para false, voc√™ desliga o modo de debug:</p>
<p><code>&lt;configuration&gt;<br />
&lt;system.web&gt;<br />
&lt;compilation debug=&quot;true&quot; targetFramework=&quot;4.5&quot; /&gt;<br />
&lt;/system.web&gt;<br />
&lt;/configuration&gt;</code></p>
<p>No Visual Studio, voc√™ tem a op√ß√£o de escolher quais debuggers utilizar no modo debug:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/5.png" alt="debuggers" width="848" height="500" class="alignnone size-full wp-image-572" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/5.png 848w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/5-300x177.png 300w" sizes="(max-width: 848px) 100vw, 848px" /></p>
<h2>Transformando O Web.Config Com XSLT</h2>
<p>No seu arquivo web.config, voc√™ guarda v√°rios tipos de configura√ß√µes como connection strings, app settings customizadas, etc. Esses valores dependem do ambiente que a aplica√ß√£o est√° rodando. Voc√™ n√£o pode fazer o deploy de uma aplica√ß√£o com a connection string do seu banco local, por exemplo. Fazer as altera√ß√µes manualmente, al√©m de levar tempo, √© suscet√≠vel a erros. </p>
<p>A√≠ entra o <em>web.config transformation syntax</em>. Com ele voc√™ define um XML que descreve as mudan√ßas a serem feitas no web.config ao mudar de debug para release.</p>
<p>Ao criar uma aplica√ß√£o ASP.NET MVC, os arquivos de transforma√ß√£o s√£o criados automaticamente:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/6.png" alt="web.config" width="335" height="486" class="alignnone size-full wp-image-573" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/6.png 335w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/6-207x300.png 207w" sizes="(max-width: 335px) 100vw, 335px" /></p>
<p>As transforma√ß√µes trabalham com a sintaxe do XML-Document-Transform. Segue um exemplo de arquivo de transforma√ß√£o que muda a connection string e configura o customErrors:</p>
<p><script src="https://gist.github.com/edneypitta/f791c82d952679cc5ded.js"></script></p>
<p>Voc√™ come√ßa especificando o namespace para o arquivo de transforma√ß√£o. Depois, com os atributos <em>xdt:Transform </em>e <em>xdt:Locator</em>, voc√™ configura como os elementos devem ser encontrados e o que acontece quando isso acontecer. Nesse exemplo, apenas mudamos a connection string, mas o elemento customErrors √© completamente substitu√≠do.</p>
<p>Para o atributo Locator, voc√™ pode usar os valores Match, XPath e Condition. A explica√ß√£o detalhada do funcionamento deles pode ser vista <a href="https://msdn.microsoft.com/en-us/library/dd465326(v=vs.110).aspx" target="_blank">aqui</a>. Para o atributo Transform, os poss√≠veis valores s√£o: Insert, InsertBefore, InsertAfter, Remove, RemoveAll, RemoveAttributes e SetAttributes.</p>
<h2>Usando SetParameters Para Preparar Um IIS App Pool</h2>
<p>A <em>web.config transformation</em> √© feita em tempo de compila√ß√£o. Isso √© bom quando voc√™ sabe em quais ambientes a aplica√ß√£o ser√° publicada.</p>
<p>Com Web Deploy, por√©m, voc√™ tem outra op√ß√£o: <em>parametriza√ß√£o</em>. Com ela voc√™ pode parametrizar valores em tempo de instala√ß√£o, facilitando a distribui√ß√£o de um pacote para v√°rios lugares. </p>
<p>Um pacote Web Deploy cria alguns arquivos para voc√™, como o <strong>{nome do projeto}.zip</strong>, que √© o pacote Web Deploy, e o <strong>{nome do projeto}.deploy.cmd</strong>, que permite que voc√™ fa√ßa o deploy da linha de comando. H√° tamb√©m o arquivo <strong>{nome do projeto}.SetParameters.xml</strong>, que tem uma s√©rie de valores que o MSDeploy.exe usa para fazer o deploy da aplica√ß√£o. Esse arquivo √© gerado dinamicamente, obtendo todas as configura√ß√µes do seu projeto, como as connection strings do web.config.</p>
<p>A parametriza√ß√£o √© feita quando voc√™ adiciona um arquivo <em>Parameters.xml</em> para o pacote Web Deploy. Nesse arquivo, voc√™ indica o arquivo que quer modificar, quais vari√°veis ser√£o alteradas e um valor padr√£o para elas. Na instala√ß√£o do pacote via IIS Manager, esses valores ser√£o pedidos para o usu√°rio digitar. </p>
<p>Segue um exemplo de uma se√ß√£o de um web.config abaixo de <em>system.ServiceModel</em>:</p>
<p><script src="https://gist.github.com/edneypitta/5930e5636bade580aabe.js"></script></p>
<p>O seguinte Parameters.xml pode ser usado:</p>
<p><script src="https://gist.github.com/edneypitta/9b0fbeb75ed715cfe771.js"></script></p>
<p>Segue a explica√ß√£o de alguns atributos importantes:</p>
<ul>
<li><strong>name</strong>: o nome que √© mostrado no IIS Manager;</li>
<li><strong>description</strong>: a descri√ß√£o que √© mostrada no IIS Manager;</li>
<li><strong>defaultValue</strong>: o valor que √© pr√©-carregado no input;</li>
<li><strong>scope</strong>: uma express√£o regular que mostra os arquivos que o par√¢metro se aplica;</li>
<li><strong>kind</strong>: especifica o tipo do recurso na qual o par√¢metro ser√° aplicado (<em>XmlFile </em>ou <em>TextFile</em>);</li>
<li><strong>match</strong>: no caso de XmlFile, um XPath que seleciona o elemento que ser√° alterado.</li>
</ul>
<p>Caso voc√™ esteja fazendo o deploy pela linha de comando, voc√™ pode usar as op√ß√µes <em>declareParamFile </em>and <em>setParamFile </em> para especificar os arquivos Parameters.xml e SetParameters.xml:</p>
<p><code>msdeploy.exe -verb:sync -source:apphostconfig="default web site/application"<br />
-dest:archivedir="C:\packages\application" <strong>-declareParamFile</strong>="C:\source\application\<br />
deployment\declareParamsFile.xml"</code></p>
<p><code>msdeploy.exe -verb:sync -dest:apphostconfig="default web site/application"<br />
-source:archivedir="C:\packages\application" <strong>-setParamFile</strong>="C:\source\application\<br />
deployment\setParamsFile.xml"</code></p>
<p>Por √∫ltimo, caso voc√™ n√£o queira alterar o arquivo SetParameters.xml na m√£o em um processo de build por exemplo, existe uma task do MSBuild chamada XmlPoke que pode automatizar isso.</p>
<p>Para o exame, lembre-se do seguinte: web.config transformation √© feita em tempo de compila√ß√£o, enquanto parametriza√ß√£o em tempo de instala√ß√£o.</p>
<h2>Configurando O Windows Azure</h2>
<p>Um projeto Cloud tem dois arquivos de configura√ß√£o: <em>ServiceConfiguration.Cloud.cscfg</em> e <em>ServiceConfiguration.Local.cscfg</em>. O arquivo Local tem valores para o Windows Azure Emulator, enquando o Cloud tem os valores que ser√£o usados no deploy para o Azure.</p>
<p>Nesses arquivos voc√™ pode configurar o n√∫mero de inst√¢ncias para cada role, quaisquer app settings customizadas, thumbprints para certificados, VPNs no caso de m√°quinas virtuais (VM), etc.</p>
<p>Ao criar um projeto Cloud com uma web role e uma worker role, o seguinte arquivo de configura√ß√£o √© criado:</p>
<p><script src="https://gist.github.com/edneypitta/1c5109148f7e28c56f69.js"></script></p>
<p>O elemento <em>Role</em>, al√©m de especificar o nome da sua role, pode tamb√©m ter o atributo <em>vmName</em> para ser usado como o nome o DNS para sua VM.</p>
<p>Dentro do elemento Role h√° o elemento <em>Instances</em> que indica o n√∫mero de inst√¢ncias da role e o elemento <em>ConfigurationSettings</em>, que √© uma cole√ß√£o chave valor.</p>
<p>Outros elementos que podem ser adicionados s√£o o <em>Certificates</em> e o <em>OsImage</em>:</p>
<p><script src="https://gist.github.com/edneypitta/b14ad00966a51d17182e.js"></script></p>
<p>Depois do elemento <em>Roles</em>, voc√™ pode especificar o elemento <em>NetworkConfiguration</em>. Essa se√ß√£o descreve os valores de DNS e VPN. Um exemplo de configura√ß√£o:</p>
<p><script src="https://gist.github.com/edneypitta/3b81287417d85f1d0a99.js"></script></p>
<hr />
<p>Chegamos ao final desse objetivo üôÇ Faltam apenas 3!</p>
<p>Obrigado pela leitura e fique de olho no pr√≥ximo post, que ser√° sobre o objetivo <strong><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-4-manage-packages-by-using-nuget/">Manage packages by using NuGet</a></strong>.</p>
<p>At√© mais!</p>

				<p><a class="btn btn-default read-more" href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-3-configure-a-web-application-for-deployment/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 5.3 ‚Äì Configure a web application for deployment">Leia Mais</a></p>

							</div><!-- .entry-content -->
					</div>
	</div>
</article><!-- #post-## -->

			
				
<article id="post-555" class="post-555 post type-post status-publish format-standard hentry category-certificacao tag-70-487">
	<div class="blog-item-wrap">
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-2-choose-a-deployment-strategy-for-a-windows-azure-web-application/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 5.2 ‚Äì Choose a deployment strategy for a Windows Azure web application" >
			 				</a>
		<div class="post-inner-content">
			<header class="entry-header page-header">

				<h1 class="entry-title"><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-2-choose-a-deployment-strategy-for-a-windows-azure-web-application/" rel="bookmark">Certifica√ß√£o Microsoft 70-487: Objetivo 5.2 ‚Äì Choose a deployment strategy for a Windows Azure web application</a></h1>

								<div class="entry-meta">
					<span class="posted-on"><i class="fa fa-calendar"></i> <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-2-choose-a-deployment-strategy-for-a-windows-azure-web-application/" rel="bookmark"><time class="entry-date published" datetime="2016-03-03T12:05:14+00:00">03/03/2016</time><time class="updated" datetime="2016-03-05T12:08:44+00:00">05/03/2016</time></a></span><span class="byline"> <i class="fa fa-user"></i> <span class="author vcard"><a class="url fn n" href="https://edneypitta.github.io/old-blog/author/admin/">Edney Pitta</a></span></span>				<span class="comments-link"><i class="fa fa-comment-o"></i><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-2-choose-a-deployment-strategy-for-a-windows-azure-web-application/#comments"><span class="dsq-postid" data-dsqidentifier="555 https://edneypitta.github.io/old-blog/?p=555">1 Coment√°rio</span></a></span>
				
				
				</div><!-- .entry-meta -->
							</header><!-- .entry-header -->

						<div class="entry-content">

				<p>Ol√° pessoal, tudo bem?<br />
Vamos ao objetivo <strong>Choose a deployment strategy for a Windows Azure web application</strong>, que fala de conceitos de deploy voltados para o Azure.</p>
<h2>Fazendo In-Place Upgrade E VIP Swap</h2>
<p>Em casos de web farm, o Azure oferece 3 maneiras de atualizar sua aplica√ß√£o: deletando e redeployando, In-Place Upgrade e VIP Swap.</p>
<p>Deletar seu cloud service e redeployar √© f√°cil, mas requer um downtime para seu servi√ßo. Voc√™ deve usar essa op√ß√£o em casos de mudan√ßa de n√∫mero de endpoints, porta, firewall, certificados, etc. </p>
<h4>In-Place Upgrade</h4>
<p>Para entender o <strong>In-Place Upgrade</strong>, √© necess√°rio entender os conceitos de <em>Upgrade Domain</em> e <em>Fault Domain</em>. Upgrade Domain √© uma unidade l√≥gica da sua aplica√ß√£o, enquanto Fault Domain √© uma unidade f√≠sica. </p>
<p>Vamos supor que voc√™ precisa de 5 inst√¢ncias para sua aplica√ß√£o. <strong>Automaticamente</strong> (isso n√£o √© control√°vel por voc√™), o Azure vai distribuir cada inst√¢ncia entre o n√∫mero de Upgrade Domains que voc√™ configurou no atributo <em>upgradeDomainCount</em> no arquivo Service Definition (valor padr√£o: 5, valor m√°ximo: 20). Na hora do deploy da sua aplica√ß√£o (In-Place Upgrade), o Azure atualiza um Upgrade Domain por vez, evitando downtime para o seu servi√ßo.</p>
<p>Fault Domain, tamb√©m automaticamente atribu√≠do pelo Azure, √© quando as inst√¢ncias s√£o separadas em servidores f√≠sicos diferentes. Somente com 2 Fault Domains o Azure garante o SLA de 99.95%.</p>
<p>Para entender melhor esses conceitos, recomendo esse post: <a href="https://blog.tompawlak.org/windows-azure-fault-and-upgrade-domain" target="_blank">https://blog.tompawlak.org/windows-azure-fault-and-upgrade-domain</a>. Vamos em frente.</p>
<p>Voc√™ tem 2 op√ß√µes para disparar um deploy In-Place Upgrade. A primeira √© diretamente pelo portal do Azure, fazendo o upload do pacote direto para seu Cloud Service. A outra √© pelo Visual Studio, que necessita de um certificado emitido pelo portal para identifica√ß√£o:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/16.png" alt="new subscription" width="534" height="444" class="alignnone size-full wp-image-557" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/16.png 534w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/16-300x249.png 300w" sizes="(max-width: 534px) 100vw, 534px" /></p>
<p>Como dito antes, ao fazer um deploy, o Azure vai atualizar seus Upgrade Domains um por um. Ent√£o se voc√™ tiver mais do que 2 Upgrade Domains, no momento do deploy eles ter√£o diferentes vers√µes da sua aplica√ß√£o. Isso pode ser um problema caso haja altera√ß√µes no schema do banco de dados, por exemplo. Para resolver isso, existe uma t√©cnica de deploy chamada VIP Swap.</p>
<h4>VIP Swap</h4>
<p>Um Cloud Service no Azure tem 2 ambientes: produ√ß√£o e staging. Ambos t√™m o mesmo hardware, diferenciando apenas o <em>virtual IP</em> (VIP) e a URL do servi√ßo.</p>
<p>O VIP Swap √© quando o VIP e a URL dos ambientes de produ√ß√£o e staging s√£o trocados. Isso significa que voc√™ pode fazer o deploy da nova vers√£o da sua aplica√ß√£o no ambiente de staging, test√°-la, e promov√™-la para produ√ß√£o instantaneamente com o VIP Swap. Depois, voc√™ pode deletar o ambiente de staging para evitar custos.</p>
<p>Isso permite que voc√™ atualize todas as inst√¢ncias de uma s√≥ vez, evitando diferentes vers√µes em produ√ß√£o ao mesmo tempo. Ainda vai haver requests que est√£o apontando para a vers√£o antiga, mas o problema √© bastante minimizado com essa t√©cnica.</p>
<p>Para realizar um VIP Swap, primeiro voc√™ precisa fazer o upload da nova vers√£o da aplica√ß√£o para o ambiente de staging, seja por deletando o servi√ßo e redeployando ou via In-Place Upgrade. Depois de validado, basta ir no portal do Azure no ambiente de staging e clicar no bot√£o Swap:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/17.png" alt="swap" width="848" height="545" class="alignnone size-full wp-image-558" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/17.png 848w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/17-300x193.png 300w" sizes="(max-width: 848px) 100vw, 848px" /></p>
<h2>Criando E Configurando Input E Internal Endpoints</h2>
<p>H√° dois tipos de endpoints para suas inst√¢ncias de Cloud Services: <em>Input Endpoint</em> e <em>Internal Endpoint</em>. Um Input Endpoint √© usado para conex√µes externas (internet) feitas via HTTP, HTTPS ou TCP. Internal Endpoints s√£o usados para conex√µes internas entre as inst√¢ncias do Cloud Services via HTTP ou TCP.</p>
<p>Seu Cloud Service pode ter 25 endpoints de cada tipo, que podem ser espalhados entre as roles. Quando voc√™ cria um projeto Cloud com uma web role e uma worker role, o arquivo <em>ServiceDefinition.csdef</em> fica assim:</p>
<p><script src="https://gist.github.com/edneypitta/4645e4befaa14c50df81.js"></script></p>
<p>A web role por padr√£o vem com um input endpoint na porta 80, padr√£o para conex√µes HTTP. A worker role n√£o tem endpoints por padr√£o, mas voc√™ pode adicionar um input endpoint sem problemas:</p>
<p><code>&lt;Endpoints&gt;<br />
&lt;InputEndpoint name=&quot;WorkerRoleInput&quot; port=&quot;8080&quot; protocol=&quot;http&quot; localPort=&quot;8080&quot;/&gt;<br />
&lt;/Endpoints&gt;</code></p>
<p>Agora o load balancer encaminha os requests na porta 8080 para a worker role. Dentro dela, voc√™ pode usar um HttpListener para lidar com os requests:</p>
<p><script src="https://gist.github.com/edneypitta/e8460b46cf4f0d16e7d0.js"></script></p>
<p>Um ponto importante √© que no Windows Azure emulator, as portas s√£o remapeadas para a pr√≥xima porta dispon√≠vel, para evitar conflitos. Isso significa que a porta 80 ser√° remapeada para 81 e a 8080 para 8081.</p>
<p>Voc√™ tamb√©m pode editar as configura√ß√µes de endpoint diretamente do Visual Studio, clicando duas vezes no nome da role no projeto Cloud Services:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/18.png" alt="cloud service" width="849" height="397" class="alignnone size-full wp-image-560" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/18.png 849w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/18-300x140.png 300w" sizes="(max-width: 849px) 100vw, 849px" /></p>
<p>Ao selecionar o tipo do endpoint, h√° uma terceira op√ß√£o chamada <em>InstanceInputEndpoint</em>. Nela voc√™ pode especificar um range de portas externas que s√£o mapeadas para uma √∫nica porta. A configura√ß√£o fica assim:</p>
<p><code>&lt;InstanceInputEndpoint name=&quot;Endpoint2&quot; <strong>localPort</strong>=&quot;1000&quot; protocol=&quot;tcp&quot;&gt;<br />
&lt;AllocatePublicPortFrom&gt;<br />
&lt;FixedPortRange min=&quot;10016&quot; max=&quot;10020&quot;/&gt;<br />
&lt;/AllocatePublicPortFrom&gt;<br />
&lt;/InstanceInputEndpoint&gt;</code></p>
<p>O elemento InstanceInputEndpoint especifica a porta local para onde os requests ser√£o direcionados e o protocolo, enquanto o elemento AllocatePublicPortFrom especifica o range de portas p√∫blicas que ser√£o ouvidas.</p>
<h2>Especificando Configura√ß√µes Do Sistema Operacional</h2>
<p>Quando voc√™ cria um projeto Cloud Services, h√° dois arquivos de configura√ß√£o: o <em>ServiceDefinition.csdef</em>, que especifica as configura√ß√µes do Cloud Service como um todo, e o <em>ServiceConfiguration.cscfg</em> para configura√ß√µes espec√≠ficas das roles, como o n√∫mero de inst√¢ncias, configura√ß√µes de diagnostics, certificados, etc.</p>
<p>Uma configura√ß√£o importante para o exame √© a especifica√ß√£o da vers√£o do sistema operacional. Ao criar um novo projeto Cloud com uma web role e uma worker role, o arquivo .cscfg fica assim:</p>
<p><script src="https://gist.github.com/edneypitta/5fcfc82186c1c810dd75.js"></script></p>
<p>O atributo <em>osFamily</em> √© o n√∫mero da fam√≠lia do sistema operacional. A especifica√ß√£o completa das fam√≠lias e o suporte de cada uma delas pode ser vista <a href="https://azure.microsoft.com/pt-br/documentation/articles/cloud-services-guestos-update-matrix/" target="_blank">aqui</a>.</p>
<p>O atributo <em>osVersion</em> especifica exatamente a vers√£o do Guest OS em que sua role vai rodar. O valor * significa sempre a √∫ltima vers√£o. Para colocar uma vers√£o espec√≠fica, o seguinte formato deve ser utilizado: <code>WA-GUEST-OS-M.m_YYYYMM-nn</code>, onde <em>WA-GUEST-OS</em> √© um valor fixo, <em>M.m</em> √© o n√∫mero da vers√£o, <em>YYYY</em> o ano, <em>MM </em>o m√™s e <em>nn </em>um n√∫mero sequencial para diferenciar os releases.</p>
<hr />
<p>Terminamos mais um objetivo üôÇ</p>
<p>Obrigado pela leitura e fique de olho no pr√≥ximo post, que ser√° sobre o objetivo 5.3: <strong><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-3-configure-a-web-application-for-deployment/">Configure a web application for deployment</a></strong>.</p>
<p>At√© mais!</p>

				<p><a class="btn btn-default read-more" href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-2-choose-a-deployment-strategy-for-a-windows-azure-web-application/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 5.2 ‚Äì Choose a deployment strategy for a Windows Azure web application">Leia Mais</a></p>

							</div><!-- .entry-content -->
					</div>
	</div>
</article><!-- #post-## -->

			
				
<article id="post-546" class="post-546 post type-post status-publish format-standard hentry category-certificacao tag-70-487">
	<div class="blog-item-wrap">
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-1-design-a-deployment-strategy/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 5.1 ‚Äì Design a deployment strategy" >
			 				</a>
		<div class="post-inner-content">
			<header class="entry-header page-header">

				<h1 class="entry-title"><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-1-design-a-deployment-strategy/" rel="bookmark">Certifica√ß√£o Microsoft 70-487: Objetivo 5.1 ‚Äì Design a deployment strategy</a></h1>

								<div class="entry-meta">
					<span class="posted-on"><i class="fa fa-calendar"></i> <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-1-design-a-deployment-strategy/" rel="bookmark"><time class="entry-date published" datetime="2016-03-03T00:33:34+00:00">03/03/2016</time><time class="updated" datetime="2016-03-03T12:06:21+00:00">03/03/2016</time></a></span><span class="byline"> <i class="fa fa-user"></i> <span class="author vcard"><a class="url fn n" href="https://edneypitta.github.io/old-blog/author/admin/">Edney Pitta</a></span></span>				<span class="comments-link"><i class="fa fa-comment-o"></i><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-1-design-a-deployment-strategy/#respond"><span class="dsq-postid" data-dsqidentifier="546 https://edneypitta.github.io/old-blog/?p=546">Deixe um coment√°rio</span></a></span>
				
				
				</div><!-- .entry-meta -->
							</header><!-- .entry-header -->

						<div class="entry-content">

				<p>Ol√° pessoal, tudo bem?<br />
Esse objetivo √© o primeiro do t√≥pico <strong>Deploying web applications and services</strong>, os √∫ltimos 20% da certifica√ß√£o. Nesse objetivo vamos ver como fazer o deploy de aplica√ß√µes web usando XCopy, criar um IIS Install Package, automatizar deploys com TFS ou Build Server e fazer deploy para web farms.</p>
<h2>Fazendo Deploy De Aplica√ß√µes Web Usando XCopy</h2>
<p>O jeito mais f√°cil de fazer o deploy de uma aplica√ß√£o para um ambiente de produ√ß√£o √© manualmente. Seja via FTP ou conex√£o remota, chamamos de XCopy quando voc√™ copia os arquivos da sua m√°quina local para uma de produ√ß√£o. XCopy, na verdade, √© um comando DOS para transfer√™ncia de v√°rios arquivos ao mesmo tempo. A sintaxe dele √© a seguinte:</p>
<p><code>xcopy /I /S /E &lt;source path&gt; &lt;destination path&gt;</code></p>
<p>A op√ß√£o <em>/I</em> diz que voc√™ copiando uma pasta, a <em>/S</em> que voc√™ quer copiar todos os subdiret√≥rios e a <em>/E</em> que as subpastas devem ser copiadas mesmo que vazias. H√° tamb√©m a op√ß√£o <em>/d</em>, que indica que somente os arquivos novos atualizados ou novos devem ser copiados.</p>
<h4>Configurando O IIS</h4>
<p>Na primeira vez que voc√™ copiar os arquivos do seu site para seu servidor, voc√™ vai precisar configur√°-lo no IIS, que √© o servidor de hospedagem para aplica√ß√µes no Windows. Voc√™ precisa dizer ao IIS qual √© a pasta do seu site e como ele vai estar dispon√≠vel para os usu√°rios.</p>
<p>Assumindo que voc√™ tenha uma aplica√ß√£o em <em>C:\Development\MyApp</em> e quer mov√™-la para <em>C:\inetpub\wwwroot\MyApp</em>, o primeiro passo √© fazer o XCopy:</p>
<p><code>xcopy /I /S C:\Development\MyApp C:\inetpub\wwwroot\MyApp</code></p>
<p>Para fazer a configura√ß√£o no IIS, voc√™ abre o IIS Manager e a op√ß√£o de adicionar um website. Voc√™ precisa dar um nome e apontar a localiza√ß√£o da pasta (nesse caso, <em>C:\inetpub\wwwroot\MyApp</em>). Normalmente tamb√©m voc√™ deve colocar um host name para o IIS mapear os requests HTTP na porta 80. </p>
<p>No exemplo abaixo, alteramos a porta para 81 e deixamos o host name em branco, para podermos acessar o site somente pela porta. A configura√ß√£o fica assim:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/15.png" alt="iis add website" width="546" height="524" class="alignnone size-full wp-image-550" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/15.png 546w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/15-300x288.png 300w" sizes="(max-width: 546px) 100vw, 546px" /></p>
<p>Acessando <em>http://localhost:81</em> no browser, o ISS j√° consegue mapear o request e mand√°-lo para a aplica√ß√£o. </p>
<h4>Preparando Um Website Para Deploy</h4>
<p>Quando os arquivos s√£o atualizados, o IIS detecta as modifica√ß√µes e come√ßa a atualizar o site. Isso gera erros nos requests feitos enquanto a aplica√ß√£o est√° parcialmente atualizada.</p>
<p>Para evitar que os usu√°rios vejam uma tela de erro, voc√™ pode colocar um arquivo com o nome <em>App_offline.htm</em> no root do website. O IIS ent√£o vai mostrar esse HTML ao inv√©s da mensagem de erro. Ap√≥s a atualiza√ß√£o de todos os arquivos, voc√™ deve apagar esse arquivos para o IIS voltar a processar os requests.</p>
<p>Outro ponto √© que o App Domain pode restartar v√°rias vezes enquanto os arquivos est√£o sendo atualizados. Voc√™ pode configurar o atributo <em>waitChangeNotification</em> no seu web.config para especificar o n√∫mero de segundos de espera antes que o App Domain restarte:</p>
<p><script src="https://gist.github.com/edneypitta/ef422e752129cc300612.js"></script></p>
<h4>Ferramental Para Deploys XCopy</h4>
<p>Usar o XCopy pela linha de comando n√£o √© a melhor maneira de voc√™ copiar seus arquivos. O Visual Studio oferece algumas ferramentas para auxiliar o processo de deploy, e vamos analisar uma delas agora: a Copy Website Tool. Nela voc√™ pode:</p>
<ul>
<li>Copiar arquivos de c√≥digo para o target especificado;</li>
<li>Copiar arquivos usando os protocolos suportados: IIS local, IIS remoto, FTP e HTTP (comente com FrontPage Server Extensions);</li>
<li>Escolher quais arquivos quer sincronizar do seu c√≥digo para o target;</li>
<li>Automaticamente copiar o arquivo App_offline.htm quando o deploy come√ßar e remov√™-lo quando terminar.</li>
</ul>
<h2>Criando Um IIS Install Package</h2>
<p>Lan√ßado em 2009, o Web Deploy permite que voc√™ crie um pacote de deploy que al√©m dos arquivos do seu site cont√©m configura√ß√µes de banco de dados, IIS, registro, assemblies para carregar no GAC, etc.</p>
<p>O Web Deployment Framework simplifica o processo podendo ser utilizado via Visual Studio, IIS, prompt de comando e Windows PowerShell. Tamb√©m ajuda em ambientes complexos como web farm, onde voc√™ sincroniza diferentes servidores usando o Web Deploy.</p>
<p>Para o exame, lembre-se: Web Deployment Framework √© a ferramenta ideal para deploys complexos.</p>
<h2>Automatizando Deploys Com TFS Ou Build Server</h2>
<p>Por motivos fora do escopo do exame, voc√™ deve saber como automatizar o deploy de uma aplica√ß√£o com TFS ou Build Server. √â importante conhecer os conceitos por tr√°s disso, como Continuous Integration e Continuous Deployment com testes de unidade e integra√ß√£o, mas estes n√£o s√£o prov√°veis de estarem no exame.</p>
<p>Voc√™ pode automatizar o deploy de uma aplica√ß√£o no Azure de forma bem f√°cil. H√° uma op√ß√£o &#8220;Set up deployment from source control&#8221; que implementa o conceito de Continuous Deployment: cada check-in no controle de vers√£o dispara um deploy automaticamente. O reposit√≥rio pode ser TFS ou Git.</p>
<p>√â poss√≠vel tamb√©m fazer isso on-premises com TFS. Voc√™ pode buildar sua aplica√ß√£o via linha de comando com MSBuild da seguinte forma:</p>
<p><code>MSBuild /target:Publish /p:PublishDir=\\myserver\drops\</code></p>
<p>Depois, editando a Build Definition no TFS, voc√™ pode adicionar um comando de Publish para publicar o pacote no Azure.</p>
<p>√â importante entender que existem duas ferramentas TFS: uma on-premises e uma na nuvem, atualmente chamada VSTS.</p>
<h2>Fazendo Deploys Para Web Farms</h2>
<p>Para essa se√ß√£o, voc√™ deve entender os conceitos de <em>scale up</em> e <em>scale out</em>. </p>
<p><strong>Scale up</strong> √© quando voc√™ aumenta a capacidade do seu hardware para fazer uma melhora de performance na sua aplica√ß√£o. Isso √© feito quando voc√™ coloca mais mem√≥ria RAM, troca de processador ou coloca um SSD no lugar do seu HD. Por√©m, al√©m de ser caro, melhoras no hardware tem o limite do pr√≥prio hardware. </p>
<p>A√≠ entra o conceito de <strong>scale out</strong>, onde voc√™ usa m√∫ltiplos servidores para hospedar sua aplica√ß√£o ao inv√©s de melhorar um. Juntos, eles formam o que chamamos de <em>web farm </em>ou ambiente distribu√≠do. Um <em>load balancer</em> √© necess√°rio para &#8220;espalhar&#8221; os requests entre os servidores da forma mais eficiente poss√≠vel.</p>
<p>Por√©m, um trabalho extra √© necess√°rio para sua aplica√ß√£o poder ser hospedada numa web farm. Normalmente voc√™ configura 1 servidor, depois cria as aplica√ß√µes no IIS de todos os outros com exatamente as mesmas configura√ß√µes. </p>
<p>Outro ponto de preocupa√ß√£o √© a <em>session</em>, que s√£o dados do usu√°rio gravados na mem√≥ria. Com web farm, requests subsequentes de um mesmo usu√°rio podem cair em v√°rias m√°quinas diferentes, o que pode impossibilitar o uso de session. Para resolver esse problema, voc√™ precisa mover os dados da sess√£o para uma m√°quina externa ou at√© um banco de dados. H√° 4 tipos de <em>session states</em>:</p>
<ul>
<li><strong>InProc</strong>: valor padr√£o, onde os dados da session s√£o gravados na mem√≥ria;</li>
<li><strong>StateServer</strong>: guarda os dados da session em um processo separado chamado <em>ASP.NET state service</em>;</li>
<li><strong>SQLServer</strong>: guarda os dados da session num banco de dados SQL Server;</li>
<li><strong>Off</strong>: desabilita a session</li>
</ul>
<p>Voc√™ tamb√©m pode escolher ativar <em>session affinity</em>, onde todos os requests de um usu√°rio v√£o cair no mesmo servidor, garantindo que os dados da session estar√£o na mem√≥ria. Por√©m, nem todos os load balancers suportam isso.</p>
<hr />
<p>Chegamos ao final desse objetivo.</p>
<p>Obrigado pela leitura e fique de olho no pr√≥ximo post, que ser√° sobre o objetivo <strong><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-2-choose-a-deployment-strategy-for-a-windows-azure-web-application/">Choose a deployment strategy for a Windows Azure web application</a></strong>.</p>
<p>At√© mais!</p>

				<p><a class="btn btn-default read-more" href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-1-design-a-deployment-strategy/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 5.1 ‚Äì Design a deployment strategy">Leia Mais</a></p>

							</div><!-- .entry-content -->
					</div>
	</div>
</article><!-- #post-## -->

			
				
<article id="post-538" class="post-538 post type-post status-publish format-standard hentry category-certificacao tag-70-487">
	<div class="blog-item-wrap">
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-4-5-consume-web-api-web-services/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 4.5 &#8211; Consume Web API web services" >
			 				</a>
		<div class="post-inner-content">
			<header class="entry-header page-header">

				<h1 class="entry-title"><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-4-5-consume-web-api-web-services/" rel="bookmark">Certifica√ß√£o Microsoft 70-487: Objetivo 4.5 &#8211; Consume Web API web services</a></h1>

								<div class="entry-meta">
					<span class="posted-on"><i class="fa fa-calendar"></i> <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-4-5-consume-web-api-web-services/" rel="bookmark"><time class="entry-date published" datetime="2016-03-02T15:56:28+00:00">02/03/2016</time><time class="updated" datetime="2016-03-03T00:34:48+00:00">03/03/2016</time></a></span><span class="byline"> <i class="fa fa-user"></i> <span class="author vcard"><a class="url fn n" href="https://edneypitta.github.io/old-blog/author/admin/">Edney Pitta</a></span></span>				<span class="comments-link"><i class="fa fa-comment-o"></i><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-4-5-consume-web-api-web-services/#respond"><span class="dsq-postid" data-dsqidentifier="538 https://edneypitta.github.io/old-blog/?p=538">Deixe um coment√°rio</span></a></span>
				
				
				</div><!-- .entry-meta -->
							</header><!-- .entry-header -->

						<div class="entry-content">

				<p>Ol√° pessoal!<br />
O objetivo <strong>Consume Web API web services</strong>, o √∫ltimo sobre Web API, cobre como consumir servi√ßos Web API usando HttpClient e mandar e receber requests em formatos diferentes.</p>
<h2>Consumindo Servi√ßos Web API</h2>
<p>A classe <em>HttpClient</em> √© usada para fazer requisi√ß√µes e trabalhar com o retorno. Para os exemplos dessa se√ß√£o, vamos utilizar o seguinte m√©todo como setup:</p>
<p><script src="https://gist.github.com/edneypitta/b94e54f60eaeed11bddc.js"></script></p>
<p>Vamos passar pelos 4 m√©todos HTTP mais comuns: Get, Post, Put e Delete, al√©m de aprender como lidar com exce√ß√µes.</p>
<h4>HttpGet</h4>
<p>Para fazer um Get, o m√©todo <em>GetAsync</em> do HttpClient √© usado. N√£o h√° um equivalente s√≠ncrono, somente o m√©todo Async.<br />
Ap√≥s o retorno da opera√ß√£o, a propriedade <em>IsSuccessStatusCode</em> √© populada. O c√≥digo ficaria assim:</p>
<p><script src="https://gist.github.com/edneypitta/faf5810261b4c0ec76a0.js"></script></p>
<p>O m√©todo <em>ReadAsAsync</em> √© um m√©todo de extens√£o, implementado no assembly <em>System.Net.Http.Formatting</em>.</p>
<h4>HttpPost</h4>
<p>Para executar um Post, voc√™ pode usar os m√©todos <em>PostAsync </em>e <em>PostAsJsonAsync</em>, que simplifica as coisas caso o Content-Type seja JSON. A implementa√ß√£o √© bem simples:</p>
<p><script src="https://gist.github.com/edneypitta/7a176ad23ca879c189c8.js"></script></p>
<h4>HttpPut</h4>
<p>Um Put pode ser feito praticamente da mesma forma que um Post. H√° os m√©todos <em>PutAsync </em>e <em>PutAsJsonAsync</em>:</p>
<p><script src="https://gist.github.com/edneypitta/3f2bc033d6d1cd944078.js"></script></p>
<h4>HtpDelete</h4>
<p>O m√©todo <em>DeleteAsync</em> faz um Delete. O m√©todo apenas recebe uma string com a URL, j√° com o identificador do item a ser deletado:</p>
<p><script src="https://gist.github.com/edneypitta/ec456452d34e05d5a3b7.js"></script></p>
<h4>Exce√ß√µes</h4>
<p>Exce√ß√µes podem ocorrer ao chamar um servi√ßo Web API. </p>
<p>Nesses casos, por√©m, na chamada ao m√©todo que fez a opera√ß√£o (GetAsync, PostAsync, etc.), a exce√ß√£o n√£o √© automaticamente lan√ßada. Voc√™ deve explicitamente chamar o m√©todo <em>EnsureSuccessStatusCode</em> para que isso aconte√ßa.</p>
<p>Veja os seguintes trechos de c√≥digo. O primeiro n√£o lan√ßa a exce√ß√£o, enquanto o segundo faz:</p>
<p><script src="https://gist.github.com/edneypitta/69e21acaa29399ed443d.js"></script></p>
<h2>Mandando E Recebendo Requests Em Formatos Diferentes</h2>
<p>H√° algumas op√ß√µes em rela√ß√£o aos formatos aceitos pelo framework Web API. Isso inclui <em>application/xml</em>, <em>text/html</em>, <em>image/png</em>, <em>application/json</em>, etc. </p>
<p>Esses valores s√£o retornados no header Content-Type dos responses, indicando o tipo do retorno. Eles tamb√©m podem ser usados no header Accept para que o client especifique o tipo do retorno que ele quer receber. Nesses headers, m√∫ltiplos valores s√£o aceitos sendo separados por v√≠rgula.</p>
<p>√â poss√≠vel tamb√©m implementar formatos customizados. Voc√™ pode fazer isso herdando das classes <em>MediaTypeFormatter</em> ou <em>BufferedMediaTypeFormatter</em>. A principal diferen√ßa entre elas √© MediaTypeFormatter suporta a leitura ass√≠ncrona, enquanto BufferedMediaTypeFormatter suporta somente leituras s√≠ncronas.</p>
<p>Primeiro, voc√™ deve herdar da classe desejada e adicionar o media type a ser suportado na cole√ß√£o <em>SupportedMediaTypes</em>:</p>
<p><script src="https://gist.github.com/edneypitta/52fa0de34dc65324ce45.js"></script></p>
<p>Voc√™ precisa tamb√©m adicionar seu formatter customizado no HttpConfiguration: <code>config.Formatters.Add(new CustomCsvFormatter());</code>.</p>
<p>Depois, voc√™ implementa sua l√≥gica na classe criada. As propriedades <em>CanWriteType</em> e <em>CanReadType</em> devem ser sobrescritas, indicando se o tipo pode ser serializado e desserializado. O m√©todo <em>WriteToStream</em> tamb√©m deve ser implementado e se o formatter suportar desserializa√ß√£o (CanReadType true), o m√©todo ReadFromStream precisa ser implementado.</p>
<p>Detalhes sobre a implementa√ß√£o n√£o cair√£o no exame, mas √© bom seguir o exemplo da documenta√ß√£o para ter uma ideia melhor de como implementar um formatter customizado: <a href="http://www.asp.net/web-api/overview/formats-and-model-binding/media-formatters" target="_blank">http://www.asp.net/web-api/overview/formats-and-model-binding/media-formatters</a>.</p>
<hr />
<p>E encerramos o cap√≠tulo sobre Web API üòÄ</p>
<p>O pr√≥ximo post ser√° sobre o objetivo 5.1, <strong><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-1-design-a-deployment-strategy/">Design a deployment strategy</a></strong>. Esse √© o primeiro objetivo do √∫ltimo t√≥pico da certifica√ß√£o.</p>
<p>Obrigado e at√© mais!</p>

				<p><a class="btn btn-default read-more" href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-4-5-consume-web-api-web-services/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 4.5 &#8211; Consume Web API web services">Leia Mais</a></p>

							</div><!-- .entry-content -->
					</div>
	</div>
</article><!-- #post-## -->

			
				
<article id="post-526" class="post-526 post type-post status-publish format-standard hentry category-certificacao tag-70-487">
	<div class="blog-item-wrap">
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-4-4-host-and-manage-a-web-api/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 4.4 ‚Äì Host and manage a Web API" >
			 				</a>
		<div class="post-inner-content">
			<header class="entry-header page-header">

				<h1 class="entry-title"><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-4-4-host-and-manage-a-web-api/" rel="bookmark">Certifica√ß√£o Microsoft 70-487: Objetivo 4.4 ‚Äì Host and manage a Web API</a></h1>

								<div class="entry-meta">
					<span class="posted-on"><i class="fa fa-calendar"></i> <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-4-4-host-and-manage-a-web-api/" rel="bookmark"><time class="entry-date published" datetime="2016-03-02T11:44:00+00:00">02/03/2016</time><time class="updated" datetime="2016-03-02T15:57:24+00:00">02/03/2016</time></a></span><span class="byline"> <i class="fa fa-user"></i> <span class="author vcard"><a class="url fn n" href="https://edneypitta.github.io/old-blog/author/admin/">Edney Pitta</a></span></span>				<span class="comments-link"><i class="fa fa-comment-o"></i><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-4-4-host-and-manage-a-web-api/#comments"><span class="dsq-postid" data-dsqidentifier="526 https://edneypitta.github.io/old-blog/?p=526">1 Coment√°rio</span></a></span>
				
				
				</div><!-- .entry-meta -->
							</header><!-- .entry-header -->

						<div class="entry-content">

				<p>Ol√° pessoal!<br />
O objetivo 4.4 da certifica√ß√£o Microsoft 70-487, <strong>Host and manage a Web API</strong>, trata dos principais mecanismos de hospedagem de um servi√ßo Web API, como self-hosting, IIS e Azure. Tamb√©m mostra como limitar o tamanho das mensagens recebidas e configurar a hospedagem para streaming. Vamos l√°?</p>
<h2>Web API Self-Hosting</h2>
<p>Para fazer o self-hosting de uma Web API, voc√™ pode usar qualquer template de projeto que crie um execut√°vel, como Windows Service, Windows Forms Application, Console Application, etc. </p>
<p>Com o projeto criado, voc√™ deve instalar o framework de self-hosting via NuGet com o pacote <em>Microsoft ASP.NET Web API Self Host</em> e referenciar os assemblies <em>System.Web.Http</em> e <em>System.Web.Http.SelfHost</em>:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/12.png" alt="self host" width="727" height="488" class="alignnone size-full wp-image-530" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/12.png 727w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/12-300x201.png 300w" sizes="(max-width: 727px) 100vw, 727px" /></p>
<p>Depois, h√° dois passos essenciais: instanciar as classes <em>HttpSelfHostConfiguration </em>e <em>HttpSelfHostServer</em>. O c√≥digo fica assim:</p>
<p><script src="https://gist.github.com/edneypitta/a23737585b6d138a4f70.js"></script></p>
<p>A primeira verifica√ß√£o se <em>MyWebApi.Controllers.ValuesController</em> √© null serve para o framework de self-hosting carregar os controllers do seu projeto Web API. Isso somente √© necess√°rio quando os controllers est√£o num assembly separado.</p>
<p>A classe HttpSelfHostConfiguration recebe o endere√ßo base de onde o servi√ßo vai ser acessado. Um ponto importante aqui √© que as rotas precisam ser configuradas diretamente na propriedade Routes.</p>
<p>Por √∫ltimo, a classe HttpSelfHostServer √© instanciada recebendo a configura√ß√£o criada anteriormente. O m√©todo OpenAsync toma conta de abrir o servidor com as configura√ß√µes passadas.</p>
<h2>Web API IIS Hosting</h2>
<p>Hospedar uma Web API no IIS n√£o tem nada diferente de outras aplica√ß√µes web. </p>
<p>Voc√™ pode primeiro criar uma application pool, conforme abaixo:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/13.png" alt="application pool" width="293" height="266" class="alignnone size-full wp-image-531" /></p>
<p>Depois, criar um novo website embaixo do nodo Sites ou adicionar uma aplica√ß√£o ou diret√≥rio virtual:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/14.png" alt="add application" width="426" height="316" class="alignnone size-full wp-image-532" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/14.png 426w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/14-300x223.png 300w" sizes="(max-width: 426px) 100vw, 426px" /></p>
<p>Com tudo isso no lugar, sua aplica√ß√£o deve estar hospedada com sucesso.</p>
<h2>Web API Windows Azure Hosting</h2>
<p>Essa √© uma se√ß√£o conceitual para as 3 formas de hospedar uma Web API no Azure. S√£o elas:</p>
<ul>
<li><strong>Windows Azure Websites</strong>: a op√ß√£o mais r√°pida. Com Azure Websites voc√™ n√£o se importa com a m√°quina que est√° hospedando seu servi√ßo, apesar de poder escalar sua aplica√ß√£o facilmente;</li>
<li><strong>Windows Azure Cloud Services</strong>: Cloud Services oferecem um controle maior. Voc√™ tem mais tamanhos de inst√¢ncia para escolher e pode criar uma arquitetura mais complexa, como uma Web API numa Web Role se comunicando via queue com uma Worker Role, por exemplo. Voc√™ pode tamb√©m configurar o IIS e outras configura√ß√µes da m√°quina quando a role come√ßar. Consegue tamb√©m se conectar via remote com a m√°quina;</li>
<li><strong>Windows Azure Virtual Machines (VMs)</strong>: usar VMs no Azure te d√° controle completo. Voc√™ precisa gerenciar sua m√°quina inteira, de atualiza√ß√µes at√© configura√ß√µes.</li>
</ul>
<p>Fazer o deploy de uma Web API para o Azure Websites ou Cloud Services √© bem simples usando o Visual Studio. Isso ser√° coberto com mais detalhes no cap√≠tulo 5.</p>
<h2>Limitando O Tamanho Das Mensagens</h2>
<p>Ao hospedar sua Web API, voc√™ com certeza gostaria de limitar o tamanho dos requests para que seu servidor n√£o sofra de ataques DDoS.</p>
<p>Usando self-hosting, voc√™ pode fazer isso setando as propriedades <em>MaxReceivedMessageSize </em>e <em>MaxBufferSize </em>do objeto HttpSelfHostConfiguration:</p>
<p><code>var config = new HttpSelfHostConfiguration(baseAddress);<br />
config.MaxReceivedMessageSize = 1024;<br />
config.MaxBufferSize = 1024;</code></p>
<p>Hospedando no IIS, isso √© poss√≠vel pela configura√ß√£o do atributo <em>maxRequestLength </em>no web.config:</p>
<p><code>&lt;httpRuntime maxRequestLength=&quot;1024&quot; /&gt;</code></p>
<h2>Configurando Streaming</h2>
<p>√Äs vezes voc√™ quer que seu servi√ßo Web API receba arquivos grandes, como algum upload de imagens ou v√≠deos. Nesses casos, √© importante configurar sua Web API para usar streaming ao inv√©s de buffer, j√° que bufferizar arquivos grandes consome muita mem√≥ria.</p>
<p>Hospedando sua aplica√ß√£o no IIS, voc√™ consegue implementar sua l√≥gica se usar buffer ou streaming herdando a classe <em>WebHostBufferPolicySelector</em>, a √∫nica que implementa a interface <em>IHostBufferPolicySelector</em>, e sobrescrevendo o m√©todo <em>UseBufferedInputStream</em>. Por exemplo, voc√™ pode habilitar streaming apenas para um controller espec√≠fico:</p>
<p><script src="https://gist.github.com/edneypitta/9a95eee1e58dd24ea54f.js"></script></p>
<p>Depois disso, voc√™ deve configurar o HttpConfiguration para usar sua implementa√ß√£o: <code>config.Services.Replace(typeof(IHostBufferPolicySelector), new StreamingPolicySelector());</code>.</p>
<p>Por √∫ltimo, voc√™ precisa configurar as propriedades do ASP.NET como <em>maxAllowedContentLength </em>e <em>maxRequestLength </em>no web.config para que o IIS n√£o rejeite os requests grandes:</p>
<p><script src="https://gist.github.com/edneypitta/850bf2e6b8cdaed226a0.js"></script></p>
<p>Para self-hosting, voc√™ s√≥ consegue habilitar streaming para todos os controllers. Voc√™ faz isso configurando a propriedade <em>TransferMode</em> no objeto HttpSelfHostConfiguration:</p>
<p><code>// somente requests<br />
selfHostConf.TransferMode = TransferMode.StreamedRequest;<br />
// somente responses<br />
selfHostConf.TransferMode = TransferMode.StreamedResponse;<br />
// ambos<br />
selfHostConf.TransferMode = TransferMode.Streamed;</code></p>
<hr />
<p>Isso √© tudo para esse objetivo üôÇ</p>
<p>Obrigado pela leitura e fique de olho no pr√≥ximo post, que ser√° o √∫ltimo objetivo sobre Web API: <strong><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-4-5-consume-web-api-web-services/">Consume Web API web services</a></strong>.</p>
<p>At√© mais!</p>

				<p><a class="btn btn-default read-more" href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-4-4-host-and-manage-a-web-api/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 4.4 ‚Äì Host and manage a Web API">Leia Mais</a></p>

							</div><!-- .entry-content -->
					</div>
	</div>
</article><!-- #post-## -->

			
				
<article id="post-509" class="post-509 post type-post status-publish format-standard hentry category-certificacao tag-70-487">
	<div class="blog-item-wrap">
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-4-3-secure-a-web-api/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 4.3 ‚Äì Secure a Web API" >
			 				</a>
		<div class="post-inner-content">
			<header class="entry-header page-header">

				<h1 class="entry-title"><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-4-3-secure-a-web-api/" rel="bookmark">Certifica√ß√£o Microsoft 70-487: Objetivo 4.3 ‚Äì Secure a Web API</a></h1>

								<div class="entry-meta">
					<span class="posted-on"><i class="fa fa-calendar"></i> <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-4-3-secure-a-web-api/" rel="bookmark"><time class="entry-date published" datetime="2016-03-01T16:07:53+00:00">01/03/2016</time><time class="updated" datetime="2016-03-02T11:45:22+00:00">02/03/2016</time></a></span><span class="byline"> <i class="fa fa-user"></i> <span class="author vcard"><a class="url fn n" href="https://edneypitta.github.io/old-blog/author/admin/">Edney Pitta</a></span></span>				<span class="comments-link"><i class="fa fa-comment-o"></i><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-4-3-secure-a-web-api/#respond"><span class="dsq-postid" data-dsqidentifier="509 https://edneypitta.github.io/old-blog/?p=509">Deixe um coment√°rio</span></a></span>
				
				
				</div><!-- .entry-meta -->
							</header><!-- .entry-header -->

						<div class="entry-content">

				<p>Ol√° pessoal!<br />
O objetivo 4.3 da certifica√ß√£o 70-487, <strong>Secure a Web API</strong>, trata de forma bem completa sobre as diferentes formas de seguran√ßa e autentica√ß√£o dispon√≠veis para servi√ßos Web API.</p>
<p>Esse objetivo cobre como 1) autenticar e autorizar usu√°rios, 2) implementar a autentica√ß√£o HTTP Basic com SSL, 3) implementar Windows Authentication, 4) prevenir <em>cross-site request forgery</em>, 5) habilitar requests cross domain e 6) implementar e extender authorization filters.</p>
<h2>Autenticar E Autorizar Usu√°rios</h2>
<p>Essa se√ß√£o apenas explica os conceitos de autentica√ß√£o e autoriza√ß√£o.</p>
<p><strong>Autentica√ß√£o </strong>√© o processo de identifica√ß√£o do usu√°rio, geralmente por um nome de usu√°rio e senha. O framework da Web API tem uma s√©rie de ferramentas para implementa√ß√£o desse processo, o que vamos ver logo mais.</p>
<p><strong>Autoriza√ß√£o </strong>√© o processo que define quais a√ß√µes o usu√°rio pode fazer no sistema. Por exemplo, voc√™ pode permitir que usu√°rios an√¥nimos fa√ßam apenas consultas, usu√°rios autenticados fa√ßam inser√ß√µes e usu√°rios administrativos fa√ßam atualiza√ß√µes.</p>
<h2>Implementando Autentica√ß√£o HTTP Basic</h2>
<p>HTTP Basic √© a forma mais simples e f√°cil de implementar um mecanismo de autentica√ß√£o. √â um formato conhecido e maduro, suportado pela maioria dos browsers e nativamente suportado pelo IIS. A principal desvantagem √© que as credenciais s√£o transmitidas em plain text nos headers do request, tornando-se vulner√°vel a interceptores. Tamb√©m n√£o h√° como fazer logout explicitamente a n√£o ser que a sess√£o do browser se encerre.</p>
<p>O fluxo com HTTP Basic √© assim:</p>
<p>Um client faz um request. Se o servi√ßo necessitar autentica√ß√£o, o server retorna o status code 401 (unauthorized) com o seguinte header: <code>WWW-Authenticate: Basic realm="Realm Name"</code>. Esse header especifica que o server suporta a autentica√ß√£o Basic no dom√≠nio especificado (<em>realm</em>).</p>
<p>O client, ao receber um response 401, faz outro request com o header de autentica√ß√£o. A constru√ß√£o do header come√ßa com o nome de usu√°rio e a senha concatenados por um dois-pontos. Por exemplo, caso o nome de usu√°rio seja <em>JohnQPublic </em>e a senha <em>!*MyPa55w0rd*!</em>, o valor seria <em>JohnQPublic:!*MyPa55w0rd*!</em>. Em seguida esse valor seria encodado por Base64, resultando na string <em>Sm9oblFQdWJsaWM6ISpNeVBhNTV3MHJkKiE=</em>. Por fim, a palavra Basic √© adicionada antes dessa string e enviada no header Authorization: <code>Authorization: Basic Sm9oblFQdWJsaWM6ISpNeVBhNTV3MHJkKiE=</code>.</p>
<p>Um ponto importante √© que o nome de usu√°rio e senha, apesar de encodados em Base64, n√£o est√£o encriptados. Qualquer interceptor que tiver acesso aos headers do request vai conseguir decifrar dados sens√≠veis do usu√°rio facilmente. Por isso, a autentica√ß√£o Basic n√£o √© segura <strong>a n√£o ser</strong> que feita por HTTPS, onde todo o request √© criptografado. Para o exame (e para a vida real), lembre-se: nunca use autentica√ß√£o Basic sem SSL.</p>
<h4>Habilitando SSL</h4>
<p>Como a autentica√ß√£o Basic n√£o deve ser utilizada sem SSL, voc√™ deve saber como for√ßar uma conex√£o HTTPS para Web API.</p>
<p>Se voc√™ viu como implementar Action Filters no <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-4-2-implement-a-web-api/" target="_blank">objetivo anterior</a>, vai reconhecer como vamos fazer isso agora. De forma simples, basta implementar a classe <em>AuthorizationFilterAttribute </em>e sobrescrever o m√©todo OnAuthorization com uma valida√ß√£o. Segue um exemplo:</p>
<p><script src="https://gist.github.com/edneypitta/1e6f53f48e88c814de52.js"></script></p>
<p>Depois disso, voc√™ deve decorar os controllers desejados com esse atributo ou registr√°-lo globalmente no HttpConfiguration.</p>
<p>N√£o sei se cair√° no exame, mas saiba que h√° uma ferramenta chamada <em>MakeCert.exe</em> para gerar certificados SSL para testes.</p>
<h2>Implementando Windows Authentication</h2>
<p>Windows Authentication √© um processo onde os usu√°rios podem se autenticar pelo seu login no Windows, Kerberos ou NTLM. √â ideal para aplica√ß√µes intranet que ser√£o acessadas somente de dentro do mesmo dom√≠nio, em uma empresa por exemplo. Obviamente, n√£o √© recomendada para cen√°rios onde usu√°rios &#8220;an√¥nimos&#8221; v√£o acessar sua API.</p>
<p>Por ser nativamente suportada pelo IIS, implementar essa autentica√ß√£o √© bem simples. Basta configurar a propriedade Mode do elemento Authentication para &#8220;Windows&#8221; no web.config, como a seguir:</p>
<p><code>&lt;system.web&gt;<br />
&lt;authentication mode=&quot;Windows&quot; /&gt;<br />
&lt;/system.web&gt;</code></p>
<p>Se o client for diretamente um browser, este precisa dar suporte ao esquema de autentica√ß√£o Negotiation. N√£o h√° muito o que se preocupar pois todos os browsers populares t√™m esse suporte.<br />
Caso seja uma aplica√ß√£o .NET, a classe HttpClient deve ser usada para fazer o request (como sempre). A √∫nica modifica√ß√£o √© que ela deve ser instanciada com um HttpClientHandler, que pode ser obtido da seguinte maneira:</p>
<p><code>HttpClientHandler clientHandler = new HttpClientHandler<br />
{<br />
UseDefaultCredentials = true<br />
};</code></p>
<h2>Prevenindo Cross-Site Request Forgery</h2>
<p>Cross-Site Request Forgery (CSRF ou XSRF) √© uma forma bastante utilizada por atacantes para acessarem recursos dispon√≠veis para usu√°rios autenticados.</p>
<p>Vamos supor que voc√™ est√° logado no portal do Azure e, no mesmo browser, recebe um e-mail dizendo que voc√™ tem desconto de 50% para novos servi√ßos no Azure. Ao clicar no link do e-mail, voc√™ √© direcionado para a p√°gina <em>https://manage.windowsazure.com/api/DeleteAllData</em> sem perceber. √â claro que essa p√°gina n√£o existe no portal, mas se existisse, voc√™ estaria em s√©rios problemas. </p>
<p>Resumidamente, um ataque XSRF acontece quando voc√™ est√° autenticado em algum sistema e um atacante se aproveita disso para executar alguma a√ß√£o. Seu sistema est√° vulner√°vel a ataques XSFR se voc√™ usa um mecanismo de autentica√ß√£o que mant√©m o usu√°rio logado (baseado em cookies) ou quando voc√™ permite requests cross domain. A autentica√ß√£o Basic tamb√©m √© vulner√°vel pois o browser normalmente armazena seu token de autentica√ß√£o para evitar que o usu√°rio digite o usu√°rio e senha a cada request.</p>
<p>Para se proteger de ataques XSRF, h√° uma solu√ß√£o pronta em MVC e que os mesmos princ√≠pios podem ser aplicados na Web API.</p>
<p>Usando o m√©todo <em>Html.AntiForgeryToken</em> na view e o atributo <em>ValidateAntiForgeryToken</em> na action, o MVC primeiro renderiza um input hidden na tela assim: <code>&lt;input name="__RequestVerificationToken" type="hidden" value="saTFWpkKN0BYazFtN6c4YbZAmsEwG0srqlUqqloi/fVgeV2ciIFVmelvzwRZpArs" /&gt;</code>. Esse valor √© gerado randomicamente e tamb√©m √© colocado num cookie passado para o usu√°rio. Ao fazer um post, por exemplo, o MVC valida se o valor do cookie e o do form data s√£o iguais. Isso √© seguro pois o atacante n√£o vai saber o valor do cookie para forjar um request v√°lido.</p>
<p>Para Web API, como dito, o princ√≠pio pode ser aplicado. Voc√™ manda um valor no cookie e no HTML e depois garante que eles s√£o o mesmo. Voc√™ pode mandar o token antiforgery usando o mesmo m√©todo Html.AntiForgeryToken.</p>
<p>Para validar o token na Web API, voc√™ deve obter o token do cookie; obter do form data; passar ambos para o m√©todo <em>AntiForgery.Validate</em> e retornar um response Unauthorized caso a valida√ß√£o falhe. O c√≥digo ficaria assim:</p>
<p><script src="https://gist.github.com/edneypitta/6ee611685a6f6a39ee4b.js"></script></p>
<h2>Habilitando Requests Cross Domain</h2>
<p>Por padr√£o, os browsers pro√≠bem requests <em>cross domain</em>, ou seja, para dom√≠nios diferentes do atual. Por exemplo, se voc√™ est√° no site <em>http://www.contoso.com</em>, voc√™ n√£o pode fazer uma requisi√ß√£o AJAX para <em>http://www.someotherwebsite.com</em>. Voc√™ tamb√©m n√£o pode fazer requests para o seu dom√≠nio com outro protocolo (HTTP ao inv√©s de HTTPS) ou para outra porta. Isso existe para evitar ataques XSRF, j√° que a maioria das autentica√ß√µes funcionam por cookie.</p>
<p>Por√©m voc√™ pode querer que sua API seja consumida por v√°rios clients, e isso se tornaria um problema. Isso se chama CORS (cross origin resource sharing), e voc√™ pode habilit√°-lo facilmente no arquivo web.config:</p>
<p><script src="https://gist.github.com/edneypitta/cd56a4873a71d13ba5e3.js"></script></p>
<p>Isso adiciona um header nos responses, indicando que CORS est√° habilitado. Com isso, <strong>qualquer </strong>site pode fazer requisi√ß√µes para sua API, o que pode n√£o ser desejado.</p>
<p>Para resolver esse problema, a Microsoft criou um pacote NuGet chamado <em>Microsoft.AspNet.WebApi.Cors</em>. Ap√≥s a instala√ß√£o, voc√™ tem um m√©todo de extens√£o no objeto HttpConfiguration: <code>config.EnableCors();</code>. </p>
<p>Chamando esse m√©todo no m√©todo WebApiConfig.Register, voc√™ habilita o suporte a CORS na sua aplica√ß√£o. Agora voc√™ pode adicionar o atributo <em>EnableCors</em> para controllers e actions assim:</p>
<p><script src="https://gist.github.com/edneypitta/1b09fb9b1119cb50c397.js"></script></p>
<p>Nesse caso, voc√™ habilitou CORS somente para esse m√©todo na URL especificada em <em>origins</em>.</p>
<h2>Implementando E Extendendo Authorization Filters</h2>
<p>A Web API oferece o atributo <em>AuthorizeAttribute</em> que por padr√£o garante que os usu√°rios acessando esse controller ou action est√£o autenticados e t√™m as roles necess√°rias, se especificadas.</p>
<p>Voc√™ pode estender a classe AuthorizeAttribute e sobrescrever o m√©todo IsAuthorized para implementar sua pr√≥pria l√≥gica. O exemplo a seguir faz uma implementa√ß√£o de black list, ou seja, usu√°rios com as roles especificadas <strong>n√£o </strong>podem acessar a action:</p>
<p><script src="https://gist.github.com/edneypitta/79f6d70a5d1f4487fcd6.js"></script></p>
<p>Voc√™ tamb√©m pode estender a classe <em>AuthorizationFilterAttribute</em> ou implementar a interface <em>IAuthorizationFilter</em> para realizar alguma l√≥gica customizada. As diferen√ßas entre elas s√£o as seguintes:</p>
<ul>
<li><strong>AuthorizeAttribute</strong>: usada para implementar l√≥gica de autoriza√ß√£o baseada no usu√°rio e nas roles;</li>
<li><strong>AuthorizationFilterAttribute</strong>: usada para implementar l√≥gica s√≠ncrona de autoriza√ß√£o que n√£o est√° baseada no usu√°rio e nas roles (por exemplo, for√ßar HTTPS);</li>
<li><strong>IAuthorizationFilter</strong>: usada para implementar l√≥gica ass√≠ncrona de autoriza√ß√£o que n√£o est√° baseada no usu√°rio e nas roles.</li>
</ul>
<hr />
<p>Obrigado pela leitura de mais um objetivo!<br />
O pr√≥ximo post ser√° sobre o objetivo 4.4, <strong><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-4-4-host-and-manage-a-web-api/">Host and manage a Web API</a></strong>.</p>
<p>At√© l√°!</p>

				<p><a class="btn btn-default read-more" href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-4-3-secure-a-web-api/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 4.3 ‚Äì Secure a Web API">Leia Mais</a></p>

							</div><!-- .entry-content -->
					</div>
	</div>
</article><!-- #post-## -->

			
			
		
		</main><!-- #main -->
	</section><!-- #primary -->

</div>
	<div id="secondary" class="widget-area col-sm-12 col-md-4" role="complementary">
		<div class="well">
						<aside id="text-3" class="widget widget_text">			<div class="textwidget"><a href="https://edneypitta.github.io/old-blog/sobre/"><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2015/08/IMG-20150829-WA00012-e1440915174271-150x150.jpg"  width="150" height="150" class="aligncenter size-thumbnail wp-image-93" style="border-radius: 80px;" />
<h2 style="text-align:center;">Edney Pitta</h2></a>
<div style="text-align: center;">Desenvolvedor de Software @ Lambda3</div>
<div style="margin-top:20px;text-align:center;"><a href="https://edneypitta.github.io/old-blog/sobre/"><button class="btn btn-danger btn-lg " >SOBRE MIM</button></a></div></div>
		</aside><aside id="search-2" class="widget widget_search">
<form role="search" method="get" class="form-search" action="https://edneypitta.github.io/old-blog/">
  <div class="input-group">
  	<label class="screen-reader-text" for="s">Search for:</label>
    <input type="text" class="form-control search-query" placeholder="Procurar&hellip;" value="" name="s" title="Search for:" />
    <span class="input-group-btn">
      <button type="submit" class="btn btn-default" name="submit" id="searchsubmit" value="Search"><span class="glyphicon glyphicon-search"></span></button>
    </span>
  </div>
</form></aside>		<aside id="recent-posts-3" class="widget widget_recent_entries">		<h3 class="widget-title">Posts recentes</h3>		<ul>
					<li>
				<a href="https://edneypitta.github.io/old-blog/migrando-um-projeto-asp-net-core-rc-1-para-rc-2/">Migrando um projeto ASP.NET Core RC 1 para RC 2</a>
						</li>
					<li>
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-486-developing-asp-net-mvc-web-applications/">Certifica√ß√£o Microsoft 70-486: Developing ASP.NET MVC Web Applications</a>
						</li>
					<li>
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-480-programming-in-html5-with-javascript-and-css3/">Certifica√ß√£o Microsoft 70-480: Programming in HTML5 with JavaScript and CSS3</a>
						</li>
					<li>
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-resultado/">Certifica√ß√£o Microsoft 70-487 &#8211; Resultado</a>
						</li>
					<li>
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-6-share-assemblies-between-multiple-applications-and-servers/">Certifica√ß√£o Microsoft 70-487: Objetivo 5.6 ‚Äì Share assemblies between multiple applications and servers</a>
						</li>
				</ul>
		</aside>		<aside id="annual_archive_widget-2" class="widget Annual_Archive_Widget"><h3 class="widget-title">Arquivo</h3>	<ul>
		<li><a href='https://edneypitta.github.io/old-blog/2016/06/'>junho 2016</a>&nbsp;(1)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2016/05/'>maio 2016</a>&nbsp;(1)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2016/04/'>abril 2016</a>&nbsp;(1)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2016/03/'>mar√ßo 2016</a>&nbsp;(10)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2016/02/'>fevereiro 2016</a>&nbsp;(11)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2016/01/'>janeiro 2016</a>&nbsp;(10)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2015/12/'>dezembro 2015</a>&nbsp;(3)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2015/11/'>novembro 2015</a>&nbsp;(3)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2015/10/'>outubro 2015</a>&nbsp;(1)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2015/09/'>setembro 2015</a>&nbsp;(5)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2015/08/'>agosto 2015</a>&nbsp;(2)</li>
	</ul>
	</aside>		</div>
	</div><!-- #secondary -->
			</div><!-- close .*-inner (main-content or sidebar, depending if sidebar is used) -->
		</div><!-- close .row -->
	</div><!-- close .container -->
</div><!-- close .site-content -->

	<div id="footer-area">
		<div class="container footer-inner">
			<div class="row">
				
				</div>
		</div>

		<footer id="colophon" class="site-footer" role="contentinfo">
			<div class="site-info container">
				<div class="row">
										<nav role="navigation" class="col-md-6">
						<ul id="menu-social-1" class="nav footer-nav clearfix"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-20"><a href="https://br.linkedin.com/in/edneypitta"><i class="fa fa-linkedin-square"></i></a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-22"><a href="https://www.facebook.com/edneypitta"><i class="fa fa-facebook-square"></i></a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-23"><a href="https://twitter.com/edneypitta"><i class="fa fa-twitter-square"></i></a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-24"><a href="https://edneypitta.github.io/old-blog/feed/"><i class="fa fa-rss"></i></a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-27"><a href="https://edneypitta.github.io/old-blog/sobre/"><i class="fa fa-info-circle"></i></a></li>
</ul>					</nav>
					<div class="copyright col-md-6">
						<a rel="license" href="http://creativecommons.org/licenses/by/2.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/2.0/80x15.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/2.0/">Creative Commons Attribution 2.0 Generic License</a>.						Theme by <a href="http://colorlib.com/" target="_blank">Colorlib</a> Powered by <a href="http://wordpress.org/" target="_blank">WordPress</a>					</div>
				</div>
			</div><!-- .site-info -->
			<div class="scroll-to-top"><i class="fa fa-angle-up"></i></div><!-- .scroll-to-top -->
		</footer><!-- #colophon -->
	</div>
</div><!-- #page -->

<script type='text/javascript' src='https://edneypitta.github.io/old-blog/wp-content/themes/sparkling/inc/js/skip-link-focus-fix.js?ver=20140222'></script>
<script type='text/javascript' src='https://edneypitta.github.io/old-blog/wp-includes/js/wp-embed.min.js?ver=4.8.2'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var countVars = {"disqusShortname":"edneypitta"};
/* ]]> */
</script>
<script type='text/javascript' src='https://edneypitta.github.io/old-blog/wp-content/plugins/disqus-comment-system/media/js/count.js?ver=4.8.2'></script>

</body>
</html>