<!doctype html>
	<!--[if !IE]>
	<html class="no-js non-ie" lang="pt-BR" prefix="og: http://ogp.me/ns#"> <![endif]-->
	<!--[if IE 7 ]>
	<html class="no-js ie7" lang="pt-BR" prefix="og: http://ogp.me/ns#"> <![endif]-->
	<!--[if IE 8 ]>
	<html class="no-js ie8" lang="pt-BR" prefix="og: http://ogp.me/ns#"> <![endif]-->
	<!--[if IE 9 ]>
	<html class="no-js ie9" lang="pt-BR" prefix="og: http://ogp.me/ns#"> <![endif]-->
	<!--[if gt IE 9]><!-->
<html class="no-js" lang="pt-BR" prefix="og: http://ogp.me/ns#"> <!--<![endif]-->
<head>
<base href="https://edneypitta.github.io/old-blog" />

<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1">



<title>março 2016 - Edney Pitta</title>

<!-- This site is optimized with the Yoast SEO plugin v3.0.7 - https://yoast.com/wordpress/plugins/seo/ -->
<meta name="robots" content="noindex,follow"/>
<link rel="canonical" href="https://edneypitta.github.io/old-blog/2016/03/" />
<meta property="og:locale" content="pt_BR" />
<meta property="og:type" content="object" />
<meta property="og:title" content="março 2016 - Edney Pitta" />
<meta property="og:url" content="https://edneypitta.github.io/old-blog/2016/03/" />
<meta property="og:site_name" content="Edney Pitta" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="março 2016 - Edney Pitta"/>
<meta name="twitter:site" content="@edneypitta"/>
<!-- / Yoast SEO plugin. -->

<link rel='dns-prefetch' href='//fonts.googleapis.com' />
<link rel='dns-prefetch' href='//s.w.org' />


		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/svg\/","svgExt":".svg","source":{"concatemoji":"http:\/\/edneypitta.github.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.8.2"}};
			!function(a,b,c){function d(a){var b,c,d,e,f=String.fromCharCode;if(!k||!k.fillText)return!1;switch(k.clearRect(0,0,j.width,j.height),k.textBaseline="top",k.font="600 32px Arial",a){case"flag":return k.fillText(f(55356,56826,55356,56819),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,56826,8203,55356,56819),0,0),c=j.toDataURL(),b!==c&&(k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447),0,0),c=j.toDataURL(),b!==c);case"emoji4":return k.fillText(f(55358,56794,8205,9794,65039),0,0),d=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55358,56794,8203,9794,65039),0,0),e=j.toDataURL(),d!==e}return!1}function e(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i,j=b.createElement("canvas"),k=j.getContext&&j.getContext("2d");for(i=Array("flag","emoji4"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='sparkling-bootstrap-css'  href='https://edneypitta.github.io/old-blog/wp-content/themes/sparkling/inc/css/bootstrap.min.css?ver=4.8.2' type='text/css' media='all' />
<link rel='stylesheet' id='sparkling-icons-css'  href='https://edneypitta.github.io/old-blog/wp-content/themes/sparkling/inc/css/font-awesome.min.css?ver=4.8.2' type='text/css' media='all' />
<link rel='stylesheet' id='sparkling-fonts-css'  href='//fonts.googleapis.com/css?family=Open+Sans%3A400italic%2C400%2C600%2C700%7CRoboto+Slab%3A400%2C300%2C700&#038;ver=4.8.2' type='text/css' media='all' />
<link rel='stylesheet' id='sparkling-style-css'  href='https://edneypitta.github.io/old-blog/wp-content/themes/sparkling/style.css?ver=4.8.2' type='text/css' media='all' />
<script type='text/javascript' src='https://edneypitta.github.io/old-blog/wp-includes/js/jquery/jquery.js?ver=1.12.4'></script>
<script type='text/javascript' src='https://edneypitta.github.io/old-blog/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<script type='text/javascript' src='https://edneypitta.github.io/old-blog/wp-content/themes/sparkling/inc/js/modernizr.min.js?ver=4.8.2'></script>
<script type='text/javascript' src='https://edneypitta.github.io/old-blog/wp-content/themes/sparkling/inc/js/bootstrap.min.js?ver=4.8.2'></script>
<script type='text/javascript' src='https://edneypitta.github.io/old-blog/wp-content/themes/sparkling/inc/js/functions.min.js?ver=4.8.2'></script>
<link rel='https://api.w.org/' href='https://edneypitta.github.io/old-blog/wp-json/' />

 

<script data-cfasync="false" src="//load.sumome.com/" data-sumo-site-id="025f16b2b72012bef5c86b74ea4d0bd0652e8245a2df8c61ed302458c0f98f3b" async></script><style type="text/css">.entry-content {font-family: Open Sans; font-size:14px; font-weight: normal; color:#6B6B6B;}.navbar > .container .navbar-brand {
font-size: 35px;
margin-top: 7px;
}

#menu-social i{
font-size:17px;
}
#menu-social-1 i {
font-size:22px;
}

article ul {
    list-style: none;
    padding:0;
    margin:0;
margin-bottom: 10px;
}

article li { 
    padding-left: 1em; 
    text-indent: -.7em;
}

article li:before {
    content: "\2022";
    color: rgb(191, 66, 78); 
padding-right:7px;
font-size: 15px;
}

#logo {
margin: 10px 0px;
}

.textwidget a:hover h2{
color:#c9302c;
}</style>	<style type="text/css">
			.navbar > .container .navbar-brand {
			color: #ffffff;
		}
		</style>
	<link rel="icon" href="https://edneypitta.github.io/old-blog/wp-content/uploads/2015/08/cropped-cropped-edneypitta-oficialissimo-fundo-branco-32x32.png" sizes="32x32" />
<link rel="icon" href="https://edneypitta.github.io/old-blog/wp-content/uploads/2015/08/cropped-cropped-edneypitta-oficialissimo-fundo-branco-192x192.png" sizes="192x192" />
<link rel="apple-touch-icon-precomposed" href="https://edneypitta.github.io/old-blog/wp-content/uploads/2015/08/cropped-cropped-edneypitta-oficialissimo-fundo-branco-180x180.png" />
<meta name="msapplication-TileImage" content="https://edneypitta.github.io/old-blog/wp-content/uploads/2015/08/cropped-cropped-edneypitta-oficialissimo-fundo-branco-270x270.png" />

<script type="text/javascript">
jQuery(document).ready(function()
{
jQuery('.fa-linkedin-square').parent().attr('target', '_blank').attr('title', 'LinkedIn');
jQuery('.fa-facebook-square').parent().attr('target', '_blank').attr('title', 'Facebook');
jQuery('.fa-twitter-square').parent().attr('target', '_blank').attr('title', 'Twitter');
jQuery('.fa-rss').parent().attr('target', '_blank').attr('title', 'RSS');

jQuery('.fa-info-circle').parent().attr('title', 'Sobre');
});
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-66613004-1', 'auto');
  ga('send', 'pageview');

</script>
</head>

<body class="archive date">
<div id="page" class="hfeed site">

	<header id="masthead" class="site-header" role="banner">
		<nav class="navbar navbar-default" role="navigation">
			<div class="container">
				<div class="row">
					<div class="site-navigation-inner col-sm-12">
						<div class="navbar-header">
							<button type="button" class="btn navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
								<span class="sr-only">Toggle navigation</span>
								<span class="icon-bar"></span>
								<span class="icon-bar"></span>
								<span class="icon-bar"></span>
							</button>

							
							<div id="logo">
								<a href="https://edneypitta.github.io/old-blog/"><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2015/08/cropped-edneypitta-oficialissimo-fundo-branco.png"  height="84" width="411" alt="Edney Pitta"/></a>
							</div><!-- end of #logo -->

							
							
						</div>
						<div class="collapse navbar-collapse navbar-ex1-collapse"><ul id="menu-social" class="nav navbar-nav"><li id="menu-item-20" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-20"><a title="&lt;i class=&quot;fa fa-linkedin-square&quot;&gt;&lt;/i&gt;" href="https://br.linkedin.com/in/edneypitta"><i class="fa fa-linkedin-square"></i></a></li>
<li id="menu-item-22" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-22"><a title="&lt;i class=&quot;fa fa-facebook-square&quot;&gt;&lt;/i&gt;" href="https://www.facebook.com/edneypitta"><i class="fa fa-facebook-square"></i></a></li>
<li id="menu-item-23" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-23"><a title="&lt;i class=&quot;fa fa-twitter-square&quot;&gt;&lt;/i&gt;" href="https://twitter.com/edneypitta"><i class="fa fa-twitter-square"></i></a></li>
<li id="menu-item-24" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-24"><a title="&lt;i class=&quot;fa fa-rss&quot;&gt;&lt;/i&gt;" href="https://edneypitta.github.io/old-blog/feed/"><i class="fa fa-rss"></i></a></li>
<li id="menu-item-27" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-27"><a title="&lt;i class=&quot;fa fa-info-circle&quot;&gt;&lt;/i&gt;" href="https://edneypitta.github.io/old-blog/sobre/"><i class="fa fa-info-circle"></i></a></li>
</ul></div>					</div>
				</div>
			</div>
		</nav><!-- .site-navigation -->
	</header><!-- #masthead -->

	<div id="content" class="site-content">

		<div class="top-section">
								</div>

		<div class="container main-content-area">
			<div class="row">
				<div class="main-content-inner col-sm-12 col-md-8 pull-left">

	<section id="primary" class="content-area">
		<main id="main" class="site-main" role="main">

		
			<header class="page-header">
				<h1 class="page-title">
					Mês: <span>março 2016</span>				</h1>
							</header><!-- .page-header -->

						
				
<article id="post-617" class="post-617 post type-post status-publish format-standard hentry category-certificacao tag-70-487">
	<div class="blog-item-wrap">
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-resultado/" title="Certificação Microsoft 70-487 &#8211; Resultado" >
			 				</a>
		<div class="post-inner-content">
			<header class="entry-header page-header">

				<h1 class="entry-title"><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-resultado/" rel="bookmark">Certificação Microsoft 70-487 &#8211; Resultado</a></h1>

								<div class="entry-meta">
					<span class="posted-on"><i class="fa fa-calendar"></i> <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-resultado/" rel="bookmark"><time class="entry-date published" datetime="2016-03-18T18:05:14+00:00">18/03/2016</time><time class="updated" datetime="2016-03-23T16:56:48+00:00">23/03/2016</time></a></span><span class="byline"> <i class="fa fa-user"></i> <span class="author vcard"><a class="url fn n" href="https://edneypitta.github.io/old-blog/author/admin/">Edney Pitta</a></span></span>				<span class="comments-link"><i class="fa fa-comment-o"></i><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-resultado/#comments"><span class="dsq-postid" data-dsqidentifier="617 https://edneypitta.github.io/old-blog/?p=617">9 Comentários</span></a></span>
				
				
				</div><!-- .entry-meta -->
							</header><!-- .entry-header -->

						<div class="entry-content">

				<p>Olá pessoal, tudo bem?</p>
<p>Em novembro do ano passado decidi tirar a certificação da Microsoft MCSD em Web Applications, começando pelo exame 70-487: Developing Microsoft Azure and Web Services. Fiz um post contando a minha estratégia de estudos, que seria escrever um post sobre cada tópico da prova baseado no livro Exam Ref da Microsoft (você pode ver os links <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-developing-microsoft-azure-and-web-services/">aqui</a>).</p>
<p>No dia que terminei o último dos 31 posts (que totalizaram 32697 palavras 😮 ), marquei a prova já para o dia seguinte. Estudei algum conteúdo sobre as atualizações da prova de 2014 e o resultado foi: <strong>aprovado!</strong></p>
<p>Para quem quiser também passar na prova, alguns pontos de atenção:<br />
 <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-resultado/#more-617" class="more-link"><span aria-label="Continue lendo Certificação Microsoft 70-487 &#8211; Resultado">(mais&hellip;)</span></a></p>

				<p><a class="btn btn-default read-more" href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-resultado/" title="Certificação Microsoft 70-487 &#8211; Resultado">Leia Mais</a></p>

							</div><!-- .entry-content -->
					</div>
	</div>
</article><!-- #post-## -->

			
				
<article id="post-570" class="post-570 post type-post status-publish format-standard hentry category-certificacao tag-70-487">
	<div class="blog-item-wrap">
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-6-share-assemblies-between-multiple-applications-and-servers/" title="Certificação Microsoft 70-487: Objetivo 5.6 – Share assemblies between multiple applications and servers" >
			 				</a>
		<div class="post-inner-content">
			<header class="entry-header page-header">

				<h1 class="entry-title"><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-6-share-assemblies-between-multiple-applications-and-servers/" rel="bookmark">Certificação Microsoft 70-487: Objetivo 5.6 – Share assemblies between multiple applications and servers</a></h1>

								<div class="entry-meta">
					<span class="posted-on"><i class="fa fa-calendar"></i> <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-6-share-assemblies-between-multiple-applications-and-servers/" rel="bookmark"><time class="entry-date published" datetime="2016-03-09T17:32:39+00:00">09/03/2016</time><time class="updated" datetime="2016-03-09T17:50:52+00:00">09/03/2016</time></a></span><span class="byline"> <i class="fa fa-user"></i> <span class="author vcard"><a class="url fn n" href="https://edneypitta.github.io/old-blog/author/admin/">Edney Pitta</a></span></span>				<span class="comments-link"><i class="fa fa-comment-o"></i><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-6-share-assemblies-between-multiple-applications-and-servers/#comments"><span class="dsq-postid" data-dsqidentifier="570 https://edneypitta.github.io/old-blog/?p=570">3 Comentários</span></a></span>
				
				
				</div><!-- .entry-meta -->
							</header><!-- .entry-header -->

						<div class="entry-content">

				<blockquote><p>Esse é o último post da série sobre a certificação Microsoft 70-487. Os links para todos os posts estão <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-developing-microsoft-azure-and-web-services/">aqui</a>.</p></blockquote>
<p>Olá pessoal, tudo bem?<br />
Vamos ao último objetivo da certificação, o <strong>Share assemblies between multiple applications and servers</strong>.</p>
<p>Esse objetivo cobre como preparar o ambiente para usar assemblies entre múltiplos servidores, assinar assemblies com um strong name, fazer o deploy de assemblies para o GAC (global assembly cache), implementar versionamento de assemblies e criar um assembly manifest. Vamos lá?</p>
<h2>Preparando O Ambiente Para Usar Assemblies Entre Múltiplos Servidores</h2>
<p>Quando você faz o deploy da sua aplicação, todo o código (inclusive o .NET Framework) é compilado para assemblies (DLLs) que são lidos e carregados na memória pelo IIS. Em casos onde um servidor hospeda várias aplicações, vários assemblies serão deployados redundantemente. Por exemplo, se existem 3 aplicações MVC, o assembly <em>System.Web.Mvc</em> será carregado 3 vezes na memória. Isso aumenta o tempo de inicialização e o uso da memória do seu servidor.</p>
<p>Para essa seção, você deve entender 2 conceitos que o ASP.NET utiliza na hospedagem de aplicações para resolver esse problema: <em>Shadow Copying</em> e <em>Assembly Interning</em>.</p>
<p>Shadow Copying é útil no momento de atualização dos assemblies. Normalmente, o CLR (Commom Language Runtime) trava os assemblies quando eles estão em execução. Isso significa que você não pode simplesmente copiar uma nova versão em cima da atual. O Shadow Copying atua nesses cenários copiando o assembly original para a pasta de arquivos temporários do ASP.NET, travando a cópia e liberando a atualização do assembly na localização original. Isso é habilitado por padrão nas pastas de assemblies (bin).</p>
<p>O Assembly Interning, disponível a partir do ASP.NET 4.5, analisa essa pasta temporária procurando por assemblies duplicados (usados 3 vezes ou mais), como no caso de 3 aplicações MVC no mesmo servidor. Esses assemblies são então movidos para uma localização especial, e todas as referências originais são substituídas com &#8220;links simbólicos&#8221;, que apontam para essa nova localização quando as aplicações fazem requisições aos assemblies que foram compartilhados. Dessa forma, todos esses assemblies são carregados apenas uma vez na memória, economizando tempo e recursos.</p>
<p>Você usa o Assembly Interning pela ferramenta <em>aspnet_intern.exe</em>, na linha de comando. Ela pode ser usada assim:</p>
<p><code>aspnet_intern -mode exec -sourcedir "C:\Windows\Microsoft.NET\Framework64\v4.0.30319\Temporary ASP.NET Files" -interndir C:\CommonAssemblies</code></p>
<p>Há também um modo de análise, onde a ferramenta mostra quais assemblies podem ser compartilhados:</p>
<p><code>aspnet_intern -mode analyze -sourcedir "C:\Windows\Microsoft.NET\Framework64\v4.0.30319\Temporary ASP.NET Files" -v</code></p>
<h2>Assinando Assemblies Com Um Strong Name</h2>
<p>O CLR suporta dois tipos de assemblies: os regulares e os com strong name (<em>&#8220;nome forte&#8221;</em>). Ambos têm a mesma estrutura, mas os fortemente nomeados têm chaves públicas e privadas que identificam o publicador e o conteúdo do assembly. </p>
<p>Isso garante singularidade, pois nenhum assembly pode ter o mesmo nome forte que o seu (o nome é baseado na chave privada). Os outros benefícios são que somente você pode publicar atualizações para o assembly e que o .NET consegue checar a integridade do assembly desde o momento que ele foi assinado.</p>
<p>Você pode assinar um assembly via linha de comando ou pelo Visual Studio. O primeiro passo é gerar as chaves privada e pública por meio de um arquivo <em>.snk</em>. O seguinte comando gera esse arquivo:</p>
<p><code>sn -k myKey.snk</code></p>
<p>Pelo Visual Studio, isso é feito na página de Properties do projeto, na aba Signing:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/26.png" alt="signing" width="715" height="554" class="alignnone size-full wp-image-604" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/26.png 715w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/26-300x232.png 300w" sizes="(max-width: 715px) 100vw, 715px" /></p>
<p>Habilitando a opção Sign the assembly, o Visual Studio gera o arquivo com a chave e assina o assembly no momento da compilação.</p>
<p>Assemblies assinados só podem referenciar assemblies que também são assinados por motivos de segurança. Caso você referencie um assembly não assinado, ao invocar qualquer código desse assembly o erro <em>Assembly generation failed &#8212; Referenced assembly &#8216;MyLib&#8217; does not have a strong name</em> é lançado.</p>
<p>Após assinar um assembly, você pode ver a chave pública pela ferramenta <em>Sn.exe</em>, instalada no Visual Studio. O seguinte comando pode ser usado:</p>
<p><code>sn -Tp C:\Windows\Microsoft.NET\Framework\v4.0.30319\System.Data.dll</code></p>
<p>O resultado é o seguinte, onde o <em>Public key token</em> representa a chave pública:</p>
<p><em>Microsoft (R) .NET Framework Strong Name Utility Version 4.0.30319.17929 Copyright (c)<br />
Microsoft Corporation. All rights reserved.<br />
Identity public key (hash algorithm: Unknown): 00000000000000000400000000000000<br />
Signature public key (hash algorithm: sha256): 002400000c800000<br />
140100000602000000240000525341310008000001000100613399aff18ef1<br />
a2c2514a273a42d9042b72321f1757102df9ebada69923e2738406c21e5b801552ab8d200a65a2<br />
35e001ac9adc25f2d811eb09496a4c6a59d4619589c69f5baf0c4179a47311d92555cd006acc8b<br />
5959f2bd6e10e360c34537a1d266da8085856583c85d81da7f3ec01ed9564c58d93d713cd0172c<br />
8e23a10f0239b80c96b07736f5d8b022542a4e74251a5f432824318b3539a5a087f8e53d2f135f<br />
9ca47f3bb2e10aff0af0849504fb7cea3ff192dc8de0edad64c68efde34c56d302ad55fd6e80f3<br />
02d5efcdeae953658d3452561b5f36c542efdbdd9f888538d374cef106acf7d93a4445c3c73cd9<br />
11f0571aaf3d54da12b11ddec375b3<br />
Public key token is b77a5c561934e089</em></p>
<p>Para empresas, é importante manter a chave privada segura, pois alguém pode roubá-la e distribuir assemblies alterados que parecem legítimos. Porém, sem a chave privada, os desenvolvedores não conseguem assinar o assembly para construir a aplicação. </p>
<p>Para evitar esse problema, o conceito de <em>delay/partial signing</em> foi criado. Com isso, os desenvolvedores conseguem assinar o assembly somente com a chave pública, deixando para assinar o assembly com a chave privada somente no momento da publicação. Na figura acima no Visual Studio, a opção Delay sign only faz isso.</p>
<p>Lembre-se para o exame dos benefícios de assinar um assembly e quando usar delayed signing.</p>
<h2>Fazendo O Deploy De Assemblies Para O GAC (Global Assembly Cache)</h2>
<p>GAC (Global Assembly Cache) é uma biblioteca especializada em guardar assemblies. Fazer o deploy de um assembly para o GAC significa que ele estará disponível para todas as aplicações hospedadas naquele servidor.</p>
<p>Usar o GAC é útil quando um assembly é compartilhado entre múltiplas aplicações. Outra razão é para melhoria de segurança, visto que normalmente somente administradores conseguem alterar o GAC. O GAC também é conveniente para fazer o deploy de múltiplas versões do mesmo assembly.</p>
<p>Para o servidor de produção, você pode fazer o deploy de um assembly para o GAC por meio de alguma ferramenta como o Windows Installer 2.0 ou com o Web Deploy configurado com um provider para fazer a instalação do arquivo no GAC. </p>
<p>No ambiente de desenvolvimento, você usa uma ferramenta chamada <em>Gacutil.exe</em>. Os seguintes comandos podem ser utilizados:</p>
<ul>
<li><code>gacutil -l</code> lista o conteúdo do GAC;</li>
<li><code>gacutil -i [assembly name]</code> instala um assembly no GAC;</li>
<li><code>gacutil -u [assembly name]</code> remove um assembly do GAC.</li>
</ul>
<p>Ao referenciar um assembly no seu projeto, você pode adicionar uma referência ao arquivo no GAC ou uma cópia local. Quando o Visual Studio detecta que há um assembly do GAC referenciado, ele adiciona a referência ao GAC.</p>
<h2>Implementando Versionamento De Assemblies</h2>
<p>Cada assembly carrega no seu manifesto o número da sua versão no seguinte formato: <em>{Major}.{Minor}.{Build}.{Revision}</em>.</p>
<p>Ao fazer o build de um assembly, há 2 números de versão que você deve levar em conta: a versão do arquivo e a versão do assembly .NET. Quando um projeto é criado no Visual Studio, o arquivo <em>AssemblyInfo.cs</em> é automaticamente criado contendo as seguintes linhas:</p>
<p><code>[assembly: AssemblyVersion("1.0.0.0")]<br />
[assembly: AssemblyFileVersion("1.0.0.0")]</code></p>
<p><em>AssemblyFileVersionAttribute</em> é o que deve ser incrementado a cada build no seu processo de build. <em>AssemblyVersionAttribute</em> deve ser incrementado manualmente a cada deploy para produção.</p>
<p>Como dito anteriormente, múltiplas versões de um mesmo assembly podem ser deployados para o GAC. Isso é chamado <em>side-by-side hosting</em>.</p>
<p>O processo de encontrar o assembly correto para ser carregado pelo CLR começa no número da versão mencionado no manifesto. Mas isso pode ser influenciado por alguns arquivos de configuração, como o da aplicação, do Publisher Policy ou da Machine Configuration.</p>
<p>Vamos supor que você tem um assembly carregado no GAC e várias aplicações dependem dele. Caso você publique uma nova versão e queira forçar as aplicações a usarem essa nova versão, você pode publicar um Publisher Policy para o GAC com a seguinte configuração:</p>
<p><script src="https://gist.github.com/edneypitta/c6daa1121fc7ecc03430.js"></script></p>
<p>Nesse exemplo, quando o CLR procura o assembly com a versão 1.0.0.0, é redirecionado para o 2.0.0.0.</p>
<p>Caso todos os assemblies estejam privados dentro da aplicação, você pode adicionar a seção de <em>probing </em>no arquivo web.config para o CLR procurar em outro diretório. Exemplo:</p>
<p><script src="https://gist.github.com/edneypitta/ea4c8abba64f5a633227.js"></script></p>
<p>Outra opção é usar o elemento <em>codeBase</em> para especificar uma localização fora do diretório da aplicação, podendo ser outro computador da rede ou algum lugar na internet. </p>
<p>Dois detalhes: os assemblies precisam ser fortemente nomeados (assinados) se estiverem fora da pasta da aplicação e os assemblies localizados em outro computador são baixados para uma pasta especial no GAC. </p>
<p>Um exemplo de configuração do codeBase:</p>
<p><script src="https://gist.github.com/edneypitta/627d66ca08e8b271f8fe.js"></script></p>
<p>Para o exame, lembre-se que a opção de probing só pode ser usada para localizações dentro do caminho da aplicação, enquanto o codeBase permite outras localizações.</p>
<h2>Criando Um Assembly Manifest</h2>
<p>O Assembly Manifest é o lugar que contém os metadados do assembly e de todos os assemblies que ele depende.</p>
<p>A ferramenta <em>ILDasm </em>analisa o conteúdo de assemblies compilados. Ela mostra da seguinte forma:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/8.png" alt="ildasm" width="562" height="301" class="alignnone size-full wp-image-607" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/8.png 562w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/8-300x161.png 300w" sizes="(max-width: 562px) 100vw, 562px" /></p>
<p>Note a presença do Assembly Manifest. Ele tem as seguintes funções:</p>
<ul>
<li>Enumera os arquivos do assembly;</li>
<li>Governa como as referências ao tipo do assembly são mapeadas para os arquivos que contém a implementação;</li>
<li>Enumera os assemblies que o assembly depende;</li>
<li>Provê um nível de separação entre os consumidores do assembly e os detalhes da implementação;</li>
<li>Renderiza a descrição do assembly.</li>
</ul>
<p>Ele ainda contém a identidade do assembly, como o nome, o número da versão, cultura e informações da assinatura. Você pode alterar esses valores no arquivo <em>AssemblyInfo.cs</em>, com os atributos <em>AssemblyCultureAttribute</em>, <em>AssemblyTitleAttribute </em>e <em>AssemblyDescriptionAttribute</em>.</p>
<p>Por último, o Assembly Manifest normalmente está no Portable Executable (PE), como uma DLL ou .exe junto com o Intermediate Language (IL) que descreve o assembly. Você pode criar um assembly em múltiplos arquivos com um Assembly Manifest ou com o Assembly Manifest incorporado dentro de cada PE.</p>
<hr />
<p>E finalmente, terminamos <strong>todos </strong>os objetivos da certificação 😀</p>
<p>Logo faço um post com algumas informações da prova, como as atualizações que vieram em abril de 2014 e algumas dicas a mais.</p>
<p>Obrigado por acompanhar essa jornada e até mais!</p>

				<p><a class="btn btn-default read-more" href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-6-share-assemblies-between-multiple-applications-and-servers/" title="Certificação Microsoft 70-487: Objetivo 5.6 – Share assemblies between multiple applications and servers">Leia Mais</a></p>

							</div><!-- .entry-content -->
					</div>
	</div>
</article><!-- #post-## -->

			
				
<article id="post-568" class="post-568 post type-post status-publish format-standard hentry category-certificacao tag-70-487">
	<div class="blog-item-wrap">
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-5-create-configure-and-publish-a-web-package/" title="Certificação Microsoft 70-487: Objetivo 5.5 – Create, configure, and publish a web package" >
			 				</a>
		<div class="post-inner-content">
			<header class="entry-header page-header">

				<h1 class="entry-title"><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-5-create-configure-and-publish-a-web-package/" rel="bookmark">Certificação Microsoft 70-487: Objetivo 5.5 – Create, configure, and publish a web package</a></h1>

								<div class="entry-meta">
					<span class="posted-on"><i class="fa fa-calendar"></i> <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-5-create-configure-and-publish-a-web-package/" rel="bookmark"><time class="entry-date published" datetime="2016-03-09T07:45:46+00:00">09/03/2016</time><time class="updated" datetime="2016-03-09T17:33:45+00:00">09/03/2016</time></a></span><span class="byline"> <i class="fa fa-user"></i> <span class="author vcard"><a class="url fn n" href="https://edneypitta.github.io/old-blog/author/admin/">Edney Pitta</a></span></span>				<span class="comments-link"><i class="fa fa-comment-o"></i><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-5-create-configure-and-publish-a-web-package/#respond"><span class="dsq-postid" data-dsqidentifier="568 https://edneypitta.github.io/old-blog/?p=568">Deixe um comentário</span></a></span>
				
				
				</div><!-- .entry-meta -->
							</header><!-- .entry-header -->

						<div class="entry-content">

				<p>Olá pessoal, tudo bem?<br />
O objetivo <strong>Create, configure, and publish a web package</strong>, penúltimo da certificação, cobre aspectos do Web Deployment Framework, ou Web Deploy.</p>
<p>Vamos ver como criar um IIS Install Package, configurar o processo de build para fazer o output de um Web Package e aplicar condições pré e pós deploy.</p>
<h2>Criando Um IIS Install Package</h2>
<p>Nessa seção, vamos cobrir as 4 principais maneiras de se criar um pacote Web Deploy: Visual Studio, IIS, prompt de comando e Windows PowerShell.</p>
<h4>Visual Studio</h4>
<p>No Visual Studio, você pode usar a ferramenta Publish para criar um pacote Web Deploy. Ela permite que você adicione scripts de banco de dados ou execute Migrations do EF e mude connection strings do web.config.</p>
<p>Você começa o processo no menu Build > Publish {nome do projeto} ou com o botão direito no projeto > Publish. A seguinte tela é mostrada:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/21.png" alt="publish web" width="765" height="603" class="alignnone size-full wp-image-594" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/21.png 765w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/21-300x236.png 300w" sizes="(max-width: 765px) 100vw, 765px" /></p>
<p>Na seção Profile, você precisa criar um Publish Profile, que é guardado na solution para futuros publishs. Você pode criar um Publish Profile para cada ambiente que vai fazer o deploy da aplicação, como desenvolvimento, homologação e produção.</p>
<p>Se você está fazendo deploy no Azure Websites, você pode fazer o download do Publish Profile diretamente do portal.</p>
<p>Na segunda página da janela, você escolhe o método do deploy. No nosso caso, escolhemos <strong>Web Deploy</strong> ou W<strong>eb Deploy Package</strong>.</p>
<p>Web Deploy faz o deploy diretamente para um servidor remoto que tem o serviço Web Deploy instalado. Você precisa colocar o endereço do servidor e as credenciais. O Web Deploy Package cria um pacote Web Deploy que você pode fazer a instalação manualmente. Você só precisa entrar com uma localização para o pacote e o nome do site, que pode ser mudado no momento do deploy:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/22.png" alt="publish web" width="763" height="601" class="alignnone size-full wp-image-595" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/22.png 763w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/22-300x236.png 300w" sizes="(max-width: 763px) 100vw, 763px" /></p>
<p>Na terceira parte você pode configurar opções como a configuração do build (Release por padrão), precompile do site, excluir arquivos do App_Data e configurar o banco de dados:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/23.png" alt="publish web" width="765" height="601" class="alignnone size-full wp-image-596" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/23.png 765w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/23-300x236.png 300w" sizes="(max-width: 765px) 100vw, 765px" /></p>
<p>Após clicar em Publish, o Visual Studio vai gerar um pacote Web Deploy que você pode usar para fazer o deploy no IIS via IIS Manager ou linha de comando.</p>
<p>Há algumas opções extras na página de Properties do seu projeto, nas páginas <strong>Package/Publish Web</strong> e <strong>Package/Publish SQL</strong>.</p>
<p>Em Package/Publish Web, você seleciona os arquivos que quer fazer o deploy nas seguintes opções: somente os arquivos obrigatórios, todos os arquivos do projeto ou todos os arquivos na pasta do projeto. Você pode também selecionar uma opção para incluir as configurações do IIS Express para garantir que os servidores estão configurados corretamente.</p>
<p>A página Package/Publish SQL é desabilitada por padrão, mostrando uma mensagem que você pode fazer as configurações na janela de Publish. Mas você pode habilitá-la e fazer as configurações para o banco de dados.</p>
<h4>IIS</h4>
<p>Após a instalação do Web Deploy, o IIS Manager suporta tanto a criação de pacotes Web Deploy como a importação deles para instalação. </p>
<p>É possível criar pacotes para uma aplicação, site ou o servidor completo. Nesse último caso, o pacote contém todas as configurações do servidor como o applicationHost.config, registros do IIS, certificados SSL e o conteúdo de todas as aplicações hospedadas.</p>
<p>Você exporta um pacote abrindo o IIS Manager, selecionando a aplicação, site ou servidor a ser exportado e indo em Export Application. A seguinte tela é mostrada:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/24.png" alt="export application package" width="730" height="556" class="alignnone size-full wp-image-597" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/24.png 730w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/24-300x228.png 300w" sizes="(max-width: 730px) 100vw, 730px" /></p>
<p>Na opção Manage Components, você pode configurar providers para configurações de registro, fazer o deploy de assemblies no GAC ou um banco de dados no pacote.</p>
<p>O próximo passo no wizard permite que você configure parâmetros para os providers, como o nome do site ou a localização do banco de dados.</p>
<p>Para fazer a importação de um pacote, você seleciona o servidor ou site e clica em Import Package. Esse pacote pode ter sido criado via exportação do IIS, Visual Studio ou linha de comando. Após selecionar a localização do pacote, uma janela é aberta para a seleção dos arquivos que você quer fazer o deploy. Você pode também especificar os valores dos parâmetros criados na exportação do pacote.</p>
<p>Na importação, há uma opção chamada <em>whatif</em> que mostra as ações que serão feitas no deploy sem que elas sejam feitas de fato.</p>
<h4>Prompt De Comando</h4>
<p>A ferramenta usada na linha de comando é a <em>MSDeploy</em>. Você pode usá-la para sincronizar servidores, criar e fazer o deploy de pacotes. O comando a seguir, por exemplo, faz a sincronização de 2 servidores com a opção whatif:</p>
<p><code>msdeploy -whatif -verb:sync -source:iisApp="Default Web Site/MyApp" -dest:iisApp="Default Web Site/MyApp", computerName=Server2</code></p>
<p>Alguns segmentos importantes são:</p>
<ul>
<li><strong>verb</strong>: especifica a operação a ser feita (delete, dump, getDependencies, getSystemInfo ou sync);</li>
<li><strong>source</strong>: especifica a fonte dos dados;</li>
<li><strong>dest</strong>: especifica o destino da operação;</li>
<li><strong>whatif</strong>: indica que o comando deve rodar sem fazer as alterações de fato.</li>
</ul>
<p>Para fazer um deploy com MSDeploy, você pode usar o <em>.cmd</em> gerado pelo Visual Studio na criação do pacote. O comando é o seguinte:</p>
<p><code>ProjectName.deploy.cmd /y /m:https://DestinationServerName:8172/MSDeploy.axd</code></p>
<p>Não é necessário memorizar todas as opções do Web Deploy para o exame. Saiba apenas a sintaxe básica, como a flag whatif. A lista completa das opções do MSDeploy pode ser vista <a href="https://technet.microsoft.com/en-us/library/dd569106.aspx" target="_blank">aqui</a>.</p>
<h4>Windows PowerShell</h4>
<p>O Windows PowerShell é uma ferramenta de linha de comando com capacidades extras. Como no prompt, você pode sincronizar servidores, criar e fazer o deploy de pacotes.</p>
<p>Para usar o Web Deploy do PowerShell, você precisa instalar o snap-in <em>WDeploySnapin3.0</em> com o comando <code>Add-PSSnapin WDeploySnapin3.0</code>.</p>
<p>Depois, você pode obter a lista dos comandos do Web Deploy com o comando <code>Get-Command -module WDeploySnapin3.0</code>. O resultado é:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/25.png" alt="powershell" width="680" height="487" class="alignnone size-full wp-image-599" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/25.png 680w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/25-300x215.png 300w" sizes="(max-width: 680px) 100vw, 680px" /></p>
<p>Para fazer um deploy, você primeiro precisa de um arquivo Publish Settings (o mesmo gerado pelo Visual Studio quando você cria ou importa um Publish Profile). O comando <em>New-WDPublishSettings</em> pode ser usado:</p>
<p><code>$cred = Get-Credential<br />
New-WDPublishSettings -ComputerName WebServer -Site WebSite1 -Credentials $cred<br />
-AllowUntrusted -SiteUrl "http://www.mywebsite.com" -FileName C:\temp\mywebsite.<br />
publishsettings -AgentType wmsvc</code></p>
<p>O seguinte arquivo é criado após esse comando:</p>
<p><script src="https://gist.github.com/edneypitta/28a592f72f0ba15893f6.js"></script></p>
<p>Depois, o comando <em>Sync-WDApp</em> pode ser usado para fazer o deploy:</p>
<p><code>Sync-WDApp "MyApp" "MyAppDeployedWithPowerShell" -DestinationPublishSettings "C:\temp\mywebsite.publishsettings"</code></p>
<h2>Configurando O Processo De Build</h2>
<p>Você pode configurar o processo de build no TFS para fazer o deploy da sua aplicação.</p>
<p>Editando o template da build com o seguinte comando, você pode criar um pacote em Release para fazer o deploy manualmente:</p>
<p><code>MSBuild "MyProjectName.csproj" /T:Package /P:Configuration=Release</code></p>
<p>Também é possível especificar o parâmetro <code>/p:DeployOnBuild=True</code>, que com o publish settings correto, faz o deploy da sua aplicação automaticamente.</p>
<h2>Aplicando Condições Pré e Pós Deploy</h2>
<p>Com Web Deploy, você pode também executar ações antes e depois de fazer o deploy da aplicação.</p>
<p>Você faz isso com as opções <em>preSync</em> e <em>postSync</em> em conjunto com <em>runcommand</em>:</p>
<p><code>msdeploy -verb:sync -source:contentPath="C:\Test1" -dest:contentPath="C:\Test2"<br />
<strong>-preSync</strong>:runcommand="c:\MyBatchFile.bat"</code></p>
<hr />
<p>Terminamos mais um objetivo 😀</p>
<p>Fique de olho no próximo post que será sobre o <strong>último</strong> objetivo da certificação, <strong><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-6-share-assemblies-between-multiple-applications-and-servers/">Share assemblies between multiple applications and servers</a></strong>.</p>
<p>Até lá!</p>

				<p><a class="btn btn-default read-more" href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-5-create-configure-and-publish-a-web-package/" title="Certificação Microsoft 70-487: Objetivo 5.5 – Create, configure, and publish a web package">Leia Mais</a></p>

							</div><!-- .entry-content -->
					</div>
	</div>
</article><!-- #post-## -->

			
				
<article id="post-566" class="post-566 post type-post status-publish format-standard hentry category-certificacao tag-70-487">
	<div class="blog-item-wrap">
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-4-manage-packages-by-using-nuget/" title="Certificação Microsoft 70-487: Objetivo 5.4 – Manage packages by using NuGet" >
			 				</a>
		<div class="post-inner-content">
			<header class="entry-header page-header">

				<h1 class="entry-title"><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-4-manage-packages-by-using-nuget/" rel="bookmark">Certificação Microsoft 70-487: Objetivo 5.4 – Manage packages by using NuGet</a></h1>

								<div class="entry-meta">
					<span class="posted-on"><i class="fa fa-calendar"></i> <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-4-manage-packages-by-using-nuget/" rel="bookmark"><time class="entry-date published" datetime="2016-03-08T10:54:27+00:00">08/03/2016</time><time class="updated" datetime="2016-03-09T07:46:29+00:00">09/03/2016</time></a></span><span class="byline"> <i class="fa fa-user"></i> <span class="author vcard"><a class="url fn n" href="https://edneypitta.github.io/old-blog/author/admin/">Edney Pitta</a></span></span>				<span class="comments-link"><i class="fa fa-comment-o"></i><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-4-manage-packages-by-using-nuget/#respond"><span class="dsq-postid" data-dsqidentifier="566 https://edneypitta.github.io/old-blog/?p=566">Deixe um comentário</span></a></span>
				
				
				</div><!-- .entry-meta -->
							</header><!-- .entry-header -->

						<div class="entry-content">

				<p>Olá pessoal!<br />
O objetivo 5.4, <strong>Manage packages by using NuGet</strong>, cobre todos os aspectos do NuGet: como instalar e atualizar um pacote, criar e configurar um pacote e preparar um repositório de pacotes. Vamos lá?</p>
<h2>Instalando E Atualizando Um Pacote NuGet Existente</h2>
<p>O NuGet permite que você instale bibliotecas para usar no seu código. Caso veja no exame alguma coisa sobre referenciar bibliotecas populares, pense em NuGet. Um pacote NuGet, além de ter uma série de assemblies que você pode referenciar, pode conter arquivos, como JavaScripts e CSSs. Também podem alterar seu arquivo de configuração ou adicionar código no seu projeto. A grande vantagem é que, ao invés de você ter que manualmente baixar assemblies ou arquivos, o NuGet faz isso automaticamente para você.</p>
<p>A partir do Visual Studio 2012, os templates de projetos são baseados no NuGet. Se você criar uma aplicação ASP.NET MVC com o template de Internet, por exemplo, um arquivo chamado <em>packages.config</em> é criado contendo todas as referências ao pacotes utilizados. Esse arquivo é parecido com isso:</p>
<p><script src="https://gist.github.com/edneypitta/b0337d6edfc55f24fb7c.js"></script></p>
<h4>Janela Manage NuGet Packages</h4>
<p>A janela Manage NuGet Packages serve para você gerenciar os pacotes instalados no seu projeto e instalar novos pacotes.</p>
<p>Você pode acessá-la pelo Visual Studio no menu Tools > Library Package Manager > Manage NuGet Packages. Desse modo, os pacotes da solution inteira são abertos:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/19.png" alt="manage nuget packages" width="850" height="568" class="alignnone size-full wp-image-579" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/19.png 850w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/19-300x200.png 300w" sizes="(max-width: 850px) 100vw, 850px" /></p>
<p>Indo na seção Online, você pode procurar os pacotes disponíveis e instalá-los diretamente do Visual Studio. Na parte Update, o Visual Studio detecta todas as atualizações disponíveis e você pode instalá-las com 1 clique.</p>
<p>Você pode abrir os pacotes instalados apenas para 1 projeto, clicando com o botão direito em References > Manage NuGet Packages. A tela funciona exatamente igual.</p>
<p>Outra grande vantagem do NuGet é que, ao instalar ou atualizar um pacote, ele detecta automaticamente todas as dependências e as instala juntamente com o pacote.</p>
<h4>Package Manager Console</h4>
<p>Para instalar, atualizar ou remover pacotes, você pode também usar o Package Manager Console, que é um Windows PowerShell integrado ao Visual Studio. Ele é assim:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/20.png" alt="package manager console" width="835" height="319" class="alignnone size-full wp-image-580" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/20.png 835w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/20-300x115.png 300w" sizes="(max-width: 835px) 100vw, 835px" /></p>
<p>Para instalar um pacote, o comando <em>Install-Package</em> pode ser usado. Exemplo: <code>Install-Package Ninject</code>.</p>
<p>Com isso, o assembly do Ninject é baixado para a pasta <em>packages</em> da solution e uma referência é adicionada ao projeto. </p>
<p>Uma feature interessante do console é o auto complete, acionado quando você aperta a tecla Tab. Ele funciona para os nomes dos comandos e dos pacotes.</p>
<p>Para desinstalar um pacote, o comando é o <em>Uninstall-Package</em>: <code>Uninstall-Package Ninject</code>.</p>
<p>Esse comando remove o pacote do packages.config, remove a referência do projeto e deleta a pasta da packages. Todas as alterações aos arquivos de configuração também são revertidas. Porém, as dependências instaladas não são automaticamente removidas.</p>
<p>Para atualizar um pacote, o comando é <em>Update-Package</em>: <code>Update-Package Ninject</code>.</p>
<p>Caso você não especifique um pacote para o comando Update-Package, todos os pacotes da solution são atualizados. Para atualizar todos os pacotes de apenas um projeto, o parâmetro <em>-Project</em> pode ser usado: <code>Update-Package -Project NuGetTest</code>.</p>
<p>Alguns pacotes oferecem comandos que são integrados ao console. Após instalar o pacote do Entity Framework, por exemplo, você pode usar os comandos <em>Enable-Migrations</em>, <em>Add-Migration</em> e <em>Update-Database</em> para usar Code First Migrations.</p>
<p>O último detalhe é que os comandos são executados por padrão para o primeiro projeto da solution. Isso pode ser alterado no drop-down <em>Default project</em>.</p>
<h4>Compartilhando Pacotes</h4>
<p>Incluir os pacotes no controle de versão não é uma boa prática, pois todos eles serão guardados e baixados para cada pessoa que acessar o projeto. Se você esquecer de adicionar um pacote no controle de versão, também vai haver problemas para os outros usuários.</p>
<p>Ao clicar com o botão direito na solution no Visual Studio, você pode habilitar a opção <em>Enable Package Restore On Build</em>. Ao fazer isso, uma pasta <em>.nuget</em> é adicionada na solution com um arquivo <em>NuGet.exe</em>. Dessa forma, no build do projeto o NuGet vai validar se todos os pacotes estão instalados e, se algum estiver faltando, vai fazer o download automaticamente. Isso permite que você não precise colocar os pacotes no controle de versão.</p>
<p>Se você quer mudar a localização dos pacotes instalados, basta adicionar um arquivo <em>nuget.config</em> na solution com o seguinte conteúdo:</p>
<p><script src="https://gist.github.com/edneypitta/601c40aa7b91a12e374d.js"></script></p>
<h2>Criando E Configurando Um Pacote NuGet</h2>
<p>Qualquer pessoa pode adicionar um pacote NuGet na galeria, tornando-o disponível a todos. Essa seção explica como criar e configurar um pacote para disponibilizá-lo na galeria.</p>
<h4>Conteúdo Do Pacote</h4>
<p>Um pacote NuGet é descrito pelo arquivo <em>.nuspec</em>, contendo um XML que descreve seu pacote. Ele é mais ou menos assim:</p>
<p><script src="https://gist.github.com/edneypitta/f61b190e57772dadb1e3.js"></script></p>
<p>Em seguida, você vai colocar seus arquivos. A convenção é distribuí-los em 3 pastas: <em>\lib</em>, <em>\content</em> e <em>\tools</em>.</p>
<p>A pasta lib contém os assemblies. Se seu pacote for multiplataforma, você pode usar subpastas para separar essas versões.</p>
<p>A pasta content tem arquivos de configuração, imagens, JavaScript, CSS, etc. Todos os arquivos nessa pasta serão incluídos no projeto. Isso significa que se você tiver uma imagem em <em>\content\images\myimg.png</em>, ela será adicionada no projeto em <em>\images\myimg.png</em>.<br />
Arquivos de transformação também podem ser colocados nessa pasta. Se houver um arquivo <em>app.config.transformation</em> ou <em>web.config.transformation</em>, o NuGet vai colocar os elementos desses arquivos que não estiverem no arquivo de configuração do projeto.<br />
Isso também é possível via código com arquivos <em>.cs.pp</em> quando você quer adicionar código no Global.asax ou alguma classe, por exemplo. Há alguns tokens que podem ser usados, como o <em>$rootnamespace$</em>, que insere o namespace correto: <code>namespace $rootnamespace$.Models</code>.</p>
<p>Por fim, na pasta tools podem ser colocados scripts Windows PowerShell para rodar quando seu pacote é carregado, instalado e desinstalado, com os nomes <em>Init.ps1</em>, <em>Install.ps1</em> e <em>Uninstall.ps1</em>, respectivamente.</p>
<p>Um último detalhe é que se seu pacote não tiver nada dentro das pastas content e lib ele é considerado um pacote a nível de solution. Você usa isso se seu objetivo for adicionar comandos ao Package Manager Console, como o pacote do Entity Framework.</p>
<h4>Criando Seu Pacote NuGet</h4>
<p>Você pode criar seu pacote NuGet via linha de comando ou usando a ferramenta <em>NuGet Package Explorer</em>.</p>
<p>Para usar a linha de comando, você deve ter o arquivo <em>NuGet.exe</em> e adicionar a localização dele no PATH.</p>
<p>O primeiro comando que você deve utilizar é o <code>NuGet Update -self</code>, que atualiza o NuGet para a última versão.</p>
<p>Para criar um pacote NuGet a partir de um assembly, o comando é o <code>nuget spec MyAssembly.dll</code>. Com isso o arquivo <em>MyAssembly.nuspec</em> é criado contendo o manifesto para você editar o nome, descrição, dependências, etc.</p>
<p>Depois disso, o comando <code>nuget pack MyAssembly.nuspec</code> cria de fato seu pacote no arquivo <em>MyAssembly.dll.1.0.0.nupkg</em>. Você pode testá-lo no Visual Studio abrindo o Package Manager Console e digitando o comando <code>Install-Package MyAssembly.dll -Source "C:\{location_of_your_package}"</code>. </p>
<p>Você pode também criar um pacote NuGet a partir de um projeto do Visual Studio. Basta ir para a pasta do projeto (onde está o arquivo <em>.csproj</em>) e rodar o comando <code>nuget spec</code>. O arquivo <em>.nuspec</em> vai ser criado obtendo os tokens de id, versão, autor e descrição do arquivo <em>AssemblyInfo.cs</em> do projeto. Depois o comando <code>nuget pack MyProject.csproj</code> cria o pacote completo.</p>
<p>Para criar um pacote complexo que contenha as pastas lib, content e tools, você precisa criar seu pacote manualmente com o comando <code>nuget spec</code>, editar o arquivo <em>.nuspec</em> como desejado, adicionar os arquivos nas pastas e criar o pacote com <code>nuget pack YourPackage.nuspec</code>.</p>
<p>Com seu pacote pronto, você vai publicá-lo no NuGet. Com a API Key gerada no site do NuGet, você deve primeiro rodar o comando <code>NuGet SetApiKey Your-API-Key</code>. Depois, a publicação é feita com <code>NuGet Push YourPackage.nupkg</code>.</p>
<p>A outra opção para criar e publicar um pacote é usando o programa <em>NuGet Package Explorer</em>. Essa ferramenta permite que você crie o manifesto com um editor gráfico, adicione arquivos nas pastas lib, content e tools e publique o pacote para o NuGet com 1 clique. Você pode também abrir pacotes, tanto locais quanto do feed, para explorar o conteúdo.</p>
<h2>Preparando Um Repositório De Pacotes</h2>
<p>Por padrão, o Visual Studio configura o repositório oficial do NuGet para obter pacotes. Você pode adicionar repositórios adicionais, tanto locais quanto remotos.</p>
<p>Para criar um repositório local, você vai em Tools > Library Package Manager > Package Manager Settings. Na aba Package Source, a seguinte tela é mostrada:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/7.png" alt="options" width="803" height="470" class="alignnone size-full wp-image-583" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/7.png 803w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/7-300x176.png 300w" sizes="(max-width: 803px) 100vw, 803px" /></p>
<p>Depois é só clicar o botão Add, colocar um nome e um caminho. Todos os arquivos <em>.nupkg</em> serão listados na aba Online da janela Manage NuGet Packages e no Package Manager Console, no drop-down Package-source.</p>
<p>Você pode também criar um feed remoto que roda no IIS. Você deve criar uma web application vazia no Visual Studio e instalar o pacote <em>NuGet.Server</em>. Esse pacote adiciona todo o código necessário para a exposição dos seus pacotes como ATOM. Os pacotes dentro da pasta <em>Packages </em>serão disponibilizados (podendo ser configurado via web.config). </p>
<p>É possível habilitar publicações para seu repositório remoto, como se fosse a galeria oficial do NuGet. Para isso basta adicionar a API Key no web.config.</p>
<p>Depois, basta hospedar sua aplicação no IIS e acessar o feed na URL <em>http://{locationofyoursite}/nuget/</em>. Adicionando essa URL no Package Source, é possível instalar pacotes desse repositório normalmente.</p>
<hr />
<p>E isso é tudo 🙂</p>
<p>Obrigado pela leitura e aguarde o próximo post, que será sobre o objetivo <strong><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-5-create-configure-and-publish-a-web-package/">Create, configure, and publish a web package</a></strong>.</p>
<p>Até mais!</p>

				<p><a class="btn btn-default read-more" href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-4-manage-packages-by-using-nuget/" title="Certificação Microsoft 70-487: Objetivo 5.4 – Manage packages by using NuGet">Leia Mais</a></p>

							</div><!-- .entry-content -->
					</div>
	</div>
</article><!-- #post-## -->

			
				
<article id="post-564" class="post-564 post type-post status-publish format-standard hentry category-certificacao tag-70-487">
	<div class="blog-item-wrap">
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-3-configure-a-web-application-for-deployment/" title="Certificação Microsoft 70-487: Objetivo 5.3 – Configure a web application for deployment" >
			 				</a>
		<div class="post-inner-content">
			<header class="entry-header page-header">

				<h1 class="entry-title"><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-3-configure-a-web-application-for-deployment/" rel="bookmark">Certificação Microsoft 70-487: Objetivo 5.3 – Configure a web application for deployment</a></h1>

								<div class="entry-meta">
					<span class="posted-on"><i class="fa fa-calendar"></i> <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-3-configure-a-web-application-for-deployment/" rel="bookmark"><time class="entry-date published" datetime="2016-03-05T12:07:44+00:00">05/03/2016</time><time class="updated" datetime="2016-03-08T10:56:09+00:00">08/03/2016</time></a></span><span class="byline"> <i class="fa fa-user"></i> <span class="author vcard"><a class="url fn n" href="https://edneypitta.github.io/old-blog/author/admin/">Edney Pitta</a></span></span>				<span class="comments-link"><i class="fa fa-comment-o"></i><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-3-configure-a-web-application-for-deployment/#respond"><span class="dsq-postid" data-dsqidentifier="564 https://edneypitta.github.io/old-blog/?p=564">Deixe um comentário</span></a></span>
				
				
				</div><!-- .entry-meta -->
							</header><!-- .entry-header -->

						<div class="entry-content">

				<p>Olá pessoal!<br />
Vamos ao objetivo 5.3, <strong>Configure a web application for deployment</strong>. Esse objetivo cobre como trocar de release para debug, transformar web.config com XSLT, usar SetParameters e configurar o Windows Azure.</p>
<h2>Mudando De Release Para Debug</h2>
<p>Ao fazer o build de um projeto, você usa uma <em>build configuration</em>. Duas configurações existem por padrão: <em>release </em>e <em>debug</em>.</p>
<p>Em release, o código é otimizado para rodar o mais rápido possível, o que você com certeza deseja no ambiente de produção.</p>
<p>O modo debug é o ideal para o ambiente de desenvolvimento, pois instruções extra são adicionadas no código compilado, permitindo que ela seja debugado.</p>
<p>Além da build configuration, há uma configuração no web.config que diz respeito a compilação. Mudando o valor do atributo debug para false, você desliga o modo de debug:</p>
<p><code>&lt;configuration&gt;<br />
&lt;system.web&gt;<br />
&lt;compilation debug=&quot;true&quot; targetFramework=&quot;4.5&quot; /&gt;<br />
&lt;/system.web&gt;<br />
&lt;/configuration&gt;</code></p>
<p>No Visual Studio, você tem a opção de escolher quais debuggers utilizar no modo debug:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/5.png" alt="debuggers" width="848" height="500" class="alignnone size-full wp-image-572" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/5.png 848w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/5-300x177.png 300w" sizes="(max-width: 848px) 100vw, 848px" /></p>
<h2>Transformando O Web.Config Com XSLT</h2>
<p>No seu arquivo web.config, você guarda vários tipos de configurações como connection strings, app settings customizadas, etc. Esses valores dependem do ambiente que a aplicação está rodando. Você não pode fazer o deploy de uma aplicação com a connection string do seu banco local, por exemplo. Fazer as alterações manualmente, além de levar tempo, é suscetível a erros. </p>
<p>Aí entra o <em>web.config transformation syntax</em>. Com ele você define um XML que descreve as mudanças a serem feitas no web.config ao mudar de debug para release.</p>
<p>Ao criar uma aplicação ASP.NET MVC, os arquivos de transformação são criados automaticamente:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/6.png" alt="web.config" width="335" height="486" class="alignnone size-full wp-image-573" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/6.png 335w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/6-207x300.png 207w" sizes="(max-width: 335px) 100vw, 335px" /></p>
<p>As transformações trabalham com a sintaxe do XML-Document-Transform. Segue um exemplo de arquivo de transformação que muda a connection string e configura o customErrors:</p>
<p><script src="https://gist.github.com/edneypitta/f791c82d952679cc5ded.js"></script></p>
<p>Você começa especificando o namespace para o arquivo de transformação. Depois, com os atributos <em>xdt:Transform </em>e <em>xdt:Locator</em>, você configura como os elementos devem ser encontrados e o que acontece quando isso acontecer. Nesse exemplo, apenas mudamos a connection string, mas o elemento customErrors é completamente substituído.</p>
<p>Para o atributo Locator, você pode usar os valores Match, XPath e Condition. A explicação detalhada do funcionamento deles pode ser vista <a href="https://msdn.microsoft.com/en-us/library/dd465326(v=vs.110).aspx" target="_blank">aqui</a>. Para o atributo Transform, os possíveis valores são: Insert, InsertBefore, InsertAfter, Remove, RemoveAll, RemoveAttributes e SetAttributes.</p>
<h2>Usando SetParameters Para Preparar Um IIS App Pool</h2>
<p>A <em>web.config transformation</em> é feita em tempo de compilação. Isso é bom quando você sabe em quais ambientes a aplicação será publicada.</p>
<p>Com Web Deploy, porém, você tem outra opção: <em>parametrização</em>. Com ela você pode parametrizar valores em tempo de instalação, facilitando a distribuição de um pacote para vários lugares. </p>
<p>Um pacote Web Deploy cria alguns arquivos para você, como o <strong>{nome do projeto}.zip</strong>, que é o pacote Web Deploy, e o <strong>{nome do projeto}.deploy.cmd</strong>, que permite que você faça o deploy da linha de comando. Há também o arquivo <strong>{nome do projeto}.SetParameters.xml</strong>, que tem uma série de valores que o MSDeploy.exe usa para fazer o deploy da aplicação. Esse arquivo é gerado dinamicamente, obtendo todas as configurações do seu projeto, como as connection strings do web.config.</p>
<p>A parametrização é feita quando você adiciona um arquivo <em>Parameters.xml</em> para o pacote Web Deploy. Nesse arquivo, você indica o arquivo que quer modificar, quais variáveis serão alteradas e um valor padrão para elas. Na instalação do pacote via IIS Manager, esses valores serão pedidos para o usuário digitar. </p>
<p>Segue um exemplo de uma seção de um web.config abaixo de <em>system.ServiceModel</em>:</p>
<p><script src="https://gist.github.com/edneypitta/5930e5636bade580aabe.js"></script></p>
<p>O seguinte Parameters.xml pode ser usado:</p>
<p><script src="https://gist.github.com/edneypitta/9b0fbeb75ed715cfe771.js"></script></p>
<p>Segue a explicação de alguns atributos importantes:</p>
<ul>
<li><strong>name</strong>: o nome que é mostrado no IIS Manager;</li>
<li><strong>description</strong>: a descrição que é mostrada no IIS Manager;</li>
<li><strong>defaultValue</strong>: o valor que é pré-carregado no input;</li>
<li><strong>scope</strong>: uma expressão regular que mostra os arquivos que o parâmetro se aplica;</li>
<li><strong>kind</strong>: especifica o tipo do recurso na qual o parâmetro será aplicado (<em>XmlFile </em>ou <em>TextFile</em>);</li>
<li><strong>match</strong>: no caso de XmlFile, um XPath que seleciona o elemento que será alterado.</li>
</ul>
<p>Caso você esteja fazendo o deploy pela linha de comando, você pode usar as opções <em>declareParamFile </em>and <em>setParamFile </em> para especificar os arquivos Parameters.xml e SetParameters.xml:</p>
<p><code>msdeploy.exe -verb:sync -source:apphostconfig="default web site/application"<br />
-dest:archivedir="C:\packages\application" <strong>-declareParamFile</strong>="C:\source\application\<br />
deployment\declareParamsFile.xml"</code></p>
<p><code>msdeploy.exe -verb:sync -dest:apphostconfig="default web site/application"<br />
-source:archivedir="C:\packages\application" <strong>-setParamFile</strong>="C:\source\application\<br />
deployment\setParamsFile.xml"</code></p>
<p>Por último, caso você não queira alterar o arquivo SetParameters.xml na mão em um processo de build por exemplo, existe uma task do MSBuild chamada XmlPoke que pode automatizar isso.</p>
<p>Para o exame, lembre-se do seguinte: web.config transformation é feita em tempo de compilação, enquanto parametrização em tempo de instalação.</p>
<h2>Configurando O Windows Azure</h2>
<p>Um projeto Cloud tem dois arquivos de configuração: <em>ServiceConfiguration.Cloud.cscfg</em> e <em>ServiceConfiguration.Local.cscfg</em>. O arquivo Local tem valores para o Windows Azure Emulator, enquando o Cloud tem os valores que serão usados no deploy para o Azure.</p>
<p>Nesses arquivos você pode configurar o número de instâncias para cada role, quaisquer app settings customizadas, thumbprints para certificados, VPNs no caso de máquinas virtuais (VM), etc.</p>
<p>Ao criar um projeto Cloud com uma web role e uma worker role, o seguinte arquivo de configuração é criado:</p>
<p><script src="https://gist.github.com/edneypitta/1c5109148f7e28c56f69.js"></script></p>
<p>O elemento <em>Role</em>, além de especificar o nome da sua role, pode também ter o atributo <em>vmName</em> para ser usado como o nome o DNS para sua VM.</p>
<p>Dentro do elemento Role há o elemento <em>Instances</em> que indica o número de instâncias da role e o elemento <em>ConfigurationSettings</em>, que é uma coleção chave valor.</p>
<p>Outros elementos que podem ser adicionados são o <em>Certificates</em> e o <em>OsImage</em>:</p>
<p><script src="https://gist.github.com/edneypitta/b14ad00966a51d17182e.js"></script></p>
<p>Depois do elemento <em>Roles</em>, você pode especificar o elemento <em>NetworkConfiguration</em>. Essa seção descreve os valores de DNS e VPN. Um exemplo de configuração:</p>
<p><script src="https://gist.github.com/edneypitta/3b81287417d85f1d0a99.js"></script></p>
<hr />
<p>Chegamos ao final desse objetivo 🙂 Faltam apenas 3!</p>
<p>Obrigado pela leitura e fique de olho no próximo post, que será sobre o objetivo <strong><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-4-manage-packages-by-using-nuget/">Manage packages by using NuGet</a></strong>.</p>
<p>Até mais!</p>

				<p><a class="btn btn-default read-more" href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-3-configure-a-web-application-for-deployment/" title="Certificação Microsoft 70-487: Objetivo 5.3 – Configure a web application for deployment">Leia Mais</a></p>

							</div><!-- .entry-content -->
					</div>
	</div>
</article><!-- #post-## -->

			
				
<article id="post-555" class="post-555 post type-post status-publish format-standard hentry category-certificacao tag-70-487">
	<div class="blog-item-wrap">
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-2-choose-a-deployment-strategy-for-a-windows-azure-web-application/" title="Certificação Microsoft 70-487: Objetivo 5.2 – Choose a deployment strategy for a Windows Azure web application" >
			 				</a>
		<div class="post-inner-content">
			<header class="entry-header page-header">

				<h1 class="entry-title"><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-2-choose-a-deployment-strategy-for-a-windows-azure-web-application/" rel="bookmark">Certificação Microsoft 70-487: Objetivo 5.2 – Choose a deployment strategy for a Windows Azure web application</a></h1>

								<div class="entry-meta">
					<span class="posted-on"><i class="fa fa-calendar"></i> <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-2-choose-a-deployment-strategy-for-a-windows-azure-web-application/" rel="bookmark"><time class="entry-date published" datetime="2016-03-03T12:05:14+00:00">03/03/2016</time><time class="updated" datetime="2016-03-05T12:08:44+00:00">05/03/2016</time></a></span><span class="byline"> <i class="fa fa-user"></i> <span class="author vcard"><a class="url fn n" href="https://edneypitta.github.io/old-blog/author/admin/">Edney Pitta</a></span></span>				<span class="comments-link"><i class="fa fa-comment-o"></i><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-2-choose-a-deployment-strategy-for-a-windows-azure-web-application/#comments"><span class="dsq-postid" data-dsqidentifier="555 https://edneypitta.github.io/old-blog/?p=555">1 Comentário</span></a></span>
				
				
				</div><!-- .entry-meta -->
							</header><!-- .entry-header -->

						<div class="entry-content">

				<p>Olá pessoal, tudo bem?<br />
Vamos ao objetivo <strong>Choose a deployment strategy for a Windows Azure web application</strong>, que fala de conceitos de deploy voltados para o Azure.</p>
<h2>Fazendo In-Place Upgrade E VIP Swap</h2>
<p>Em casos de web farm, o Azure oferece 3 maneiras de atualizar sua aplicação: deletando e redeployando, In-Place Upgrade e VIP Swap.</p>
<p>Deletar seu cloud service e redeployar é fácil, mas requer um downtime para seu serviço. Você deve usar essa opção em casos de mudança de número de endpoints, porta, firewall, certificados, etc. </p>
<h4>In-Place Upgrade</h4>
<p>Para entender o <strong>In-Place Upgrade</strong>, é necessário entender os conceitos de <em>Upgrade Domain</em> e <em>Fault Domain</em>. Upgrade Domain é uma unidade lógica da sua aplicação, enquanto Fault Domain é uma unidade física. </p>
<p>Vamos supor que você precisa de 5 instâncias para sua aplicação. <strong>Automaticamente</strong> (isso não é controlável por você), o Azure vai distribuir cada instância entre o número de Upgrade Domains que você configurou no atributo <em>upgradeDomainCount</em> no arquivo Service Definition (valor padrão: 5, valor máximo: 20). Na hora do deploy da sua aplicação (In-Place Upgrade), o Azure atualiza um Upgrade Domain por vez, evitando downtime para o seu serviço.</p>
<p>Fault Domain, também automaticamente atribuído pelo Azure, é quando as instâncias são separadas em servidores físicos diferentes. Somente com 2 Fault Domains o Azure garante o SLA de 99.95%.</p>
<p>Para entender melhor esses conceitos, recomendo esse post: <a href="https://blog.tompawlak.org/windows-azure-fault-and-upgrade-domain" target="_blank">https://blog.tompawlak.org/windows-azure-fault-and-upgrade-domain</a>. Vamos em frente.</p>
<p>Você tem 2 opções para disparar um deploy In-Place Upgrade. A primeira é diretamente pelo portal do Azure, fazendo o upload do pacote direto para seu Cloud Service. A outra é pelo Visual Studio, que necessita de um certificado emitido pelo portal para identificação:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/16.png" alt="new subscription" width="534" height="444" class="alignnone size-full wp-image-557" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/16.png 534w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/16-300x249.png 300w" sizes="(max-width: 534px) 100vw, 534px" /></p>
<p>Como dito antes, ao fazer um deploy, o Azure vai atualizar seus Upgrade Domains um por um. Então se você tiver mais do que 2 Upgrade Domains, no momento do deploy eles terão diferentes versões da sua aplicação. Isso pode ser um problema caso haja alterações no schema do banco de dados, por exemplo. Para resolver isso, existe uma técnica de deploy chamada VIP Swap.</p>
<h4>VIP Swap</h4>
<p>Um Cloud Service no Azure tem 2 ambientes: produção e staging. Ambos têm o mesmo hardware, diferenciando apenas o <em>virtual IP</em> (VIP) e a URL do serviço.</p>
<p>O VIP Swap é quando o VIP e a URL dos ambientes de produção e staging são trocados. Isso significa que você pode fazer o deploy da nova versão da sua aplicação no ambiente de staging, testá-la, e promovê-la para produção instantaneamente com o VIP Swap. Depois, você pode deletar o ambiente de staging para evitar custos.</p>
<p>Isso permite que você atualize todas as instâncias de uma só vez, evitando diferentes versões em produção ao mesmo tempo. Ainda vai haver requests que estão apontando para a versão antiga, mas o problema é bastante minimizado com essa técnica.</p>
<p>Para realizar um VIP Swap, primeiro você precisa fazer o upload da nova versão da aplicação para o ambiente de staging, seja por deletando o serviço e redeployando ou via In-Place Upgrade. Depois de validado, basta ir no portal do Azure no ambiente de staging e clicar no botão Swap:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/17.png" alt="swap" width="848" height="545" class="alignnone size-full wp-image-558" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/17.png 848w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/17-300x193.png 300w" sizes="(max-width: 848px) 100vw, 848px" /></p>
<h2>Criando E Configurando Input E Internal Endpoints</h2>
<p>Há dois tipos de endpoints para suas instâncias de Cloud Services: <em>Input Endpoint</em> e <em>Internal Endpoint</em>. Um Input Endpoint é usado para conexões externas (internet) feitas via HTTP, HTTPS ou TCP. Internal Endpoints são usados para conexões internas entre as instâncias do Cloud Services via HTTP ou TCP.</p>
<p>Seu Cloud Service pode ter 25 endpoints de cada tipo, que podem ser espalhados entre as roles. Quando você cria um projeto Cloud com uma web role e uma worker role, o arquivo <em>ServiceDefinition.csdef</em> fica assim:</p>
<p><script src="https://gist.github.com/edneypitta/4645e4befaa14c50df81.js"></script></p>
<p>A web role por padrão vem com um input endpoint na porta 80, padrão para conexões HTTP. A worker role não tem endpoints por padrão, mas você pode adicionar um input endpoint sem problemas:</p>
<p><code>&lt;Endpoints&gt;<br />
&lt;InputEndpoint name=&quot;WorkerRoleInput&quot; port=&quot;8080&quot; protocol=&quot;http&quot; localPort=&quot;8080&quot;/&gt;<br />
&lt;/Endpoints&gt;</code></p>
<p>Agora o load balancer encaminha os requests na porta 8080 para a worker role. Dentro dela, você pode usar um HttpListener para lidar com os requests:</p>
<p><script src="https://gist.github.com/edneypitta/e8460b46cf4f0d16e7d0.js"></script></p>
<p>Um ponto importante é que no Windows Azure emulator, as portas são remapeadas para a próxima porta disponível, para evitar conflitos. Isso significa que a porta 80 será remapeada para 81 e a 8080 para 8081.</p>
<p>Você também pode editar as configurações de endpoint diretamente do Visual Studio, clicando duas vezes no nome da role no projeto Cloud Services:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/18.png" alt="cloud service" width="849" height="397" class="alignnone size-full wp-image-560" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/18.png 849w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/18-300x140.png 300w" sizes="(max-width: 849px) 100vw, 849px" /></p>
<p>Ao selecionar o tipo do endpoint, há uma terceira opção chamada <em>InstanceInputEndpoint</em>. Nela você pode especificar um range de portas externas que são mapeadas para uma única porta. A configuração fica assim:</p>
<p><code>&lt;InstanceInputEndpoint name=&quot;Endpoint2&quot; <strong>localPort</strong>=&quot;1000&quot; protocol=&quot;tcp&quot;&gt;<br />
&lt;AllocatePublicPortFrom&gt;<br />
&lt;FixedPortRange min=&quot;10016&quot; max=&quot;10020&quot;/&gt;<br />
&lt;/AllocatePublicPortFrom&gt;<br />
&lt;/InstanceInputEndpoint&gt;</code></p>
<p>O elemento InstanceInputEndpoint especifica a porta local para onde os requests serão direcionados e o protocolo, enquanto o elemento AllocatePublicPortFrom especifica o range de portas públicas que serão ouvidas.</p>
<h2>Especificando Configurações Do Sistema Operacional</h2>
<p>Quando você cria um projeto Cloud Services, há dois arquivos de configuração: o <em>ServiceDefinition.csdef</em>, que especifica as configurações do Cloud Service como um todo, e o <em>ServiceConfiguration.cscfg</em> para configurações específicas das roles, como o número de instâncias, configurações de diagnostics, certificados, etc.</p>
<p>Uma configuração importante para o exame é a especificação da versão do sistema operacional. Ao criar um novo projeto Cloud com uma web role e uma worker role, o arquivo .cscfg fica assim:</p>
<p><script src="https://gist.github.com/edneypitta/5fcfc82186c1c810dd75.js"></script></p>
<p>O atributo <em>osFamily</em> é o número da família do sistema operacional. A especificação completa das famílias e o suporte de cada uma delas pode ser vista <a href="https://azure.microsoft.com/pt-br/documentation/articles/cloud-services-guestos-update-matrix/" target="_blank">aqui</a>.</p>
<p>O atributo <em>osVersion</em> especifica exatamente a versão do Guest OS em que sua role vai rodar. O valor * significa sempre a última versão. Para colocar uma versão específica, o seguinte formato deve ser utilizado: <code>WA-GUEST-OS-M.m_YYYYMM-nn</code>, onde <em>WA-GUEST-OS</em> é um valor fixo, <em>M.m</em> é o número da versão, <em>YYYY</em> o ano, <em>MM </em>o mês e <em>nn </em>um número sequencial para diferenciar os releases.</p>
<hr />
<p>Terminamos mais um objetivo 🙂</p>
<p>Obrigado pela leitura e fique de olho no próximo post, que será sobre o objetivo 5.3: <strong><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-3-configure-a-web-application-for-deployment/">Configure a web application for deployment</a></strong>.</p>
<p>Até mais!</p>

				<p><a class="btn btn-default read-more" href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-2-choose-a-deployment-strategy-for-a-windows-azure-web-application/" title="Certificação Microsoft 70-487: Objetivo 5.2 – Choose a deployment strategy for a Windows Azure web application">Leia Mais</a></p>

							</div><!-- .entry-content -->
					</div>
	</div>
</article><!-- #post-## -->

			
				
<article id="post-546" class="post-546 post type-post status-publish format-standard hentry category-certificacao tag-70-487">
	<div class="blog-item-wrap">
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-1-design-a-deployment-strategy/" title="Certificação Microsoft 70-487: Objetivo 5.1 – Design a deployment strategy" >
			 				</a>
		<div class="post-inner-content">
			<header class="entry-header page-header">

				<h1 class="entry-title"><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-1-design-a-deployment-strategy/" rel="bookmark">Certificação Microsoft 70-487: Objetivo 5.1 – Design a deployment strategy</a></h1>

								<div class="entry-meta">
					<span class="posted-on"><i class="fa fa-calendar"></i> <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-1-design-a-deployment-strategy/" rel="bookmark"><time class="entry-date published" datetime="2016-03-03T00:33:34+00:00">03/03/2016</time><time class="updated" datetime="2016-03-03T12:06:21+00:00">03/03/2016</time></a></span><span class="byline"> <i class="fa fa-user"></i> <span class="author vcard"><a class="url fn n" href="https://edneypitta.github.io/old-blog/author/admin/">Edney Pitta</a></span></span>				<span class="comments-link"><i class="fa fa-comment-o"></i><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-1-design-a-deployment-strategy/#respond"><span class="dsq-postid" data-dsqidentifier="546 https://edneypitta.github.io/old-blog/?p=546">Deixe um comentário</span></a></span>
				
				
				</div><!-- .entry-meta -->
							</header><!-- .entry-header -->

						<div class="entry-content">

				<p>Olá pessoal, tudo bem?<br />
Esse objetivo é o primeiro do tópico <strong>Deploying web applications and services</strong>, os últimos 20% da certificação. Nesse objetivo vamos ver como fazer o deploy de aplicações web usando XCopy, criar um IIS Install Package, automatizar deploys com TFS ou Build Server e fazer deploy para web farms.</p>
<h2>Fazendo Deploy De Aplicações Web Usando XCopy</h2>
<p>O jeito mais fácil de fazer o deploy de uma aplicação para um ambiente de produção é manualmente. Seja via FTP ou conexão remota, chamamos de XCopy quando você copia os arquivos da sua máquina local para uma de produção. XCopy, na verdade, é um comando DOS para transferência de vários arquivos ao mesmo tempo. A sintaxe dele é a seguinte:</p>
<p><code>xcopy /I /S /E &lt;source path&gt; &lt;destination path&gt;</code></p>
<p>A opção <em>/I</em> diz que você copiando uma pasta, a <em>/S</em> que você quer copiar todos os subdiretórios e a <em>/E</em> que as subpastas devem ser copiadas mesmo que vazias. Há também a opção <em>/d</em>, que indica que somente os arquivos novos atualizados ou novos devem ser copiados.</p>
<h4>Configurando O IIS</h4>
<p>Na primeira vez que você copiar os arquivos do seu site para seu servidor, você vai precisar configurá-lo no IIS, que é o servidor de hospedagem para aplicações no Windows. Você precisa dizer ao IIS qual é a pasta do seu site e como ele vai estar disponível para os usuários.</p>
<p>Assumindo que você tenha uma aplicação em <em>C:\Development\MyApp</em> e quer movê-la para <em>C:\inetpub\wwwroot\MyApp</em>, o primeiro passo é fazer o XCopy:</p>
<p><code>xcopy /I /S C:\Development\MyApp C:\inetpub\wwwroot\MyApp</code></p>
<p>Para fazer a configuração no IIS, você abre o IIS Manager e a opção de adicionar um website. Você precisa dar um nome e apontar a localização da pasta (nesse caso, <em>C:\inetpub\wwwroot\MyApp</em>). Normalmente também você deve colocar um host name para o IIS mapear os requests HTTP na porta 80. </p>
<p>No exemplo abaixo, alteramos a porta para 81 e deixamos o host name em branco, para podermos acessar o site somente pela porta. A configuração fica assim:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/15.png" alt="iis add website" width="546" height="524" class="alignnone size-full wp-image-550" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/15.png 546w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/15-300x288.png 300w" sizes="(max-width: 546px) 100vw, 546px" /></p>
<p>Acessando <em>http://localhost:81</em> no browser, o ISS já consegue mapear o request e mandá-lo para a aplicação. </p>
<h4>Preparando Um Website Para Deploy</h4>
<p>Quando os arquivos são atualizados, o IIS detecta as modificações e começa a atualizar o site. Isso gera erros nos requests feitos enquanto a aplicação está parcialmente atualizada.</p>
<p>Para evitar que os usuários vejam uma tela de erro, você pode colocar um arquivo com o nome <em>App_offline.htm</em> no root do website. O IIS então vai mostrar esse HTML ao invés da mensagem de erro. Após a atualização de todos os arquivos, você deve apagar esse arquivos para o IIS voltar a processar os requests.</p>
<p>Outro ponto é que o App Domain pode restartar várias vezes enquanto os arquivos estão sendo atualizados. Você pode configurar o atributo <em>waitChangeNotification</em> no seu web.config para especificar o número de segundos de espera antes que o App Domain restarte:</p>
<p><script src="https://gist.github.com/edneypitta/ef422e752129cc300612.js"></script></p>
<h4>Ferramental Para Deploys XCopy</h4>
<p>Usar o XCopy pela linha de comando não é a melhor maneira de você copiar seus arquivos. O Visual Studio oferece algumas ferramentas para auxiliar o processo de deploy, e vamos analisar uma delas agora: a Copy Website Tool. Nela você pode:</p>
<ul>
<li>Copiar arquivos de código para o target especificado;</li>
<li>Copiar arquivos usando os protocolos suportados: IIS local, IIS remoto, FTP e HTTP (comente com FrontPage Server Extensions);</li>
<li>Escolher quais arquivos quer sincronizar do seu código para o target;</li>
<li>Automaticamente copiar o arquivo App_offline.htm quando o deploy começar e removê-lo quando terminar.</li>
</ul>
<h2>Criando Um IIS Install Package</h2>
<p>Lançado em 2009, o Web Deploy permite que você crie um pacote de deploy que além dos arquivos do seu site contém configurações de banco de dados, IIS, registro, assemblies para carregar no GAC, etc.</p>
<p>O Web Deployment Framework simplifica o processo podendo ser utilizado via Visual Studio, IIS, prompt de comando e Windows PowerShell. Também ajuda em ambientes complexos como web farm, onde você sincroniza diferentes servidores usando o Web Deploy.</p>
<p>Para o exame, lembre-se: Web Deployment Framework é a ferramenta ideal para deploys complexos.</p>
<h2>Automatizando Deploys Com TFS Ou Build Server</h2>
<p>Por motivos fora do escopo do exame, você deve saber como automatizar o deploy de uma aplicação com TFS ou Build Server. É importante conhecer os conceitos por trás disso, como Continuous Integration e Continuous Deployment com testes de unidade e integração, mas estes não são prováveis de estarem no exame.</p>
<p>Você pode automatizar o deploy de uma aplicação no Azure de forma bem fácil. Há uma opção &#8220;Set up deployment from source control&#8221; que implementa o conceito de Continuous Deployment: cada check-in no controle de versão dispara um deploy automaticamente. O repositório pode ser TFS ou Git.</p>
<p>É possível também fazer isso on-premises com TFS. Você pode buildar sua aplicação via linha de comando com MSBuild da seguinte forma:</p>
<p><code>MSBuild /target:Publish /p:PublishDir=\\myserver\drops\</code></p>
<p>Depois, editando a Build Definition no TFS, você pode adicionar um comando de Publish para publicar o pacote no Azure.</p>
<p>É importante entender que existem duas ferramentas TFS: uma on-premises e uma na nuvem, atualmente chamada VSTS.</p>
<h2>Fazendo Deploys Para Web Farms</h2>
<p>Para essa seção, você deve entender os conceitos de <em>scale up</em> e <em>scale out</em>. </p>
<p><strong>Scale up</strong> é quando você aumenta a capacidade do seu hardware para fazer uma melhora de performance na sua aplicação. Isso é feito quando você coloca mais memória RAM, troca de processador ou coloca um SSD no lugar do seu HD. Porém, além de ser caro, melhoras no hardware tem o limite do próprio hardware. </p>
<p>Aí entra o conceito de <strong>scale out</strong>, onde você usa múltiplos servidores para hospedar sua aplicação ao invés de melhorar um. Juntos, eles formam o que chamamos de <em>web farm </em>ou ambiente distribuído. Um <em>load balancer</em> é necessário para &#8220;espalhar&#8221; os requests entre os servidores da forma mais eficiente possível.</p>
<p>Porém, um trabalho extra é necessário para sua aplicação poder ser hospedada numa web farm. Normalmente você configura 1 servidor, depois cria as aplicações no IIS de todos os outros com exatamente as mesmas configurações. </p>
<p>Outro ponto de preocupação é a <em>session</em>, que são dados do usuário gravados na memória. Com web farm, requests subsequentes de um mesmo usuário podem cair em várias máquinas diferentes, o que pode impossibilitar o uso de session. Para resolver esse problema, você precisa mover os dados da sessão para uma máquina externa ou até um banco de dados. Há 4 tipos de <em>session states</em>:</p>
<ul>
<li><strong>InProc</strong>: valor padrão, onde os dados da session são gravados na memória;</li>
<li><strong>StateServer</strong>: guarda os dados da session em um processo separado chamado <em>ASP.NET state service</em>;</li>
<li><strong>SQLServer</strong>: guarda os dados da session num banco de dados SQL Server;</li>
<li><strong>Off</strong>: desabilita a session</li>
</ul>
<p>Você também pode escolher ativar <em>session affinity</em>, onde todos os requests de um usuário vão cair no mesmo servidor, garantindo que os dados da session estarão na memória. Porém, nem todos os load balancers suportam isso.</p>
<hr />
<p>Chegamos ao final desse objetivo.</p>
<p>Obrigado pela leitura e fique de olho no próximo post, que será sobre o objetivo <strong><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-2-choose-a-deployment-strategy-for-a-windows-azure-web-application/">Choose a deployment strategy for a Windows Azure web application</a></strong>.</p>
<p>Até mais!</p>

				<p><a class="btn btn-default read-more" href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-1-design-a-deployment-strategy/" title="Certificação Microsoft 70-487: Objetivo 5.1 – Design a deployment strategy">Leia Mais</a></p>

							</div><!-- .entry-content -->
					</div>
	</div>
</article><!-- #post-## -->

			
				
<article id="post-538" class="post-538 post type-post status-publish format-standard hentry category-certificacao tag-70-487">
	<div class="blog-item-wrap">
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-4-5-consume-web-api-web-services/" title="Certificação Microsoft 70-487: Objetivo 4.5 &#8211; Consume Web API web services" >
			 				</a>
		<div class="post-inner-content">
			<header class="entry-header page-header">

				<h1 class="entry-title"><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-4-5-consume-web-api-web-services/" rel="bookmark">Certificação Microsoft 70-487: Objetivo 4.5 &#8211; Consume Web API web services</a></h1>

								<div class="entry-meta">
					<span class="posted-on"><i class="fa fa-calendar"></i> <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-4-5-consume-web-api-web-services/" rel="bookmark"><time class="entry-date published" datetime="2016-03-02T15:56:28+00:00">02/03/2016</time><time class="updated" datetime="2016-03-03T00:34:48+00:00">03/03/2016</time></a></span><span class="byline"> <i class="fa fa-user"></i> <span class="author vcard"><a class="url fn n" href="https://edneypitta.github.io/old-blog/author/admin/">Edney Pitta</a></span></span>				<span class="comments-link"><i class="fa fa-comment-o"></i><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-4-5-consume-web-api-web-services/#respond"><span class="dsq-postid" data-dsqidentifier="538 https://edneypitta.github.io/old-blog/?p=538">Deixe um comentário</span></a></span>
				
				
				</div><!-- .entry-meta -->
							</header><!-- .entry-header -->

						<div class="entry-content">

				<p>Olá pessoal!<br />
O objetivo <strong>Consume Web API web services</strong>, o último sobre Web API, cobre como consumir serviços Web API usando HttpClient e mandar e receber requests em formatos diferentes.</p>
<h2>Consumindo Serviços Web API</h2>
<p>A classe <em>HttpClient</em> é usada para fazer requisições e trabalhar com o retorno. Para os exemplos dessa seção, vamos utilizar o seguinte método como setup:</p>
<p><script src="https://gist.github.com/edneypitta/b94e54f60eaeed11bddc.js"></script></p>
<p>Vamos passar pelos 4 métodos HTTP mais comuns: Get, Post, Put e Delete, além de aprender como lidar com exceções.</p>
<h4>HttpGet</h4>
<p>Para fazer um Get, o método <em>GetAsync</em> do HttpClient é usado. Não há um equivalente síncrono, somente o método Async.<br />
Após o retorno da operação, a propriedade <em>IsSuccessStatusCode</em> é populada. O código ficaria assim:</p>
<p><script src="https://gist.github.com/edneypitta/faf5810261b4c0ec76a0.js"></script></p>
<p>O método <em>ReadAsAsync</em> é um método de extensão, implementado no assembly <em>System.Net.Http.Formatting</em>.</p>
<h4>HttpPost</h4>
<p>Para executar um Post, você pode usar os métodos <em>PostAsync </em>e <em>PostAsJsonAsync</em>, que simplifica as coisas caso o Content-Type seja JSON. A implementação é bem simples:</p>
<p><script src="https://gist.github.com/edneypitta/7a176ad23ca879c189c8.js"></script></p>
<h4>HttpPut</h4>
<p>Um Put pode ser feito praticamente da mesma forma que um Post. Há os métodos <em>PutAsync </em>e <em>PutAsJsonAsync</em>:</p>
<p><script src="https://gist.github.com/edneypitta/3f2bc033d6d1cd944078.js"></script></p>
<h4>HtpDelete</h4>
<p>O método <em>DeleteAsync</em> faz um Delete. O método apenas recebe uma string com a URL, já com o identificador do item a ser deletado:</p>
<p><script src="https://gist.github.com/edneypitta/ec456452d34e05d5a3b7.js"></script></p>
<h4>Exceções</h4>
<p>Exceções podem ocorrer ao chamar um serviço Web API. </p>
<p>Nesses casos, porém, na chamada ao método que fez a operação (GetAsync, PostAsync, etc.), a exceção não é automaticamente lançada. Você deve explicitamente chamar o método <em>EnsureSuccessStatusCode</em> para que isso aconteça.</p>
<p>Veja os seguintes trechos de código. O primeiro não lança a exceção, enquanto o segundo faz:</p>
<p><script src="https://gist.github.com/edneypitta/69e21acaa29399ed443d.js"></script></p>
<h2>Mandando E Recebendo Requests Em Formatos Diferentes</h2>
<p>Há algumas opções em relação aos formatos aceitos pelo framework Web API. Isso inclui <em>application/xml</em>, <em>text/html</em>, <em>image/png</em>, <em>application/json</em>, etc. </p>
<p>Esses valores são retornados no header Content-Type dos responses, indicando o tipo do retorno. Eles também podem ser usados no header Accept para que o client especifique o tipo do retorno que ele quer receber. Nesses headers, múltiplos valores são aceitos sendo separados por vírgula.</p>
<p>É possível também implementar formatos customizados. Você pode fazer isso herdando das classes <em>MediaTypeFormatter</em> ou <em>BufferedMediaTypeFormatter</em>. A principal diferença entre elas é MediaTypeFormatter suporta a leitura assíncrona, enquanto BufferedMediaTypeFormatter suporta somente leituras síncronas.</p>
<p>Primeiro, você deve herdar da classe desejada e adicionar o media type a ser suportado na coleção <em>SupportedMediaTypes</em>:</p>
<p><script src="https://gist.github.com/edneypitta/52fa0de34dc65324ce45.js"></script></p>
<p>Você precisa também adicionar seu formatter customizado no HttpConfiguration: <code>config.Formatters.Add(new CustomCsvFormatter());</code>.</p>
<p>Depois, você implementa sua lógica na classe criada. As propriedades <em>CanWriteType</em> e <em>CanReadType</em> devem ser sobrescritas, indicando se o tipo pode ser serializado e desserializado. O método <em>WriteToStream</em> também deve ser implementado e se o formatter suportar desserialização (CanReadType true), o método ReadFromStream precisa ser implementado.</p>
<p>Detalhes sobre a implementação não cairão no exame, mas é bom seguir o exemplo da documentação para ter uma ideia melhor de como implementar um formatter customizado: <a href="http://www.asp.net/web-api/overview/formats-and-model-binding/media-formatters" target="_blank">http://www.asp.net/web-api/overview/formats-and-model-binding/media-formatters</a>.</p>
<hr />
<p>E encerramos o capítulo sobre Web API 😀</p>
<p>O próximo post será sobre o objetivo 5.1, <strong><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-1-design-a-deployment-strategy/">Design a deployment strategy</a></strong>. Esse é o primeiro objetivo do último tópico da certificação.</p>
<p>Obrigado e até mais!</p>

				<p><a class="btn btn-default read-more" href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-4-5-consume-web-api-web-services/" title="Certificação Microsoft 70-487: Objetivo 4.5 &#8211; Consume Web API web services">Leia Mais</a></p>

							</div><!-- .entry-content -->
					</div>
	</div>
</article><!-- #post-## -->

			
				
<article id="post-526" class="post-526 post type-post status-publish format-standard hentry category-certificacao tag-70-487">
	<div class="blog-item-wrap">
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-4-4-host-and-manage-a-web-api/" title="Certificação Microsoft 70-487: Objetivo 4.4 – Host and manage a Web API" >
			 				</a>
		<div class="post-inner-content">
			<header class="entry-header page-header">

				<h1 class="entry-title"><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-4-4-host-and-manage-a-web-api/" rel="bookmark">Certificação Microsoft 70-487: Objetivo 4.4 – Host and manage a Web API</a></h1>

								<div class="entry-meta">
					<span class="posted-on"><i class="fa fa-calendar"></i> <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-4-4-host-and-manage-a-web-api/" rel="bookmark"><time class="entry-date published" datetime="2016-03-02T11:44:00+00:00">02/03/2016</time><time class="updated" datetime="2016-03-02T15:57:24+00:00">02/03/2016</time></a></span><span class="byline"> <i class="fa fa-user"></i> <span class="author vcard"><a class="url fn n" href="https://edneypitta.github.io/old-blog/author/admin/">Edney Pitta</a></span></span>				<span class="comments-link"><i class="fa fa-comment-o"></i><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-4-4-host-and-manage-a-web-api/#comments"><span class="dsq-postid" data-dsqidentifier="526 https://edneypitta.github.io/old-blog/?p=526">1 Comentário</span></a></span>
				
				
				</div><!-- .entry-meta -->
							</header><!-- .entry-header -->

						<div class="entry-content">

				<p>Olá pessoal!<br />
O objetivo 4.4 da certificação Microsoft 70-487, <strong>Host and manage a Web API</strong>, trata dos principais mecanismos de hospedagem de um serviço Web API, como self-hosting, IIS e Azure. Também mostra como limitar o tamanho das mensagens recebidas e configurar a hospedagem para streaming. Vamos lá?</p>
<h2>Web API Self-Hosting</h2>
<p>Para fazer o self-hosting de uma Web API, você pode usar qualquer template de projeto que crie um executável, como Windows Service, Windows Forms Application, Console Application, etc. </p>
<p>Com o projeto criado, você deve instalar o framework de self-hosting via NuGet com o pacote <em>Microsoft ASP.NET Web API Self Host</em> e referenciar os assemblies <em>System.Web.Http</em> e <em>System.Web.Http.SelfHost</em>:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/12.png" alt="self host" width="727" height="488" class="alignnone size-full wp-image-530" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/12.png 727w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/12-300x201.png 300w" sizes="(max-width: 727px) 100vw, 727px" /></p>
<p>Depois, há dois passos essenciais: instanciar as classes <em>HttpSelfHostConfiguration </em>e <em>HttpSelfHostServer</em>. O código fica assim:</p>
<p><script src="https://gist.github.com/edneypitta/a23737585b6d138a4f70.js"></script></p>
<p>A primeira verificação se <em>MyWebApi.Controllers.ValuesController</em> é null serve para o framework de self-hosting carregar os controllers do seu projeto Web API. Isso somente é necessário quando os controllers estão num assembly separado.</p>
<p>A classe HttpSelfHostConfiguration recebe o endereço base de onde o serviço vai ser acessado. Um ponto importante aqui é que as rotas precisam ser configuradas diretamente na propriedade Routes.</p>
<p>Por último, a classe HttpSelfHostServer é instanciada recebendo a configuração criada anteriormente. O método OpenAsync toma conta de abrir o servidor com as configurações passadas.</p>
<h2>Web API IIS Hosting</h2>
<p>Hospedar uma Web API no IIS não tem nada diferente de outras aplicações web. </p>
<p>Você pode primeiro criar uma application pool, conforme abaixo:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/13.png" alt="application pool" width="293" height="266" class="alignnone size-full wp-image-531" /></p>
<p>Depois, criar um novo website embaixo do nodo Sites ou adicionar uma aplicação ou diretório virtual:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/14.png" alt="add application" width="426" height="316" class="alignnone size-full wp-image-532" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/14.png 426w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/03/14-300x223.png 300w" sizes="(max-width: 426px) 100vw, 426px" /></p>
<p>Com tudo isso no lugar, sua aplicação deve estar hospedada com sucesso.</p>
<h2>Web API Windows Azure Hosting</h2>
<p>Essa é uma seção conceitual para as 3 formas de hospedar uma Web API no Azure. São elas:</p>
<ul>
<li><strong>Windows Azure Websites</strong>: a opção mais rápida. Com Azure Websites você não se importa com a máquina que está hospedando seu serviço, apesar de poder escalar sua aplicação facilmente;</li>
<li><strong>Windows Azure Cloud Services</strong>: Cloud Services oferecem um controle maior. Você tem mais tamanhos de instância para escolher e pode criar uma arquitetura mais complexa, como uma Web API numa Web Role se comunicando via queue com uma Worker Role, por exemplo. Você pode também configurar o IIS e outras configurações da máquina quando a role começar. Consegue também se conectar via remote com a máquina;</li>
<li><strong>Windows Azure Virtual Machines (VMs)</strong>: usar VMs no Azure te dá controle completo. Você precisa gerenciar sua máquina inteira, de atualizações até configurações.</li>
</ul>
<p>Fazer o deploy de uma Web API para o Azure Websites ou Cloud Services é bem simples usando o Visual Studio. Isso será coberto com mais detalhes no capítulo 5.</p>
<h2>Limitando O Tamanho Das Mensagens</h2>
<p>Ao hospedar sua Web API, você com certeza gostaria de limitar o tamanho dos requests para que seu servidor não sofra de ataques DDoS.</p>
<p>Usando self-hosting, você pode fazer isso setando as propriedades <em>MaxReceivedMessageSize </em>e <em>MaxBufferSize </em>do objeto HttpSelfHostConfiguration:</p>
<p><code>var config = new HttpSelfHostConfiguration(baseAddress);<br />
config.MaxReceivedMessageSize = 1024;<br />
config.MaxBufferSize = 1024;</code></p>
<p>Hospedando no IIS, isso é possível pela configuração do atributo <em>maxRequestLength </em>no web.config:</p>
<p><code>&lt;httpRuntime maxRequestLength=&quot;1024&quot; /&gt;</code></p>
<h2>Configurando Streaming</h2>
<p>Às vezes você quer que seu serviço Web API receba arquivos grandes, como algum upload de imagens ou vídeos. Nesses casos, é importante configurar sua Web API para usar streaming ao invés de buffer, já que bufferizar arquivos grandes consome muita memória.</p>
<p>Hospedando sua aplicação no IIS, você consegue implementar sua lógica se usar buffer ou streaming herdando a classe <em>WebHostBufferPolicySelector</em>, a única que implementa a interface <em>IHostBufferPolicySelector</em>, e sobrescrevendo o método <em>UseBufferedInputStream</em>. Por exemplo, você pode habilitar streaming apenas para um controller específico:</p>
<p><script src="https://gist.github.com/edneypitta/9a95eee1e58dd24ea54f.js"></script></p>
<p>Depois disso, você deve configurar o HttpConfiguration para usar sua implementação: <code>config.Services.Replace(typeof(IHostBufferPolicySelector), new StreamingPolicySelector());</code>.</p>
<p>Por último, você precisa configurar as propriedades do ASP.NET como <em>maxAllowedContentLength </em>e <em>maxRequestLength </em>no web.config para que o IIS não rejeite os requests grandes:</p>
<p><script src="https://gist.github.com/edneypitta/850bf2e6b8cdaed226a0.js"></script></p>
<p>Para self-hosting, você só consegue habilitar streaming para todos os controllers. Você faz isso configurando a propriedade <em>TransferMode</em> no objeto HttpSelfHostConfiguration:</p>
<p><code>// somente requests<br />
selfHostConf.TransferMode = TransferMode.StreamedRequest;<br />
// somente responses<br />
selfHostConf.TransferMode = TransferMode.StreamedResponse;<br />
// ambos<br />
selfHostConf.TransferMode = TransferMode.Streamed;</code></p>
<hr />
<p>Isso é tudo para esse objetivo 🙂</p>
<p>Obrigado pela leitura e fique de olho no próximo post, que será o último objetivo sobre Web API: <strong><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-4-5-consume-web-api-web-services/">Consume Web API web services</a></strong>.</p>
<p>Até mais!</p>

				<p><a class="btn btn-default read-more" href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-4-4-host-and-manage-a-web-api/" title="Certificação Microsoft 70-487: Objetivo 4.4 – Host and manage a Web API">Leia Mais</a></p>

							</div><!-- .entry-content -->
					</div>
	</div>
</article><!-- #post-## -->

			
				
<article id="post-509" class="post-509 post type-post status-publish format-standard hentry category-certificacao tag-70-487">
	<div class="blog-item-wrap">
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-4-3-secure-a-web-api/" title="Certificação Microsoft 70-487: Objetivo 4.3 – Secure a Web API" >
			 				</a>
		<div class="post-inner-content">
			<header class="entry-header page-header">

				<h1 class="entry-title"><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-4-3-secure-a-web-api/" rel="bookmark">Certificação Microsoft 70-487: Objetivo 4.3 – Secure a Web API</a></h1>

								<div class="entry-meta">
					<span class="posted-on"><i class="fa fa-calendar"></i> <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-4-3-secure-a-web-api/" rel="bookmark"><time class="entry-date published" datetime="2016-03-01T16:07:53+00:00">01/03/2016</time><time class="updated" datetime="2016-03-02T11:45:22+00:00">02/03/2016</time></a></span><span class="byline"> <i class="fa fa-user"></i> <span class="author vcard"><a class="url fn n" href="https://edneypitta.github.io/old-blog/author/admin/">Edney Pitta</a></span></span>				<span class="comments-link"><i class="fa fa-comment-o"></i><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-4-3-secure-a-web-api/#respond"><span class="dsq-postid" data-dsqidentifier="509 https://edneypitta.github.io/old-blog/?p=509">Deixe um comentário</span></a></span>
				
				
				</div><!-- .entry-meta -->
							</header><!-- .entry-header -->

						<div class="entry-content">

				<p>Olá pessoal!<br />
O objetivo 4.3 da certificação 70-487, <strong>Secure a Web API</strong>, trata de forma bem completa sobre as diferentes formas de segurança e autenticação disponíveis para serviços Web API.</p>
<p>Esse objetivo cobre como 1) autenticar e autorizar usuários, 2) implementar a autenticação HTTP Basic com SSL, 3) implementar Windows Authentication, 4) prevenir <em>cross-site request forgery</em>, 5) habilitar requests cross domain e 6) implementar e extender authorization filters.</p>
<h2>Autenticar E Autorizar Usuários</h2>
<p>Essa seção apenas explica os conceitos de autenticação e autorização.</p>
<p><strong>Autenticação </strong>é o processo de identificação do usuário, geralmente por um nome de usuário e senha. O framework da Web API tem uma série de ferramentas para implementação desse processo, o que vamos ver logo mais.</p>
<p><strong>Autorização </strong>é o processo que define quais ações o usuário pode fazer no sistema. Por exemplo, você pode permitir que usuários anônimos façam apenas consultas, usuários autenticados façam inserções e usuários administrativos façam atualizações.</p>
<h2>Implementando Autenticação HTTP Basic</h2>
<p>HTTP Basic é a forma mais simples e fácil de implementar um mecanismo de autenticação. É um formato conhecido e maduro, suportado pela maioria dos browsers e nativamente suportado pelo IIS. A principal desvantagem é que as credenciais são transmitidas em plain text nos headers do request, tornando-se vulnerável a interceptores. Também não há como fazer logout explicitamente a não ser que a sessão do browser se encerre.</p>
<p>O fluxo com HTTP Basic é assim:</p>
<p>Um client faz um request. Se o serviço necessitar autenticação, o server retorna o status code 401 (unauthorized) com o seguinte header: <code>WWW-Authenticate: Basic realm="Realm Name"</code>. Esse header especifica que o server suporta a autenticação Basic no domínio especificado (<em>realm</em>).</p>
<p>O client, ao receber um response 401, faz outro request com o header de autenticação. A construção do header começa com o nome de usuário e a senha concatenados por um dois-pontos. Por exemplo, caso o nome de usuário seja <em>JohnQPublic </em>e a senha <em>!*MyPa55w0rd*!</em>, o valor seria <em>JohnQPublic:!*MyPa55w0rd*!</em>. Em seguida esse valor seria encodado por Base64, resultando na string <em>Sm9oblFQdWJsaWM6ISpNeVBhNTV3MHJkKiE=</em>. Por fim, a palavra Basic é adicionada antes dessa string e enviada no header Authorization: <code>Authorization: Basic Sm9oblFQdWJsaWM6ISpNeVBhNTV3MHJkKiE=</code>.</p>
<p>Um ponto importante é que o nome de usuário e senha, apesar de encodados em Base64, não estão encriptados. Qualquer interceptor que tiver acesso aos headers do request vai conseguir decifrar dados sensíveis do usuário facilmente. Por isso, a autenticação Basic não é segura <strong>a não ser</strong> que feita por HTTPS, onde todo o request é criptografado. Para o exame (e para a vida real), lembre-se: nunca use autenticação Basic sem SSL.</p>
<h4>Habilitando SSL</h4>
<p>Como a autenticação Basic não deve ser utilizada sem SSL, você deve saber como forçar uma conexão HTTPS para Web API.</p>
<p>Se você viu como implementar Action Filters no <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-4-2-implement-a-web-api/" target="_blank">objetivo anterior</a>, vai reconhecer como vamos fazer isso agora. De forma simples, basta implementar a classe <em>AuthorizationFilterAttribute </em>e sobrescrever o método OnAuthorization com uma validação. Segue um exemplo:</p>
<p><script src="https://gist.github.com/edneypitta/1e6f53f48e88c814de52.js"></script></p>
<p>Depois disso, você deve decorar os controllers desejados com esse atributo ou registrá-lo globalmente no HttpConfiguration.</p>
<p>Não sei se cairá no exame, mas saiba que há uma ferramenta chamada <em>MakeCert.exe</em> para gerar certificados SSL para testes.</p>
<h2>Implementando Windows Authentication</h2>
<p>Windows Authentication é um processo onde os usuários podem se autenticar pelo seu login no Windows, Kerberos ou NTLM. É ideal para aplicações intranet que serão acessadas somente de dentro do mesmo domínio, em uma empresa por exemplo. Obviamente, não é recomendada para cenários onde usuários &#8220;anônimos&#8221; vão acessar sua API.</p>
<p>Por ser nativamente suportada pelo IIS, implementar essa autenticação é bem simples. Basta configurar a propriedade Mode do elemento Authentication para &#8220;Windows&#8221; no web.config, como a seguir:</p>
<p><code>&lt;system.web&gt;<br />
&lt;authentication mode=&quot;Windows&quot; /&gt;<br />
&lt;/system.web&gt;</code></p>
<p>Se o client for diretamente um browser, este precisa dar suporte ao esquema de autenticação Negotiation. Não há muito o que se preocupar pois todos os browsers populares têm esse suporte.<br />
Caso seja uma aplicação .NET, a classe HttpClient deve ser usada para fazer o request (como sempre). A única modificação é que ela deve ser instanciada com um HttpClientHandler, que pode ser obtido da seguinte maneira:</p>
<p><code>HttpClientHandler clientHandler = new HttpClientHandler<br />
{<br />
UseDefaultCredentials = true<br />
};</code></p>
<h2>Prevenindo Cross-Site Request Forgery</h2>
<p>Cross-Site Request Forgery (CSRF ou XSRF) é uma forma bastante utilizada por atacantes para acessarem recursos disponíveis para usuários autenticados.</p>
<p>Vamos supor que você está logado no portal do Azure e, no mesmo browser, recebe um e-mail dizendo que você tem desconto de 50% para novos serviços no Azure. Ao clicar no link do e-mail, você é direcionado para a página <em>https://manage.windowsazure.com/api/DeleteAllData</em> sem perceber. É claro que essa página não existe no portal, mas se existisse, você estaria em sérios problemas. </p>
<p>Resumidamente, um ataque XSRF acontece quando você está autenticado em algum sistema e um atacante se aproveita disso para executar alguma ação. Seu sistema está vulnerável a ataques XSFR se você usa um mecanismo de autenticação que mantém o usuário logado (baseado em cookies) ou quando você permite requests cross domain. A autenticação Basic também é vulnerável pois o browser normalmente armazena seu token de autenticação para evitar que o usuário digite o usuário e senha a cada request.</p>
<p>Para se proteger de ataques XSRF, há uma solução pronta em MVC e que os mesmos princípios podem ser aplicados na Web API.</p>
<p>Usando o método <em>Html.AntiForgeryToken</em> na view e o atributo <em>ValidateAntiForgeryToken</em> na action, o MVC primeiro renderiza um input hidden na tela assim: <code>&lt;input name="__RequestVerificationToken" type="hidden" value="saTFWpkKN0BYazFtN6c4YbZAmsEwG0srqlUqqloi/fVgeV2ciIFVmelvzwRZpArs" /&gt;</code>. Esse valor é gerado randomicamente e também é colocado num cookie passado para o usuário. Ao fazer um post, por exemplo, o MVC valida se o valor do cookie e o do form data são iguais. Isso é seguro pois o atacante não vai saber o valor do cookie para forjar um request válido.</p>
<p>Para Web API, como dito, o princípio pode ser aplicado. Você manda um valor no cookie e no HTML e depois garante que eles são o mesmo. Você pode mandar o token antiforgery usando o mesmo método Html.AntiForgeryToken.</p>
<p>Para validar o token na Web API, você deve obter o token do cookie; obter do form data; passar ambos para o método <em>AntiForgery.Validate</em> e retornar um response Unauthorized caso a validação falhe. O código ficaria assim:</p>
<p><script src="https://gist.github.com/edneypitta/6ee611685a6f6a39ee4b.js"></script></p>
<h2>Habilitando Requests Cross Domain</h2>
<p>Por padrão, os browsers proíbem requests <em>cross domain</em>, ou seja, para domínios diferentes do atual. Por exemplo, se você está no site <em>http://www.contoso.com</em>, você não pode fazer uma requisição AJAX para <em>http://www.someotherwebsite.com</em>. Você também não pode fazer requests para o seu domínio com outro protocolo (HTTP ao invés de HTTPS) ou para outra porta. Isso existe para evitar ataques XSRF, já que a maioria das autenticações funcionam por cookie.</p>
<p>Porém você pode querer que sua API seja consumida por vários clients, e isso se tornaria um problema. Isso se chama CORS (cross origin resource sharing), e você pode habilitá-lo facilmente no arquivo web.config:</p>
<p><script src="https://gist.github.com/edneypitta/cd56a4873a71d13ba5e3.js"></script></p>
<p>Isso adiciona um header nos responses, indicando que CORS está habilitado. Com isso, <strong>qualquer </strong>site pode fazer requisições para sua API, o que pode não ser desejado.</p>
<p>Para resolver esse problema, a Microsoft criou um pacote NuGet chamado <em>Microsoft.AspNet.WebApi.Cors</em>. Após a instalação, você tem um método de extensão no objeto HttpConfiguration: <code>config.EnableCors();</code>. </p>
<p>Chamando esse método no método WebApiConfig.Register, você habilita o suporte a CORS na sua aplicação. Agora você pode adicionar o atributo <em>EnableCors</em> para controllers e actions assim:</p>
<p><script src="https://gist.github.com/edneypitta/1b09fb9b1119cb50c397.js"></script></p>
<p>Nesse caso, você habilitou CORS somente para esse método na URL especificada em <em>origins</em>.</p>
<h2>Implementando E Extendendo Authorization Filters</h2>
<p>A Web API oferece o atributo <em>AuthorizeAttribute</em> que por padrão garante que os usuários acessando esse controller ou action estão autenticados e têm as roles necessárias, se especificadas.</p>
<p>Você pode estender a classe AuthorizeAttribute e sobrescrever o método IsAuthorized para implementar sua própria lógica. O exemplo a seguir faz uma implementação de black list, ou seja, usuários com as roles especificadas <strong>não </strong>podem acessar a action:</p>
<p><script src="https://gist.github.com/edneypitta/79f6d70a5d1f4487fcd6.js"></script></p>
<p>Você também pode estender a classe <em>AuthorizationFilterAttribute</em> ou implementar a interface <em>IAuthorizationFilter</em> para realizar alguma lógica customizada. As diferenças entre elas são as seguintes:</p>
<ul>
<li><strong>AuthorizeAttribute</strong>: usada para implementar lógica de autorização baseada no usuário e nas roles;</li>
<li><strong>AuthorizationFilterAttribute</strong>: usada para implementar lógica síncrona de autorização que não está baseada no usuário e nas roles (por exemplo, forçar HTTPS);</li>
<li><strong>IAuthorizationFilter</strong>: usada para implementar lógica assíncrona de autorização que não está baseada no usuário e nas roles.</li>
</ul>
<hr />
<p>Obrigado pela leitura de mais um objetivo!<br />
O próximo post será sobre o objetivo 4.4, <strong><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-4-4-host-and-manage-a-web-api/">Host and manage a Web API</a></strong>.</p>
<p>Até lá!</p>

				<p><a class="btn btn-default read-more" href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-4-3-secure-a-web-api/" title="Certificação Microsoft 70-487: Objetivo 4.3 – Secure a Web API">Leia Mais</a></p>

							</div><!-- .entry-content -->
					</div>
	</div>
</article><!-- #post-## -->

			
			
		
		</main><!-- #main -->
	</section><!-- #primary -->

</div>
	<div id="secondary" class="widget-area col-sm-12 col-md-4" role="complementary">
		<div class="well">
						<aside id="text-3" class="widget widget_text">			<div class="textwidget"><a href="https://edneypitta.github.io/old-blog/sobre/"><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2015/08/IMG-20150829-WA00012-e1440915174271-150x150.jpg"  width="150" height="150" class="aligncenter size-thumbnail wp-image-93" style="border-radius: 80px;" />
<h2 style="text-align:center;">Edney Pitta</h2></a>
<div style="text-align: center;">Desenvolvedor de Software @ Lambda3</div>
<div style="margin-top:20px;text-align:center;"><a href="https://edneypitta.github.io/old-blog/sobre/"><button class="btn btn-danger btn-lg " >SOBRE MIM</button></a></div></div>
		</aside><aside id="search-2" class="widget widget_search">
<form role="search" method="get" class="form-search" action="https://edneypitta.github.io/old-blog/">
  <div class="input-group">
  	<label class="screen-reader-text" for="s">Search for:</label>
    <input type="text" class="form-control search-query" placeholder="Procurar&hellip;" value="" name="s" title="Search for:" />
    <span class="input-group-btn">
      <button type="submit" class="btn btn-default" name="submit" id="searchsubmit" value="Search"><span class="glyphicon glyphicon-search"></span></button>
    </span>
  </div>
</form></aside>		<aside id="recent-posts-3" class="widget widget_recent_entries">		<h3 class="widget-title">Posts recentes</h3>		<ul>
					<li>
				<a href="https://edneypitta.github.io/old-blog/migrando-um-projeto-asp-net-core-rc-1-para-rc-2/">Migrando um projeto ASP.NET Core RC 1 para RC 2</a>
						</li>
					<li>
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-486-developing-asp-net-mvc-web-applications/">Certificação Microsoft 70-486: Developing ASP.NET MVC Web Applications</a>
						</li>
					<li>
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-480-programming-in-html5-with-javascript-and-css3/">Certificação Microsoft 70-480: Programming in HTML5 with JavaScript and CSS3</a>
						</li>
					<li>
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-resultado/">Certificação Microsoft 70-487 &#8211; Resultado</a>
						</li>
					<li>
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-6-share-assemblies-between-multiple-applications-and-servers/">Certificação Microsoft 70-487: Objetivo 5.6 – Share assemblies between multiple applications and servers</a>
						</li>
				</ul>
		</aside>		<aside id="annual_archive_widget-2" class="widget Annual_Archive_Widget"><h3 class="widget-title">Arquivo</h3>	<ul>
		<li><a href='https://edneypitta.github.io/old-blog/2016/06/'>junho 2016</a>&nbsp;(1)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2016/05/'>maio 2016</a>&nbsp;(1)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2016/04/'>abril 2016</a>&nbsp;(1)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2016/03/'>março 2016</a>&nbsp;(10)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2016/02/'>fevereiro 2016</a>&nbsp;(11)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2016/01/'>janeiro 2016</a>&nbsp;(10)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2015/12/'>dezembro 2015</a>&nbsp;(3)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2015/11/'>novembro 2015</a>&nbsp;(3)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2015/10/'>outubro 2015</a>&nbsp;(1)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2015/09/'>setembro 2015</a>&nbsp;(5)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2015/08/'>agosto 2015</a>&nbsp;(2)</li>
	</ul>
	</aside>		</div>
	</div><!-- #secondary -->
			</div><!-- close .*-inner (main-content or sidebar, depending if sidebar is used) -->
		</div><!-- close .row -->
	</div><!-- close .container -->
</div><!-- close .site-content -->

	<div id="footer-area">
		<div class="container footer-inner">
			<div class="row">
				
				</div>
		</div>

		<footer id="colophon" class="site-footer" role="contentinfo">
			<div class="site-info container">
				<div class="row">
										<nav role="navigation" class="col-md-6">
						<ul id="menu-social-1" class="nav footer-nav clearfix"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-20"><a href="https://br.linkedin.com/in/edneypitta"><i class="fa fa-linkedin-square"></i></a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-22"><a href="https://www.facebook.com/edneypitta"><i class="fa fa-facebook-square"></i></a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-23"><a href="https://twitter.com/edneypitta"><i class="fa fa-twitter-square"></i></a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-24"><a href="https://edneypitta.github.io/old-blog/feed/"><i class="fa fa-rss"></i></a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-27"><a href="https://edneypitta.github.io/old-blog/sobre/"><i class="fa fa-info-circle"></i></a></li>
</ul>					</nav>
					<div class="copyright col-md-6">
						<a rel="license" href="http://creativecommons.org/licenses/by/2.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/2.0/80x15.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/2.0/">Creative Commons Attribution 2.0 Generic License</a>.						Theme by <a href="http://colorlib.com/" target="_blank">Colorlib</a> Powered by <a href="http://wordpress.org/" target="_blank">WordPress</a>					</div>
				</div>
			</div><!-- .site-info -->
			<div class="scroll-to-top"><i class="fa fa-angle-up"></i></div><!-- .scroll-to-top -->
		</footer><!-- #colophon -->
	</div>
</div><!-- #page -->

<script type='text/javascript' src='https://edneypitta.github.io/old-blog/wp-content/themes/sparkling/inc/js/skip-link-focus-fix.js?ver=20140222'></script>
<script type='text/javascript' src='https://edneypitta.github.io/old-blog/wp-includes/js/wp-embed.min.js?ver=4.8.2'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var countVars = {"disqusShortname":"edneypitta"};
/* ]]> */
</script>
<script type='text/javascript' src='https://edneypitta.github.io/old-blog/wp-content/plugins/disqus-comment-system/media/js/count.js?ver=4.8.2'></script>

</body>
</html>