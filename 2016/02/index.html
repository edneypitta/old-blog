<!doctype html>
	<!--[if !IE]>
	<html class="no-js non-ie" lang="pt-BR" prefix="og: http://ogp.me/ns#"> <![endif]-->
	<!--[if IE 7 ]>
	<html class="no-js ie7" lang="pt-BR" prefix="og: http://ogp.me/ns#"> <![endif]-->
	<!--[if IE 8 ]>
	<html class="no-js ie8" lang="pt-BR" prefix="og: http://ogp.me/ns#"> <![endif]-->
	<!--[if IE 9 ]>
	<html class="no-js ie9" lang="pt-BR" prefix="og: http://ogp.me/ns#"> <![endif]-->
	<!--[if gt IE 9]><!-->
<html class="no-js" lang="pt-BR" prefix="og: http://ogp.me/ns#"> <!--<![endif]-->
<head>
<base href="https://edneypitta.github.io/old-blog" />

<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1">



<title>fevereiro 2016 - Edney Pitta</title>

<!-- This site is optimized with the Yoast SEO plugin v3.0.7 - https://yoast.com/wordpress/plugins/seo/ -->
<meta name="robots" content="noindex,follow"/>
<link rel="canonical" href="https://edneypitta.github.io/old-blog/2016/02/" />
<link rel="next" href="https://edneypitta.github.io/old-blog/2016/02/page/2/" />
<meta property="og:locale" content="pt_BR" />
<meta property="og:type" content="object" />
<meta property="og:title" content="fevereiro 2016 - Edney Pitta" />
<meta property="og:url" content="https://edneypitta.github.io/old-blog/2016/02/" />
<meta property="og:site_name" content="Edney Pitta" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="fevereiro 2016 - Edney Pitta"/>
<meta name="twitter:site" content="@edneypitta"/>
<!-- / Yoast SEO plugin. -->

<link rel='dns-prefetch' href='//fonts.googleapis.com' />
<link rel='dns-prefetch' href='//s.w.org' />


		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/svg\/","svgExt":".svg","source":{"concatemoji":"http:\/\/edneypitta.github.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.8.2"}};
			!function(a,b,c){function d(a){var b,c,d,e,f=String.fromCharCode;if(!k||!k.fillText)return!1;switch(k.clearRect(0,0,j.width,j.height),k.textBaseline="top",k.font="600 32px Arial",a){case"flag":return k.fillText(f(55356,56826,55356,56819),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,56826,8203,55356,56819),0,0),c=j.toDataURL(),b!==c&&(k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447),0,0),c=j.toDataURL(),b!==c);case"emoji4":return k.fillText(f(55358,56794,8205,9794,65039),0,0),d=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55358,56794,8203,9794,65039),0,0),e=j.toDataURL(),d!==e}return!1}function e(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i,j=b.createElement("canvas"),k=j.getContext&&j.getContext("2d");for(i=Array("flag","emoji4"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='sparkling-bootstrap-css'  href='https://edneypitta.github.io/old-blog/wp-content/themes/sparkling/inc/css/bootstrap.min.css?ver=4.8.2' type='text/css' media='all' />
<link rel='stylesheet' id='sparkling-icons-css'  href='https://edneypitta.github.io/old-blog/wp-content/themes/sparkling/inc/css/font-awesome.min.css?ver=4.8.2' type='text/css' media='all' />
<link rel='stylesheet' id='sparkling-fonts-css'  href='//fonts.googleapis.com/css?family=Open+Sans%3A400italic%2C400%2C600%2C700%7CRoboto+Slab%3A400%2C300%2C700&#038;ver=4.8.2' type='text/css' media='all' />
<link rel='stylesheet' id='sparkling-style-css'  href='https://edneypitta.github.io/old-blog/wp-content/themes/sparkling/style.css?ver=4.8.2' type='text/css' media='all' />
<script type='text/javascript' src='https://edneypitta.github.io/old-blog/wp-includes/js/jquery/jquery.js?ver=1.12.4'></script>
<script type='text/javascript' src='https://edneypitta.github.io/old-blog/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<script type='text/javascript' src='https://edneypitta.github.io/old-blog/wp-content/themes/sparkling/inc/js/modernizr.min.js?ver=4.8.2'></script>
<script type='text/javascript' src='https://edneypitta.github.io/old-blog/wp-content/themes/sparkling/inc/js/bootstrap.min.js?ver=4.8.2'></script>
<script type='text/javascript' src='https://edneypitta.github.io/old-blog/wp-content/themes/sparkling/inc/js/functions.min.js?ver=4.8.2'></script>
<link rel='https://api.w.org/' href='https://edneypitta.github.io/old-blog/wp-json/' />

 

<script data-cfasync="false" src="//load.sumome.com/" data-sumo-site-id="025f16b2b72012bef5c86b74ea4d0bd0652e8245a2df8c61ed302458c0f98f3b" async></script><style type="text/css">.entry-content {font-family: Open Sans; font-size:14px; font-weight: normal; color:#6B6B6B;}.navbar > .container .navbar-brand {
font-size: 35px;
margin-top: 7px;
}

#menu-social i{
font-size:17px;
}
#menu-social-1 i {
font-size:22px;
}

article ul {
    list-style: none;
    padding:0;
    margin:0;
margin-bottom: 10px;
}

article li { 
    padding-left: 1em; 
    text-indent: -.7em;
}

article li:before {
    content: "\2022";
    color: rgb(191, 66, 78); 
padding-right:7px;
font-size: 15px;
}

#logo {
margin: 10px 0px;
}

.textwidget a:hover h2{
color:#c9302c;
}</style>	<style type="text/css">
			.navbar > .container .navbar-brand {
			color: #ffffff;
		}
		</style>
	<link rel="icon" href="https://edneypitta.github.io/old-blog/wp-content/uploads/2015/08/cropped-cropped-edneypitta-oficialissimo-fundo-branco-32x32.png" sizes="32x32" />
<link rel="icon" href="https://edneypitta.github.io/old-blog/wp-content/uploads/2015/08/cropped-cropped-edneypitta-oficialissimo-fundo-branco-192x192.png" sizes="192x192" />
<link rel="apple-touch-icon-precomposed" href="https://edneypitta.github.io/old-blog/wp-content/uploads/2015/08/cropped-cropped-edneypitta-oficialissimo-fundo-branco-180x180.png" />
<meta name="msapplication-TileImage" content="https://edneypitta.github.io/old-blog/wp-content/uploads/2015/08/cropped-cropped-edneypitta-oficialissimo-fundo-branco-270x270.png" />

<script type="text/javascript">
jQuery(document).ready(function()
{
jQuery('.fa-linkedin-square').parent().attr('target', '_blank').attr('title', 'LinkedIn');
jQuery('.fa-facebook-square').parent().attr('target', '_blank').attr('title', 'Facebook');
jQuery('.fa-twitter-square').parent().attr('target', '_blank').attr('title', 'Twitter');
jQuery('.fa-rss').parent().attr('target', '_blank').attr('title', 'RSS');

jQuery('.fa-info-circle').parent().attr('title', 'Sobre');
});
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-66613004-1', 'auto');
  ga('send', 'pageview');

</script>
</head>

<body class="archive date">
<div id="page" class="hfeed site">

	<header id="masthead" class="site-header" role="banner">
		<nav class="navbar navbar-default" role="navigation">
			<div class="container">
				<div class="row">
					<div class="site-navigation-inner col-sm-12">
						<div class="navbar-header">
							<button type="button" class="btn navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
								<span class="sr-only">Toggle navigation</span>
								<span class="icon-bar"></span>
								<span class="icon-bar"></span>
								<span class="icon-bar"></span>
							</button>

							
							<div id="logo">
								<a href="https://edneypitta.github.io/old-blog/"><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2015/08/cropped-edneypitta-oficialissimo-fundo-branco.png"  height="84" width="411" alt="Edney Pitta"/></a>
							</div><!-- end of #logo -->

							
							
						</div>
						<div class="collapse navbar-collapse navbar-ex1-collapse"><ul id="menu-social" class="nav navbar-nav"><li id="menu-item-20" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-20"><a title="&lt;i class=&quot;fa fa-linkedin-square&quot;&gt;&lt;/i&gt;" href="https://br.linkedin.com/in/edneypitta"><i class="fa fa-linkedin-square"></i></a></li>
<li id="menu-item-22" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-22"><a title="&lt;i class=&quot;fa fa-facebook-square&quot;&gt;&lt;/i&gt;" href="https://www.facebook.com/edneypitta"><i class="fa fa-facebook-square"></i></a></li>
<li id="menu-item-23" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-23"><a title="&lt;i class=&quot;fa fa-twitter-square&quot;&gt;&lt;/i&gt;" href="https://twitter.com/edneypitta"><i class="fa fa-twitter-square"></i></a></li>
<li id="menu-item-24" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-24"><a title="&lt;i class=&quot;fa fa-rss&quot;&gt;&lt;/i&gt;" href="https://edneypitta.github.io/old-blog/feed/"><i class="fa fa-rss"></i></a></li>
<li id="menu-item-27" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-27"><a title="&lt;i class=&quot;fa fa-info-circle&quot;&gt;&lt;/i&gt;" href="https://edneypitta.github.io/old-blog/sobre/"><i class="fa fa-info-circle"></i></a></li>
</ul></div>					</div>
				</div>
			</div>
		</nav><!-- .site-navigation -->
	</header><!-- #masthead -->

	<div id="content" class="site-content">

		<div class="top-section">
								</div>

		<div class="container main-content-area">
			<div class="row">
				<div class="main-content-inner col-sm-12 col-md-8 pull-left">

	<section id="primary" class="content-area">
		<main id="main" class="site-main" role="main">

		
			<header class="page-header">
				<h1 class="page-title">
					M√™s: <span>fevereiro 2016</span>				</h1>
							</header><!-- .page-header -->

						
				
<article id="post-494" class="post-494 post type-post status-publish format-standard hentry category-certificacao tag-70-487">
	<div class="blog-item-wrap">
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-4-2-implement-a-web-api/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 4.2 ‚Äì Implement a Web API" >
			 				</a>
		<div class="post-inner-content">
			<header class="entry-header page-header">

				<h1 class="entry-title"><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-4-2-implement-a-web-api/" rel="bookmark">Certifica√ß√£o Microsoft 70-487: Objetivo 4.2 ‚Äì Implement a Web API</a></h1>

								<div class="entry-meta">
					<span class="posted-on"><i class="fa fa-calendar"></i> <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-4-2-implement-a-web-api/" rel="bookmark"><time class="entry-date published" datetime="2016-02-29T15:38:47+00:00">29/02/2016</time><time class="updated" datetime="2016-03-01T16:58:35+00:00">01/03/2016</time></a></span><span class="byline"> <i class="fa fa-user"></i> <span class="author vcard"><a class="url fn n" href="https://edneypitta.github.io/old-blog/author/admin/">Edney Pitta</a></span></span>				<span class="comments-link"><i class="fa fa-comment-o"></i><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-4-2-implement-a-web-api/#respond"><span class="dsq-postid" data-dsqidentifier="494 https://edneypitta.github.io/old-blog/?p=494">Deixe um coment√°rio</span></a></span>
				
				
				</div><!-- .entry-meta -->
							</header><!-- .entry-header -->

						<div class="entry-content">

				<p>O objetivo 4.2, <strong>Implement a Web API</strong>, √© a continua√ß√£o l√≥gica do objetivo anterior com alguns t√≥picos mais avan√ßados como content negotiation, HttpMessageHandler, inje√ß√£o de depend√™ncia, Action Filters, streaming, etc. Vamos l√°?</p>
<h2>Manipulando Dados Em JSON</h2>
<p>Com sua Web API retornando os dados, √© interessante (e √≥bvio) que voc√™ construa uma interface para seus usu√°rios trabalharem com os dados. </p>
<p>Ao criar uma aplica√ß√£o Web API, a engine de views Razor √© usada por padr√£o e uma view Index.cshtml √© criada na pasta Views/Home, com algum layout pronto. Fazendo as altera√ß√µes a seguir no HTML, a tela fica mais ou menos assim:</p>
<p><script src="https://gist.github.com/edneypitta/8987912da3708fa19975.js"></script></p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/111.png" alt="index.cshtml" width="450" height="469" class="alignnone size-full wp-image-496" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/111.png 450w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/111-288x300.png 288w" sizes="(max-width: 450px) 100vw, 450px" /></p>
<p>O plano √© listar todos os Customers na ul <em>customers</em> e os que cont√™m o Last Name informado pelo usu√°rio na ul <em>results</em>. Tudo isso ser√° feito via AJAX (Asynchronous JavaScript and XML), onde o browser consegue fazer requisi√ß√µes ao servi√ßo Web API sem a necessidade de carregar a p√°gina inteira novamente.</p>
<p>O seguinte script pode ser utilizado:</p>
<p><script src="https://gist.github.com/edneypitta/f6f362bdc9a8d2671102.js"></script></p>
<p>O ponto principal dessa se√ß√£o √© que voc√™ n√£o precisa alterar nada no servi√ßo Web API para que ele aceite formatos em JSON ou XML. O passo mais importante no client √© apenas indicar explicitamente se ele est√° enviando JSON ou XML pelo request header Content-Type (o m√©todo do jQuery getJSON() fez isso).</p>
<h2>Content Negotiation</h2>
<p>Content Negotiation (<em>negocia√ß√£o de conte√∫do</em>) √© o processo onde o client indica o tipo do retorno que ele deseja ao fazer uma chamada a um servi√ßo Web API.<br />
Isso √© feito por 4 headers no request:</p>
<ul>
<li><strong>Accept</strong>:  especifica o tipo do retorno do response. Para JSON o valor √© <em>application/json</em> e para XML √© <em>application/xml</em> ou <em>text/xml</em>;</li>
<li><strong>Accept-Charset</strong>: especifica o charset. Valores comuns s√£o <em>UTF-8</em> e <em>ISO-8859-1</em>;</li>
<li><strong>Accept-Encoding</strong>: indica quais encodings s√£o aceitos;</li>
<li><strong>Accept-Language</strong>: especifica a linguagem preferida.</li>
</ul>
<p>Para entender melhor, vamos olhar o request e o response da chamada ao servi√ßo FindCustomers do exemplo anterior:</p>
<h5>Request</h5>
<p><code>GET http://localhost:53366/data/Customer/FindCustomers?lastName=r HTTP/1.1<br />
X-Requested-With: XMLHttpRequest<br />
<strong>Accept: application/json, text/javascript, */*; q=0.01</strong><br />
Referer: http://localhost:53366/<br />
<strong>Accept-Language: en-US,en;q=0.5</strong><br />
<strong>Accept-Encoding: gzip, deflate</strong><br />
User-Agent: Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.2; WOW64; Trident/6.0)<br />
Host: localhost:53366<br />
DNT: 1<br />
Connection: Keep-Alive</code></p>
<h5>Response</h5>
<p><code>HTTP/1.1 200 OK<br />
Cache-Control: no-cache<br />
Pragma: no-cache<br />
<strong>Content-Type: application/json; charset=utf-8</strong><br />
Expires: -1<br />
Server: Microsoft-IIS/8.0<br />
X-AspNet-Version: 4.0.30319<br />
X-SourceFiles: =?UTF-8?B?QzpcUHJvamVjdHNcTXlTb2x1dGlvblxNeVdlYkFwaVxkYXRhXEN1c3RvbWVyXEZpbmRDdXN0b21lcnM=?=<br />
X-Powered-By: ASP.NET<br />
Date: Mon, 15 Jul 2013 15:52:20 GMT<br />
Content-Length: 290<br />
[{"CustomerId":4,"AccountId":2,"FirstName":"Captain","LastName":"America"},<br />
{"CustomerId":8,"AccountId":3,"FirstName":"Ham","LastName":"Burgler"},<br />
{"CustomerId":11,"AccountId":4,"FirstName":"Betty","LastName":"Rubble"},<br />
{"CustomerId":12,"AccountId":4,"FirstName":"Barney","LastName":"Rubble"}]</code></p>
<p>Nesse caso, o client fez a requisi√ß√£o solicitando o resultado em JSON (application/json), JavaScript (text/javascript) ou qualquer outra coisa (*/*). O servidor informou que o retorno est√° em JSON pelo response header Content-Type.</p>
<p>Caso alguma Exception acontecesse, o response estaria com o status code 500 mas o body ainda seria JSON, provavelmente com a Exception serializada.</p>
<p>A execu√ß√£o dessa negocia√ß√£o acontece da seguinte forma: quando o request √© recebido pelo servidor, o framework obt√©m uma inst√¢ncia de <em>IContentNegotiator </em>do HttpConfiguration, que tem a lista dos formatters dispon√≠veis. O m√©todo Negotiate de IContentNegotiator √© chamado com 3 par√¢metros (o tipo do objeto sendo serializado, a lista dos formatters e o request) e retorna o formatter a ser utilizado e o media type para o response. Se nenhum formatter for encontrado, o client recebe um response com o HttpStatusCode NotAcceptable (406).</p>
<h2>Data Binding</h2>
<p>Um dos aspectos importantes da Web API √© o binding dos dados. As actions que voc√™ cria recebem par√¢metros e √© importante entender como o framework &#8220;preenche&#8221; os valores.</p>
<p>No caso de tipos simples como int, string, bool, DateTime, etc., os valores v√™m da URL. No nosso exemplo anterior, o servi√ßo FindCustomers recebe uma string lastName que √© passada na URL como query string: <code>/data/Customer/FindCustomers?lastName=r</code>. Para tipo complexos (classes), o framework obt√©m os dados do body usando um formatter.</p>
<p>Voc√™ pode alterar o processo de binding padr√£o. O atributo <strong>FromUri</strong>, por exemplo, indica que um tipo complexo deve ser lido da URL ao inv√©s do body:</p>
<p><code>public HttpResponseMessage Get([FromUri] Person person)</code></p>
<p>Dessa forma voc√™ chamaria esse servi√ßo assim: <code>/api/Persons/?FirstName=John&LastName=Doe</code>. De maneira similar, o atributo <strong>FromBody</strong> indica que o tipo simples deve ser obtido do body.</p>
<h2>HttpMessageHandler</h2>
<p>Message handlers fazem parte do pipeline do framework Web API e s√£o respons√°veis por interceptar as mensagens que chegam (requests) e as que s√£o retornadas (responses) para os clients.</p>
<p>Voc√™ pode implementar um message handler para efetuar alguma l√≥gica ou fazer alguma valida√ß√£o antes que uma action seja chamada. Isso √© poss√≠vel derivando a classe <em>System.Net.Http.DelegatingHandler</em> e implementando o m√©todo SendAsync. Por exemplo:</p>
<p><script src="https://gist.github.com/edneypitta/4dcd04309149b894f6bb.js"></script></p>
<p>Para interromper o request, basta n√£o chamar o m√©todo base e retornar um response de falha.</p>
<p>Seu handler precisa ainda ser registrado no pipeline da Web API. Voc√™ pode fazer isso de duas formas.</p>
<p>Na primeira, voc√™ adiciona o handler nos MessageHandlers do HttpConfiguration, no m√©todo Register da classe WebApiConfig: <code>config.MessageHandlers.Add(new LoggingMessageHandler());</code><br />
Dessa forma o handler √© registrado globalmente, sendo executado para todos os requests.</p>
<p>O outro jeito √© adicionar o handler para uma rota espec√≠fica, fazendo ele ser executado apenas para actions daquela rota:</p>
<p><script src="https://gist.github.com/edneypitta/ad13f18a65756d5a2239.js"></script></p>
<h2>Implementando Inje√ß√£o De Depend√™ncia</h2>
<p>Por motivos fora do escopo do exame, depend√™ncias <em>suck</em>. Tome o c√≥digo a seguir como exemplo:</p>
<p><code>public string Get()<br />
{<br />
WebClient webClient = new WebClient();<br />
string result = webClient.DownloadString("http://microsoft.com");<br />
return result;<br />
}</code></p>
<p>Seria bem melhor voc√™ ter uma interface <em>IContentRepository</em> com um m√©todo <em>GetContent(string uri)</em> e ter uma implementa√ß√£o <em>WebClientContentRepository</em>, que utiliza a classe WebClient. O controller agora ficaria assim:</p>
<p><script src="https://gist.github.com/edneypitta/e1b88d5ed2c0da9333af.js"></script></p>
<p>Com o c√≥digo desacoplado, voc√™ precisa de um mecanismo para preencher a depend√™ncia do seu controller. A interface <em>IDependencyResolver </em> pode ser implementada da seguinte forma:</p>
<p><script src="https://gist.github.com/edneypitta/fe1ae6907af0f19cf9fc.js"></script></p>
<p>Configurando o DependencyResolver no objeto HttpConfiguration (<code>config.DependencyResolver = new ResolveController();</code>), o framework j√° consegue resolver a depend√™ncia de IContentRepository.</p>
<p>Essa obviamente n√£o √© a melhor op√ß√£o, pois cada nova depend√™ncia vai acarretar numa mudan√ßa na verifica√ß√£o do tipo do controller no m√©todo GetService. Para resolver esse problema, existem v√°rios projetos open source que ajudam nessa implementa√ß√£o, e talvez uma delas caia no exame: Unity.</p>
<p>Ao instalar o Unity pelo NuGet, o arquivo Bootstrapper.cs √© adicionado ao projeto. As √∫nicas coisas que voc√™ precisa saber √© que o m√©todo BootStrapper.Initialize deve ser chamado no Global.asax e que voc√™ registra uma depend√™ncia dessa forma: <code>container.RegisterType<IContentRepository, WebClientContentRepository>();</code>.</p>
<h2>Action Filters E Exception Filters</h2>
<p>Filters s√£o m√©todos que podem alterar a action que est√° sendo executada.<br />
Action Filter √© um m√©todo que √© invocado toda vez que uma action √© chamada, enquanto Exception Filter √© um m√©todo executado quando ocorre uma Exception n√£o tratada.<br />
Para implementar uma Action Filter voc√™ implementa a classe <em>ActionFilterAttribute</em>, e para um Exception Filter a classe <em>ExceptionFilterAttribute</em>.</p>
<p>Veja o seguinte exemplo:</p>
<p><script src="https://gist.github.com/edneypitta/107242838bc2718f580a.js"></script></p>
<p>Esse filtro pode ser aplicado para for√ßar a action a retornar XML, sobrescrevendo o comportamento padr√£o.</p>
<p>Voc√™ pode aplicar esse atributo a um controller (que vai aplicar para todas as actions) ou actions espec√≠ficas. Tamb√©m √© poss√≠vel configurar esse filtro globalmente pela propriedade HttpConfiguration.Filters.</p>
<h2>Streaming Actions</h2>
<p>A classe <em>PushStreamContent</em> pode ser usada para uma action retornar um stream, quando voc√™ precisa enviar uma quantidade muito grande de dados para um client.</p>
<p>Segue um exemplo de implementa√ß√£o. Esse c√≥digo usa um timer para enviar alguns dados para os clients conectados a cada segundo. A classe PushStreamContent √© inicializada com o m√©todo OnStreamAvailable:</p>
<p><script src="https://gist.github.com/edneypitta/bbb02d6edd22ab2bdd8d.js"></script></p>
<p>Se voc√™ executar essa action, o request s√≥ vai terminar quando voc√™ fechar o browser. Dessa forma, voc√™ consegue enviar uma grande quantidade de dados em pacotes para o client.</p>
<hr />
<p>E chegamos ao final desse objetivo üôÇ<br />
Obrigado pela leitura e fique de olho no post do pr√≥ximo objetivo, <strong><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-4-3-secure-a-web-api/">Secure a Web API</a></strong>.</p>
<p>At√© mais!</p>

				<p><a class="btn btn-default read-more" href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-4-2-implement-a-web-api/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 4.2 ‚Äì Implement a Web API">Leia Mais</a></p>

							</div><!-- .entry-content -->
					</div>
	</div>
</article><!-- #post-## -->

			
				
<article id="post-482" class="post-482 post type-post status-publish format-standard hentry category-certificacao tag-70-487">
	<div class="blog-item-wrap">
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-4-1-design-a-web-api/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 4.1 ‚Äì Design a Web API" >
			 				</a>
		<div class="post-inner-content">
			<header class="entry-header page-header">

				<h1 class="entry-title"><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-4-1-design-a-web-api/" rel="bookmark">Certifica√ß√£o Microsoft 70-487: Objetivo 4.1 ‚Äì Design a Web API</a></h1>

								<div class="entry-meta">
					<span class="posted-on"><i class="fa fa-calendar"></i> <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-4-1-design-a-web-api/" rel="bookmark"><time class="entry-date published" datetime="2016-02-26T10:16:29+00:00">26/02/2016</time><time class="updated" datetime="2016-03-01T16:58:30+00:00">01/03/2016</time></a></span><span class="byline"> <i class="fa fa-user"></i> <span class="author vcard"><a class="url fn n" href="https://edneypitta.github.io/old-blog/author/admin/">Edney Pitta</a></span></span>				<span class="comments-link"><i class="fa fa-comment-o"></i><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-4-1-design-a-web-api/#comments"><span class="dsq-postid" data-dsqidentifier="482 https://edneypitta.github.io/old-blog/?p=482">1 Coment√°rio</span></a></span>
				
				
				</div><!-- .entry-meta -->
							</header><!-- .entry-header -->

						<div class="entry-content">

				<p>Ol√° pessoal!</p>
<p>Hoje vamos come√ßar o primeiro objetivo do cap√≠tulo sobre Web API, <strong>Design a Web API</strong>. Esse objetivo cobre como escolher um m√©todo HTTP apropriado, definir recursos HTTP com actions, usar rotas, escolher formatos e planejar quando usar actions ass√≠ncronas. Vamos l√°?</p>
<h2>Escolhendo M√©todos HTTP</h2>
<p>Resumindo a introdu√ß√£o, Web API √© um servi√ßo REST (Representational State Transfer) baseado em HTTP. Ao inv√©s de chamar um m√©todo espec√≠fico, como no WCF, com Web API voc√™ faz uma chamada para uma URL em conjunto com um m√©todo HTTP.</p>
<p>Segue uma lista com os m√©todos HTTP existentes e depois entraremos em detalhes sobre os mais importantes:</p>
<ul>
<li><strong>Delete</strong>: deleta a entidade;</li>
<li><strong>Get</strong>: obt√©m os dados de uma ou mais entidades;</li>
<li><strong>Put</strong>: atualiza a entidade inteira;</li>
<li><strong>Patch</strong>: atualiza parcialmente a entidade;</li>
<li><strong>Post</strong>: cria uma nova entidade;</li>
<li><strong>Head</strong>: recupera somente os headers;</li>
<li><strong>Options</strong>: requisita informa√ß√µes sobre as op√ß√µes dispon√≠veis de comunica√ß√£o.</li>
</ul>
<h4>HttpGet</h4>
<p>Geralmente o m√©todo mais usado, o HttpGet serve para obter dados de uma ou mais entidades. Ou seja, para cada entidade em um modelo, geralmente haver√° um Get para obter todos os itens e outro Get para obter os detalhes de um item espec√≠fico:</p>
<p><code>"/api/Foos" // obt√©m lista de todos os Foos<br />
"/api/Foos/keyvalue" // obt√©m um Foo com a key especificada<br />
"/api/Foos?attributename=attributevalue" // obt√©m um ou mais Foos com os atributos especificados</code></p>
<p>Caso nenhum valor seja encontrado, √© importante lan√ßar uma HttpResponseException com HttpStatusCode.NotFound (404) ao inv√©s de simplesmente lan√ßar uma Exception.</p>
<h4>HttpDelete</h4>
<p>Talvez o mais simples de todos, o HttpDelete simplesmente deleta uma entidade com o valor especificado, geralmente a chave. √â aconselh√°vel usar o prefixo <em>Delete</em> no nome do m√©todo do controller Web API.</p>
<p>Idealmente, h√° 3 poss√≠veis retornos para um request Delete: </p>
<ul>
<li>HttpStatusCode.OK (200), que indica sucesso;</li>
<li>HttpStatusCode.Accepted (202), que indica que o request foi processado e aceito mas est√° ainda pendente;</</li>
<li>HttpStatusCode.NoResponse (204), valor padr√£o para m√©todos com retorno void</li>
</ul>
<h4>HttpPost</h4>
<p>Para criar uma nova entidade, o m√©todo HttpPost deve ser usado. Assim como em Delete, o prefixo <em>Post</em> deve ser utilizado.</p>
<p>Em caso de sucesso, o retorno estipulado pelo protocolo HTTP 1.1 √© HttpStatusCode.Created (201), mas o status code padr√£o √© 200 (OK). √â tamb√©m aconselh√°vel retornar a localiza√ß√£o (URL) de detalhes da nova entidade criada. Seguindo esses padr√µes, a implementa√ß√£o de um HttpPost para criar uma Account seria assim:</p>
<p><code>[HttpPost]<br />
public HttpResponseMessage PostAccount(Account account)<br />
{<br />
HttpResponseMessage response = Request.CreateResponse<Account>(HttpStatusCode.Created, account);<br />
string newUri = Url.Link("NamedApi", new { accountId = account.AccountId });<br />
response.Headers.Location = new Uri(newUri);<br />
return response;<br />
}</code></p>
<h4>HttpPut</h4>
<p>HttpPut deve ser utilizado para opera√ß√µes <em>upserts</em>, que inserem novos registros ou atualizam registros existentes. Tamb√©m devem utilizar o prefixo <em>Put</em>.</p>
<p>Para atualizar uma Account, por exemplo, voc√™ deve receber um Id para procurar e uma Account para atualizar os valores. A implementa√ß√£o seria assim:</p>
<p><code>[HttpPut]<br />
public HttpResponseMessage PutAccount(int id, Account account)<br />
{<br />
// perform insert and/or edit here.<br />
}</code></p>
<h2>Definindo Recursos HTTP Com Actions</h2>
<p>Um servi√ßo Web API nada mais √© do que uma aplica√ß√£o que usa controllers e actions para mapear URLs com a√ß√µes HTTP. Esta se√ß√£o foca no b√°sico de como construir uma aplica√ß√£o Web API.</p>
<h4>Criando O Model</h4>
<p>Voltando um pouco ao cap√≠tulo anterior, em WCF era necess√°rio decorar suas classes com os atributos DataContract e DataMember para trafeg√°-las pelos servi√ßos.</p>
<p>Com Web API, isso n√£o √© mais necess√°rio. O pr√≥prio framework toma conta de enviar sua classe via HTTP, serializada em JSON ou XML. Isso evita o acoplamento entre seu modelo e o servi√ßo que o exp√µe, al√©m de facilitar os poss√≠veis clients desse servi√ßo pelo fato de JSON e XML serem praticamente universais.</p>
<p>Para os exemplos a seguir, vamos considerar o seguinte model:</p>
<p><script src="https://gist.github.com/edneypitta/167b3d7653d04b2112fb.js"></script></p>
<h4>Criando O Controller</h4>
<p>Os controllers s√£o as classes que definem os servi√ßos da sua Web API. Eles herdam de <em>ApiController</em> e cada m√©todo p√∫blico vira uma <em>action</em>, como se fosse um m√©todo no WCF.</p>
<p>Veja a implementa√ß√£o dos controllers abaixo. Seguindo o padr√£o REST, √© criado um servi√ßo para cada tipo no modelo:</p>
<p><script src="https://gist.github.com/edneypitta/51124e2030818e670284.js"></script></p>
<p><script src="https://gist.github.com/edneypitta/4f8d4763dd6d01e8f0b4.js"></script></p>
<p>Com isso, voc√™ j√° tem sua Web API funcionando. Basta acessar <code>http://localhost:{porta}/api/Account</code> e a lista de Accounts √© retornada. Chamando <code>/api/Account?accountId=1</code>, a Account com o Id 1 √© retornada. </p>
<p>Um ponto importante √© que, chamando essas URLs diretamente no browser, o comportamento √© definido pelo pr√≥prio browser. O Chrome e o Firefox, por exemplo, mostrariam um XML na tela, enquanto o Internet Explorer faria o download de um JSON. Isso varia do request header <strong>Accept </strong>que o browser envia para a Web API.</p>
<h2>Definindo Rotas</h2>
<p>Toda a m√°gica da Web API de tornar m√©todos p√∫blicos em um controller acess√≠veis por clients acontece por causa da <em>Routing Table</em>. </p>
<p>Routing Table √© um classe que implementa <em>System.Web.Http.Routing.IHttpRoute</em> e tem a tarefa de mepear um request para um controller e uma action espec√≠ficos. No caso de Web API, a classe se chama WebApiConfig e fica dentro de App_Start:</p>
<p><script src="https://gist.github.com/edneypitta/bc41c4fabf2f6f1035d7.js"></script></p>
<p>Se voc√™ mudar o routeTemplate para <code>"data/{controller}/{id}"</code>, por exemplo, voc√™ agora acessa sua api com <code>http://localhost:{porta}/data/Account</code>.</p>
<p>Quando uma requisi√ß√£o √© feita para uma Web API, o framework tenta achar o controller e a action segundo o que est√° definido na Routing Table. Se n√£o encontra, uma HttpStatusCode 404 √© retornado. Caso contr√°rio, o request √© encaminhado para o m√©todo. As seguintes a√ß√µes s√£o tomadas pelo framework para encontrar o controller e a action:</p>
<ul>
<li>Para achar o controller, a Web API adiciona a palavra <em>Controller</em> na vari√°vel do controller (por isso voc√™ chama diretamente Account, por exemplo);</li>
<li>Para a action, a Web API examina o m√©todo HTTP do request e tenta achar uma action com o nome correspondente;</li>
<li>Por padr√£o, isso s√≥ funciona com os m√©todos GET, POST, PUT e DELETE. Outro m√©todos s√£o suportados, mas outro mecanismo √© utilizado;</li>
<li>Por √∫ltimo, as vari√°veis no routeTemplate s√£o mapeadas para os par√¢metros da action (por padr√£o, <em>id</em>).</li>
</ul>
<p>Voc√™ pode setar explicitamente um m√©todo HTTP em uma action. Isso √© importante quando voc√™ quer que o nome do m√©todo seja diferente do m√©todo HTTP. Para fazer isso, basta decorar o m√©todo com o atributo <em>System.Web.Http.ActionMethodSelectorAttribute</em>. Ele possui 4 valores: HttpGet, HttpPost, HttpDelete e HttpPut. O m√©todo ficaria assim: </p>
<p><code>[HttpGet]<br />
public Account GetAccount(int accountId)</code></p>
<p>Para definir m√∫ltiplos m√©todos HTTP para uma action ou suportar um m√©todo HTTP fora os 4 citados, voc√™ usa o atributo <em>System.Web.Http.AcceptVerbsAttribute</em>. O construtor aceita um array de strings que correspondem aos m√©todos que devem ser mapeados. O uso ficaria assim:</p>
<p><code>[System.Web.Http.AcceptVerbs("GET", "HEAD")]<br />
public IEnumerable<Customer> GetCustomers(int accountId)</code></p>
<h4>Alterando Actions</h4>
<p>Se voc√™ quiser criar as rotas com o nome da ation expl√≠cito, basta mudar a Routing Table para isso. O c√≥digo ficaria assim:</p>
<p><script src="https://gist.github.com/edneypitta/71116a14432f469431a7.js"></script></p>
<p>Com isso, ao inv√©s de acessar <code>/api/Customer/1</code>, voc√™ acessa <code>/api/Customer/GetCustomers/1</code>. </p>
<p>Voc√™ pode alterar o nome da action pelo atributo <em>ActionNameAttribute</em>:</p>
<p><code>[HttpGet]<br />
[ActionName("FindCustomers")]<br />
public IEnumerable<Customer> SearchCustomers(string lastName)</code></p>
<p>Assim, voc√™ acessa essa action com a URL <code>/api/Customer/FindCustomers?lastName=r</code>.</p>
<p>O √∫ltimo ponto √© que voc√™ pode querer que um m√©todo p√∫blico no controller n√£o seja uma action acess√≠vel pelo servi√ßo. Para isso, decore o m√©todo com o atributo <em>NonAction</em>.</p>
<h2>Escolhendo Formatos</h2>
<p>O request header Accept indica o formato que o client espera como retorno. Acessando sua Web API pelo browser, geralmente o seguinte header √© enviado: </p>
<p><code>Accept: text/html,application/xhtml+xml,application/xml</code></p>
<p>Por padr√£o, a Web API trabalha com JSON e XML. Isso √© configurado por um objeto chamado <em>media-type formatter</em>.</p>
<p>Para essa se√ß√£o, basta voc√™ saber isso e que voc√™ pode adicionar formatters customizados implementando a classe <em>MediaTypeFormatter </em>ou <em>BufferedMediaTypeFormatter</em>.</p>
<h2>Actions Ass√≠ncronas</h2>
<p>Ao fazer um request para um servi√ßo Web API, uma thread √© alocada do servidor para fazer o processamento necess√°rio.<br />
Em cen√°rios de grandes processamentos de I/O (entrada/sa√≠da), como acesso a banco de dados e chamadas a outros servi√ßos, √© importante liberar a thread atual para que ela processe mais requests enquanto essa entrada/sa√≠da longa √© executada.</p>
<p>O C# 5 nos deu mecanismos para fazer isso de forma muito simples: as palavras-chave <em>async </em>e <em>await</em>. Tome por exemplo a seguinte action de uma Web API:</p>
<p><code>public string Get()<br />
{<br />
WebClient webClient = new WebClient();<br />
string result = webClient.DownloadString("http://microsoft.com");<br />
return result;<br />
}</code></p>
<p>Na maior parte do tempo, a thread alocada fica esperando o processamento I/O de fazer o request para o site da microsoft e buscar o HTML. Olhe essa action com async/await:</p>
<p><code>public <strong>async </strong>Task&lt;string&gt; Get()<br />
{<br />
WebClient webClient = new WebClient();<br />
string result = await webClient.DownloadString<strong>TaskAsync</strong>("http://microsoft.com");<br />
return result;<br />
}</code></p>
<p>Na chamada a <code>await webClient.DownloadStringTaskAsync</code>, a thread alocada √© liberada para processar outros requests enquanto a requisi√ß√£o ao site da Microsoft √© feita.</p>
<p>Um √∫ltimo alerta √© que chamadas ass√≠ncronas devem ser feitas <strong>apenas</strong> para processamentos I/O. Se o m√©todo ass√≠ncrono fizer um processamento de CPU, outra thread ter√° que ser alocada para fazer esse processamento, o que invalida quaisquer benef√≠cios da programa√ß√£o ass√≠ncrona (podendo at√© piorar devido √† troca de threads).</p>
<hr />
<p>Chegamos ao fim desse objetivo üôÇ</p>
<p>Obrigado pela leitura e espere pelo pr√≥ximo post sobre o objetivo 4.2, <strong><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-4-2-implement-a-web-api/">Implement a Web API</a></strong>.</p>
<p>At√© mais!</p>

				<p><a class="btn btn-default read-more" href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-4-1-design-a-web-api/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 4.1 ‚Äì Design a Web API">Leia Mais</a></p>

							</div><!-- .entry-content -->
					</div>
	</div>
</article><!-- #post-## -->

			
				
<article id="post-474" class="post-474 post type-post status-publish format-standard hentry category-certificacao tag-70-487">
	<div class="blog-item-wrap">
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-9-host-and-manage-services/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 3.9 ‚Äì Host and manage services" >
			 				</a>
		<div class="post-inner-content">
			<header class="entry-header page-header">

				<h1 class="entry-title"><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-9-host-and-manage-services/" rel="bookmark">Certifica√ß√£o Microsoft 70-487: Objetivo 3.9 ‚Äì Host and manage services</a></h1>

								<div class="entry-meta">
					<span class="posted-on"><i class="fa fa-calendar"></i> <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-9-host-and-manage-services/" rel="bookmark"><time class="entry-date published" datetime="2016-02-20T22:51:45+00:00">20/02/2016</time><time class="updated" datetime="2016-03-01T16:58:23+00:00">01/03/2016</time></a></span><span class="byline"> <i class="fa fa-user"></i> <span class="author vcard"><a class="url fn n" href="https://edneypitta.github.io/old-blog/author/admin/">Edney Pitta</a></span></span>				<span class="comments-link"><i class="fa fa-comment-o"></i><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-9-host-and-manage-services/#respond"><span class="dsq-postid" data-dsqidentifier="474 https://edneypitta.github.io/old-blog/?p=474">Deixe um coment√°rio</span></a></span>
				
				
				</div><!-- .entry-meta -->
							</header><!-- .entry-header -->

						<div class="entry-content">

				<p>Ol√°!<br />
Esse post ser√° sobre o √∫ltimo objetivo do cap√≠tulo de WCF, Host and manage services.<br />
Esse objetivo cobre como gerenciar simultaneidade, escolher um Instance Mode, criar hosts, escolher um mecanismo de hosting, criar servi√ßos transacionais e hostear em um Azure Worker Role.</p>
<h2>Gerenciando Simultaneidade</h2>
<p>√â bem prov√°vel que seu servi√ßo seja consumido por mais de um consumidor ao mesmo tempo. Com isso, √© necess√°rio tentar prever e gerenciar a simultaneidade que seu servi√ßo suportar√°.</p>
<p>Dentro de ServiceBehavior, voc√™ pode definir o ConcurrencyMode: <code>[ServiceBehavior(ConcurrencyMode=ConcurrencyMode.Single)]</code></p>
<p>O enum ConcurrencyMode possui 3 valores:</p>
<ul>
<li><strong>Single</strong>: em qualquer momento, somente 1 request tem acesso ao servi√ßo WCF por vez. Caso v√°rios requests sejam feitos simultaneamente, todos v√£o esperar at√© que o anterior complete seu processamento;</li>
<li><strong>Multiple</strong>: como o nome sugere, m√∫ltiplos requests podem ser feitos simultaneamente em threads separadas;</li>
<li><strong>Reentrant</strong>: funciona como o Single, mas se voc√™ fizer uma chamada a outro servi√ßo, o lock √© liberado para que o pr√≥ximo request seja processado.</li>
</ul>
<h2>Escolhendo um Instance Mode</h2>
<p>Tratando ainda sobre simultaneidade, a configura√ß√£o <strong>InstanceContextMode</strong> especifica o n√∫mero de inst√¢ncias do servi√ßo para processar os requests. Tamb√©m tem 3 valores e, junto com ConcurrencyMode, d√£o 9 poss√≠veis combina√ß√µes.</p>
<p>Assim como ConcurrencyMode, voc√™ pode setar essa propriedade no atributo ServiceBehavior. Os 3 valores s√£o:</p>
<ul>
<li><strong>Single</strong>: uma √∫nica inst√¢ncia do servi√ßo √© usada para todos os requests;</li>
<li><strong>PerSession</strong>: cria uma ou mais inst√¢ncias para cada client. √â a configura√ß√£o padr√£o;</li>
<li><strong>PerCall</strong>: cria uma ou mais inst√¢ncias para cada request.</li>
</ul>
<p>Esse √© um assunto bem complexo e o comportamento de cada combina√ß√£o aparentemente est√° fora do escopo do exame. Se quiser ir a fundo no tema, h√° um bom artigo no <a href="http://www.codeproject.com/Articles/89858/WCF-Concurrency-Single-Multiple-and-Reentrant-and" target="_blank">codeproject</a>.</p>
<h2>Criando Hosts</h2>
<p>H√° v√°rias op√ß√µes de host para um servi√ßo WCF. Vamos passar pelas op√ß√µes dispon√≠veis (ou prov√°veis de estar no exame) resumindo os pontos positivos e negativos.</p>
<h4>Self Hosting</h4>
<p>Servi√ßos WCF podem ser hospedados em qualquer aplica√ß√£o .NET. Voc√™ especifica a configura√ß√£o do servi√ßo em um arquivo de configura√ß√£o ou no c√≥digo em conjunto com inst√¢ncias da classe ServiceHost.</p>
<p>H√° v√°rios benef√≠cios dessa forma. Como voc√™ pode facilmente trocar de hosts, se sua aplica√ß√£o n√£o estiver performando bem, voc√™ pode fazer upgrade para outro host ou habilitar outros bindings. Fazer debug da aplica√ß√£o tamb√©m fica facilitado.</p>
<p>A principal desvantagem √© que voc√™ deve gerenciar todo o host, consertando quaisquer bugs que apare√ßam. Mover o host para outra m√°quina ou fazer um upgrade de hardware, se for necess√°rio, tamb√©m √© doloroso. Por isso s√£o geralmente usados para ambiente de desenvolvimento, e n√£o produ√ß√£o.</p>
<h4>Managed Windows Services</h4>
<p>N√£o muito diferentes de outras aplica√ß√µes .NET, Managed Services s√£o parecidos com Self Hosting, mas com mais poder. Se a m√°quina reiniciar, por exemplo, o servi√ßo pode startar automaticamente, sem a necessidade de um usu√°rio logado. Tamb√©m n√£o √© necess√°rio usar IIS ou WAS para rodar na m√°quina.</p>
<p>Como desvantagens, voc√™ ainda precisa escrever c√≥digo para criar o host com a classe ServiceHost e existe limita√ß√£o para <em>scale up</em> e <em>scale down</em>. Services tamb√©m tendem a ser mais dif√≠ceis para debug.</p>
<h4>Internet Information Services (IIS)</h4>
<p>O IIS, conhecido por hospedar aplica√ß√µes ASP.NET, tamb√©m pode ser usado para hospedar um servi√ßo WCF.</p>
<p>As vantagens s√£o todas as features que o IIS tem, como isolamento de pools de aplica√ß√µes, recycling, desligamento por ociosidade, monitoramento, etc. Se o servi√ßo precisar de alta disponibilidade e ser escal√°vel, IIS √© a escolha ideal.</p>
<p>A desvantagem que pode deix√°-lo inutiliz√°vel para alguns servi√ßos √© que ele s√≥ suporta bindings que fazem o transporte por HTTP.</p>
<h4>Windows Activation Service (WAS)</h4>
<p>WAS, apesar de presente na maioria das grandes organiza√ß√µes, n√£o √© t√£o conhecido como o IIS. </p>
<p>Ele prov√™ todos os benef√≠cios do IIS e suporta outros tipos de transporte, como TCP, named pipes e MSMQ.</p>
<p>A desvantagem √© que, por ser uma tecnologia nova, h√° pouco suporte e material sobre ela.</p>
<h4>Windows Azure</h4>
<p>Hospedar seu servi√ßo na nuvem possui v√°rias vantagens. A principal √© que toda a dor de cabe√ßa de manter um servidor com um servi√ßo rodando fica com a Microsoft, e n√£o com voc√™.</p>
<p>Por enquanto, √© suficiente saber que h√° 3 principais op√ß√µes no Azure: WebRole, AppFabric service bus e WorkerRole.</p>
<p>A desvantagem pode ser que sua aplica√ß√£o est√° hospedada por outras pessoas, o que tira o seu controle de ter um servidor on premise. Usando Azure, voc√™ ainda ter√° que fazer a escolhe entre self-host, IIS ou WAS.</p>
<h4>Classe ServiceHost</h4>
<p>Criar uma inst√¢ncia de ServiceHost √© simples. Voc√™ chama o construtor passando o tipo do servi√ßo, que deve estar referenciado. H√° v√°rios overloads do construtor, mas n√£o s√£o prov√°veis de estarem no exame. Ap√≥s isso, voc√™ chama o m√©todo Open e por fim Close, ambos num try/catch pois v√°rias coisas podem dar errado nesse tempo.</p>
<p><code>using (ServiceHost HostInstance = new ServiceHost(typeof(TestServiceType)))<br />
{<br />
 HostInstance.Open();<br />
 //Put in a Wait Condition so Host stays open<br />
 HostInstance.Close();<br />
}</code></p>
<p>Ap√≥s o canal ser aberto por um client, o comportamento depende das defini√ß√µes do servi√ßo (ConcurrencyMode, InstancingMode, tipos de endpoint, etc.). Um ponto importante para o client √© que, caso haja algum erro n√£o tratado, todo o canal √© considerado falho e inv√°lido para novas opera√ß√µes. Sempre deve haver a valida√ß√£o se a conex√£o est√° v√°lida.</p>
<p>√â importante tamb√©m entender as op√ß√µes de host. Como servi√ßos WCF podem ser hospedados em qualquer AppDomain, seja uma aplica√ß√£o Windows Form ou Console, se o AppDomain n√£o estiver ativo, o host tamb√©m n√£o estar√°.</p>
<p>Ao usar um mecanismo de hosting como IIS ou WAS, n√£o √© necess√°rio criar um ServiceHost. Basta configurar o servi√ßo e gerenciar pela ferramenta.</p>
<p>H√° outro ponto que possivelmente esteja no exame. Antes do .NET 4.0, se voc√™ quisesse usar o IIS para hospedar seu servi√ßo, voc√™ tinha que criar uma aplica√ß√£o ASP.NET com uma refer√™ncia ao seu servi√ßo, colocar as configura√ß√µes no Web.config e criar um arquivo de texto com a exten√ß√£o .svc (com uma √∫nica linha) para mapear o servi√ßo. </p>
<p>Com a vers√£o 4.0, isso n√£o √© mais necess√°rio. Voc√™ pode usar a classe <strong>ServiceHostingEnvironment</strong>, que permite que voc√™ referencie o arquivo .svc virtualmente, sem a necessidade de cri√°-lo fisicamente. A configura√ß√£o via arquivo fica assim:</p>
<p><code>&lt;serviceHostingEnvironment&gt;<br />
  &lt;serviceActivations&gt;<br />
    &lt;add relativeAddress=&quot;ServiceOrInterfaceName.svc&quot; service=&quot;FullyQualifiedServiceName&quot;/&gt;<br />
  &lt;/serviceActivations&gt;<br />
&lt;/serviceHostingEnvironment&gt;<br />
</code></p>
<h2>Escolhendo Um Mecanismo De Hosting</h2>
<p>Resumindo o que vimos at√© agora, voc√™ tem v√°rias op√ß√µes para hospedar um servi√ßo WCF:</p>
<ul>
<li>Windows Form application</li>
<li>Console application</li>
<li>Managed Windows Service</li>
<li>ASP.NET application</li>
<li>IIS</li>
<li>WAS</li>
<li>Windows Azure</li>
</ul>
<p>N√£o existe regra para fazer essa escolha ou uma op√ß√£o que atenda todos os cen√°rios. Se seu servi√ßo demandar que o transporte n√£o seja feito por HTTP, por exemplo, o IIS n√£o √© uma op√ß√£o. Ou se voc√™ precisar usar um binding MSMQ, voc√™ vai precisar de um host que d√™ suporte a isso.</p>
<p>Falando no geral, procure uma solu√ß√£o que te d√™ menos trabalho. IIS e WAS s√£o produtos confi√°veis, com uma base de usu√°rios grande e f√°ceis de usar em conjunto com WCF. Escrever um novo host fatalmente ir√° gerar bugs ao longo do caminho.</p>
<h2>Criando Servi√ßos Transacionais</h2>
<p>No <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-1-3-implement-transactions/" target="_blank">objetivo 1.3</a>, falamos sobre a classe TransactionScope. Ela tamb√©m funciona de maneira bem simples com servi√ßos WCF.</p>
<p>Voc√™ precisa decorar a opera√ß√£o com o atributo TransactionFlow (em conjunto com o atributo OperationContract), que especifica se a opera√ß√£o suporta transa√ß√µes. O construtor aceita 3 valores:</p>
<ul>
<li><code>[TransactionFlow(TransactionFlowOption.NotAllowed)]</code>: a opera√ß√£o n√£o pode participar de uma transaction;</li>
<li><code>[TransactionFlow(TransactionFlowOption.Allowed)]</code>: a opera√ß√£o pode participar de uma transaction, se o client iniciar uma;</li>
<li><code>[TransactionFlow(TransactionFlowOption.Mandatory)]</code>: obrigatoriamente a chamada deve fazer parte de uma transaction.</li>
</ul>
<p>Al√©m disso, voc√™ deve setar as propriedades TransactionAutoComplete e TransactionScopeRequired do OperationBehavior como true:</p>
<p><code>[OperationBehavior(TransactionAutoComplete = true, TransactionScopeRequired = true)]<br />
public String GetTestSummary(String examId){}</code></p>
<p>TransactionAutoComplete diz ao runtime para automaticamente completar a transa√ß√£o se nenhuma exce√ß√£o for lan√ßada. Caso seja, ser√° feito o rollback. O atributo TransactionScopeRequired diz que o m√©todo precisa fazer parte de uma TransactionScope.</p>
<h2>Hospedando Servi√ßos Em Um Azure WorkerRole</h2>
<p>Hospedar seu servi√ßo no Azure em um WorkerRole significa ter mais controle sobre o servidor e as configura√ß√µes do seu servi√ßo, permitindo que voc√™ n√£o use o IIS como hosting, por exemplo.</p>
<p>Com isso, √© de sua responsabilidade configurar endpoints, inicializar e abrir um ServiceHost. Isso pode ser feito no m√©todo OnStart.</p>
<p>As configura√ß√µes de endpoint podem estar no arquivo de configura√ß√£o da role (.csdef). O c√≥digo fica assim:</p>
<p><script src="https://gist.github.com/edneypitta/117c18d38759fa885679.js"></script></p>
<p>√â interessante deixar a vari√°vel de host fora do m√©todo para que o garbage collector n√£o a remova do escopo quando o m√©todo terminar.</p>
<p>O √∫ltimo detalhe desse objetivo, n√£o relacionado a nenhum item, √© que voc√™ deve saber que existe um <strong>DiscoveryEndpoint</strong> que faz com que seu servi√ßo seja descoberto por clients.</p>
<hr />
<p>E acabamos o cap√≠tulo 3 sobre servi√ßos WCF üòÄ Por ser o maior objetivo da certifica√ß√£o, o assunto ficou bem extenso e chato, √†s vezes. </p>
<p>Mas agora vem o cap√≠tulo 4 com os objetivos sobre Web API, que √© o mais comum nas aplica√ß√µes hoje em dia (e bem mais elegante).</p>
<p>O pr√≥ximo objetivo ser√° o 4.1,<strong> <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-4-1-design-a-web-api/">Design a Web API</a></strong>.</p>
<p>At√© mais!</p>

				<p><a class="btn btn-default read-more" href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-9-host-and-manage-services/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 3.9 ‚Äì Host and manage services">Leia Mais</a></p>

							</div><!-- .entry-content -->
					</div>
	</div>
</article><!-- #post-## -->

			
				
<article id="post-469" class="post-469 post type-post status-publish format-standard hentry category-certificacao tag-70-487">
	<div class="blog-item-wrap">
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-8-implement-messaging-patterns/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 3.8 ‚Äì Implement messaging patterns" >
			 				</a>
		<div class="post-inner-content">
			<header class="entry-header page-header">

				<h1 class="entry-title"><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-8-implement-messaging-patterns/" rel="bookmark">Certifica√ß√£o Microsoft 70-487: Objetivo 3.8 ‚Äì Implement messaging patterns</a></h1>

								<div class="entry-meta">
					<span class="posted-on"><i class="fa fa-calendar"></i> <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-8-implement-messaging-patterns/" rel="bookmark"><time class="entry-date published" datetime="2016-02-20T15:25:10+00:00">20/02/2016</time><time class="updated" datetime="2016-03-01T16:58:18+00:00">01/03/2016</time></a></span><span class="byline"> <i class="fa fa-user"></i> <span class="author vcard"><a class="url fn n" href="https://edneypitta.github.io/old-blog/author/admin/">Edney Pitta</a></span></span>				<span class="comments-link"><i class="fa fa-comment-o"></i><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-8-implement-messaging-patterns/#respond"><span class="dsq-postid" data-dsqidentifier="469 https://edneypitta.github.io/old-blog/?p=469">Deixe um coment√°rio</span></a></span>
				
				
				</div><!-- .entry-meta -->
							</header><!-- .entry-header -->

						<div class="entry-content">

				<p>Ol√° pessoal!<br />
O objetivo 3.8, Implement messaging patterns, trata de <em>Message Exchange Patterns</em> (ou Padr√µes de Troca de Mensagem), que s√£o mecanismos que descrevem como o client e o server v√£o se comunicar.<br />
Vamos cobrir como implementar os tipos one-way, request/reply, streaming e duplex, al√©m de falar sobre alguns mecanismos no Azure. Vamos l√°?</p>
<h2>Implementando One-Way, Request/Reply, Streaming e Duplex</h2>
<h4>One-Way</h4>
<p>Implementa√ß√µes one-way servem para cen√°rios <em>fire and forget</em>, onde voc√™ faz uma chamada e n√£o se importa com a resposta, como escrever alguma coisa em um log.</p>
<p>O WCF suporta implementa√ß√µes one-way de forma simples. Basta setar o par√¢metro IsOneWay como true no atributo OperationContract e n√£o ter nenhum tipo de retorno no m√©todo: </p>
<p><code>[OperationContract(IsOneWay = true)]<br />
void LogMessage(String message);</code></p>
<p>Num cen√°rio comum, um request √© feito para o servidor que processa e envia um response. Com OneWay, acontece o seguinte: quando o request √© feito, o servidor responde instantaneamente com o StatusCode 202, Accepted. S√≥ depois disso ele vai de fato processar o request, como se fosse uma opera√ß√£o ass√≠ncrona.</p>
<p>Apesar de ser uma boa feature, OneWay deve ser usado com cuidado. Opera√ß√µes cr√≠ticas podem dar errado sem que voc√™ saiba, causando problemas. Bons candidatos a OneWay s√£o opera√ß√µes de baixa prioridade e que n√£o retornam valor.</p>
<h4>Streaming</h4>
<p>Ao implementar streaming com WCF, voc√™ tem dois modos para trabalhar: <strong>Buffered</strong> ou <strong>Streaming</strong>. </p>
<p>Buffered, o modo default, significa que a mensagem inteira precisa ser enviada para que o recebedor comece a leitura. Em Streaming, o recebedor consegue come√ßar a leitura assim que a informa√ß√£o estiver dispon√≠vel (cen√°rio ideal para transfer√™ncia de arquivos grandes, como √°udio ou v√≠deo).</p>
<p>Nesse formato, uma propriedade importante √© a maxReceivedMessageSize, que limita o tamanho de mensagens recebidas. Isso √© crucial para evitar ataques DDoS.<br />
No n√≠vel do contrato, voc√™ come√ßa o processo definindo o retorno de um m√©todo como Stream. Depois √© necess√°rio configurar o binding para que o TransferMode seja Streamed e a√≠ configurar o atributo maxReceivedMessageSize. O arquivo de configura√ß√£o ficaria assim:</p>
<p><script src="https://gist.github.com/edneypitta/6b14037220816e6274db.js"></script></p>
<p>H√° 4 valores para o enum TransferMode, com nomes bem sugestivos: <em>Buffered</em>, <em>Streamed</em>, <em>StreamedRequest </em>e <em>StreamedResponse</em>.</p>
<p>Um ponto para se ter em mente √© que habilitar streaming para um servi√ßo n√£o vai automaticamente melhorar a performance. √â verdade que com streaming n√£o s√£o necess√°rios grandes buffers de mem√≥ria, mas num contexto comum de transfer√™ncia de informa√ß√µes a melhora de performance √© impercept√≠vel. </p>
<p>Outro aspecto √© que nem todos os bindings suportam a propriedade TransferMode. Os √∫nicos bindings padr√£o que aceitam s√£o <em>BasicHttpBinding</em>, <em>NetTcpBinding </em>e <em>NetNamedPipeBinding</em>.</p>
<p>Por √∫ltimo, h√° algumas limita√ß√µes ao se usar streaming. S√£o elas:</p>
<ul>
<li>Opera√ß√µes que usam o transporte Streamed s√≥ podem ter um input e um output de par√¢metro;</li>
<li>Headers SOAP s√£o sempre buffered, mesmo habilitando streaming. Eles n√£o podem ultrapassar o tamanho da propriedade MaxBufferSize;</li>
<li>As implementa√ß√µes de seguran√ßa Reliable Message e SOAP Message confiam na transmiss√£o buffered. Geralmente voc√™ deve usar seguran√ßa no n√≠vel de transporte (<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-4-secure-a-wcf-service/" target="_blank">objetivo 3.4</a>).</li>
</ul>
<h4>Request/Reply</h4>
<p>√â o modo padr√£o de funcionamento de qualquer web service, onde o client envia um request, o server processa e envia um response. N√£o h√° muito a mais o que ser dito üòÄ Vamos para o pr√≥ximo item.</p>
<h4>Duplex</h4>
<p>Na comunica√ß√£o duplex, o client se conecta com um servi√ßo provendo um canal de comunica√ß√£o, onde o server pode mandar mensagens de volta para o client. Para funcionar, tudo isso precisa existir no contexto de uma sess√£o.</p>
<p>Nesse cen√°rio com WCF, al√©m de definir um contrato de ServiceContract, outra interface √© necess√°ria para especificar a propriedade CallbackContract, que serve como callback. Para o exame, n√£o √© necess√°rio saber mais que isso existe.</p>
<h2>Implementando Azure Service Bus E Azure Queues</h2>
<p>Como visto no <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-7-create-and-configure-a-wcf-service-on-windows-azure/" target="_blank">objetivo anterior</a>, o Azure Service Bus √© um componente que conecta servi√ßos WCF (e outras aplica√ß√µes) pelo Azure.</p>
<p>Usando relay, a comunica√ß√£o √© feita diretamente entre as duas partes. Isso implica que ambas precisam estar online para a comunica√ß√£o acontecer.<br />
√Äs vezes, voc√™ precisa de uma fila de comunica√ß√µes ou usar um mecanismo de <a href="https://en.wikipedia.org/wiki/Publish%E2%80%93subscribe_pattern" target="_blank">publish/subscribe</a>. O Azure tamb√©m oferece essas tipos de comunica√ß√µes.</p>
<p>Uma <em>Queue </em>(fila) permite que mensagens enviadas por um client sejam armazenadas at√© que outro client as leia. Um <em>Topic</em> extende o comportamento da queue adicionando <em>subscriptions</em>, onde cada client especifica crit√©rios para filtrar as mensagens que v√™. Como Topics n√£o estar√£o no exame, vamos focar na Queue.</p>
<p>Quando usando uma Queue, voc√™ manda uma mensagem para o service bus com um conjunto de propriedades chave/valor e um body bin√°rio. A mensagem √© armazenada pelo service bus e entregada a um recebedor em um determinado momento, desacoplando as duas (ou mais) aplica√ß√µes. O recebedor pode remover o item da fila na leitura ou colocar um lock, processar a mensagem e depois remov√™-la (como o Storage Queue faz).</p>
<p>Quest√µes sobre a implementa√ß√£o n√£o s√£o prov√°veis de estar no exame, ent√£o o conhecimento do mecanismo j√° √© suficiente. Voc√™ pode obter mais detalhes <a href="https://azure.microsoft.com/en-us/documentation/articles/service-bus-dotnet-multi-tier-app-using-service-bus-queues/" target="_blank">aqui</a>.</p>
<p>O conceito importante √© o uso da classe QueueClient que permite o envio e recebimento de mensagens da queue. A mensagem √© representada pela classe BrokeredMessage.</p>
<p>E chegamos ao final desse objetivo.<br />
O pr√≥ximo post, sobre o objetivo <strong><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-9-host-and-manage-services/">Host and manage services</a></strong>, ser√° o √∫ltimo do cap√≠tulo sobre WCF.</p>
<p>At√© mais!</p>

				<p><a class="btn btn-default read-more" href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-8-implement-messaging-patterns/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 3.8 ‚Äì Implement messaging patterns">Leia Mais</a></p>

							</div><!-- .entry-content -->
					</div>
	</div>
</article><!-- #post-## -->

			
				
<article id="post-461" class="post-461 post type-post status-publish format-standard hentry category-certificacao tag-70-487">
	<div class="blog-item-wrap">
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-7-create-and-configure-a-wcf-service-on-windows-azure/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 3.7 ‚Äì Create and configure a WCF service on Windows Azure" >
			 				</a>
		<div class="post-inner-content">
			<header class="entry-header page-header">

				<h1 class="entry-title"><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-7-create-and-configure-a-wcf-service-on-windows-azure/" rel="bookmark">Certifica√ß√£o Microsoft 70-487: Objetivo 3.7 ‚Äì Create and configure a WCF service on Windows Azure</a></h1>

								<div class="entry-meta">
					<span class="posted-on"><i class="fa fa-calendar"></i> <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-7-create-and-configure-a-wcf-service-on-windows-azure/" rel="bookmark"><time class="entry-date published" datetime="2016-02-20T11:37:02+00:00">20/02/2016</time><time class="updated" datetime="2016-03-01T16:58:10+00:00">01/03/2016</time></a></span><span class="byline"> <i class="fa fa-user"></i> <span class="author vcard"><a class="url fn n" href="https://edneypitta.github.io/old-blog/author/admin/">Edney Pitta</a></span></span>				<span class="comments-link"><i class="fa fa-comment-o"></i><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-7-create-and-configure-a-wcf-service-on-windows-azure/#respond"><span class="dsq-postid" data-dsqidentifier="461 https://edneypitta.github.io/old-blog/?p=461">Deixe um coment√°rio</span></a></span>
				
				
				</div><!-- .entry-meta -->
							</header><!-- .entry-header -->

						<div class="entry-content">

				<p>O objetivo Create and configure a WCF service on Windows Azure (finalmente sobre Azure) fala principalmente sobre o <strong>Azure Service Bus</strong>, servi√ßo que permite que voc√™ exponha seu servi√ßo WCF (ou qualquer outro) hospedado no seu pr√≥prio datacenter. Isso evita os problemas de instala√ß√£o e configura√ß√£o de deixar tudo <em>on premises</em> e te d√° as vantagens que o Azure pode oferecer. Vamos l√°?</p>
<h2>Criando E Configurando Bindings</h2>
<p>Apenas revisando, um servi√ßo WCF basicamente precisa do ABC (address, binding e contract). Para fazer o deploy de um servi√ßo WCF no Azure em uma Web Role ou Web Site voc√™ n√£o precisa fazer nenhuma modifica√ß√£o no c√≥digo ou nas configura√ß√µes.</p>
<p>Usando a feature de <em>relay</em> do Azure Service Bus, voc√™ pode configurar alguns bindings adicionais no seu projeto adicionando o pacote NuGet <strong>Windows Azure Service Bus</strong>.</p>
<p>Considere o c√≥digo a seguir, assumindo que ISecretService e SecretService formam o contrato e a implementa√ß√£o de um servi√ßo:</p>
<p><script src="https://gist.github.com/edneypitta/a9a868a8cd8013f3551e.js"></script></p>
<p>Nesse exemplo, o servi√ßo est√° exposto em dois endpoints, um interno (com NetTcpBinding) e um externo, usando a feature de relay do Azure Service Bus (com NetTcpRelayBinding). Ao fechar a aplica√ß√£o (sh.Close()), o endpoint √© removido do Azure.</p>
<p>Voc√™ pode configurar tamb√©m o endpoint no Azure pelo arquivo de configura√ß√£o:</p>
<p><script src="https://gist.github.com/edneypitta/37e5fbf9ad2587f2443b.js"></script></p>
<p>Nos dois exemplos o binding NetTcpRelayBinding √© usado, mas h√° outros dispon√≠veis.<br />
Tanto por c√≥digo ou arquivo de configura√ß√£o, voc√™ deve setar o nome do servi√ßo e a Default Key.<br />
Outro ponto interessante √© que o Azure Service Bus n√£o requer nenhuma configura√ß√£o no seu servidor on premise. Normalmente a comunica√ß√£o √© feita por TCP, mas se as portas n√£o estiverem dispon√≠veis, o relay pode usar as portas HTTP ou HTTPS.</p>
<h2>Criando Um Azure Service Bus</h2>
<p>Para criar um Azure Service Bus, basta ir no portal do Azure, selecionar a cria√ß√£o de um Azure Service Bus, configurar um namespace e selecionar uma regi√£o.</p>
<p>O portal vai informar a connection string de conex√£o, que cont√©m o nome do servi√ßo e a Default Key:</p>
<p><code><strong>Endpoint</strong>=sb://wcfonazure.servicebus.windows.net/;<strong>SharedSecretIssuer</strong>=owner;<strong>SharedSecretValue</strong>=D1Kmb83CCLrAtz4du9vb3xn99DaM2dH4jQqSec98if4=<br />
</code></p>
<h2>Integrando Com O Azure Service Bus Relay</h2>
<p>Ap√≥s criar um novo service bus no Azure e hospedar um servi√ßo WCF, voc√™ pode criar um client para se comunicar com seu servi√ßo on premise pelo Azure.</p>
<p>√â necess√°rio ter o namespace especificado, o nome do servi√ßo e a Default Key. O c√≥digo a seguir mostra como o consumo pode ser feito via ChannelFactory:</p>
<p><script src="https://gist.github.com/edneypitta/02832ee8fc50835b373b.js"></script></p>
<p>O m√©todo CreateSharedSecretTokenProvider se autentica no service bus pelo owner e a key, mas h√° outros mecanismos de autentica√ß√£o como SAML ou SimpleWebToken.</p>
<p>Isso √© tudo üôÇ<br />
O pr√≥ximo post ser√° sobre o objetivo 3.8, <strong><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-8-implement-messaging-patterns/">Implement messaging patterns</a></strong>.</p>
<p>At√© l√°!</p>

				<p><a class="btn btn-default read-more" href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-7-create-and-configure-a-wcf-service-on-windows-azure/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 3.7 ‚Äì Create and configure a WCF service on Windows Azure">Leia Mais</a></p>

							</div><!-- .entry-content -->
					</div>
	</div>
</article><!-- #post-## -->

			
				
<article id="post-456" class="post-456 post type-post status-publish format-standard hentry category-certificacao tag-70-487">
	<div class="blog-item-wrap">
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-6-version-a-wcf-service/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 3.6 ‚Äì Version a WCF service" >
			 				</a>
		<div class="post-inner-content">
			<header class="entry-header page-header">

				<h1 class="entry-title"><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-6-version-a-wcf-service/" rel="bookmark">Certifica√ß√£o Microsoft 70-487: Objetivo 3.6 ‚Äì Version a WCF service</a></h1>

								<div class="entry-meta">
					<span class="posted-on"><i class="fa fa-calendar"></i> <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-6-version-a-wcf-service/" rel="bookmark"><time class="entry-date published" datetime="2016-02-20T10:37:00+00:00">20/02/2016</time><time class="updated" datetime="2016-03-01T16:58:54+00:00">01/03/2016</time></a></span><span class="byline"> <i class="fa fa-user"></i> <span class="author vcard"><a class="url fn n" href="https://edneypitta.github.io/old-blog/author/admin/">Edney Pitta</a></span></span>				<span class="comments-link"><i class="fa fa-comment-o"></i><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-6-version-a-wcf-service/#comments"><span class="dsq-postid" data-dsqidentifier="456 https://edneypitta.github.io/old-blog/?p=456">1 Coment√°rio</span></a></span>
				
				
				</div><!-- .entry-meta -->
							</header><!-- .entry-header -->

						<div class="entry-content">

				<p>Ol√° pessoal!<br />
Continuando a s√©rie sobre a certifica√ß√£o Microsoft 70-487, esse post ser√° sobre o objetivo 3.6, Version a WCF service.<br />
Esse objetivo, que √© bem curto, cobre os conceitos sobre como versionar diferentes tipos de contratos e informa√ß√µes de bindings.</p>
<p>V√°rias mudan√ßas podem ocorrer no ciclo de vida de um servi√ßo WCF: no contrato, no endere√ßo (address), nos bindings, na implementa√ß√£o de algum m√©todo, etc. Essas mudan√ßar podem ser classificadas em <em>breaking changes</em> ou <em>Nonbreaking changes</em>.</p>
<p>H√° 2 tipos de versionamento: <em>strict </em>e <em>lax</em>.</p>
<p>O versionamento strict √© quando voc√™ tem um ou mais clients que n√£o toleram mudan√ßas no servi√ßo. Nesse caso, <strong>todas </strong>as mudan√ßas precisam levar isso em conta e voc√™ nunca deve modificar algum comportamento; apenas adicionar em outras vers√µes ou namespaces.</p>
<p>No versionamento lax, suportado pelo WCF e at√© web services .asmx, voc√™ pode fazer pequenas altera√ß√µes sem quebrar o contrato existente. √â poss√≠vel, por exemplo, adicionar um novo membro fazendo com que os dados sejam somente ignorados por clients antigos.</p>
<p>Esse objetivo √© bem conceitual e saber quando uma mudan√ßa vai quebrar ou n√£o um servi√ßo √© suficiente para o exame. Mudan√ßas no contrato s√£o breaking changes; adi√ß√µes no DataContract podem ser ignoradas por clients antigos e n√£o v√£o quebrar a funcionalidade.</p>
<p>E √© <strong>s√≥</strong> isso üôÇ<br />
O pr√≥ximo objetivo, tamb√©m curto, ser√° o <strong><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-7-create-and-configure-a-wcf-service-on-windows-azure/">Create and configure a WCF service on Windows Azure</a></strong>.</p>
<p>At√© l√°!</p>

				<p><a class="btn btn-default read-more" href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-6-version-a-wcf-service/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 3.6 ‚Äì Version a WCF service">Leia Mais</a></p>

							</div><!-- .entry-content -->
					</div>
	</div>
</article><!-- #post-## -->

			
				
<article id="post-441" class="post-441 post type-post status-publish format-standard hentry category-certificacao tag-70-487">
	<div class="blog-item-wrap">
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-5-consume-wcf-services/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 3.5 ‚Äì Consume WCF services" >
			 				</a>
		<div class="post-inner-content">
			<header class="entry-header page-header">

				<h1 class="entry-title"><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-5-consume-wcf-services/" rel="bookmark">Certifica√ß√£o Microsoft 70-487: Objetivo 3.5 ‚Äì Consume WCF services</a></h1>

								<div class="entry-meta">
					<span class="posted-on"><i class="fa fa-calendar"></i> <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-5-consume-wcf-services/" rel="bookmark"><time class="entry-date published" datetime="2016-02-20T09:54:44+00:00">20/02/2016</time><time class="updated" datetime="2016-03-01T16:58:06+00:00">01/03/2016</time></a></span><span class="byline"> <i class="fa fa-user"></i> <span class="author vcard"><a class="url fn n" href="https://edneypitta.github.io/old-blog/author/admin/">Edney Pitta</a></span></span>				<span class="comments-link"><i class="fa fa-comment-o"></i><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-5-consume-wcf-services/#respond"><span class="dsq-postid" data-dsqidentifier="441 https://edneypitta.github.io/old-blog/?p=441">Deixe um coment√°rio</span></a></span>
				
				
				</div><!-- .entry-meta -->
							</header><!-- .entry-header -->

						<div class="entry-content">

				<p>Ol√°!<br />
Hoje vamos falar sobre o objetivo 3.5 da certifica√ß√£o 70-487, <strong>Consume WCF services</strong>.<br />
Esse objetivo cobre como consumir um servi√ßo WCF de 3 formas: gerando classes proxy com Svcutil.exe, gerando classes proxy adicionando uma refer√™ncia ao servi√ßo e consumindo via ChannelFactory. Vamos l√°?</p>
<h2>Gerando Proxies Com Svcutil.exe</h2>
<p>√â poss√≠vel consumir servi√ßos WCF gerando uma classe proxy e interagindo com ela como se fosse uma classe comum, deixando o framework fazer toda a comunica√ß√£o por tr√°s.</p>
<p>O Svcutil.exe, uma ferramenta chamada pela linha de comando, √© uma das formas de gerar classes proxy de um servi√ßo WCF. √â poss√≠vel fazer a gera√ß√£o baseado em servi√ßos existentes ou metadata. </p>
<p>A ferramenta tamb√©m permite que voc√™ exporte metadata de um servi√ßo, valide c√≥digo de um servi√ßo, fa√ßa download dos metadatas de servi√ßos existentes e gere c√≥digo de serializa√ß√£o.</p>
<p>A melhor maneira de estudar para o exame √© criar alguns servi√ßos e gerar as proxies chamando o Svcutil.exe com op√ß√µes diferentes, analisando o que a ferramenta de fato faz. A lista abaixo traz as op√ß√µes importantes para o exame ao chamar a ferramenta pela linha de comando (atalhos est√£o entre par√™nteses):</p>
<ul>
<li><strong>/directory:&lt;directory&gt; (/d)</strong>: especifica o diret√≥rio em que os arquivos gerados ser√£o colocados. Se n√£o for especificado, o diret√≥rio atual ser√° usado. Caso o diret√≥rio j√° tenha sido usado, o Svcutil.exe ir√° sobrescrever os arquivos;</li>
<li><strong>/mergeConfig</strong>: caso o diret√≥rio j√° tenha sido usado, ao inv√©s de sobrescrever os arquivos, com essa op√ß√£o o Svcutil.exe ir√° fazer o merge das configura√ß√µes;</li>
<li><strong>/help (/?)</strong>: lista as op√ß√µes dispon√≠veis;</li>
<li><strong>/noLogo</strong>: tira as informa√ß√µes Logo (copyright e mensagem de banner);</li>
<li><strong>/svcutilConfig:&lt;configFile&gt;</strong>: coloca as configura√ß√µes no arquivo especificado. O default √© o App.config;</li>
<li><strong>/target:&lt;output type&gt; (/t)</strong>: instrui a ferramenta a criar um output espec√≠fico. As op√ß√µes s√£o <em>code</em>, <em>metadata</em> e <em>xmlSerializer</em>;</li>
<li><strong>/async (/a)</strong>: cria todos os m√©todos das classes proxy com a vers√£o normal e uma Async;</li>
<li><strong>/internal (/i)</strong>: cria todos os m√©todos das classes proxy como <em>internal</em>, e n√£o <em>public</em>;</li>
<li><strong>/serializer (/ser)</strong>: gera os tipos com um serializer espec√≠fico. As op√ß√µes s√£o <em>Auto</em>, <em>DataContractSerializer</em> e <em>XmlSerializer</em>;</li>
<li><strong>/out (/o)</strong>: especifica o nome do arquivo para o c√≥digo gerado;</li>
<li><strong>/language (/l)</strong>: especifica uma linguagem para o c√≥digo gerado. As op√ß√µes s√£o <em>c#</em>, <em>cs</em>, <em>csharp</em>, <em>vb</em>, <em>visualbasic</em>, <em>c++</em> e <em>cpp</em>.</li>
</ul>
<h2>Gerando Proxies Por Refer√™ncia</h2>
<p>Uma feature do Visual Studio √© a possibilidade de gerar classes proxy adicionando uma refer√™ncia a um servi√ßo.<br />
Basta clicar com o bot√£o direito no seu projeto e ir em Add Service Reference. A seguinte tela √© mostrada:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/21.png" alt="add service" width="574" height="466" class="alignnone size-full wp-image-446" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/21.png 574w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/21-300x244.png 300w" sizes="(max-width: 574px) 100vw, 574px" /></p>
<p>Voc√™ pode prover uma URL de um servi√ßo (com metadata habilitado) ou clicar no bot√£o Discover para encontrar services que est√£o na mesma solution. Ap√≥s clicar em Go, os servi√ßos s√£o listados e voc√™ pode especificar um namespace, o que √© recomendado.</p>
<p>Ao clicar em Advanced abaixo, a tela Service Reference Settings √© aberta:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/31.png" alt="service reference settings" width="590" height="607" class="alignnone size-full wp-image-448" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/31.png 590w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/31-292x300.png 292w" sizes="(max-width: 590px) 100vw, 590px" /></p>
<p>No topo voc√™ pode especificar o modificador de acesso e se m√©todos async devem ser gerados, como as op√ß√µes /internal e /async usando Svcutil.exe.<br />
A op√ß√£o Always Generate Message Contracts faz o que o nome diz, gera classes para os contratos.</p>
<p>Na se√ß√£o Data Type, voc√™ pode definir o tipo das cole√ß√µes. Nada te impede de usar generics (List&lt;T&gt;), mas geralmente arrays s√£o utilizados para manter a compatibilidade entre diferentes clients que n√£o sejam .NET.</p>
<p>A √∫ltima se√ß√£o, Compatibility, serve se voc√™ estiver consumindo um web service antigo <em>.asmx</em>. A tela Add Web Reference √© aberta:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/41.png" alt="add web reference" width="848" height="593" class="alignnone size-full wp-image-449" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/41.png 848w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/41-300x210.png 300w" sizes="(max-width: 848px) 100vw, 848px" /></p>
<h2>Criando E Implementando ChannelFactories</h2>
<p>A classe ChannelFactory serve para fazer comunica√ß√µes com endpoints de forma simples. Ela pode atuar em conjunto com o arquivo de configura√ß√£o da sua aplica√ß√£o, fazendo com que uma chamada a um servi√ßo tenha 2 linhas de c√≥digo.</p>
<p>A primeira coisa que voc√™ deve saber √© que a classe ChannelFactory trabalha com o contrato do servi√ßo, ent√£o voc√™ deve ter uma refer√™ncia √† interface que especifica o contrato.</p>
<h4>Construtores</h4>
<p>O construtor padr√£o n√£o aceita nenhum par√¢metro, ent√£o informa√ß√µes sobre o endpoint precisam ser especificadas: <code>new ChannelFactory<ITestService>()</code>.</p>
<p>O pr√≥ximo aceita uma string com o nome de configura√ß√£o do endpoint:</p>
<p><code>String endpointConfigName = "wsHttp_BindingConfig";<br />
ChannelFactory&lt;ITestService&gt; proxy = new ChannelFactory&lt;ITestService&gt;(endpointConfigName);</code></p>
<p>Outro aceita um binding, mas funciona da mesma forma:</p>
<p><code>String endpointConfigName = "wsHttp_BindingConfig";<br />
WSHttpBinding wSBinding = new WSHttpBinding(EndpointConfigName);<br />
ChannelFactory&lt;ITestService&gt; proxy = new ChannelFactory&lt;ITestService&gt;(wSBinding);</code></p>
<p>O pr√≥ximo aceita um ServiceEndpoint:</p>
<p><code>ServiceEndpoint endpoint = new ServiceEndpoint(new ContractDescription("Endpoint"));<br />
ChannelFactory&lt;ITestService&gt; proxy = new ChannelFactory&lt;ITestService&gt;(endpoint);</code></p>
<p>H√° outros construtores que s√£o bem intuitivos. Vamos a um cen√°rio real de uso da classe ChannelFactory, algo bem prov√°vel de conter pelo menos 1 quest√£o no exame:</p>
<p><script src="https://gist.github.com/edneypitta/d96af1c3b703d014e693.js"></script></p>
<p>O m√©todo CreateChannel inicializa a ChannelFactory, retornando o tipo do contrato especificado no construtor. Depois disso, basta chamar os m√©todos desejados que est√£o no contrato. Por fim, chame o m√©todo Close. Ele possui uma chamada padr√£o sem par√¢metros e uma recebendo um TimeSpan, onde voc√™ indica que se o canal n√£o for fechado nesse tempo uma exce√ß√£o √© lan√ßada.</p>
<p>Por √∫ltimo, √© importante destacar que com ChannelFactory voc√™ n√£o precisa da classe de defini√ß√£o do servi√ßo, apenas a interface do contrato.</p>
<p>Isso √© tudo para esse objetivo üôÇ<br />
Obrigado pela leitura e fique de olho no post do pr√≥ximo objetivo, <strong><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-6-version-a-wcf-service/">Version a WCF service</a></strong>.</p>
<p>At√© mais!</p>

				<p><a class="btn btn-default read-more" href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-5-consume-wcf-services/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 3.5 ‚Äì Consume WCF services">Leia Mais</a></p>

							</div><!-- .entry-content -->
					</div>
	</div>
</article><!-- #post-## -->

			
				
<article id="post-433" class="post-433 post type-post status-publish format-standard hentry category-certificacao tag-70-487">
	<div class="blog-item-wrap">
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-4-secure-a-wcf-service/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 3.4 ‚Äì Secure a WCF service" >
			 				</a>
		<div class="post-inner-content">
			<header class="entry-header page-header">

				<h1 class="entry-title"><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-4-secure-a-wcf-service/" rel="bookmark">Certifica√ß√£o Microsoft 70-487: Objetivo 3.4 ‚Äì Secure a WCF service</a></h1>

								<div class="entry-meta">
					<span class="posted-on"><i class="fa fa-calendar"></i> <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-4-secure-a-wcf-service/" rel="bookmark"><time class="entry-date published" datetime="2016-02-16T23:18:40+00:00">16/02/2016</time><time class="updated" datetime="2016-03-01T16:57:42+00:00">01/03/2016</time></a></span><span class="byline"> <i class="fa fa-user"></i> <span class="author vcard"><a class="url fn n" href="https://edneypitta.github.io/old-blog/author/admin/">Edney Pitta</a></span></span>				<span class="comments-link"><i class="fa fa-comment-o"></i><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-4-secure-a-wcf-service/#respond"><span class="dsq-postid" data-dsqidentifier="433 https://edneypitta.github.io/old-blog/?p=433">Deixe um coment√°rio</span></a></span>
				
				
				</div><!-- .entry-meta -->
							</header><!-- .entry-header -->

						<div class="entry-content">

				<p>O objetivo 3.4 do exame, <strong>Secure a WCF service</strong>, cobre as features de seguran√ßa que o WCF disponibiliza. Isso inclui 1) como implementar seguran√ßa no n√≠vel de mensagem, 2) como implementar seguran√ßa no n√≠vel de transporte e 3) como implementar <em>certificates</em>, que √© a combina√ß√£o dos itens anteriores. Vamos l√°?</p>
<h2>Implementando Seguran√ßa no N√≠vel de Mensagem</h2>
<p>Basicamente, implementar seguran√ßa no n√≠vel da mensagem √© &#8220;incrementar&#8221; as mensagens SOAP com 3 caracter√≠sticas CIA:</p>
<ul>
<li><strong>Confidencialidade</strong>: significa que somente as pessoas que devem ver uma mensagem s√£o as pessoas que de fato vejam a mensagem;</li>
<li><strong>Integridade</strong>: significa que a mensagem n√£o pode ser alterada;</li>
<li><strong>Autentica√ß√£o</strong>: garante a identidade de quem est√° vendo a mensagem.</li>
</ul>
<p>Isso significa que a mensagem n√£o √© visualizada sem a chave correspondente, mas o texto criptografado pode ser visto na rede.</p>
<p>Na maioria dos bindings, isso √© feito por padr√£o e roda transparentemente, sem interven√ß√£o do desenvolvedor. Voc√™ pode tamb√©m especificar via c√≥digo ou arquivo de configura√ß√£o.</p>
<p>Por c√≥digo, basta setar a propriedade Security.Mode do binding desejado, seja por construtor ou setando a propriedade manualmente:</p>
<p><code>// Set Security Mode to Message in Constructor<br />
WSHttpBinding WsHttpSecurity = new WSHttpBinding(SecurityMode.Message);</code></p>
<p><code>// Set the Security property manually<br />
WSHttpBinding wsHttpSecurity2 = new WSHttpBinding();<br />
wsHttpSecurity2.Security.Mode = SecurityMode.Message;</code></p>
<p>A propriedade Mode para o wsHttpBinding √© do tipo <strong>SecurityMode</strong>. Para o basicHttpBinding o tipo √© <strong>BasicHttpSecurityMode </strong>e para o netNamedPipeBinding √© <strong>NetNamedPipeSecurityMode</strong>.</p>
<p>√â poss√≠vel fazer essa configura√ß√£o no arquivo de configura√ß√£o pelo WCF Service Configuration Editor. Para cada binding configurado, h√° duas abas no editor: Binding e Security. Basta ir na aba Security e setar o Mode para Message:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/11.png" alt="security mode" width="686" height="494" class="alignnone size-full wp-image-435" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/11.png 686w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/11-300x216.png 300w" sizes="(max-width: 686px) 100vw, 686px" /></p>
<p>Se voc√™ for para o arquivo de configura√ß√£o, ver√° que nada foi adicionado pois o wsHttpBinding faz essa seguran√ßa por padr√£o. Contudo, √© poss√≠vel declarar tamb√©m explicitamente dessa forma:</p>
<p><code>&lt;wsHttpBinding&gt;<br />
 &lt;binding name=&quot;wsHttpBindingConfigSample&quot; &gt;<br />
 &lt;security mode=&quot;Message&quot;/&gt;<br />
 &lt;/binding&gt;<br />
 &lt;/wsHttpBinding&gt;</code></p>
<h2>Implementando Seguran√ßa no N√≠vel de Transporte</h2>
<p>Transporte seguro significa que todo o transporte √© criptografado, tornando dif√≠cil para um interceptor compreender a mensagem. Com isso, o texto da mensagem n√£o precisa ser criptografado; pode ser trafegado em plain text.</p>
<p>Implementar seguran√ßa no n√≠vel de transporte √© virtualmente id√™ntico ao item anterior. A diferen√ßa √© que, ao inv√©s de setar o Mode como Message, voc√™ deve escolher <strong>Transport </strong>ou <strong>TransportWithMessageCredential</strong></p>
<p>Seja via c√≥digo ou arquivo de configura√ß√£o, o funcionamento √© exatamente o mesmo.</p>
<h2>Implementando Certificates</h2>
<p>Para usar certificados, voc√™ precisa adicionar uma refer√™ncia a <em>System.Security.dll</em>. Com o certificado instalado, a configura√ß√£o no WCF √© bem simples. </p>
<p>Assumindo que voc√™ tenha um netHttpBinding configurado para o servi√ßo, basta sincronizar os elementos &lt;security&gt; e &lt;message&gt; para que o Mode da propriedade Security seja TransportWithMessageCredential e a propriedade ClientCredentialType da mensagem seja o certificado. </p>
<p>Ap√≥s essa configura√ß√£o, basta garantir que certificado est√° instalado no client, obter uma refer√™ncia a ele e adicion√°-lo na propriedade <em>Credentials.ClientCredentials.Certificate</em>:</p>
<p><code>var MyFactory = new ChannelFactory<ITestService>("*");<br />
MyFactory.Credentials.ClientCredentials.Certificate = X509.CurrentUser.My.SubjectDistinguishedName.Find("CN=CLIENT").FirstOrDefault();</code></p>
<p>Isso √© tudo para esse objetivo üôÇ O pr√≥ximo post ser√° sobre o objetivo 3.5, <strong><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-5-consume-wcf-services/">Consume WCF services</a></strong>.</p>
<p>At√© l√°!</p>

				<p><a class="btn btn-default read-more" href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-4-secure-a-wcf-service/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 3.4 ‚Äì Secure a WCF service">Leia Mais</a></p>

							</div><!-- .entry-content -->
					</div>
	</div>
</article><!-- #post-## -->

			
				
<article id="post-411" class="post-411 post type-post status-publish format-standard hentry category-certificacao tag-70-487">
	<div class="blog-item-wrap">
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-3-configure-wcf-services-by-using-the-api/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 3.3 ‚Äì Configure WCF services by using the API" >
			 				</a>
		<div class="post-inner-content">
			<header class="entry-header page-header">

				<h1 class="entry-title"><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-3-configure-wcf-services-by-using-the-api/" rel="bookmark">Certifica√ß√£o Microsoft 70-487: Objetivo 3.3 ‚Äì Configure WCF services by using the API</a></h1>

								<div class="entry-meta">
					<span class="posted-on"><i class="fa fa-calendar"></i> <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-3-configure-wcf-services-by-using-the-api/" rel="bookmark"><time class="entry-date published" datetime="2016-02-16T07:41:55+00:00">16/02/2016</time><time class="updated" datetime="2016-03-01T16:57:25+00:00">01/03/2016</time></a></span><span class="byline"> <i class="fa fa-user"></i> <span class="author vcard"><a class="url fn n" href="https://edneypitta.github.io/old-blog/author/admin/">Edney Pitta</a></span></span>				<span class="comments-link"><i class="fa fa-comment-o"></i><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-3-configure-wcf-services-by-using-the-api/#comments"><span class="dsq-postid" data-dsqidentifier="411 https://edneypitta.github.io/old-blog/?p=411">1 Coment√°rio</span></a></span>
				
				
				</div><!-- .entry-meta -->
							</header><!-- .entry-header -->

						<div class="entry-content">

				<p>O objetivo 3.3 da certifica√ß√£o Microsoft 70-487, Configure WCF services by using the API, trata dos mesmos aspectos do <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-2-configure-wcf-services-by-using-configuration-settings/">objetivo anterior</a>. A diferen√ßa √© que enquanto no objetivo 3.2 vimos como alterar as configura√ß√µes de um servi√ßo WCF via arquivo de configura√ß√£o, nesse vamos ver como fazer essas configura√ß√µes via c√≥digo, ou API. </p>
<h2>Configurando Comportamentos do Servi√ßo</h2>
<p>Como configuramos os behaviors no post anterior com ServiceBehaviors e EndpointBehaviors, podemos fazer as mesmas configura√ß√µes com os atributos <strong>ServiceBehaviorAttribute </strong>e <strong>OperationBehaviorAttribute</strong>.<br />
ServiceBehaviorAttribute √© do mesmo n√≠vel que ServiceContract, ent√£o os behaviors s√£o configurados no n√≠vel de servi√ßo e se aplicam ao servi√ßo inteiro. OperationBehaviorAttribute se equivale ao OperationContract, ou seja, a cada m√©todo do servi√ßo. </p>
<p>ServiceBehaviorAttribute n√£o pode decorar a interface do contrato, somente a implementa√ß√£o (classe). A lista das propriedades pode ser consultada na <a href="https://msdn.microsoft.com/pt-br/library/system.servicemodel.servicebehaviorattribute(v=vs.110).aspx" target="_blank">MSDN</a>.</p>
<p>Uma quest√£o prov√°vel de cair no exame √© sobre concorr√™ncia de ServiceContractAttribute e ServiceBehaviorAttribute. Por exemplo, ambas t√™m as propriedades Name e Namespace, resultando no seguinte cen√°rio:</p>
<p><code>[ServiceContract(<strong>Namespace</strong>="http://www.williamgryan.mobi/Books/70-487", <strong>Name</strong>="RandomText")]<br />
public interface ITestService{}<br />
[ServiceBehavior(<strong>Name</strong>="Test", <strong>Namespace</strong>="http://www.williamgryan.mobi/Books/70-487/Services")]<br />
public class TestService : ITestService<br />
{}</code></p>
<p>O resultado do envelope do request √© o seguinte:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/8.png" alt="request envelope" width="967" height="180" class="alignnone size-full wp-image-414" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/8.png 967w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/8-300x56.png 300w" sizes="(max-width: 967px) 100vw, 967px" /></p>
<p>Aqui o namespace (xmlns) √© o definido no ServiceContract. Note o que acontece no MetadataExchange, quando voc√™ adiciona uma refer√™ncia ao servi√ßo em um client, e no WSDL:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/9.png" alt="reference" width="600" height="486" class="alignnone size-full wp-image-415" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/9.png 600w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/9-300x243.png 300w" sizes="(max-width: 600px) 100vw, 600px" /></p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/10.png" alt="wsdl" width="978" height="483" class="alignnone size-full wp-image-416" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/10.png 978w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/10-300x148.png 300w" sizes="(max-width: 978px) 100vw, 978px" /></p>
<p>Isso mostra que o ServiceBehaviorAttribute seta os valores de Name e Namespace no elemento service dentro do WSDL. Quando definidos no ServiceContract, eles ficam no WSDL.</p>
<h2>Configurando Bindings</h2>
<p>Assim como no arquivo de configura√ß√£o, h√° v√°rios bindings dispon√≠veis para se configurar via API. Todos eles funcionam de forma quase id√™ntica, apenas com pequenas diferen√ßas. Vamos passar pelos 5 mais comuns, incluindo custom binding.</p>
<h4>BasicHttpBinding</h4>
<p>BasicHttpBinding √© o mais simples dos bindings dispon√≠veis. Funciona via HTTP, precisa da especifica√ß√£o do SOAP 1.1 e tem poucos recursos de seguran√ßa. Ele possui 3 construtores:</p>
<ul>
<li><strong>new BasicHttpBinding()</strong>: deixa o WCF lidar com os valores default de configura√ß√£o;</li>
<li><strong>new BasicHttpBinding(BasicHttpSecurityMode)</strong>: recebe um BasicHttpSecurityMode que tem os seguintes valores: None, Transport, Message e TransportCredentialOnly;</li>
<li><strong>new BasicHttpBinding(string)</strong>: recebe o nome de um binding no arquivo de configura√ß√£o.</li>
</ul>
<h4>wsHttpBinding</h4>
<p>Funciona via HTTP como o BasicHttpBinding, mas possui 2 principais vantagens: usa o padr√£o SOAP 1.2 e tem suporte ao padr√£o WS-*, que contempla features como Reliable Messaging, transa√ß√µes, comunica√ß√£o <em>duplex</em>, etc.</p>
<p>wsHttpBinding tem 4 construtores:</p>
<ul>
<li><strong>new WSHttpBinding()</strong>: deixa o WCF lidar com os valores default de configura√ß√£o;</li>
<li><strong>new WSHttpBinding(SecurityMode)</strong>: recebe um BasicHttpSecurityMode que tem os seguintes valores: None, Transport, Message e TransportWithMessageCredential;</li>
<li><strong>new WSHttpBinding(string)</strong>: recebe o nome de um binding no arquivo de configura√ß√£o;</li>
<li><strong>new WSHttpBinding(SecurityMode, bool)</strong>: recebe um SecurityMode e um bool que habilita ReliableSession</li>
</ul>
<h4>NetMsmqBinding</h4>
<p>Implementa√ß√£o quase id√™ntica √† de um wsHttpBinding. A diferen√ßa √© que usa o enum MsmqSecurityMode para op√ß√µes de seguran√ßa e n√£o h√° suporte para Reliable Messaging:</p>
<ul>
<li><strong>new NetMsmqBinding()</strong>: deixa o WCF lidar com os valores default de configura√ß√£o;</li>
<li><strong>new NetMsmqBinding(NetMsmqSecurityMode)</strong>: recebe um NetMsmqSecurityModeque tem os seguintes valores: Transport, Message, Both e None;</li>
<li><strong>new NetMsmqBinding(string)</strong>: recebe o nome de um binding no arquivo de configura√ß√£o.</li>
</ul>
<h4>NetNamedPipeBinding</h4>
<p>NetNamedPipeBinding √© usado para comunica√ß√£o entre servi√ßos na mesma m√°quina, tendo um grande n√≠vel de performance.</p>
<p>Como o NetMsmqBinding Implementa√ß√£o quase id√™ntica √† de um wsHttpBinding. A diferen√ßa √© que usa o enum MsmqSecurityMode para op√ß√µes de seguran√ßa e n√£o h√° suporte para Reliable Messaging:</p>
<ul>
<li><strong>new NetMsmqBinding()</strong>: deixa o WCF lidar com os valores default de configura√ß√£o;</li>
<li><strong>new NetMsmqBinding(NetMsmqSecurityMode)</strong>: recebe um NetMsmqSecurityModeque tem os seguintes valores: Transport, Message, Both e None;</li>
<li><strong>new NetMsmqBinding(string)</strong>: recebe o nome de um binding no arquivo de configura√ß√£o.</li>
</ul>
<h4>Custom Binding</h4>
<p>Para implementar um binding customizado, voc√™ pode usar um ou mais dos predefinidos e adicionar features ou implementar um exclusivo.</p>
<p>O elemento <em>&lt;customBinding&gt;</em> √© utilizado para se definir um binding customizado. H√° um processo a se seguir com ordem espec√≠fica:</p>
<ol>
<li>O item mais externo √© o <strong>TransactionFlowBindingElement</strong>. √â opcional, necess√°rio somente se voc√™ quiser suportar Flowing Transactions;</li>
<li><strong>ReliableSessionBindingElement</strong>, tamb√©m opcional, indica se Reliable Sessions devem ser suportadas;</li>
<li><strong>SecurityBindingElement</strong> define funcionalidades de seguran√ßa como autoriza√ß√£o, autentica√ß√£o, prote√ß√£o, confidencialidade, etc. Tamb√©m opcional;</li>
<li>O pr√≥ximo item da cadeia √© o <strong>CompositeDuplexBindingElement</strong>, caso comunica√ß√µes duplex sejam suportadas;</li>
<li>O elemento <strong>OneWayBindingElement</strong> pode ser usado se voc√™ quiser prover comunica√ß√µes OneWay para o servi√ßo;</li>
<li>Dois elementos podem ser implementados para prover Stream Security: <strong>SslStreamSecurityBindingElement </strong>e <strong>WindowsStreamSecurityBindingElement</strong>. Implementa√ß√£o opcional;</li>
<li>O pr√≥ximo item se trata do encoding da mensagem. Ao contr√°rio dos outros, esse √© obrigat√≥rio na implementa√ß√£o de um custom binding. H√° 3 encodings dispon√≠veis: <strong>TextMessageEncodingBindingElement</strong>, <strong>BinaryMessageEncodingBindingElement</strong>, e <strong>MtomMessageEncodingBindingElement</strong>;</li>
<li>O √∫ltimo e obrigat√≥rio item √© o elemento de transporte. H√° 8 op√ß√µes dispon√≠veis: <strong>TcpTransportBindingElement</strong>,  <strong>HttpTransportBindingElement</strong>, <strong>HttpsTransportBindingElement</strong>, <strong>NamedPipeTransportBindingElement</strong>, <strong>PeerTransportBindingElement</strong>, <strong>MsmqTransportBindingElement</strong>, <strong>MsmqIntegrationBindingElement </strong>e <strong>ConnectionOrientedTransportBindingElement</strong>.</li>
</ol>
<h2>Especificando Contratos</h2>
<p>Essa se√ß√£o √© uma revis√£o de como se define um servi√ßo WCF:</p>
<ul>
<li>Defina um contrato usando o atributo <strong>ServiceContract</strong>;</li>
<li>Defina as opera√ß√µes com o atributo <strong>OperationContract</strong>;</li>
<li>Defina as classes que ser√£o transportadas com os atributos <strong>DataContract </strong>e <strong>DataMember</strong>.</li>
</ul>
<p>Um ponto √© que o atributo ServiceContract pode ser definido tanto na classe de implementa√ß√£o quanto na interface, mas n√£o em ambas. Caso isso aconte√ßa, uma InvalidOperationException √© lan√ßada ao tentar referenciar esse servi√ßo. O mesmo ocorre com o atributo OperationContract.</p>
<p>O √∫ltimo detalhe √© que o construtor padr√£o do ServiceContract seta 3 propriedades: Name (com o nome da classe), Namespace (com &#8220;http://tempuri.org&#8221;) e ProtectionLevel para ProtectionLevelNone. √â recomend√°vel setar essas propriedades manualmente.</p>
<h2>Expondo Metadados</h2>
<p>Os atributos usados para se definir um servi√ßo (ServiceContract e OperationContract) n√£o exp√µem automaticamente os detalhes do servi√ßo (metadados). </p>
<p>Voc√™ pode fazer isso definindo endpoints de <em>metadata exchange</em>. Atualmente h√° 4 bindings dispon√≠veis: mexHttpBinding, mexHttpsBinding, mexNamedPipeBinding e mexTcpBinding (&#8220;mex&#8221; √© uma combina√ß√£o das palavras &#8220;metadata exchange&#8221;). </p>
<p>No arquivo de configura√ß√£o, isso ficaria assim:</p>
<p><code>&lt;endpoint address=&quot;&quot; binding=&quot;basicHttpBinding&quot; contract=&quot;Samples.WCF.Services.ITestService&quot; /&gt;<br />
&lt;endpoint address=&quot;mex&quot; binding=&quot;mexHttpBinding&quot; <strong>contract=&quot;IMetadataExchange&quot;</strong> /&gt;</code></p>
<p>Note que o atributo contract sempre usa a interface <strong>IMetadataExchange</strong>.</p>
<p>Para adicionar o endpoint de metadata exchange via API, voc√™ pode usar a classe <strong>MetadataExchangeBindings</strong>. Vamos assumir que voc√™ est√° definindo o seguinte ServiceHost:</p>
<p><code>String uriString = "http://yourhost/Samples.WCF.Services/TestService/";<br />
Uri[] baseAddresses = new Uri[]{new Uri(uriString)};<br />
ServiceHost hoster = new ServiceHost(typeof(TestService), baseAddresses);</code></p>
<p>A classe MetadataExchangeBindings tem um m√©todo Create para cada binding dispon√≠vel. Voc√™ adicionaria os endpoints assim:</p>
<ul>
<li>Hoster.AddServiceEndpoint(ServiceMetadataBehavior.MexContractName, MetadataExchangeBindings.<strong>CreateMexHttpBinding()</strong>, &#8220;mexBindingHttp&#8221;);</li>
<li>Hoster.AddServiceEndpoint(ServiceMetadataBehavior.MexContractName, MetadataExchangeBindings.<strong>CreateMexHttpsBinding()</strong>, &#8220;mexBindingHttps&#8221;);</li>
<li>Hoster.AddServiceEndpoint(ServiceMetadataBehavior.MexContractName, MetadataExchangeBindings.<strong>CreateMexTcpBinding()</strong>, &#8220;mexBindingTcp&#8221;);</li>
<li>Hoster.AddServiceEndpoint(ServiceMetadataBehavior.MexContractName, MetadataExchangeBindings.<strong>CreateMexNamedPipeBinding()</strong>, &#8220;mexBindingPipe&#8221;).</li>
</ul>
<p><em>ServiceMetadataBehavior.MexContractName</em> √© apenas uma constante com o nome da interface IMetadataExchange.</p>
<p>Chegamos ao fim desse objetivo üôÇ<br />
Obrigado pela leitura e fique de olho no post do pr√≥ximo objetivo, <strong><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-4-secure-a-wcf-service/">Secure a WCF service</a></strong>.</p>
<p>At√© mais! </p>

				<p><a class="btn btn-default read-more" href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-3-configure-wcf-services-by-using-the-api/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 3.3 ‚Äì Configure WCF services by using the API">Leia Mais</a></p>

							</div><!-- .entry-content -->
					</div>
	</div>
</article><!-- #post-## -->

			
				
<article id="post-395" class="post-395 post type-post status-publish format-standard hentry category-certificacao tag-70-487">
	<div class="blog-item-wrap">
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-2-configure-wcf-services-by-using-configuration-settings/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 3.2 ‚Äì Configure WCF services by using configuration settings" >
			 				</a>
		<div class="post-inner-content">
			<header class="entry-header page-header">

				<h1 class="entry-title"><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-2-configure-wcf-services-by-using-configuration-settings/" rel="bookmark">Certifica√ß√£o Microsoft 70-487: Objetivo 3.2 ‚Äì Configure WCF services by using configuration settings</a></h1>

								<div class="entry-meta">
					<span class="posted-on"><i class="fa fa-calendar"></i> <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-2-configure-wcf-services-by-using-configuration-settings/" rel="bookmark"><time class="entry-date published" datetime="2016-02-08T14:37:17+00:00">08/02/2016</time><time class="updated" datetime="2016-03-01T16:57:19+00:00">01/03/2016</time></a></span><span class="byline"> <i class="fa fa-user"></i> <span class="author vcard"><a class="url fn n" href="https://edneypitta.github.io/old-blog/author/admin/">Edney Pitta</a></span></span>				<span class="comments-link"><i class="fa fa-comment-o"></i><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-2-configure-wcf-services-by-using-configuration-settings/#respond"><span class="dsq-postid" data-dsqidentifier="395 https://edneypitta.github.io/old-blog/?p=395">Deixe um coment√°rio</span></a></span>
				
				
				</div><!-- .entry-meta -->
							</header><!-- .entry-header -->

						<div class="entry-content">

				<p>V√°rios comportamentos importantes de um servi√ßo WCF podem ser configurados por arquivos de configura√ß√µes. Esses arquivos s√£o muito √∫teis na constru√ß√£o de uma aplica√ß√£o, seja web ou WCF. Voc√™ pode controlar quase qualquer aspecto de um servi√ßo sem a necessidade de rebuildar e redeployar a aplica√ß√£o. O objetivo 3.2, Configure WCF services by using configuration settings, mostra que o exame vai cobrar conhecimentos sobre as poss√≠veis configura√ß√µes e como manipul√°-las, no formato de drag and drop. Vamos l√°?</p>
<h2>Configurando Comportamentos do Servi√ßo</h2>
<p>O Visual Studio oferece uma ferramenta chamada <strong>WCF Service Configuration Editor</strong>, dispon√≠vel no menu Tools. Ela permite a manipula√ß√£o de arquivos de configura√ß√£o visualmente, suportando at√© a cria√ß√£o de servi√ßos. Segue abaixo o guia b√°sico da cria√ß√£o e configura√ß√£o de um servi√ßo WCF:</p>
<h4>Criando Um Servi√ßo</h4>
<p>Voc√™ pode escolher a op√ß√£o Create a New Service, se ainda n√£o tiver um servi√ßo criado:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/1.png" alt="create a new service" width="787" height="577" class="aligncenter size-full wp-image-397" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/1.png 787w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/1-300x220.png 300w" sizes="(max-width: 787px) 100vw, 787px" /></p>
<p>A primeira coisa que o wizard faz √© adicionar um elemento <system.ServiceModel> e um <services> no arquivo de configura√ß√£o. Depois, apresenta a p√°gina New Service Element Wizard para voc√™ selecionar o assembly que cont√©m o servi√ßo:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/2.png" alt="select assembly" width="624" height="513" class="alignnone size-full wp-image-398" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/2.png 624w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/2-300x247.png 300w" sizes="(max-width: 624px) 100vw, 624px" /></p>
<p>Ap√≥s especificar o servi√ßo, voc√™ precisa especificar os contratos correspondentes:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/3.png" alt="select contract" width="613" height="505" class="alignnone size-full wp-image-399" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/3.png 613w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/3-300x247.png 300w" sizes="(max-width: 613px) 100vw, 613px" /></p>
<p>Depois, o wizard prossegue para a defini√ß√£o da comunica√ß√£o do servi√ßo:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/4.png" alt="select communication mode" width="627" height="518" class="alignnone size-full wp-image-400" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/4.png 627w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/4-300x248.png 300w" sizes="(max-width: 627px) 100vw, 627px" /></p>
<p>Depois, o modo de interoperabilidade (b√°sica ou avan√ßada):</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/5.png" alt="select interoperability" width="627" height="520" class="alignnone size-full wp-image-401" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/5.png 627w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/5-300x249.png 300w" sizes="(max-width: 627px) 100vw, 627px" /></p>
<p>Por √∫ltimo, o wizard pede o endere√ßo do endpoint e apresenta uma p√°gina que sumariza todas as informa√ß√µes dadas. O importante aqui √© como o arquivo de configura√ß√£o ficou ap√≥s esses passos:</p>
<p><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;<br />
&lt;configuration&gt;<br />
 &lt;system.serviceModel&gt;<br />
 &lt;services&gt;<br />
 &lt;service name=&quot;Samples.WCF.Services.TestService&quot;&gt;<br />
 &lt;endpoint address=http://www.williamgryan.mobi/samples/487<br />
 binding=&quot;wsDualHttpBinding&quot; bindingConfiguration=&quot;&quot; name=&quot;DualHttp&quot;<br />
 contract=&quot;Samples.WCF.Services.ITestService&quot; /&gt;<br />
 &lt;/service&gt;<br />
 &lt;/services&gt;<br />
 &lt;/system.serviceModel&gt;<br />
&lt;/configuration&gt;</code></p>
<p>Voc√™ pode notar, pelo nome do nodo <strong>services</strong>, que mais de um servi√ßo pode ser especificado no mesmo projeto WCF. O atributo <strong>Name</strong> √© o tipo (classe) do servi√ßo, e ele precisa ser encontrado no caminho especificado. No elemento <strong>endpoint</strong>, o ABC √© inclu√≠do: address, binding e contract.</p>
<h2>Expondo Metadados</h2>
<p>Endpoints de metadados come√ßam com o prefixo <strong>mex</strong>, abrevia√ß√£o para <strong>metadata exchange</strong>. Atualmente h√° quatro tipos de endpoints: <em>mexHttpBinding</em>, <em>mexHttpsBinding</em>, <em>mexNamedPipeBinding</em> e <em>mexMsmqBinding</em>. Cada um corresponde para o binding do servi√ßo, mas voc√™ pode expor todos se necess√°rio.</p>
<p>Vamos alterar o servi√ßo acima para o binding wsHttpBinding e adicionar um endpoint de metadados mexHttpBinding. O XML de configura√ß√£o ficaria assim:</p>
<p><code>&lt;service name=&quot;Samples.WCF.Services.TestService&quot;&gt;<br />
 &lt;endpoint address=&quot;http://www.williamgryan.mobi/samples/487&quot;<br />
 binding=&quot;wsHttpBinding&quot; bindingConfiguration=&quot;&quot; name=&quot;WsHttp&quot;<br />
 contract=&quot;Samples.WCF.Services.ITestService&quot; /&gt;<br />
<strong> &lt;endpoint binding=&quot;mexHttpBinding&quot; bindingConfiguration=&quot;&quot;<br />
 name=&quot;Mex&quot; contract=&quot;IMetadataExchange&quot; /&gt;</strong><br />
</service></code></p>
<p>Com isso, a troca de metados est√° habilitada, permitindo que os clients vejam o WSDL para obter informa√ß√µes do servi√ßo.</p>
<h2>Configurando ServiceBehaviors e EndpointBehaviors</h2>
<p>Voc√™ especificar comportamentos (behaviors) espec√≠ficos que habilitam op√ß√µes avan√ßadas de seguran√ßa ou performance, por exemplo. EndpointBehaviors habilitam a configura√ß√£o dos endpoints, como clientCredentials, o batch de transa√ß√£o, o serializer do DataContract, e muito mais. ServiceBehaviors controlam aspectos do servi√ßo em um n√≠vel granular.</p>
<p>Usando o WCF Service Configuration Editor, basta ir para o nodo Advanced, depois Service Behaviors ou Endpoint Behaviors e adicionar um novo behavior. A tela seguintes mostra uma lista dos behaviors dispon√≠veis:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/6.png" alt="select behaviors" width="432" height="579" class="alignnone size-full wp-image-403" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/6.png 432w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/6-224x300.png 224w" sizes="(max-width: 432px) 100vw, 432px" /></p>
<p>Basta selecionar os behaviors desejados e clicar em Add. O XML ficar√° parecido com o seguinte:</p>
<p><code>&lt;system.serviceModel&gt;<br />
 <strong>&lt;behaviors&gt;<br />
 &lt;serviceBehaviors&gt;<br />
 &lt;behavior name=&quot;Debug&quot;&gt;<br />
 &lt;serviceDebug /&gt;<br />
 &lt;/behavior&gt;<br />
 &lt;/serviceBehaviors&gt;<br />
 &lt;/behaviors&gt;</strong><br />
 &lt;services&gt;<br />
 &lt;service <strong>behaviorConfiguration=&quot;Debug&quot;</strong> name=&quot;Samples.WCF.Services.<br />
TestService&quot;&gt;<br />
 &lt;endpoint address=http://www.williamgryan.mobi/samples/487<br />
 binding=&quot;wsHttpBinding&quot; bindingConfiguration=&quot;&quot; name=&quot;WsHttp&quot;<br />
 contract=&quot;Samples.WCF.Services.ITestService&quot; /&gt;<br />
 &lt;endpoint binding=&quot;mexHttpBinding&quot; bindingConfiguration=&quot;&quot; name=&quot;Mex&quot;<br />
 contract=&quot;IMetadataExchange&quot; /&gt;<br />
 &lt;/service&gt;<br />
 &lt;/services&gt;<br />
&lt;/system.serviceModel&gt;</code></p>
<p>O link entre o behavior configurado e o servi√ßo est√° no atributo behaviorConfiguration do service, conforme destacado acima.</p>
<p>Outro item prov√°vel de cair no exame √© o ProtocolMapping. Esse elemento permite que voc√™ relacione bindings aos protocolos de transporte:</p>
<p><code>&lt;protocolMapping&gt;<br />
 &lt;add scheme=&quot;http&quot; binding=&quot;basicHttpBinding&quot;/&gt;<br />
 &lt;add scheme=&quot;net.tcp&quot; binding=&quot;netTcpBinding&quot;/&gt;<br />
 &lt;add scheme=&quot;net.pipe&quot; binding=&quot;netNamedPipeBinding&quot;/&gt;<br />
 &lt;add scheme=&quot;net.msmq&quot; binding=&quot;netMsmqBinding&quot;/&gt;<br />
&lt;/protocolMapping&gt;</code></p>
<p>Isso pode ser feito tanto nos arquivos app.config de cada servi√ßo quanto no arquivo geral da m√°quina de host, o machine.config.</p>
<h2>Configurando Bindings</h2>
<p>Ainda no WCF Service Configuration Editor, √© poss√≠vel configurar bindings. A tela Create a New Binding lista todas as op√ß√µes poss√≠veis:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/7.png" alt="select binding" width="294" height="434" class="alignnone size-full wp-image-406" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/7.png 294w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/7-203x300.png 203w" sizes="(max-width: 294px) 100vw, 294px" /></p>
<p>Ap√≥s criar um wsHttpBinding, √© necess√°rio definir um ProtocolMapping para o protocolo wsHttp. √â poss√≠vel fazer isso selecionando o nodo Protocol Mapping, clicando em New, e informando o Scheme (wsHttp), o Binding (wsHttpBinding) e o Binding Configuration, com o nome do binding criado anteriormente. A configura√ß√£o no XML ficaria assim:</p>
<p><code>&lt;protocolMapping&gt;<br />
 &lt;add scheme=&quot;wsHttp&quot; binding=&quot;wsHttpBinding&quot;<br />
 bindingConfiguration=&quot;wsHttpBindingConfigSample&quot; /&gt;<br />
&lt;/protocolMapping&gt;<br />
&lt;bindings&gt;<br />
 &lt;wsHttpBinding&gt;<br />
 &lt;binding name=&quot;wsHttpBindingConfigSample&quot; /&gt;<br />
 &lt;/wsHttpBinding&gt;<br />
&lt;/bindings&gt;</code></p>
<p>Nesse caso, configuramos o protocolo wsHttp pelo Protocol Mapping para responder nesse binding. Um cen√°rio mais real seria editar um protocolo j√° configurado por padr√£o para responder no nosso binding criado. </p>
<p>Vamos fazer isso com o protocolo http. Pelo editor, basta ir em Protocol Mapping, selecionar o Scheme http e Edit. Ap√≥s configurar para o nosso binding (wsHttpBinding), o arquivo de configura√ß√£o ficar√° assim:</p>
<p><code>&lt;protocolMapping&gt;<br />
 &lt;remove scheme=&quot;http&quot; /&gt;<br />
 &lt;add scheme=&quot;http&quot; binding=&quot;wsHttpBinding&quot;<br />
 bindingConfiguration=&quot;wsHttpBindingConfigSample&quot; /&gt;<br />
&lt;/protocolMapping&gt;</code></p>
<p>Isso √© tudo para esse objetivo üôÇ<br />
Para o exame, certifique-se de olhar os exemplos em XML acima e memorizar os atributos poss√≠veis para cada elemento.</p>
<p>O pr√≥ximo post ser√° sobre o objetivo 3.3, <strong><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-3-configure-wcf-services-by-using-the-api/">Configure WCF services by using the API</a></strong>.<br />
At√© l√°!</p>

				<p><a class="btn btn-default read-more" href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-2-configure-wcf-services-by-using-configuration-settings/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 3.2 ‚Äì Configure WCF services by using configuration settings">Leia Mais</a></p>

							</div><!-- .entry-content -->
					</div>
	</div>
</article><!-- #post-## -->

			
				<nav class="navigation paging-navigation" role="navigation">
		<h1 class="screen-reader-text">Navega√ß√£o de Posts</h1>
		<div class="nav-links">

						<div class="nav-previous"> <a href="https://edneypitta.github.io/old-blog/2016/02/page/2/" ><i class="fa fa-chevron-left"></i> Anteriores</a></div>
			
			
		</div><!-- .nav-links -->
	</nav><!-- .navigation -->
	
		
		</main><!-- #main -->
	</section><!-- #primary -->

</div>
	<div id="secondary" class="widget-area col-sm-12 col-md-4" role="complementary">
		<div class="well">
						<aside id="text-3" class="widget widget_text">			<div class="textwidget"><a href="https://edneypitta.github.io/old-blog/sobre/"><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2015/08/IMG-20150829-WA00012-e1440915174271-150x150.jpg"  width="150" height="150" class="aligncenter size-thumbnail wp-image-93" style="border-radius: 80px;" />
<h2 style="text-align:center;">Edney Pitta</h2></a>
<div style="text-align: center;">Desenvolvedor de Software @ Lambda3</div>
<div style="margin-top:20px;text-align:center;"><a href="https://edneypitta.github.io/old-blog/sobre/"><button class="btn btn-danger btn-lg " >SOBRE MIM</button></a></div></div>
		</aside><aside id="search-2" class="widget widget_search">
<form role="search" method="get" class="form-search" action="https://edneypitta.github.io/old-blog/">
  <div class="input-group">
  	<label class="screen-reader-text" for="s">Search for:</label>
    <input type="text" class="form-control search-query" placeholder="Procurar&hellip;" value="" name="s" title="Search for:" />
    <span class="input-group-btn">
      <button type="submit" class="btn btn-default" name="submit" id="searchsubmit" value="Search"><span class="glyphicon glyphicon-search"></span></button>
    </span>
  </div>
</form></aside>		<aside id="recent-posts-3" class="widget widget_recent_entries">		<h3 class="widget-title">Posts recentes</h3>		<ul>
					<li>
				<a href="https://edneypitta.github.io/old-blog/migrando-um-projeto-asp-net-core-rc-1-para-rc-2/">Migrando um projeto ASP.NET Core RC 1 para RC 2</a>
						</li>
					<li>
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-486-developing-asp-net-mvc-web-applications/">Certifica√ß√£o Microsoft 70-486: Developing ASP.NET MVC Web Applications</a>
						</li>
					<li>
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-480-programming-in-html5-with-javascript-and-css3/">Certifica√ß√£o Microsoft 70-480: Programming in HTML5 with JavaScript and CSS3</a>
						</li>
					<li>
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-resultado/">Certifica√ß√£o Microsoft 70-487 &#8211; Resultado</a>
						</li>
					<li>
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-6-share-assemblies-between-multiple-applications-and-servers/">Certifica√ß√£o Microsoft 70-487: Objetivo 5.6 ‚Äì Share assemblies between multiple applications and servers</a>
						</li>
				</ul>
		</aside>		<aside id="annual_archive_widget-2" class="widget Annual_Archive_Widget"><h3 class="widget-title">Arquivo</h3>	<ul>
		<li><a href='https://edneypitta.github.io/old-blog/2016/06/'>junho 2016</a>&nbsp;(1)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2016/05/'>maio 2016</a>&nbsp;(1)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2016/04/'>abril 2016</a>&nbsp;(1)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2016/03/'>mar√ßo 2016</a>&nbsp;(10)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2016/02/'>fevereiro 2016</a>&nbsp;(11)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2016/01/'>janeiro 2016</a>&nbsp;(10)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2015/12/'>dezembro 2015</a>&nbsp;(3)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2015/11/'>novembro 2015</a>&nbsp;(3)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2015/10/'>outubro 2015</a>&nbsp;(1)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2015/09/'>setembro 2015</a>&nbsp;(5)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2015/08/'>agosto 2015</a>&nbsp;(2)</li>
	</ul>
	</aside>		</div>
	</div><!-- #secondary -->
			</div><!-- close .*-inner (main-content or sidebar, depending if sidebar is used) -->
		</div><!-- close .row -->
	</div><!-- close .container -->
</div><!-- close .site-content -->

	<div id="footer-area">
		<div class="container footer-inner">
			<div class="row">
				
				</div>
		</div>

		<footer id="colophon" class="site-footer" role="contentinfo">
			<div class="site-info container">
				<div class="row">
										<nav role="navigation" class="col-md-6">
						<ul id="menu-social-1" class="nav footer-nav clearfix"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-20"><a href="https://br.linkedin.com/in/edneypitta"><i class="fa fa-linkedin-square"></i></a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-22"><a href="https://www.facebook.com/edneypitta"><i class="fa fa-facebook-square"></i></a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-23"><a href="https://twitter.com/edneypitta"><i class="fa fa-twitter-square"></i></a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-24"><a href="https://edneypitta.github.io/old-blog/feed/"><i class="fa fa-rss"></i></a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-27"><a href="https://edneypitta.github.io/old-blog/sobre/"><i class="fa fa-info-circle"></i></a></li>
</ul>					</nav>
					<div class="copyright col-md-6">
						<a rel="license" href="http://creativecommons.org/licenses/by/2.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/2.0/80x15.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/2.0/">Creative Commons Attribution 2.0 Generic License</a>.						Theme by <a href="http://colorlib.com/" target="_blank">Colorlib</a> Powered by <a href="http://wordpress.org/" target="_blank">WordPress</a>					</div>
				</div>
			</div><!-- .site-info -->
			<div class="scroll-to-top"><i class="fa fa-angle-up"></i></div><!-- .scroll-to-top -->
		</footer><!-- #colophon -->
	</div>
</div><!-- #page -->

<script type='text/javascript' src='https://edneypitta.github.io/old-blog/wp-content/themes/sparkling/inc/js/skip-link-focus-fix.js?ver=20140222'></script>
<script type='text/javascript' src='https://edneypitta.github.io/old-blog/wp-includes/js/wp-embed.min.js?ver=4.8.2'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var countVars = {"disqusShortname":"edneypitta"};
/* ]]> */
</script>
<script type='text/javascript' src='https://edneypitta.github.io/old-blog/wp-content/plugins/disqus-comment-system/media/js/count.js?ver=4.8.2'></script>

</body>
</html>