<!doctype html>
	<!--[if !IE]>
	<html class="no-js non-ie" lang="pt-BR" prefix="og: http://ogp.me/ns#"> <![endif]-->
	<!--[if IE 7 ]>
	<html class="no-js ie7" lang="pt-BR" prefix="og: http://ogp.me/ns#"> <![endif]-->
	<!--[if IE 8 ]>
	<html class="no-js ie8" lang="pt-BR" prefix="og: http://ogp.me/ns#"> <![endif]-->
	<!--[if IE 9 ]>
	<html class="no-js ie9" lang="pt-BR" prefix="og: http://ogp.me/ns#"> <![endif]-->
	<!--[if gt IE 9]><!-->
<html class="no-js" lang="pt-BR" prefix="og: http://ogp.me/ns#"> <!--<![endif]-->
<head>
<base href="https://edneypitta.github.io/old-blog" />

<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1">



<title>Edney Pitta - P√°gina 3 de 5 - Descomplicando a Carreira de Programador</title>

<!-- This site is optimized with the Yoast SEO plugin v3.0.7 - https://yoast.com/wordpress/plugins/seo/ -->
<meta name="description" content="O blog Edney Pitta - Descomplicando a Carreira de Programador vai te ajudar a saber onde voc√™ est√° na sua carreira, quais s√£o suas atuais op√ß√µes e como elas v√£o impactar seu futuro."/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="https://edneypitta.github.io/old-blog/page/3/" />

<link rel="next" href="https://edneypitta.github.io/old-blog/page/4/" />
<meta property="og:locale" content="pt_BR" />
<meta property="og:type" content="website" />
<meta property="og:title" content="Edney Pitta" />
<meta property="og:description" content="Descomplicando a Carreira de Programador" />
<meta property="og:url" content="https://edneypitta.github.io/old-blog/page/3/" />
<meta property="og:site_name" content="Edney Pitta" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:description" content="O blog Edney Pitta - Descomplicando a Carreira de Programador vai te ajudar a saber onde voc√™ est√° na sua carreira, quais s√£o suas atuais op√ß√µes e como elas v√£o impactar seu futuro."/>
<meta name="twitter:title" content="Edney Pitta - P√°gina 3 de 5 - Descomplicando a Carreira de Programador"/>
<meta name="twitter:site" content="@edneypitta"/>
<script type='application/ld+json'>{"@context":"http:\/\/schema.org","@type":"WebSite","url":"http:\/\/edneypitta.github.io\/","name":"Edney Pitta","alternateName":"Descomplicando a Carreira de Programador","potentialAction":{"@type":"SearchAction","target":"http:\/\/edneypitta.github.io\/?s={search_term_string}","query-input":"required name=search_term_string"}}</script>
<script type='application/ld+json'>{"@context":"http:\/\/schema.org","@type":"Person","url":"http:\/\/edneypitta.github.io","sameAs":["https:\/\/www.facebook.com\/edneypitta","https:\/\/br.linkedin.com\/in\/edneypitta","https:\/\/twitter.com\/edneypitta"],"name":"Edney Pitta"}</script>
<!-- / Yoast SEO plugin. -->

<link rel='dns-prefetch' href='//fonts.googleapis.com' />
<link rel='dns-prefetch' href='//s.w.org' />


		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/svg\/","svgExt":".svg","source":{"concatemoji":"http:\/\/edneypitta.github.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.8.2"}};
			!function(a,b,c){function d(a){var b,c,d,e,f=String.fromCharCode;if(!k||!k.fillText)return!1;switch(k.clearRect(0,0,j.width,j.height),k.textBaseline="top",k.font="600 32px Arial",a){case"flag":return k.fillText(f(55356,56826,55356,56819),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,56826,8203,55356,56819),0,0),c=j.toDataURL(),b!==c&&(k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447),0,0),c=j.toDataURL(),b!==c);case"emoji4":return k.fillText(f(55358,56794,8205,9794,65039),0,0),d=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55358,56794,8203,9794,65039),0,0),e=j.toDataURL(),d!==e}return!1}function e(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i,j=b.createElement("canvas"),k=j.getContext&&j.getContext("2d");for(i=Array("flag","emoji4"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='sparkling-bootstrap-css'  href='https://edneypitta.github.io/old-blog/wp-content/themes/sparkling/inc/css/bootstrap.min.css?ver=4.8.2' type='text/css' media='all' />
<link rel='stylesheet' id='sparkling-icons-css'  href='https://edneypitta.github.io/old-blog/wp-content/themes/sparkling/inc/css/font-awesome.min.css?ver=4.8.2' type='text/css' media='all' />
<link rel='stylesheet' id='sparkling-fonts-css'  href='//fonts.googleapis.com/css?family=Open+Sans%3A400italic%2C400%2C600%2C700%7CRoboto+Slab%3A400%2C300%2C700&#038;ver=4.8.2' type='text/css' media='all' />
<link rel='stylesheet' id='sparkling-style-css'  href='https://edneypitta.github.io/old-blog/wp-content/themes/sparkling/style.css?ver=4.8.2' type='text/css' media='all' />
<script type='text/javascript' src='https://edneypitta.github.io/old-blog/wp-includes/js/jquery/jquery.js?ver=1.12.4'></script>
<script type='text/javascript' src='https://edneypitta.github.io/old-blog/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<script type='text/javascript' src='https://edneypitta.github.io/old-blog/wp-content/themes/sparkling/inc/js/modernizr.min.js?ver=4.8.2'></script>
<script type='text/javascript' src='https://edneypitta.github.io/old-blog/wp-content/themes/sparkling/inc/js/bootstrap.min.js?ver=4.8.2'></script>
<script type='text/javascript' src='https://edneypitta.github.io/old-blog/wp-content/themes/sparkling/inc/js/functions.min.js?ver=4.8.2'></script>
<link rel='https://api.w.org/' href='https://edneypitta.github.io/old-blog/wp-json/' />

 

<script data-cfasync="false" src="//load.sumome.com/" data-sumo-site-id="025f16b2b72012bef5c86b74ea4d0bd0652e8245a2df8c61ed302458c0f98f3b" async></script><style type="text/css">.entry-content {font-family: Open Sans; font-size:14px; font-weight: normal; color:#6B6B6B;}.navbar > .container .navbar-brand {
font-size: 35px;
margin-top: 7px;
}

#menu-social i{
font-size:17px;
}
#menu-social-1 i {
font-size:22px;
}

article ul {
    list-style: none;
    padding:0;
    margin:0;
margin-bottom: 10px;
}

article li { 
    padding-left: 1em; 
    text-indent: -.7em;
}

article li:before {
    content: "\2022";
    color: rgb(191, 66, 78); 
padding-right:7px;
font-size: 15px;
}

#logo {
margin: 10px 0px;
}

.textwidget a:hover h2{
color:#c9302c;
}</style>	<style type="text/css">
			.navbar > .container .navbar-brand {
			color: #ffffff;
		}
		</style>
	<link rel="icon" href="https://edneypitta.github.io/old-blog/wp-content/uploads/2015/08/cropped-cropped-edneypitta-oficialissimo-fundo-branco-32x32.png" sizes="32x32" />
<link rel="icon" href="https://edneypitta.github.io/old-blog/wp-content/uploads/2015/08/cropped-cropped-edneypitta-oficialissimo-fundo-branco-192x192.png" sizes="192x192" />
<link rel="apple-touch-icon-precomposed" href="https://edneypitta.github.io/old-blog/wp-content/uploads/2015/08/cropped-cropped-edneypitta-oficialissimo-fundo-branco-180x180.png" />
<meta name="msapplication-TileImage" content="https://edneypitta.github.io/old-blog/wp-content/uploads/2015/08/cropped-cropped-edneypitta-oficialissimo-fundo-branco-270x270.png" />

<script type="text/javascript">
jQuery(document).ready(function()
{
jQuery('.fa-linkedin-square').parent().attr('target', '_blank').attr('title', 'LinkedIn');
jQuery('.fa-facebook-square').parent().attr('target', '_blank').attr('title', 'Facebook');
jQuery('.fa-twitter-square').parent().attr('target', '_blank').attr('title', 'Twitter');
jQuery('.fa-rss').parent().attr('target', '_blank').attr('title', 'RSS');

jQuery('.fa-info-circle').parent().attr('title', 'Sobre');
});
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-66613004-1', 'auto');
  ga('send', 'pageview');

</script>
</head>

<body class="home blog paged paged-3">
<div id="page" class="hfeed site">

	<header id="masthead" class="site-header" role="banner">
		<nav class="navbar navbar-default" role="navigation">
			<div class="container">
				<div class="row">
					<div class="site-navigation-inner col-sm-12">
						<div class="navbar-header">
							<button type="button" class="btn navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
								<span class="sr-only">Toggle navigation</span>
								<span class="icon-bar"></span>
								<span class="icon-bar"></span>
								<span class="icon-bar"></span>
							</button>

							
							<div id="logo">
								<a href="https://edneypitta.github.io/old-blog/"><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2015/08/cropped-edneypitta-oficialissimo-fundo-branco.png"  height="84" width="411" alt="Edney Pitta"/></a>
							</div><!-- end of #logo -->

							
							
						</div>
						<div class="collapse navbar-collapse navbar-ex1-collapse"><ul id="menu-social" class="nav navbar-nav"><li id="menu-item-20" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-20"><a title="&lt;i class=&quot;fa fa-linkedin-square&quot;&gt;&lt;/i&gt;" href="https://br.linkedin.com/in/edneypitta"><i class="fa fa-linkedin-square"></i></a></li>
<li id="menu-item-22" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-22"><a title="&lt;i class=&quot;fa fa-facebook-square&quot;&gt;&lt;/i&gt;" href="https://www.facebook.com/edneypitta"><i class="fa fa-facebook-square"></i></a></li>
<li id="menu-item-23" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-23"><a title="&lt;i class=&quot;fa fa-twitter-square&quot;&gt;&lt;/i&gt;" href="https://twitter.com/edneypitta"><i class="fa fa-twitter-square"></i></a></li>
<li id="menu-item-24" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-24"><a title="&lt;i class=&quot;fa fa-rss&quot;&gt;&lt;/i&gt;" href="https://edneypitta.github.io/old-blog/feed/"><i class="fa fa-rss"></i></a></li>
<li id="menu-item-27" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-27"><a title="&lt;i class=&quot;fa fa-info-circle&quot;&gt;&lt;/i&gt;" href="https://edneypitta.github.io/old-blog/sobre/"><i class="fa fa-info-circle"></i></a></li>
</ul></div>					</div>
				</div>
			</div>
		</nav><!-- .site-navigation -->
	</header><!-- #masthead -->

	<div id="content" class="site-content">

		<div class="top-section">
								</div>

		<div class="container main-content-area">
			<div class="row">
				<div class="main-content-inner col-sm-12 col-md-8 pull-left">

	<div id="primary" class="content-area">
		<main id="main" class="site-main" role="main">

		
						
				
<article id="post-433" class="post-433 post type-post status-publish format-standard hentry category-certificacao tag-70-487">
	<div class="blog-item-wrap">
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-4-secure-a-wcf-service/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 3.4 ‚Äì Secure a WCF service" >
			 				</a>
		<div class="post-inner-content">
			<header class="entry-header page-header">

				<h1 class="entry-title"><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-4-secure-a-wcf-service/" rel="bookmark">Certifica√ß√£o Microsoft 70-487: Objetivo 3.4 ‚Äì Secure a WCF service</a></h1>

								<div class="entry-meta">
					<span class="posted-on"><i class="fa fa-calendar"></i> <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-4-secure-a-wcf-service/" rel="bookmark"><time class="entry-date published" datetime="2016-02-16T23:18:40+00:00">16/02/2016</time><time class="updated" datetime="2016-03-01T16:57:42+00:00">01/03/2016</time></a></span><span class="byline"> <i class="fa fa-user"></i> <span class="author vcard"><a class="url fn n" href="https://edneypitta.github.io/old-blog/author/admin/">Edney Pitta</a></span></span>				<span class="comments-link"><i class="fa fa-comment-o"></i><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-4-secure-a-wcf-service/#respond"><span class="dsq-postid" data-dsqidentifier="433 https://edneypitta.github.io/old-blog/?p=433">Deixe um coment√°rio</span></a></span>
				
				
				</div><!-- .entry-meta -->
							</header><!-- .entry-header -->

						<div class="entry-content">

				<p>O objetivo 3.4 do exame, <strong>Secure a WCF service</strong>, cobre as features de seguran√ßa que o WCF disponibiliza. Isso inclui 1) como implementar seguran√ßa no n√≠vel de mensagem, 2) como implementar seguran√ßa no n√≠vel de transporte e 3) como implementar <em>certificates</em>, que √© a combina√ß√£o dos itens anteriores. Vamos l√°?</p>
<h2>Implementando Seguran√ßa no N√≠vel de Mensagem</h2>
<p>Basicamente, implementar seguran√ßa no n√≠vel da mensagem √© &#8220;incrementar&#8221; as mensagens SOAP com 3 caracter√≠sticas CIA:</p>
<ul>
<li><strong>Confidencialidade</strong>: significa que somente as pessoas que devem ver uma mensagem s√£o as pessoas que de fato vejam a mensagem;</li>
<li><strong>Integridade</strong>: significa que a mensagem n√£o pode ser alterada;</li>
<li><strong>Autentica√ß√£o</strong>: garante a identidade de quem est√° vendo a mensagem.</li>
</ul>
<p>Isso significa que a mensagem n√£o √© visualizada sem a chave correspondente, mas o texto criptografado pode ser visto na rede.</p>
<p>Na maioria dos bindings, isso √© feito por padr√£o e roda transparentemente, sem interven√ß√£o do desenvolvedor. Voc√™ pode tamb√©m especificar via c√≥digo ou arquivo de configura√ß√£o.</p>
<p>Por c√≥digo, basta setar a propriedade Security.Mode do binding desejado, seja por construtor ou setando a propriedade manualmente:</p>
<p><code>// Set Security Mode to Message in Constructor<br />
WSHttpBinding WsHttpSecurity = new WSHttpBinding(SecurityMode.Message);</code></p>
<p><code>// Set the Security property manually<br />
WSHttpBinding wsHttpSecurity2 = new WSHttpBinding();<br />
wsHttpSecurity2.Security.Mode = SecurityMode.Message;</code></p>
<p>A propriedade Mode para o wsHttpBinding √© do tipo <strong>SecurityMode</strong>. Para o basicHttpBinding o tipo √© <strong>BasicHttpSecurityMode </strong>e para o netNamedPipeBinding √© <strong>NetNamedPipeSecurityMode</strong>.</p>
<p>√â poss√≠vel fazer essa configura√ß√£o no arquivo de configura√ß√£o pelo WCF Service Configuration Editor. Para cada binding configurado, h√° duas abas no editor: Binding e Security. Basta ir na aba Security e setar o Mode para Message:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/11.png" alt="security mode" width="686" height="494" class="alignnone size-full wp-image-435" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/11.png 686w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/11-300x216.png 300w" sizes="(max-width: 686px) 100vw, 686px" /></p>
<p>Se voc√™ for para o arquivo de configura√ß√£o, ver√° que nada foi adicionado pois o wsHttpBinding faz essa seguran√ßa por padr√£o. Contudo, √© poss√≠vel declarar tamb√©m explicitamente dessa forma:</p>
<p><code>&lt;wsHttpBinding&gt;<br />
 &lt;binding name=&quot;wsHttpBindingConfigSample&quot; &gt;<br />
 &lt;security mode=&quot;Message&quot;/&gt;<br />
 &lt;/binding&gt;<br />
 &lt;/wsHttpBinding&gt;</code></p>
<h2>Implementando Seguran√ßa no N√≠vel de Transporte</h2>
<p>Transporte seguro significa que todo o transporte √© criptografado, tornando dif√≠cil para um interceptor compreender a mensagem. Com isso, o texto da mensagem n√£o precisa ser criptografado; pode ser trafegado em plain text.</p>
<p>Implementar seguran√ßa no n√≠vel de transporte √© virtualmente id√™ntico ao item anterior. A diferen√ßa √© que, ao inv√©s de setar o Mode como Message, voc√™ deve escolher <strong>Transport </strong>ou <strong>TransportWithMessageCredential</strong></p>
<p>Seja via c√≥digo ou arquivo de configura√ß√£o, o funcionamento √© exatamente o mesmo.</p>
<h2>Implementando Certificates</h2>
<p>Para usar certificados, voc√™ precisa adicionar uma refer√™ncia a <em>System.Security.dll</em>. Com o certificado instalado, a configura√ß√£o no WCF √© bem simples. </p>
<p>Assumindo que voc√™ tenha um netHttpBinding configurado para o servi√ßo, basta sincronizar os elementos &lt;security&gt; e &lt;message&gt; para que o Mode da propriedade Security seja TransportWithMessageCredential e a propriedade ClientCredentialType da mensagem seja o certificado. </p>
<p>Ap√≥s essa configura√ß√£o, basta garantir que certificado est√° instalado no client, obter uma refer√™ncia a ele e adicion√°-lo na propriedade <em>Credentials.ClientCredentials.Certificate</em>:</p>
<p><code>var MyFactory = new ChannelFactory<ITestService>("*");<br />
MyFactory.Credentials.ClientCredentials.Certificate = X509.CurrentUser.My.SubjectDistinguishedName.Find("CN=CLIENT").FirstOrDefault();</code></p>
<p>Isso √© tudo para esse objetivo üôÇ O pr√≥ximo post ser√° sobre o objetivo 3.5, <strong><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-5-consume-wcf-services/">Consume WCF services</a></strong>.</p>
<p>At√© l√°!</p>

				<p><a class="btn btn-default read-more" href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-4-secure-a-wcf-service/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 3.4 ‚Äì Secure a WCF service">Leia Mais</a></p>

							</div><!-- .entry-content -->
					</div>
	</div>
</article><!-- #post-## -->

			
				
<article id="post-411" class="post-411 post type-post status-publish format-standard hentry category-certificacao tag-70-487">
	<div class="blog-item-wrap">
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-3-configure-wcf-services-by-using-the-api/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 3.3 ‚Äì Configure WCF services by using the API" >
			 				</a>
		<div class="post-inner-content">
			<header class="entry-header page-header">

				<h1 class="entry-title"><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-3-configure-wcf-services-by-using-the-api/" rel="bookmark">Certifica√ß√£o Microsoft 70-487: Objetivo 3.3 ‚Äì Configure WCF services by using the API</a></h1>

								<div class="entry-meta">
					<span class="posted-on"><i class="fa fa-calendar"></i> <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-3-configure-wcf-services-by-using-the-api/" rel="bookmark"><time class="entry-date published" datetime="2016-02-16T07:41:55+00:00">16/02/2016</time><time class="updated" datetime="2016-03-01T16:57:25+00:00">01/03/2016</time></a></span><span class="byline"> <i class="fa fa-user"></i> <span class="author vcard"><a class="url fn n" href="https://edneypitta.github.io/old-blog/author/admin/">Edney Pitta</a></span></span>				<span class="comments-link"><i class="fa fa-comment-o"></i><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-3-configure-wcf-services-by-using-the-api/#comments"><span class="dsq-postid" data-dsqidentifier="411 https://edneypitta.github.io/old-blog/?p=411">1 Coment√°rio</span></a></span>
				
				
				</div><!-- .entry-meta -->
							</header><!-- .entry-header -->

						<div class="entry-content">

				<p>O objetivo 3.3 da certifica√ß√£o Microsoft 70-487, Configure WCF services by using the API, trata dos mesmos aspectos do <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-2-configure-wcf-services-by-using-configuration-settings/">objetivo anterior</a>. A diferen√ßa √© que enquanto no objetivo 3.2 vimos como alterar as configura√ß√µes de um servi√ßo WCF via arquivo de configura√ß√£o, nesse vamos ver como fazer essas configura√ß√µes via c√≥digo, ou API. </p>
<h2>Configurando Comportamentos do Servi√ßo</h2>
<p>Como configuramos os behaviors no post anterior com ServiceBehaviors e EndpointBehaviors, podemos fazer as mesmas configura√ß√µes com os atributos <strong>ServiceBehaviorAttribute </strong>e <strong>OperationBehaviorAttribute</strong>.<br />
ServiceBehaviorAttribute √© do mesmo n√≠vel que ServiceContract, ent√£o os behaviors s√£o configurados no n√≠vel de servi√ßo e se aplicam ao servi√ßo inteiro. OperationBehaviorAttribute se equivale ao OperationContract, ou seja, a cada m√©todo do servi√ßo. </p>
<p>ServiceBehaviorAttribute n√£o pode decorar a interface do contrato, somente a implementa√ß√£o (classe). A lista das propriedades pode ser consultada na <a href="https://msdn.microsoft.com/pt-br/library/system.servicemodel.servicebehaviorattribute(v=vs.110).aspx" target="_blank">MSDN</a>.</p>
<p>Uma quest√£o prov√°vel de cair no exame √© sobre concorr√™ncia de ServiceContractAttribute e ServiceBehaviorAttribute. Por exemplo, ambas t√™m as propriedades Name e Namespace, resultando no seguinte cen√°rio:</p>
<p><code>[ServiceContract(<strong>Namespace</strong>="http://www.williamgryan.mobi/Books/70-487", <strong>Name</strong>="RandomText")]<br />
public interface ITestService{}<br />
[ServiceBehavior(<strong>Name</strong>="Test", <strong>Namespace</strong>="http://www.williamgryan.mobi/Books/70-487/Services")]<br />
public class TestService : ITestService<br />
{}</code></p>
<p>O resultado do envelope do request √© o seguinte:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/8.png" alt="request envelope" width="967" height="180" class="alignnone size-full wp-image-414" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/8.png 967w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/8-300x56.png 300w" sizes="(max-width: 967px) 100vw, 967px" /></p>
<p>Aqui o namespace (xmlns) √© o definido no ServiceContract. Note o que acontece no MetadataExchange, quando voc√™ adiciona uma refer√™ncia ao servi√ßo em um client, e no WSDL:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/9.png" alt="reference" width="600" height="486" class="alignnone size-full wp-image-415" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/9.png 600w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/9-300x243.png 300w" sizes="(max-width: 600px) 100vw, 600px" /></p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/10.png" alt="wsdl" width="978" height="483" class="alignnone size-full wp-image-416" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/10.png 978w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/10-300x148.png 300w" sizes="(max-width: 978px) 100vw, 978px" /></p>
<p>Isso mostra que o ServiceBehaviorAttribute seta os valores de Name e Namespace no elemento service dentro do WSDL. Quando definidos no ServiceContract, eles ficam no WSDL.</p>
<h2>Configurando Bindings</h2>
<p>Assim como no arquivo de configura√ß√£o, h√° v√°rios bindings dispon√≠veis para se configurar via API. Todos eles funcionam de forma quase id√™ntica, apenas com pequenas diferen√ßas. Vamos passar pelos 5 mais comuns, incluindo custom binding.</p>
<h4>BasicHttpBinding</h4>
<p>BasicHttpBinding √© o mais simples dos bindings dispon√≠veis. Funciona via HTTP, precisa da especifica√ß√£o do SOAP 1.1 e tem poucos recursos de seguran√ßa. Ele possui 3 construtores:</p>
<ul>
<li><strong>new BasicHttpBinding()</strong>: deixa o WCF lidar com os valores default de configura√ß√£o;</li>
<li><strong>new BasicHttpBinding(BasicHttpSecurityMode)</strong>: recebe um BasicHttpSecurityMode que tem os seguintes valores: None, Transport, Message e TransportCredentialOnly;</li>
<li><strong>new BasicHttpBinding(string)</strong>: recebe o nome de um binding no arquivo de configura√ß√£o.</li>
</ul>
<h4>wsHttpBinding</h4>
<p>Funciona via HTTP como o BasicHttpBinding, mas possui 2 principais vantagens: usa o padr√£o SOAP 1.2 e tem suporte ao padr√£o WS-*, que contempla features como Reliable Messaging, transa√ß√µes, comunica√ß√£o <em>duplex</em>, etc.</p>
<p>wsHttpBinding tem 4 construtores:</p>
<ul>
<li><strong>new WSHttpBinding()</strong>: deixa o WCF lidar com os valores default de configura√ß√£o;</li>
<li><strong>new WSHttpBinding(SecurityMode)</strong>: recebe um BasicHttpSecurityMode que tem os seguintes valores: None, Transport, Message e TransportWithMessageCredential;</li>
<li><strong>new WSHttpBinding(string)</strong>: recebe o nome de um binding no arquivo de configura√ß√£o;</li>
<li><strong>new WSHttpBinding(SecurityMode, bool)</strong>: recebe um SecurityMode e um bool que habilita ReliableSession</li>
</ul>
<h4>NetMsmqBinding</h4>
<p>Implementa√ß√£o quase id√™ntica √† de um wsHttpBinding. A diferen√ßa √© que usa o enum MsmqSecurityMode para op√ß√µes de seguran√ßa e n√£o h√° suporte para Reliable Messaging:</p>
<ul>
<li><strong>new NetMsmqBinding()</strong>: deixa o WCF lidar com os valores default de configura√ß√£o;</li>
<li><strong>new NetMsmqBinding(NetMsmqSecurityMode)</strong>: recebe um NetMsmqSecurityModeque tem os seguintes valores: Transport, Message, Both e None;</li>
<li><strong>new NetMsmqBinding(string)</strong>: recebe o nome de um binding no arquivo de configura√ß√£o.</li>
</ul>
<h4>NetNamedPipeBinding</h4>
<p>NetNamedPipeBinding √© usado para comunica√ß√£o entre servi√ßos na mesma m√°quina, tendo um grande n√≠vel de performance.</p>
<p>Como o NetMsmqBinding Implementa√ß√£o quase id√™ntica √† de um wsHttpBinding. A diferen√ßa √© que usa o enum MsmqSecurityMode para op√ß√µes de seguran√ßa e n√£o h√° suporte para Reliable Messaging:</p>
<ul>
<li><strong>new NetMsmqBinding()</strong>: deixa o WCF lidar com os valores default de configura√ß√£o;</li>
<li><strong>new NetMsmqBinding(NetMsmqSecurityMode)</strong>: recebe um NetMsmqSecurityModeque tem os seguintes valores: Transport, Message, Both e None;</li>
<li><strong>new NetMsmqBinding(string)</strong>: recebe o nome de um binding no arquivo de configura√ß√£o.</li>
</ul>
<h4>Custom Binding</h4>
<p>Para implementar um binding customizado, voc√™ pode usar um ou mais dos predefinidos e adicionar features ou implementar um exclusivo.</p>
<p>O elemento <em>&lt;customBinding&gt;</em> √© utilizado para se definir um binding customizado. H√° um processo a se seguir com ordem espec√≠fica:</p>
<ol>
<li>O item mais externo √© o <strong>TransactionFlowBindingElement</strong>. √â opcional, necess√°rio somente se voc√™ quiser suportar Flowing Transactions;</li>
<li><strong>ReliableSessionBindingElement</strong>, tamb√©m opcional, indica se Reliable Sessions devem ser suportadas;</li>
<li><strong>SecurityBindingElement</strong> define funcionalidades de seguran√ßa como autoriza√ß√£o, autentica√ß√£o, prote√ß√£o, confidencialidade, etc. Tamb√©m opcional;</li>
<li>O pr√≥ximo item da cadeia √© o <strong>CompositeDuplexBindingElement</strong>, caso comunica√ß√µes duplex sejam suportadas;</li>
<li>O elemento <strong>OneWayBindingElement</strong> pode ser usado se voc√™ quiser prover comunica√ß√µes OneWay para o servi√ßo;</li>
<li>Dois elementos podem ser implementados para prover Stream Security: <strong>SslStreamSecurityBindingElement </strong>e <strong>WindowsStreamSecurityBindingElement</strong>. Implementa√ß√£o opcional;</li>
<li>O pr√≥ximo item se trata do encoding da mensagem. Ao contr√°rio dos outros, esse √© obrigat√≥rio na implementa√ß√£o de um custom binding. H√° 3 encodings dispon√≠veis: <strong>TextMessageEncodingBindingElement</strong>, <strong>BinaryMessageEncodingBindingElement</strong>, e <strong>MtomMessageEncodingBindingElement</strong>;</li>
<li>O √∫ltimo e obrigat√≥rio item √© o elemento de transporte. H√° 8 op√ß√µes dispon√≠veis: <strong>TcpTransportBindingElement</strong>,  <strong>HttpTransportBindingElement</strong>, <strong>HttpsTransportBindingElement</strong>, <strong>NamedPipeTransportBindingElement</strong>, <strong>PeerTransportBindingElement</strong>, <strong>MsmqTransportBindingElement</strong>, <strong>MsmqIntegrationBindingElement </strong>e <strong>ConnectionOrientedTransportBindingElement</strong>.</li>
</ol>
<h2>Especificando Contratos</h2>
<p>Essa se√ß√£o √© uma revis√£o de como se define um servi√ßo WCF:</p>
<ul>
<li>Defina um contrato usando o atributo <strong>ServiceContract</strong>;</li>
<li>Defina as opera√ß√µes com o atributo <strong>OperationContract</strong>;</li>
<li>Defina as classes que ser√£o transportadas com os atributos <strong>DataContract </strong>e <strong>DataMember</strong>.</li>
</ul>
<p>Um ponto √© que o atributo ServiceContract pode ser definido tanto na classe de implementa√ß√£o quanto na interface, mas n√£o em ambas. Caso isso aconte√ßa, uma InvalidOperationException √© lan√ßada ao tentar referenciar esse servi√ßo. O mesmo ocorre com o atributo OperationContract.</p>
<p>O √∫ltimo detalhe √© que o construtor padr√£o do ServiceContract seta 3 propriedades: Name (com o nome da classe), Namespace (com &#8220;http://tempuri.org&#8221;) e ProtectionLevel para ProtectionLevelNone. √â recomend√°vel setar essas propriedades manualmente.</p>
<h2>Expondo Metadados</h2>
<p>Os atributos usados para se definir um servi√ßo (ServiceContract e OperationContract) n√£o exp√µem automaticamente os detalhes do servi√ßo (metadados). </p>
<p>Voc√™ pode fazer isso definindo endpoints de <em>metadata exchange</em>. Atualmente h√° 4 bindings dispon√≠veis: mexHttpBinding, mexHttpsBinding, mexNamedPipeBinding e mexTcpBinding (&#8220;mex&#8221; √© uma combina√ß√£o das palavras &#8220;metadata exchange&#8221;). </p>
<p>No arquivo de configura√ß√£o, isso ficaria assim:</p>
<p><code>&lt;endpoint address=&quot;&quot; binding=&quot;basicHttpBinding&quot; contract=&quot;Samples.WCF.Services.ITestService&quot; /&gt;<br />
&lt;endpoint address=&quot;mex&quot; binding=&quot;mexHttpBinding&quot; <strong>contract=&quot;IMetadataExchange&quot;</strong> /&gt;</code></p>
<p>Note que o atributo contract sempre usa a interface <strong>IMetadataExchange</strong>.</p>
<p>Para adicionar o endpoint de metadata exchange via API, voc√™ pode usar a classe <strong>MetadataExchangeBindings</strong>. Vamos assumir que voc√™ est√° definindo o seguinte ServiceHost:</p>
<p><code>String uriString = "http://yourhost/Samples.WCF.Services/TestService/";<br />
Uri[] baseAddresses = new Uri[]{new Uri(uriString)};<br />
ServiceHost hoster = new ServiceHost(typeof(TestService), baseAddresses);</code></p>
<p>A classe MetadataExchangeBindings tem um m√©todo Create para cada binding dispon√≠vel. Voc√™ adicionaria os endpoints assim:</p>
<ul>
<li>Hoster.AddServiceEndpoint(ServiceMetadataBehavior.MexContractName, MetadataExchangeBindings.<strong>CreateMexHttpBinding()</strong>, &#8220;mexBindingHttp&#8221;);</li>
<li>Hoster.AddServiceEndpoint(ServiceMetadataBehavior.MexContractName, MetadataExchangeBindings.<strong>CreateMexHttpsBinding()</strong>, &#8220;mexBindingHttps&#8221;);</li>
<li>Hoster.AddServiceEndpoint(ServiceMetadataBehavior.MexContractName, MetadataExchangeBindings.<strong>CreateMexTcpBinding()</strong>, &#8220;mexBindingTcp&#8221;);</li>
<li>Hoster.AddServiceEndpoint(ServiceMetadataBehavior.MexContractName, MetadataExchangeBindings.<strong>CreateMexNamedPipeBinding()</strong>, &#8220;mexBindingPipe&#8221;).</li>
</ul>
<p><em>ServiceMetadataBehavior.MexContractName</em> √© apenas uma constante com o nome da interface IMetadataExchange.</p>
<p>Chegamos ao fim desse objetivo üôÇ<br />
Obrigado pela leitura e fique de olho no post do pr√≥ximo objetivo, <strong><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-4-secure-a-wcf-service/">Secure a WCF service</a></strong>.</p>
<p>At√© mais! </p>

				<p><a class="btn btn-default read-more" href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-3-configure-wcf-services-by-using-the-api/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 3.3 ‚Äì Configure WCF services by using the API">Leia Mais</a></p>

							</div><!-- .entry-content -->
					</div>
	</div>
</article><!-- #post-## -->

			
				
<article id="post-395" class="post-395 post type-post status-publish format-standard hentry category-certificacao tag-70-487">
	<div class="blog-item-wrap">
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-2-configure-wcf-services-by-using-configuration-settings/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 3.2 ‚Äì Configure WCF services by using configuration settings" >
			 				</a>
		<div class="post-inner-content">
			<header class="entry-header page-header">

				<h1 class="entry-title"><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-2-configure-wcf-services-by-using-configuration-settings/" rel="bookmark">Certifica√ß√£o Microsoft 70-487: Objetivo 3.2 ‚Äì Configure WCF services by using configuration settings</a></h1>

								<div class="entry-meta">
					<span class="posted-on"><i class="fa fa-calendar"></i> <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-2-configure-wcf-services-by-using-configuration-settings/" rel="bookmark"><time class="entry-date published" datetime="2016-02-08T14:37:17+00:00">08/02/2016</time><time class="updated" datetime="2016-03-01T16:57:19+00:00">01/03/2016</time></a></span><span class="byline"> <i class="fa fa-user"></i> <span class="author vcard"><a class="url fn n" href="https://edneypitta.github.io/old-blog/author/admin/">Edney Pitta</a></span></span>				<span class="comments-link"><i class="fa fa-comment-o"></i><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-2-configure-wcf-services-by-using-configuration-settings/#respond"><span class="dsq-postid" data-dsqidentifier="395 https://edneypitta.github.io/old-blog/?p=395">Deixe um coment√°rio</span></a></span>
				
				
				</div><!-- .entry-meta -->
							</header><!-- .entry-header -->

						<div class="entry-content">

				<p>V√°rios comportamentos importantes de um servi√ßo WCF podem ser configurados por arquivos de configura√ß√µes. Esses arquivos s√£o muito √∫teis na constru√ß√£o de uma aplica√ß√£o, seja web ou WCF. Voc√™ pode controlar quase qualquer aspecto de um servi√ßo sem a necessidade de rebuildar e redeployar a aplica√ß√£o. O objetivo 3.2, Configure WCF services by using configuration settings, mostra que o exame vai cobrar conhecimentos sobre as poss√≠veis configura√ß√µes e como manipul√°-las, no formato de drag and drop. Vamos l√°?</p>
<h2>Configurando Comportamentos do Servi√ßo</h2>
<p>O Visual Studio oferece uma ferramenta chamada <strong>WCF Service Configuration Editor</strong>, dispon√≠vel no menu Tools. Ela permite a manipula√ß√£o de arquivos de configura√ß√£o visualmente, suportando at√© a cria√ß√£o de servi√ßos. Segue abaixo o guia b√°sico da cria√ß√£o e configura√ß√£o de um servi√ßo WCF:</p>
<h4>Criando Um Servi√ßo</h4>
<p>Voc√™ pode escolher a op√ß√£o Create a New Service, se ainda n√£o tiver um servi√ßo criado:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/1.png" alt="create a new service" width="787" height="577" class="aligncenter size-full wp-image-397" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/1.png 787w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/1-300x220.png 300w" sizes="(max-width: 787px) 100vw, 787px" /></p>
<p>A primeira coisa que o wizard faz √© adicionar um elemento <system.ServiceModel> e um <services> no arquivo de configura√ß√£o. Depois, apresenta a p√°gina New Service Element Wizard para voc√™ selecionar o assembly que cont√©m o servi√ßo:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/2.png" alt="select assembly" width="624" height="513" class="alignnone size-full wp-image-398" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/2.png 624w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/2-300x247.png 300w" sizes="(max-width: 624px) 100vw, 624px" /></p>
<p>Ap√≥s especificar o servi√ßo, voc√™ precisa especificar os contratos correspondentes:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/3.png" alt="select contract" width="613" height="505" class="alignnone size-full wp-image-399" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/3.png 613w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/3-300x247.png 300w" sizes="(max-width: 613px) 100vw, 613px" /></p>
<p>Depois, o wizard prossegue para a defini√ß√£o da comunica√ß√£o do servi√ßo:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/4.png" alt="select communication mode" width="627" height="518" class="alignnone size-full wp-image-400" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/4.png 627w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/4-300x248.png 300w" sizes="(max-width: 627px) 100vw, 627px" /></p>
<p>Depois, o modo de interoperabilidade (b√°sica ou avan√ßada):</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/5.png" alt="select interoperability" width="627" height="520" class="alignnone size-full wp-image-401" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/5.png 627w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/5-300x249.png 300w" sizes="(max-width: 627px) 100vw, 627px" /></p>
<p>Por √∫ltimo, o wizard pede o endere√ßo do endpoint e apresenta uma p√°gina que sumariza todas as informa√ß√µes dadas. O importante aqui √© como o arquivo de configura√ß√£o ficou ap√≥s esses passos:</p>
<p><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;<br />
&lt;configuration&gt;<br />
 &lt;system.serviceModel&gt;<br />
 &lt;services&gt;<br />
 &lt;service name=&quot;Samples.WCF.Services.TestService&quot;&gt;<br />
 &lt;endpoint address=http://www.williamgryan.mobi/samples/487<br />
 binding=&quot;wsDualHttpBinding&quot; bindingConfiguration=&quot;&quot; name=&quot;DualHttp&quot;<br />
 contract=&quot;Samples.WCF.Services.ITestService&quot; /&gt;<br />
 &lt;/service&gt;<br />
 &lt;/services&gt;<br />
 &lt;/system.serviceModel&gt;<br />
&lt;/configuration&gt;</code></p>
<p>Voc√™ pode notar, pelo nome do nodo <strong>services</strong>, que mais de um servi√ßo pode ser especificado no mesmo projeto WCF. O atributo <strong>Name</strong> √© o tipo (classe) do servi√ßo, e ele precisa ser encontrado no caminho especificado. No elemento <strong>endpoint</strong>, o ABC √© inclu√≠do: address, binding e contract.</p>
<h2>Expondo Metadados</h2>
<p>Endpoints de metadados come√ßam com o prefixo <strong>mex</strong>, abrevia√ß√£o para <strong>metadata exchange</strong>. Atualmente h√° quatro tipos de endpoints: <em>mexHttpBinding</em>, <em>mexHttpsBinding</em>, <em>mexNamedPipeBinding</em> e <em>mexMsmqBinding</em>. Cada um corresponde para o binding do servi√ßo, mas voc√™ pode expor todos se necess√°rio.</p>
<p>Vamos alterar o servi√ßo acima para o binding wsHttpBinding e adicionar um endpoint de metadados mexHttpBinding. O XML de configura√ß√£o ficaria assim:</p>
<p><code>&lt;service name=&quot;Samples.WCF.Services.TestService&quot;&gt;<br />
 &lt;endpoint address=&quot;http://www.williamgryan.mobi/samples/487&quot;<br />
 binding=&quot;wsHttpBinding&quot; bindingConfiguration=&quot;&quot; name=&quot;WsHttp&quot;<br />
 contract=&quot;Samples.WCF.Services.ITestService&quot; /&gt;<br />
<strong> &lt;endpoint binding=&quot;mexHttpBinding&quot; bindingConfiguration=&quot;&quot;<br />
 name=&quot;Mex&quot; contract=&quot;IMetadataExchange&quot; /&gt;</strong><br />
</service></code></p>
<p>Com isso, a troca de metados est√° habilitada, permitindo que os clients vejam o WSDL para obter informa√ß√µes do servi√ßo.</p>
<h2>Configurando ServiceBehaviors e EndpointBehaviors</h2>
<p>Voc√™ especificar comportamentos (behaviors) espec√≠ficos que habilitam op√ß√µes avan√ßadas de seguran√ßa ou performance, por exemplo. EndpointBehaviors habilitam a configura√ß√£o dos endpoints, como clientCredentials, o batch de transa√ß√£o, o serializer do DataContract, e muito mais. ServiceBehaviors controlam aspectos do servi√ßo em um n√≠vel granular.</p>
<p>Usando o WCF Service Configuration Editor, basta ir para o nodo Advanced, depois Service Behaviors ou Endpoint Behaviors e adicionar um novo behavior. A tela seguintes mostra uma lista dos behaviors dispon√≠veis:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/6.png" alt="select behaviors" width="432" height="579" class="alignnone size-full wp-image-403" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/6.png 432w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/6-224x300.png 224w" sizes="(max-width: 432px) 100vw, 432px" /></p>
<p>Basta selecionar os behaviors desejados e clicar em Add. O XML ficar√° parecido com o seguinte:</p>
<p><code>&lt;system.serviceModel&gt;<br />
 <strong>&lt;behaviors&gt;<br />
 &lt;serviceBehaviors&gt;<br />
 &lt;behavior name=&quot;Debug&quot;&gt;<br />
 &lt;serviceDebug /&gt;<br />
 &lt;/behavior&gt;<br />
 &lt;/serviceBehaviors&gt;<br />
 &lt;/behaviors&gt;</strong><br />
 &lt;services&gt;<br />
 &lt;service <strong>behaviorConfiguration=&quot;Debug&quot;</strong> name=&quot;Samples.WCF.Services.<br />
TestService&quot;&gt;<br />
 &lt;endpoint address=http://www.williamgryan.mobi/samples/487<br />
 binding=&quot;wsHttpBinding&quot; bindingConfiguration=&quot;&quot; name=&quot;WsHttp&quot;<br />
 contract=&quot;Samples.WCF.Services.ITestService&quot; /&gt;<br />
 &lt;endpoint binding=&quot;mexHttpBinding&quot; bindingConfiguration=&quot;&quot; name=&quot;Mex&quot;<br />
 contract=&quot;IMetadataExchange&quot; /&gt;<br />
 &lt;/service&gt;<br />
 &lt;/services&gt;<br />
&lt;/system.serviceModel&gt;</code></p>
<p>O link entre o behavior configurado e o servi√ßo est√° no atributo behaviorConfiguration do service, conforme destacado acima.</p>
<p>Outro item prov√°vel de cair no exame √© o ProtocolMapping. Esse elemento permite que voc√™ relacione bindings aos protocolos de transporte:</p>
<p><code>&lt;protocolMapping&gt;<br />
 &lt;add scheme=&quot;http&quot; binding=&quot;basicHttpBinding&quot;/&gt;<br />
 &lt;add scheme=&quot;net.tcp&quot; binding=&quot;netTcpBinding&quot;/&gt;<br />
 &lt;add scheme=&quot;net.pipe&quot; binding=&quot;netNamedPipeBinding&quot;/&gt;<br />
 &lt;add scheme=&quot;net.msmq&quot; binding=&quot;netMsmqBinding&quot;/&gt;<br />
&lt;/protocolMapping&gt;</code></p>
<p>Isso pode ser feito tanto nos arquivos app.config de cada servi√ßo quanto no arquivo geral da m√°quina de host, o machine.config.</p>
<h2>Configurando Bindings</h2>
<p>Ainda no WCF Service Configuration Editor, √© poss√≠vel configurar bindings. A tela Create a New Binding lista todas as op√ß√µes poss√≠veis:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/7.png" alt="select binding" width="294" height="434" class="alignnone size-full wp-image-406" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/7.png 294w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/7-203x300.png 203w" sizes="(max-width: 294px) 100vw, 294px" /></p>
<p>Ap√≥s criar um wsHttpBinding, √© necess√°rio definir um ProtocolMapping para o protocolo wsHttp. √â poss√≠vel fazer isso selecionando o nodo Protocol Mapping, clicando em New, e informando o Scheme (wsHttp), o Binding (wsHttpBinding) e o Binding Configuration, com o nome do binding criado anteriormente. A configura√ß√£o no XML ficaria assim:</p>
<p><code>&lt;protocolMapping&gt;<br />
 &lt;add scheme=&quot;wsHttp&quot; binding=&quot;wsHttpBinding&quot;<br />
 bindingConfiguration=&quot;wsHttpBindingConfigSample&quot; /&gt;<br />
&lt;/protocolMapping&gt;<br />
&lt;bindings&gt;<br />
 &lt;wsHttpBinding&gt;<br />
 &lt;binding name=&quot;wsHttpBindingConfigSample&quot; /&gt;<br />
 &lt;/wsHttpBinding&gt;<br />
&lt;/bindings&gt;</code></p>
<p>Nesse caso, configuramos o protocolo wsHttp pelo Protocol Mapping para responder nesse binding. Um cen√°rio mais real seria editar um protocolo j√° configurado por padr√£o para responder no nosso binding criado. </p>
<p>Vamos fazer isso com o protocolo http. Pelo editor, basta ir em Protocol Mapping, selecionar o Scheme http e Edit. Ap√≥s configurar para o nosso binding (wsHttpBinding), o arquivo de configura√ß√£o ficar√° assim:</p>
<p><code>&lt;protocolMapping&gt;<br />
 &lt;remove scheme=&quot;http&quot; /&gt;<br />
 &lt;add scheme=&quot;http&quot; binding=&quot;wsHttpBinding&quot;<br />
 bindingConfiguration=&quot;wsHttpBindingConfigSample&quot; /&gt;<br />
&lt;/protocolMapping&gt;</code></p>
<p>Isso √© tudo para esse objetivo üôÇ<br />
Para o exame, certifique-se de olhar os exemplos em XML acima e memorizar os atributos poss√≠veis para cada elemento.</p>
<p>O pr√≥ximo post ser√° sobre o objetivo 3.3, <strong><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-3-configure-wcf-services-by-using-the-api/">Configure WCF services by using the API</a></strong>.<br />
At√© l√°!</p>

				<p><a class="btn btn-default read-more" href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-2-configure-wcf-services-by-using-configuration-settings/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 3.2 ‚Äì Configure WCF services by using configuration settings">Leia Mais</a></p>

							</div><!-- .entry-content -->
					</div>
	</div>
</article><!-- #post-## -->

			
				
<article id="post-372" class="post-372 post type-post status-publish format-standard hentry category-certificacao tag-70-487">
	<div class="blog-item-wrap">
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-1-create-a-wcf-service/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 3.1 ‚Äì Create a WCF service" >
			 				</a>
		<div class="post-inner-content">
			<header class="entry-header page-header">

				<h1 class="entry-title"><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-1-create-a-wcf-service/" rel="bookmark">Certifica√ß√£o Microsoft 70-487: Objetivo 3.1 ‚Äì Create a WCF service</a></h1>

								<div class="entry-meta">
					<span class="posted-on"><i class="fa fa-calendar"></i> <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-1-create-a-wcf-service/" rel="bookmark"><time class="entry-date published" datetime="2016-02-03T21:42:31+00:00">03/02/2016</time><time class="updated" datetime="2016-03-01T16:57:13+00:00">01/03/2016</time></a></span><span class="byline"> <i class="fa fa-user"></i> <span class="author vcard"><a class="url fn n" href="https://edneypitta.github.io/old-blog/author/admin/">Edney Pitta</a></span></span>				<span class="comments-link"><i class="fa fa-comment-o"></i><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-1-create-a-wcf-service/#comments"><span class="dsq-postid" data-dsqidentifier="372 https://edneypitta.github.io/old-blog/?p=372">1 Coment√°rio</span></a></span>
				
				
				</div><!-- .entry-meta -->
							</header><!-- .entry-header -->

						<div class="entry-content">

				<p>Ol√° pessoal! Chegamos ao cap√≠tulo 3 da certifica√ß√£o que fala sobre WCF, a tecnologia prim√°ria da Microsoft para o desenvolvimento de aplica√ß√µes SOA. Esse √© o componente com mais conte√∫do na certifica√ß√£o e que tem o maior n√∫mero de objetivos (9). </p>
<p>O primeiro objetivo, <strong>Create a WCF service</strong>, √© a introdu√ß√£o ao assunto e um dos maiores objetivos da certifica√ß√£o. Esse objetivo fala sobre conceitos de SOA, como criar contratos, implementar Message Inspectors e opera√ß√µes ass√≠ncronas no servi√ßo.</p>
<h2>Conceitos de SOA</h2>
<p>Antes de entrar na discuss√£o sobre como construir ou manter servi√ßos, alguns componente de SOA precisam ser definidos. S√£o eles:</p>
<ul>
<li><strong>Service</strong>: um componente que √© capaz de fazer uma ou mais tarefas;</li>
<li><strong>Service definition</strong>: um contrato que define uma feature do servi√ßo. O uso de contratos √© uma caracter√≠stica determinante de SOA.</li>
<li><strong>Binding</strong>: item que especifica o transporte, encoding e detalhes do protocolo necess√°rios para se realizar uma conex√£o cliente-servidor;</li>
<li><strong>Serialization</strong>: Como SOA envolve comunica√ß√£o entre diferentes processos, a serializa√ß√£o √© necess√°ria para que os dados sejam transferidos e consumidos entre esses processos.</li>
</ul>
<p>Alguns conceitos universais de SOA s√£o tamb√©m importantes:</p>
<ul>
<li><strong>Fronteiras s√£o expl√≠citas</strong>: para se comunicar com um servi√ßo, voc√™ precisa saber algumas coisas dele. Qual √© o ponto de entrada do servi√ßo? Quais opera√ß√µes ele suporta? Quais mecanismos de comunica√ß√£o s√£o aceitas?</li>
<li><strong>Servi√ßos s√£o aut√¥nomos</strong>: o servi√ßo e quaisquer depend√™ncias devem ser independentemente deployados, versionados e configurados;</li>
<li><strong>Servi√ßos compartilham schemas e contratos, n√£o classes</strong>: para se comunicar com um servi√ßo, o client precisa saber a URI, o protocolo de comunica√ß√£o e quais opera√ß√µes s√£o suportadas. N√£o √© necess√°ria uma c√≥pia das classes ou biblioteca que prov√™ as opera√ß√µes;</li>
<li><strong>A compatibilidade de servi√ßos √© baseada na pol√≠tica</strong>: apesar da WSDL (Web Service Definition Language) prover bastante informa√ß√£o sobre o servi√ßo, √© imposs√≠vel informar todos os requisitos que um servi√ßo pode ter.</li>
</ul>
<h2>Criando Contratos</h2>
<p>Como visto acima, um elemento cr√≠tico de um servi√ßo SOA √© o contrato, para que clients e servers possam se comunicar de forma flex√≠vel. H√° v√°rios atributos que definem o contrato de um servi√ßo WCF, sendo eles:</p>
<ul>
<li><strong>Atributo ServiceContract</strong>: √© o que de fato faz um tipo em .NET se tornar um servi√ßo WCF. Sem ServiceContract, n√£o h√° servi√ßo;</li>
<li><strong>Atributo OperationContract</strong>: marca uma fun√ß√£o como uma opera√ß√£o de um servi√ßo;</li>
<li><strong>Atributo DataContract</strong>: informa ao runtime que o tipo √© serializ√°vel;</li>
<li><strong>Atributo FaultContract</strong>: prov√™ informa√ß√µes de exceptions de uma forma universal.</li>
</ul>
<h4>Criando Um Projeto WCF</h4>
<p>Um servi√ßo WCF √© basicamente um compilado de classes. Voc√™ pode criar um projeto comum, adicionar algumas refer√™ncias, definir o contrato com os atributos acima e pronto; temos um servi√ßo WCF. Outra forma, mais recomendada, √© criar um projeto WCF diretamente no Visual Studio, que vai adicionar as refer√™ncias necess√°rias e construir a aplica√ß√£o de host (com os bindings e muitas configura√ß√µes feitas por padr√£o).</p>
<p>Fazendo pelo Visual Studio, voc√™ tem as seguintes op√ß√µes:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/print.png" alt="WCF Options" width="813" height="593" class="aligncenter size-full wp-image-378" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/print.png 813w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/print-300x219.png 300w" sizes="(max-width: 813px) 100vw, 813px" /></p>
<p>As duas op√ß√µes mais comuns s√£o <strong>WCF Service Library </strong>e <strong>WCF Service Application</strong>. A principal diferen√ßa entre elas √© que WCF Service Library permite que voc√™ crie um servi√ßo independente de hospedagem. WCF Service Application inclui um host IIS ou WAS (Windows Activation Service).</p>
<p>Criando um WCF Service Library, o Visual Studio criar√° um projeto com as refer√™ncias necess√°rias, uma classe de servi√ßo e uma interface de servi√ßo com os atributos ServiceContract e OperationContract. Isso √© o b√°sico para que um assembly se torne um servi√ßo WCF.</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/print2.png" alt="Project" width="369" height="429" class="aligncenter size-full wp-image-379" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/print2.png 369w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/print2-258x300.png 258w" sizes="(max-width: 369px) 100vw, 369px" /></p>
<p>Note as refer√™ncias √† <em>System.Runtime.Serialization</em> e <em>System.ServiceModel</em>, al√©m do arquivo App.config com as configura√ß√µes do servi√ßo (detalhes em outros objetivos).</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/print3.png" alt="Project Properties" width="709" height="250" class="aligncenter size-full wp-image-381" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/print3.png 709w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/02/print3-300x106.png 300w" sizes="(max-width: 709px) 100vw, 709px" /></p>
<p>Os dois itens de distin√ß√£o s√£o que o <strong>Output type</strong> √© definido como <em>class library</em>, refor√ßando que um servi√ßo WCF √© como um assembly normal, e que <strong>Startup project</strong> n√£o √© definido pois √© poss√≠vel ter v√°rios servi√ßos em uma solution, e todos eles s√£o independentes.</p>
<h4>Definindo O Servi√ßo</h4>
<p>Como visto acima, ao se criar um projeto WCF, o Visual Studio cria por padr√£o uma interface que define o contrato e uma classe que faz a implementa√ß√£o do servi√ßo. A interface deve ser marcada com o atributo ServiceContract, enquanto os m√©todos devem ter o atributo OperationContract. √â poss√≠vel ter os atributos diretamente na classe que faz a implementa√ß√£o, mas como a classe vai herdar da interface, faz sentido deixar tudo l√° (al√©m de facilitar o reuso e desacoplar o contrato da implementa√ß√£o). Para usar tipos complexos, as classes precisam ter o atributo DataContract. Vamos ao c√≥digo:</p>
<p><script src="https://gist.github.com/edneypitta/594c616233b27a1f85f4.js"></script></p>
<p><script src="https://gist.github.com/edneypitta/264ca12d090683b6651c.js"></script></p>
<h4>Endpoints</h4>
<p>Endpoints s√£o essenciais para um servi√ßo WCF, j√° que a principal caracter√≠stica de um servi√ßo WCF √© a exposi√ß√£o dos dados para v√°rios clientes. O termo &#8220;ABC&#8221; √© frequentemente usado na literatura sobre WCF, que significa:</p>
<ul>
<li><strong>A</strong>: significa &#8220;address&#8221;, geralmente uma URI;</li>
<li><strong>B</strong>: significa &#8220;binding&#8221;, que define como o transporte dos dados ser√° feito. Bindings s√£o definidos para cada servi√ßo, e um servi√ßo pode ser exposto por v√°rios bindings ao mesmo tempo;</li>
<li><strong>C</strong>: &#8220;contrato&#8221;, a interface definida no servi√ßo.</li>
</ul>
<p>A lista completa dos bindings (que cont√©m v√°rios m√©todos para HTTP, TCP, etc.) est√° dispon√≠vel em <a href="http://msdn.microsoft.com/en-us/library/ms730879.aspx" target="_blank">http://msdn.microsoft.com/en-us/library/ms730879.aspx</a>.</p>
<h4>Pipeline De Processamento WCF</h4>
<p>No consumo de um servi√ßo WCF, voc√™ sabe que de um lado h√° um servi√ßo exposto, e do outro lado um client consumindo. Mas o que acontece entre esses processos?</p>
<p>Direta ou indiretamente, uma classe proxy √© criada para o client, e essa classe o habilita a interagir com os m√©todos do servi√ßo. O request √© serializado e transferido pelo protocolo definido no binding. Todas as informa√ß√µes precisam ser desserializadas para o servi√ßo consumir, e vice-versa. </p>
<p>Esse processo de serializa√ß√£o e desserializa√ß√£o precisa ser independente de plataforma, j√° que o servi√ßo pode ser consumido de qualquer linguagem. Por exemplo, uma aplica√ß√£o Java ou Python n√£o sabe o que √© a classe <em>System.Data.SqlClient.SqlDataAdapter</em>. Arrays, pilhas e filas s√£o conhecidas pela maioria das linguagens, n√£o <em>System.Collections.Generic.List</em>, espec√≠fico para .NET. Isso foi pensado na cria√ß√£o do WCF, ent√£o h√° v√°rios mecanismos para lidar com esse problema. ServiceContract e OperationContract s√£o a primeira parte dessa equa√ß√£o, mas existem v√°rias outras. </p>
<p>Vamos olhar a implementa√ß√£o de um servi√ßo e comentar todos os aspectos que voc√™ precisa saber para o exame:</p>
<p><script src="https://gist.github.com/edneypitta/ce1c18a7a715cdbf577b.js"></script></p>
<p><script src="https://gist.github.com/edneypitta/c779b7e3b92dd6630502.js"></script></p>
<p><script src="https://gist.github.com/edneypitta/d7aa0f531ce6d978c6b4.js"></script></p>
<h4>DataContract</h4>
<p>Se voc√™ olhar para as classes AnswerSet, AnswerDetails, e TestQuestion, vai notar que todas elas t√™m o atributo DataContract. Esse atributo cont√©m todas as informa√ß√µes sobre como os dados ser√£o serializados.</p>
<p>Para a maioria dos casos, colocar esse atributo j√° ser√° suficiente para sua classe ser serializada e desserializada pelo WCF e pelo client. Mas h√° algumas exce√ß√µes:</p>
<ul>
<li>Se o item sendo enviado deriva de um DataContract, mas n√£o √© um DataContract;</li>
<li>Se o tipo da informa√ß√£o transmitida for uma interface ou classe abstrata;</li>
<li>Se o tipo for um Object.</li>
</ul>
<p>Nesses 3 casos, geralmente haver√° um erro na desserializa√ß√£o da classe. Para deixar a engine de serializa√ß√£o saber sobre um tipo, o atributo KnownType deve ser usado em conjunto com o DataContract.</p>
<p>Vamos ver um exemplo na pr√°tica. Suponha que voc√™ tenha uma classe base <em>QuestionBase</em> e as derivadas <em>MathQuestion </em>e <em>EnglishQuestion</em>:</p>
<p><code>[DataContract(Name="English" Namespace="487Samples")]<br />
public class EnglishQuestion : QuestionBase<br />
{}<br />
[DataContract(Name="Math" Namespace="487Samples")]<br />
public class MathQuestion : QuestionBase<br />
{}</code></p>
<p>Agora suponha que voc√™ tenha a seguinte classe que deve ser serializada:</p>
<p><code>[DataContract(Namespace="487Sample")]<br />
public class QuestionManager<br />
{<br />
[DataMember]<br />
private Guid QuestionSetId;<br />
[DataMember]<br />
private QuestionBase ExamQuestion;<br />
}</code></p>
<p>Por n√£o saber quais os poss√≠veis tipos para a classe abstrata QuestionBase, ao desserializar essa classe uma exception √© lan√ßada. Para resolver esse problema, como dito, o atributo KnownType deve ser usado para indicar quais tipos podem ser usados em uma QuestionBase:</p>
<p><code>[DataContract]<br />
[KnownType(typeof(EnglishQuestion))]<br />
[KnownType(typeof(MathQuestion))]<br />
public class QuestionManager{}</code></p>
<p>Tirando as exce√ß√µes acima, todos os tipos primitivos e algumas classes .NET s√£o serializadas sem problemas pelo DataContractSerializer. A lista completa pode ser vista <a href="http://msdn.microsoft.com/en-us/library/ms731923.aspx" target="_blank">aqui</a>.</p>
<p>A propriedade <strong>Name</strong>, n√£o obrigat√≥ria, especifica um nome diferente da classe vis√≠vel para os clients. AnswerSet, por exemplo, tem o Name <em>Answers</em>, e todos os clients enxergar√£o essa classe como Answers. A propriedade Namespace, tamb√©m n√£o obrigat√≥ria, serve para evitar conflitos de classes com o mesmo Name.</p>
<p>Al√©m do atributo DataContract, √© necess√°rio colocar o atributo DataMember (ou EnumMember, no caso de um enum) em cada propriedade a ser serializada.</p>
<h4>DataMember</h4>
<p>DataMember indica uma propriedade a ser serializada. Se voc√™ marcar uma classe com DataContract mas nenhuma propriedade com DataMember, nada ser√° serializado. </p>
<p>H√° algumas propriedades opcionais que voc√™ pode setar:</p>
<ul>
<li><strong>EmitDefaultValue</strong>: indica se, quando uma propriedade tiver o valor default, ela deve ser serializada ou n√£o. O valor padr√£o √© true. Deve ser marcada false para minimizar o tamanho da mensagem a ser serializada (dica para o exame);</li>
<li><strong>Name</strong>: identifica uma propriedade com um nome diferente para os clients;</li>
<li><strong>IsRequired</strong>: indica se a propriedade deve ter um valor ao serializar, resultando numa exception caso o valor seja default. O valor padr√£o √© false;</li>
<li><strong>Order</strong>: especifica a ordem de serializa√ß√£o do membro;</li>
<li><strong>TypeId</strong>: caso definido numa classe derivada, retorna um identificador √∫nico para o atributo.</li>
</ul>
<h4>EnumMember</h4>
<p>Funciona exatamente como DataMember, mas se aplica a enums. As propriedades opcionais s√£o:</p>
<ul>
<li><strong>Name</strong>: retorna o nome do membro;</li>
<li><strong>Value</strong>: retorna o valor do membro;</li>
<li><strong>BuiltInTypeKind</strong>: retorna o tipo;</li>
<li><strong>Documentation</strong>: obt√©m ou seta o objeto de documenta√ß√£o, se especificado.</li>
</ul>
<p>O comportamento de Value √© interessante. No caso do enum AnswerDetails, os valores serializados por padr√£o s√£o A, B, C, D e All. Se voc√™ especificar o Value, esse valor ser√° retornado no lugar. Por exemplo:</p>
<p><code>[DataContract(Namespace="http://www.williamgryan.mobi/Book/70-487")]<br />
[Flags]<br />
public enum AnswerDetails : int<br />
{<br />
[EnumMember(Value="1")]<br />
A = 0x0,<br />
[EnumMember(Value = "2")]<br />
B = 0x1,<br />
[EnumMember(Value = "3")]<br />
C = 0x2,<br />
[EnumMember(Value = "Bill")]<br />
D = 0x4,<br />
[EnumMember(Value = "Ryan")]<br />
All = 0x8<br />
}</code></p>
<h4>FaultContracts</h4>
<p>A classe base de exce√ß√µes do .NET, <em>System.Exception</em>, n√£o √© conhecida por potenciais clients de um WCF, como Java ou Python. Cada framework tem sua maneira de lidar com exceptions, mas num cen√°rio distribu√≠do como o consumo de um servi√ßo WCF, todos eles devem se comunicar igualmente tratando-se de erros. Outro problema frequente √© que, em um cen√°rio de exception, voc√™ provavelmente n√£o gostaria de enviar todo o stack do erro para seus clients por v√°rios motivos. <strong>FaultContracts </strong>resolvem esses dois problemas de maneira simples. Voc√™ pode definir quando e quais informa√ß√µes ser√£o enviadas da exception sem expor seu servi√ßo abertamente.</p>
<p>O m√©todo GetQuestionText mostrado anteriormente lan√ßava uma exce√ß√£o se o n√∫mero da quest√£o passado fosse igual ou menor a 0:</p>
<p><code>public String GetQuestionText(Int32 questionNumber)<br />
{<br />
 if (questionNumber <= 0)
 {
 String OutOfRangeMessage = "Question Ids must be a positive value greater than 0";
 IndexOutOfRangeException InvalidQuestionId = new IndexOutOfRangeException(OutOfRangeMessage);
 throw new FaultException<IndexOutOfRangeException>(InvalidQuestionId, OutOfRangeMessage);<br />
 }<br />
 String AnswerText = null;<br />
 // Method implementation<br />
 return AnswerText;<br />
}</code></p>
<p>Para o client saber que uma exce√ß√£o pode ser lan√ßada por um servi√ßo, isso deve estar definido no contrato do m√©todo:</p>
<p><code>[FaultContract(typeof(IndexOutOfRangeException))]<br />
[OperationContract]<br />
String GetQuestionText(Int32 questionNumber);</code></p>
<p>Com isso, exce√ß√µes podem ser enviadas para o client sem problemas de compatibilidade. Se voc√™ quiser incluir detalhes sobre o erro, voc√™ pode setar a propriedade Reason que aceita um FaultReason.</p>
<p>FaultException tem outra propriedade chamada FaultCode. Com ela √© poss√≠vel especificar erros no n√≠vel de SOAP. SOAP 1.1, por exemplo, aceita os erros VersionMismatch, MustUnderstand, Client e Server. SOAP 1.2 prov√™ os erros VersionMismatch, MustUnderstand, DataEncodingUnknown, Sender, e Receiver. Voc√™ deve levar em conta o binding do servi√ßo, j√° que a especifica√ß√£o de mensagem de erro pode ser espec√≠fico em SOAP 1.1 ou SOAP 1.2.</p>
<p>Ainda outra op√ß√£o √© usar a classe MessageFault, que te d√° uma representa√ß√£o da falha em mem√≥ria, o que permite que voc√™ especifique o erro o quanto quiser.</p>
<p>Para o exame, √© recomend√°vel se familiarizar com os construtores da classe FaultException. S√£o eles:</p>
<ul>
<li><strong>FaultException()</strong>: cria uma FaultException;</li>
<li><strong>FaultException(FaultReason)</strong>: cria e especifica uma Reason;</li>
<li><strong>FaultException(MessageFault)</strong>: cria e especifica uma MessageFault;</li>
<li><strong>FaultException(String)</strong>: cria e usa a string para criar uma FaultReason com o texto;</li>
<li><strong>FaultException(FaultReason, FaultCode)</strong>: cria especificando uma FaultReason e um FaultCode;</li>
<li><strong>FaultException(MessageFault, String)</strong>: cria especificando uma MessageFault e uma string para a action SOAP fault;</li>
<li><strong>FaultException(SerializationInfo, StreamingContext)</strong>: cria especificando informa√ß√µes de serializa√ß√£o e um contexto em que a FaultException ser√° desserializada. Pouco prov√°vel de ter no exame;</li>
<li><strong>FaultException(String, FaultCode)</strong>: cria especificando uma FaultReason e um FaultCode;</li>
<li><strong>FaultException(FaultReason, FaultCode, String)</strong>: cria especificando uma FaultReason, um FaultCode e uma string para a action SOAP fault;</li>
<li><strong>FaultException(String, FaultCode, String)</strong>: o mesmo que o anterior, mas a primeira string √© transformada em uma FaultReason.</li>
</ul>
<p>Resumindo, foque em como definir um FaultContract, como lan√ßar uma FaultException e as principais propriedades dela (FaultReason e FaultCode). Tenha em mente tamb√©m que FaultException herda de CommunicationException.</p>
<h2>Implementando Inspectors</h2>
<p>Voc√™ pode implementar inspectors que estendem o comportamento do WCF.</p>
<p>O primeiro deles √© o <strong>Parameter Inspector</strong>. Com a interface <em>IParameterInspector</em> voc√™ consegue validar se os par√¢metros atendem √† condi√ß√µes customizadas antes que o servi√ßo seja de fato chamado. Por exemplo, se um servi√ßo recebe um par√¢metro userName e este deve ser o tamanho maior que 7, um Parameter Inspector poderia ser implementado para evitar chamadas desnecess√°rias ao servi√ßo.</p>
<p>A interface IParameterInspector tem dois m√©todos bem intuitivos: <em>BeforeCall </em>e <em>AfterCall</em>. No exemplo acima, fica claro que nossa l√≥gica precisa estar em BeforeCall.</p>
<p>O client precisa ter uma refer√™ncia √† classe que implementa IParameterInspector e adicionar na cole√ß√£o Behaviors da propriedade Operations da classe proxy:</p>
<p><code>ProxyInstance.Endpoint.Contract.Operations[0].Behaviors.Add(new UserNameInspector());</code></p>
<p>Feito isso, √© necess√°rio criar o atributo (que herda de <em>Attribute </em>e <em>IOperationBehavior</em>) a ser inserido no contrato e a classe que implementa a interface IParameterInspector:</p>
<p><script src="https://gist.github.com/edneypitta/fc1d3c917f88428b4818.js"></script></p>
<p>Outro inspector √© o <strong>Message Inspector</strong>. O prop√≥sito dele √© voc√™ interceptar processamentos dado algum evento. Digamos que seu servi√ßo processa uma compra de um e-commerce. Voc√™ dispara uma verifica√ß√£o do cart√£o de cr√©dito informado e inicia o processamento de salvar todos os dados. No meio do processamento, a operadora do cart√£o de cr√©dito retornou que este √© inv√°lido. Com um Message Inspector, voc√™ conseguiria interromper e cancelar o processo que estava ocorrendo de salvar todas as informa√ß√µes. </p>
<p>Para implementar um Message Inspector do lado do server, voc√™ usa a interface <em>IDispatchMessageInspector</em>. Ela possui dois m√©todos:</p>
<ul>
<li><strong>AfterReceiveRequest</strong>: chamado ap√≥s receber um request, mas antes da mensagem ser encaminhada para o m√©todo;</li>
<li><strong>BeforeSendReply</strong>: chamado ap√≥s o retorno do m√©todo mas antes que o retorno seja enviado de fato para o client.</li>
</ul>
<p>Uma vantagem do Message Inspector √© que voc√™ o adiciona no pipeline do WCF via arquivo de configura√ß√£o, evitando que o servi√ßo inteiro seja deployado para que um inspector seja adicionado. Assumindo que a classe <em>ServerInspector </em>implementa a interface IDispatchMessageInspector, voc√™ o habilita com a seguinte configura√ß√£o:</p>
<p><code>&lt;extensions&gt;<br />
 &lt;behaviorExtensions&gt;<br />
 &lt;add name=&quot;clientSample&quot; type=&quot;Samples.WCF.Services.ServerInspector, ClientHost, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null&quot;/&gt;<br />
 &lt;/behaviorExtensions&gt;<br />
&lt;/extensions&gt;</code></p>
<p>√â poss√≠vel implementar Message Inspectors do lado do client tamb√©m, de forma bem parecida com a do server. A interface respons√°vel se chama <em>IClientMessageInspector</em> e tem os seguintes m√©todos:</p>
<ul>
<li><strong>BeforeSendRequest</strong>: chamado antes de um request ser enviado ao servi√ßo;</li>
<li><strong>AfterReceiveReply</strong>: chamado ap√≥s o response do server, mas antes de ser encaminhado ao m√©todo que o chamou.</li>
</ul>
<p>Para adicion√°-lo no WCF, a configura√ß√£o √© exatamente igual √† do server. Para o exame voc√™ deve saber que MessageInspectors existem, quais interfaces devem ser implementadas e onde especific√°-los no arquivo de configura√ß√£o.</p>
<p>A <strong>finalmente </strong>terminamos üôÇ</p>
<p>Fique ligado no post do pr√≥ximo objetivo, <strong><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-2-configure-wcf-services-by-using-configuration-settings/">Configure WCF services by using configuration settings</a></strong>.<br />
At√© mais!</p>

				<p><a class="btn btn-default read-more" href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-1-create-a-wcf-service/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 3.1 ‚Äì Create a WCF service">Leia Mais</a></p>

							</div><!-- .entry-content -->
					</div>
	</div>
</article><!-- #post-## -->

			
				
<article id="post-363" class="post-363 post type-post status-publish format-standard hentry category-certificacao tag-70-487">
	<div class="blog-item-wrap">
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-5-create-an-entity-framework-data-model/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 2.5 ‚Äì Create an Entity Framework data model" >
			 				</a>
		<div class="post-inner-content">
			<header class="entry-header page-header">

				<h1 class="entry-title"><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-5-create-an-entity-framework-data-model/" rel="bookmark">Certifica√ß√£o Microsoft 70-487: Objetivo 2.5 ‚Äì Create an Entity Framework data model</a></h1>

								<div class="entry-meta">
					<span class="posted-on"><i class="fa fa-calendar"></i> <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-5-create-an-entity-framework-data-model/" rel="bookmark"><time class="entry-date published" datetime="2016-01-27T23:22:43+00:00">27/01/2016</time><time class="updated" datetime="2016-03-01T16:57:07+00:00">01/03/2016</time></a></span><span class="byline"> <i class="fa fa-user"></i> <span class="author vcard"><a class="url fn n" href="https://edneypitta.github.io/old-blog/author/admin/">Edney Pitta</a></span></span>				<span class="comments-link"><i class="fa fa-comment-o"></i><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-5-create-an-entity-framework-data-model/#respond"><span class="dsq-postid" data-dsqidentifier="363 https://edneypitta.github.io/old-blog/?p=363">Deixe um coment√°rio</span></a></span>
				
				
				</div><!-- .entry-meta -->
							</header><!-- .entry-header -->

						<div class="entry-content">

				<p>Ol√°!</p>
<p>O objetivo 2.5 da certifica√ß√£o, Create an Entity Framework data model, √© o √∫ltimo objetivo do segundo t√≥pico da certifica√ß√£o, <strong>Querying and manipulating data by using the Entity Framework</strong>. Finalmente vamos ver como construir um Entity Model, al√©m de recordar alguns conceitos e componentes do EF cobertos no objetivo 1.1.</p>
<p>Esse objetivo cobre como: 1) estruturar o model usando as heran√ßas Table-per-Type e Table-per-Hierarchy, 2) escolher e implementar um m√©todo de data model (Model First ou Database First), 3) implementar objetos POCO e 4) descrever um data model usando Conceptual Schema Definitions, Storage Schema Definition, e Mapping Language (CSDL, SSDL, MSL). Vamos l√°?</p>
<h2>Estruturando o Data Model Usando as Heran√ßas Table-per-Type e Table-per-Hierarchy</h2>
<p>Voc√™ pode tratar os casos de heran√ßa de duas formas: Table-per-Type (tabela por tipo) e Table-per-Hierarchy (tabela por hierarquia). </p>
<p>Basicamente, a diferen√ßa entre as duas √© que, em tabela por tipo, cada classe herdeira vira uma tabela no banco de dados. Em tabela por hierarquia, tanto a classe pai quanto as filhas ficar√£o guardadas na mesma tabela, geralmente com uma coluna indicando qual √© o tipo.</p>
<p>Para o exame, voc√™ deve saber quais s√£o as vantagens e desvantagens das duas formas:</p>
<h4>Tabela Por Tipo</h4>
<p>Vantagens:</p>
<ul>
<li>Os dados n√£o s√£o guardados redundantemente;</li>
<li>Os dados s√£o armazenados na terceira norma formal, aumentando a integridade;</li>
<li>A implementa√ß√£o √© mais simples. Para adicionar ou remover uma entidade herdeira, basta deletar a tabela no banco de dados e atualizar o Entity Model.</li>
</ul>
<p>Desvantagens:</p>
<ul>
<li>A performance √© afetada em opera√ß√µes b√°sicas (CRUD);</li>
<li>Complica a administra√ß√£o do banco de dados pelas tabelas adicionais.</li>
</ul>
<h4>Tabela Por Hierarquia</h4>
<p>Vantagens:</p>
<ul>
<li>Deixa o schema do banco simplificado por conter menos tabelas;</li>
<li>Opera√ß√µes de CRUD otimizadas por trabalhar em uma s√≥ tabela.</li>
</ul>
<p>Desvantagens:</p>
<ul>
<li>H√° redund√¢ncia dos dados por n√£o seguir a terceira normal formal;</li>
<li>Pode haver problemas com a integridade dos dados devido a redund√¢ncia;</li>
<li>O Entity Model fica mais complexo pela tabela conter mais campos.</li>
</ul>
<h2>Escolher e Implementar um M√©todo de Data Model (Model First ou Database First)</h2>
<p>Escolher um modelo de EDM √© um conceito importante, mas n√£o h√° muito o que aprender aqui.</p>
<p><strong>Model First</strong> acontece quando voc√™ cria um modelo vazio e vai criando os recursos necess√°rios, como as entidades, os relacionamentos entre elas e o comportamento das propriedades. Depois disso tudo, voc√™ gera o schema do banco de dados do EDM; e o Entity Framework cuida da cria√ß√£o do banco de dados e o mapeamento entre o banco e o modelo.</p>
<p><strong>Database First</strong>, como esperado, assume que voc√™ j√° tem o schema do banco de dados pronto e escolhe criar o EDM a partir dele. Nesse caso, o Entity Framework cuida da cria√ß√£o dos itens do EDM e o mapeamento entre eles.</p>
<p>Outro ponto importante nesse assunto s√£o as propriedades que voc√™ pode setar diretamente no EDM, escolhendo qualquer um dos dois m√©todos. Clicando com o bot√£o direito no designer e indo em Properties, voc√™ pode controlar algumas propriedades que t√™m o nome bem sugestivo, como se o Lazy Loading deve ser utilizado, o nome do namespace desejado, o n√≠vel de acesso dos containers, etc. </p>
<p>Indo nas propriedades de cada entidade ou em alguma propriedade, h√° alguns comportamentos e configura√ß√µes que podem ser alterados:</p>
<ul>
<li>A classe base da entidade;</li>
<li>Se a propriedade √© Nullable;</li>
<li>Visibilidade dos getters e setters;</li>
<li>Um valor default para uma propriedade;</li>
<li>Essa √© bem interessante: a propriedade <strong>Concurrency Mode</strong>, quando setada para <em>Fixed</em>, assegura que o valor no banco de dados n√£o foi alterado quando voc√™ vai atualiz√°-lo. Por exemplo, se voc√™ obteve uma entidade do banco com uma propriedade no valor &#8220;x&#8221; e vai alter√°-la para &#8220;y&#8221;, o Entity Framework vai validar se o valor ainda √© &#8220;x&#8221; antes de voc√™ atualiz√°-lo para &#8220;y&#8221;. Isso pode ser bem √∫til em alguns cen√°rios, mas carrega uma piora na performance pela valida√ß√£o. Outro ponto √© que, embora esse comportamento seja definido no n√≠vel de propriedade, se voc√™ tiver 50 campos setados para Fixed, apenas uma query ser√° feita no banco para comparar os 50 valores.</li>
</ul>
<h2>Implementar Objetos POCO</h2>
<p>Ao criar uma entidade no EDM, o Entity Framework vai gerar a classe .NET automaticamente. Caso desejado, voc√™ pode desabilitar esse comportamento nas Properties do designer e criar voc√™ mesmo um POCO (<em>plain old common object</em>), tendo mais controle sobre suas classes.</p>
<p>Para usar suas classes POCO no contexto do EF, alguns passos s√£o necess√°rios. A primeira coisa √© que as classes devem ser decoradas com o atributo Table, especificando o nome da tabela no banco de dados:</p>
<p><code>[Table("Account")]<br />
public class Account{}<br />
[Table("Customers")]<br />
public class Customers{}<br />
[Table("TransactionDetails")]<br />
public class TransactionDetail{}<br />
Table("Transactions")]<br />
public class Transaction{}</code></p>
<p>O modo de vincular as classes no contexto depende se voc√™ estiver utilizando DbContext ou ObjectContext.</p>
<p>Com DbContext, basta definir as classes usando a classe gen√©rica DbSet e passando o tipo de cada POCO:</p>
<p><code>public partial class EntityFrameworkSamplesEntitiesDb : DbContext<br />
{<br />
 public EntityFrameworkSamplesEntitiesDb(): base("name=EntityFrameworkSamplesEntities1")<br />
{}<br />
public DbSet<Account> Accounts { get; set; }<br />
public DbSet<Customer> Customers { get; set; }<br />
public DbSet<TransactionDetail> TransactionDetails { get; set; }<br />
public DbSet<Transaction> Transactions { get; set; }<br />
}</code></p>
<p>Com ObjectContext n√£o √© muito diferente. A classe gen√©rica ObjectSet deve ser usada e as propriedades devem ser inicializadas no construtor:</p>
<p><code>public partial class EntityFrameworkSamplesEntitiesSample : ObjectContext<br />
{<br />
 public EntityFrameworkSamplesEntitiesSample(): base("name=EntityFrameworkSamplesEntities1")<br />
{<br />
 Accounts = new ObjectSet<Account>();<br />
 Customers = new ObjectSet<Customer>();<br />
 TransactionDetails = new ObjectSet<TransactionDetail>();<br />
 Transactions = new ObjectSet<Transaction>();<br />
}<br />
 public ObjectSet<Account> Accounts { get; set; }<br />
 public ObjectSet<Customer> Customers { get; set; }<br />
 public ObjectSet<TransactionDetail> TransactionDetails { get; set; }<br />
 public ObjectSet<Transaction> Transactions { get; set; }<br />
}</code></p>
<h2>Descrever um Data Model Usando Conceptual Schema Definitions, Storage Schema Definition, e Mapping Language (CSDL, SSDL, MSL)</h2>
<p>O Entity Framework junta cada um desses componentes no arquivo .edmx, mas para o exame √© importante entender qual o papel de cada um. Basicamente, o CSDL √© o conceito do schema do banco traduzido para objetos; o SSDL representa o pr√≥prio schema do banco de dados e o MSL √© o respons√°vel por juntar os dois e mapear o schema do banco com os objetos.</p>
<p>N√£o h√° muito o que ir mais fundo sobre o CSDL e o SSDL, a n√£o ser que s√£o XMLs representando informa√ß√µes &#8211; objetos e modelos relacionais de banco de dados. O MSL, que unifica os dois, √© um pouco mais complexo e merece um entendimento maior.</p>
<p>O MSL, junto com o .edmx, cont√©m v√°rios outros arquivos gerados automaticamente. S√£o eles:</p>
<ul>
<li>Um arquivo .edmx que serve como container para tudo;</li>
<li>Um arquivo <em>ModelName.Context.tt</em> para gera√ß√£o de templates das classes .NET especificadas no model do respectivo contexto;</li>
<li>O arquivo <em>ModelName.Context.cs</em> que cont√©m as classes do contexto;</li>
<li>O arquivo <em>ModelName.Designer.cs</em> que prov√™ suporte para o designer do EDM;</li>
<li> Um arquivo <em>ModelName.edmx.Diagram</em> que cont√©m um XML parecido com o seguinte:<br />
<code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;<br /> &lt;edmx:Edmx Version=&quot;2.0&quot; xmlns:edmx=&quot;http://schemas.microsoft.com/ado/2008/10/edmx&quot;&gt;<br /> &lt;!-- EF Designer content (DO NOT EDIT MANUALLY BELOW HERE) --&gt;<br /> &lt;edmx:Designer xmlns=&quot;http://schemas.microsoft.com/ado/2008/10/edmx&quot;&gt;<br /> &lt;!-- Diagram content (shape and connector positions) --&gt;<br /> &lt;edmx:Diagrams&gt;<br />&lt;Diagram DiagramId=&quot;8576b1de6991436caba647ac89886831&quot; Name=&quot;Diagram1&quot;&gt;<br />&lt;EntityTypeShape EntityType=&quot;EntityFrameworkSamplesModel1.Account&quot; Width=&quot;1.5&quot; PointX=&quot;7.5&quot; PointY=&quot;0.875&quot; IsExpanded=&quot;true&quot; /&gt;<br />&lt;EntityTypeShape EntityType=&quot;EntityFrameworkSamplesModel1.Customer&quot; Width=&quot;1.5&quot; PointX=&quot;9.75&quot; PointY=&quot;0.875&quot; IsExpanded=&quot;true&quot; /&gt;<br />&lt;EntityTypeShape EntityType=&quot;EntityFrameworkSamplesModel1.TransactionDetail&quot; Width=&quot;1.5&quot; PointX=&quot;14.25&quot; PointY=&quot;0.875&quot; IsExpanded=&quot;true&quot; /&gt;<br />&lt;EntityTypeShape EntityType=&quot;EntityFrameworkSamplesModel1.Transaction&quot; Width=&quot;1.5&quot; PointX=&quot;12&quot; PointY=&quot;0.875&quot; IsExpanded=&quot;true&quot; /&gt;<br />&lt;AssociationConnector Association=&quot;EntityFrameworkSamplesModel1.FK_Account_Account&quot; ManuallyRouted=&quot;false&quot; /&gt;<br />&lt;AssociationConnector Association=&quot;EntityFrameworkSamplesModel1.FK_Customer_Account&quot; ManuallyRouted=&quot;false&quot; /&gt;<br />&lt;AssociationConnector Association=&quot;EntityFrameworkSamplesModel1.FK_Transactions_Customer&quot; ManuallyRouted=&quot;false&quot; /&gt;<br />&lt;AssociationConnector Association=&quot;EntityFrameworkSamplesModel1.FK_TransactionDetails_Transactions&quot; ManuallyRouted=&quot;false&quot; /&gt;<br />&lt;/Diagram&gt;<br />&lt;/edmx:Diagrams&gt;<br />&lt;/edmx:Designer&gt;<br />&lt;/edmx:Edmx&gt;</code>
</li>
<li>Por √∫ltimo, o arquivo <em>ModelName.tt</em> que tem as informa√ß√µes de template para gera√ß√£o das classes de dados.</li>
</ul>
<p>Uma olhada no arquivo .edmx pode ajudar na visualiza√ß√£o de todos esses artefatos:</p>
<p><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/01/edmx.png" alt="edmx" width="426" height="878" class="aligncenter size-full wp-image-367" srcset="https://edneypitta.github.io/old-blog/wp-content/uploads/2016/01/edmx.png 426w, https://edneypitta.github.io/old-blog/wp-content/uploads/2016/01/edmx-146x300.png 146w" sizes="(max-width: 426px) 100vw, 426px" /></p>
<p>Isso √© tudo para esse objetivo. O pr√≥ximo post cobrir√° o primeiro objetivo do cap√≠tulo 3 da certifica√ß√£o, <strong><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-3-1-create-a-wcf-service/">Designing and implementing WCF Services</a></strong>.</p>
<p>Nos vemos l√°!</p>

				<p><a class="btn btn-default read-more" href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-5-create-an-entity-framework-data-model/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 2.5 ‚Äì Create an Entity Framework data model">Leia Mais</a></p>

							</div><!-- .entry-content -->
					</div>
	</div>
</article><!-- #post-## -->

			
				
<article id="post-349" class="post-349 post type-post status-publish format-standard hentry category-certificacao tag-70-487">
	<div class="blog-item-wrap">
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-4-query-and-manipulate-data-by-using-ado-net/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 2.4 ‚Äì Query and manipulate data by using ADO.NET" >
			 				</a>
		<div class="post-inner-content">
			<header class="entry-header page-header">

				<h1 class="entry-title"><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-4-query-and-manipulate-data-by-using-ado-net/" rel="bookmark">Certifica√ß√£o Microsoft 70-487: Objetivo 2.4 ‚Äì Query and manipulate data by using ADO.NET</a></h1>

								<div class="entry-meta">
					<span class="posted-on"><i class="fa fa-calendar"></i> <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-4-query-and-manipulate-data-by-using-ado-net/" rel="bookmark"><time class="entry-date published" datetime="2016-01-22T22:24:19+00:00">22/01/2016</time><time class="updated" datetime="2016-03-01T16:57:01+00:00">01/03/2016</time></a></span><span class="byline"> <i class="fa fa-user"></i> <span class="author vcard"><a class="url fn n" href="https://edneypitta.github.io/old-blog/author/admin/">Edney Pitta</a></span></span>				<span class="comments-link"><i class="fa fa-comment-o"></i><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-4-query-and-manipulate-data-by-using-ado-net/#respond"><span class="dsq-postid" data-dsqidentifier="349 https://edneypitta.github.io/old-blog/?p=349">Deixe um coment√°rio</span></a></span>
				
				
				</div><!-- .entry-meta -->
							</header><!-- .entry-header -->

						<div class="entry-content">

				<p>Ol√° pessoal! Esse post ser√° sobre objetivo 2.4 da certifica√ß√£o Microsoft 40-487, <strong>Query and manipulate data by using ADO.NET</strong>. Embora j√° coberto no <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-1-1-choose-data-access-technologies/" target="_blank">objetivo 1.1</a>, esse objetivo √© bem espec√≠fico sobre o ADO.NET e suas classes, assim como m√©todos ass√≠ncronos.</p>
<h2>Fazendo Queries com Connection, DataReader, Command, DataAdapter e DataSet</h2>
<h4>SqlConnection</h4>
<p>N√£o h√° muito segredo sobre a classe SqlConnection. Ela herda de <em>IDbConnection</em> e voc√™ deve instanci√°-la passando uma connection string, seja inline ou de um arquivo de configura√ß√£o (web.config).</p>
<p>Todas as connections precisam ser abertas com o m√©todo Open e fechadas explicitamente com Close ou num bloco using.</p>
<p><code>using (SqlConnection connection = new SqlConnection("ConnectionStringName"))<br />
{<br />
connection.Open();<br />
}</code></p>
<p>Sempre abra uma conex√£o num bloco try/catch, pois fatores fora do seu alcan√ßa podem impedir que isso aconte√ßa.</p>
<h4>SqlCommand</h4>
<p>A classe SqlCommand, herdeira de <em>IDbCommand</em>, √© a respons√°vel por fazer comandos ao banco de dados. Algumas de suas caracter√≠sticas s√£o:</p>
<ul>
<li>Uma SqlCommand precisa de uma SqlConnection aberta para operar;</li>
<li>Al√©m da propriedade Connection, o √∫nico outro item importante √© setar a propriedade CommandText, que √© o SQL a ser executado. √â poss√≠vel tamb√©m passar somente o nome de uma stored procedure no lugar do SQL, sendo necess√°rio nesse caso setar a propriedade CommandType para StoredProcedure;</li>
<li>Voc√™ nunca deve concatenar valores como string numa query SQL. Instancie a classe SqlParameter e o adicione na propriedade Parameters;</li>
<li>H√° muito debate entre stored procedures e &#8220;SQLs din√¢micos&#8221; (queries na propriedade CommandText). O fato √© que, sendo parametrizados corretamente, o plano de execu√ß√£o dos SQLs din√¢micos √© cacheado, o que pode aumentar a performance e ser menos vulner√°vel √† ataques;</li>
<li>H√° v√°rias maneiras de executar um SqlCommand. Voc√™ pode us√°-lo como input da propriedade SelectCommand de um SqlDataAdapter, chamar ExecuteScalar para retornar um valor ou ExecuteReader para retornar um SqlDataReader;</li>
<li>Cada m√©todo de execu√ß√£o tem seu par ass√≠ncrono, indicados pelo nome come√ßando com Begin;</li>
<li>√â bom chamar o m√©todo Dispose de um SqlCommand. Fa√ßa isso explicitamente ou fa√ßa uso de um bloco using.</li>
</ul>
<p><script src="https://gist.github.com/edneypitta/02cea8020c58df13674d.js"></script></p>
<h4>SqlDataReader</h4>
<p>A classe SqlDataReader, invocada pelo m√©todo ExecuteReader de um SqlCommand, √© respons√°vel pela obten√ß√£o de dados. Voc√™ deve fechar explicitamente quaisquer SqlDataReader abertos.</p>
<p>SqlDataReader tem uma caracter√≠stica que voc√™ deve ter em mente: ao obter um SqlDataReader pelo m√©todo ExecuteReader, o buffer √© carregado do banco de dados, mas o stream dos dados <strong>n√£o √© feito</strong> at√© voc√™ iterar pelos itens com o m√©todo Read. √â poss√≠vel saber se h√° itens no buffer com a propriedade HasRows, mas n√£o h√° como saber quantos itens existem sem iterar pelos dados, o que esvazia o buffer no processo. Isso significa que voc√™ s√≥ pode iterar pelos dados uma √∫nica vez.</p>
<p><script src="https://gist.github.com/edneypitta/667e197b6cc90f8e5569.js"></script></p>
<h4>SqlDataAdapter</h4>
<p>SqlDataAdapter √© uma classe designada para fazer todas as opera√ß√µes no banco de dados (CRUD).</p>
<p>Na leitura, ela funciona bem diferente do SqlDataReader: um <em>DataSet </em>√© populado (com uma mais <em>DataTables</em>), permitindo que voc√™ itere quantas vezes quiser &#8211; at√© com LINQ. Outra diferen√ßa √© que voc√™ pode obter facilmente a quantidade de registros retornados com o Count de uma DataTable.</p>
<p>O m√©todo <strong>Fill </strong>√© o jeito mais b√°sico de carregar um SqlDataAdapter. Passando um SqlCommand v√°lido, o m√©todo conecta ao banco de dados, executa o comando e cria uma DataTable para cada query SELECT. </p>
<p>Cada coluna gera uma DataColumn na DataTable sendo constru√≠da. O pr√≥prio adapter infere o tipo da DataColumn, de acordo com o schema no banco de dados. Se houver mais de uma coluna com o mesmo nome ou alias, o adapter adiciona um n√∫mero no final do nome (<em>FirstName1, FirstName2, FirstName3</em>). √â poss√≠vel tamb√©m chamar o m√©todo Fill especificando o valor AddWithKey do enum MissingSchemaAction, resultando na adi√ß√£o de uma primary key e outras contraints existentes no banco de dados. Caso haja mais de uma primary key numa query, voc√™ pode criar uma manualmente na DataTable. Com a DataTable e as DataColumns criadas, o adapter cria uma DataRow para cada registro retornado do banco de dados.</p>
<p>Outro m√©todo importante √© o <strong>Update</strong>. Ele funciona assim: todas as DataRows, quando retornadas, tem o RowState como Unchanged. Voc√™ pode alterar o RowState de uma DataRow para Added, Modified ou Deleted. Basicamente, quando o m√©todo Update √© chamado, ele varre todas as DataRows e, dependendo do RowState, chama o SqlCommand correspondente (InsertCommand, UpdateCommand ou DeleteCommand) do SqlDataAdapter. Para funcionar corretamente, voc√™ precisa setar todas essas propriedades. Caso o command n√£o seja encontrado, uma exce√ß√£o √© lan√ßada.</p>
<p>A sintaxe do SqlDataAdapter √© assim: (note que o pr√≥prio m√©todo Fill chama o m√©todo Open da SqlConnection, e ele se encarrega de fech√°-la. Caso voc√™ a abra, a responsabilidade de fech√°-la √© sua)</p>
<p><script src="https://gist.github.com/edneypitta/687ebc27faa2d2c3ac3f.js"></script></p>
<p>Por √∫ltimo, voc√™ pode definir o comportamento de um SqlDataAdapter com algumas propriedades:</p>
<ul>
<li><strong>AcceptChangesDuringFill</strong>: por padr√£o, o m√©todo Fill carrega todas as DataRows com o RowState Unchanged. Se voc√™ setar essa propriedade como false, todas as DataRows ter√£o o RowState <strong>Added</strong>;</li>
<li><strong>AcceptChangesDuringUpdate</strong>: como dito anteriormente, o m√©todo Update examina o RowState de cada DataRow para saber qual Command invocar. Ao final do m√©todo, todos os RowStates s√£o retornados para Unchanged. Setar essa propriedade como false n√£o reseta o RowState; mant√©m o estado que estava antes do m√©todo Fill ser chamado;</li>
<li><strong>UpdateBatchSize</strong>: por padr√£o, o SqlDataAdapter atualiza uma DataRow por vez. Setando essa propriedade, as atualiza√ß√µes s√£o feitas em grupos, o que diminui as chamadas ao banco de dados;</li>
<li><strong>OnRowUpdating/OnRowUpdated</strong>: eventos na atualiza√ß√£o de uma DataRow;</li>
<li><strong>ContinueUpdateOnError</strong>: por padr√£o, quando h√° v√°rios comandos a serem executados e um deles lan√ßa uma Exception, todos os outros comandos n√£o s√£o feitos. Setando essa propriedade como true, o comando que deu erro √© ignorado e os outros comandos s√£o executados normalmente;</li>
<li><strong>FillSchema</strong>: FillSchema usa o SelectCommand para construir o schema do DataTable correspondente, sem popular a tabela.</li>
</ul>
<h2>Fazendo Opera√ß√µes S√≠ncronas e Ass√≠ncronas</h2>
<p>H√° tr√™s m√©todos de um SqlCommand que t√™m suas partes ass√≠ncronas: BeginExecuteReader, BeginExecuteXmlReader e BeginExecuteNonQuery. Eles s√£o bem f√°ceis de usar. Basta examinar a propriedade IsCompleted e, quando completo, chamar o m√©todo End correspondente:</p>
<p><script src="https://gist.github.com/edneypitta/9e93908367aa1738bfc3.js"></script></p>
<p>Obrigado pela leitura e fiquem ligados no post do objetivo 2.5, <strong><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-5-create-an-entity-framework-data-model/">Create an Entity Framework data model</a></strong>.</p>
<p>At√© mais!</p>

				<p><a class="btn btn-default read-more" href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-4-query-and-manipulate-data-by-using-ado-net/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 2.4 ‚Äì Query and manipulate data by using ADO.NET">Leia Mais</a></p>

							</div><!-- .entry-content -->
					</div>
	</div>
</article><!-- #post-## -->

			
				
<article id="post-343" class="post-343 post type-post status-publish format-standard hentry category-certificacao tag-70-487">
	<div class="blog-item-wrap">
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-3-query-data-by-using-linq-to-entities/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 2.3 ‚Äì Query data by using LINQ to Entities" >
			 				</a>
		<div class="post-inner-content">
			<header class="entry-header page-header">

				<h1 class="entry-title"><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-3-query-data-by-using-linq-to-entities/" rel="bookmark">Certifica√ß√£o Microsoft 70-487: Objetivo 2.3 ‚Äì Query data by using LINQ to Entities</a></h1>

								<div class="entry-meta">
					<span class="posted-on"><i class="fa fa-calendar"></i> <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-3-query-data-by-using-linq-to-entities/" rel="bookmark"><time class="entry-date published" datetime="2016-01-18T17:18:06+00:00">18/01/2016</time><time class="updated" datetime="2016-03-01T16:56:54+00:00">01/03/2016</time></a></span><span class="byline"> <i class="fa fa-user"></i> <span class="author vcard"><a class="url fn n" href="https://edneypitta.github.io/old-blog/author/admin/">Edney Pitta</a></span></span>				<span class="comments-link"><i class="fa fa-comment-o"></i><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-3-query-data-by-using-linq-to-entities/#respond"><span class="dsq-postid" data-dsqidentifier="343 https://edneypitta.github.io/old-blog/?p=343">Deixe um coment√°rio</span></a></span>
				
				
				</div><!-- .entry-meta -->
							</header><!-- .entry-header -->

						<div class="entry-content">

				<p>Ol√° pessoal! Chegamos ao objetivo 2.3 da certifica√ß√£o Developing Microsoft Azure and Web Services, o <strong>Query data by using LINQ to Entities</strong>. </p>
<p>Esse objetivo cobre como 1) fazer queries usando LINQ, 2) IQueryable vs. IEnumerable e 3) logar queries. Vamos l√°?</p>
<h4>Fazendo queries usando LINQ</h4>
<p>O objetivo desse ponto √© mostrar que √© poss√≠vel utilizar LINQ to Entities de vers√µes antigas do Entity Framework com ObjectContext, assim como se faz com DbContext. </p>
<p>Com ObjectContext, voc√™ cria um ObjectQuery que √© virtualmente id√™ntico √† aqueles do DbContext. Por exemplo:</p>
<p><code>IQueryable<Account> query = from acct in Context.Accounts<br />
where acct.AccountAlias == "Primary"<br />
select acct;</code></p>
<p>√â importante tamb√©m saber que o ObjectQuery implementa IQueryable, IEnumerable e IListSource.</p>
<h4>IQueryable vs. IEnumerable</h4>
<p>IEnumerable √© caracterizado por:</p>
<ul>
<li>Uso em LINQ to Objects e LINQ to XML;</li>
<li>S√£o performados em mem√≥ria;</li>
<li>S√£o performados no heap.</li>
</ul>
<p>IQueryable s√£o notavelmente diferente na maioria dos casos:</p>
<ul>
<li>Rodam fora do processo;</li>
<li>Suportam diferentes datasources, incluindo remotos;</li>
<li>S√£o usados em LINQ to Entities e LINQ to DataServices.</li>
</ul>
<h4>Logando Queries</h4>
<p>Usando Entity Framework, √†s vezes se torna necess√°rio voc√™ saber exatamente qual a query SQL o framework gerou automaticamente. Por exemplo:</p>
<p><code>IQueryable<Account> Query = from Acct in Context.Accounts<br />
where Acct.AccountAlias == "Primary"<br />
select Acct;</code></p>
<p>Com ObjectQuery (ObjectContext), voc√™ pode obter a query fazendo um cast expl√≠cito para ObjectQuery e usar o m√©todo ToTraceString:</p>
<p><code>String Tracer = (Query as ObjectQuery).ToTraceString();</code></p>
<p>Com DbContext, √© poss√≠vel de maneira similar:</p>
<p><code>String Output = (from Acct in ContextName.ContextSet select Acct).ToString();</code></p>
<p>Isso √© tudo para o conte√∫do desse objetivo.<br />
Obrigado pela leitura e acompanhe a continua√ß√£o das postagens da certifica√ß√£o Microsoft 70-487, que ser√° sobre o pr√≥ximo objetivo <strong>Query and manipulate data by using ADO.NET</strong>.</p>
<p>At√© mais!<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-4-query-and-manipulate-data-by-using-ado-net/">Query and manipulate data by using ADO.NET</a></p>

				<p><a class="btn btn-default read-more" href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-3-query-data-by-using-linq-to-entities/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 2.3 ‚Äì Query data by using LINQ to Entities">Leia Mais</a></p>

							</div><!-- .entry-content -->
					</div>
	</div>
</article><!-- #post-## -->

			
				
<article id="post-334" class="post-334 post type-post status-publish format-standard hentry category-certificacao tag-70-487">
	<div class="blog-item-wrap">
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-2-query-and-manipulate-data-by-using-data-provider-for-entity-framework/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 2.2 ‚Äì Query and manipulate data by using Data Provider for Entity Framework" >
			 				</a>
		<div class="post-inner-content">
			<header class="entry-header page-header">

				<h1 class="entry-title"><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-2-query-and-manipulate-data-by-using-data-provider-for-entity-framework/" rel="bookmark">Certifica√ß√£o Microsoft 70-487: Objetivo 2.2 ‚Äì Query and manipulate data by using Data Provider for Entity Framework</a></h1>

								<div class="entry-meta">
					<span class="posted-on"><i class="fa fa-calendar"></i> <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-2-query-and-manipulate-data-by-using-data-provider-for-entity-framework/" rel="bookmark"><time class="entry-date published" datetime="2016-01-18T09:01:02+00:00">18/01/2016</time><time class="updated" datetime="2016-03-01T16:56:46+00:00">01/03/2016</time></a></span><span class="byline"> <i class="fa fa-user"></i> <span class="author vcard"><a class="url fn n" href="https://edneypitta.github.io/old-blog/author/admin/">Edney Pitta</a></span></span>				<span class="comments-link"><i class="fa fa-comment-o"></i><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-2-query-and-manipulate-data-by-using-data-provider-for-entity-framework/#comments"><span class="dsq-postid" data-dsqidentifier="334 https://edneypitta.github.io/old-blog/?p=334">1 Coment√°rio</span></a></span>
				
				
				</div><!-- .entry-meta -->
							</header><!-- .entry-header -->

						<div class="entry-content">

				<p>Ol√° pessoal! Continuando a s√©rie de posts sobre a certifica√ß√£o Microsoft 70-487, vamos ao objetivo 2.2, <strong>Query and manipulate data by using Data Provider for Entity Framework</strong>. Esse √© um objetivo bem curto que fala sobre como fazer queries usando o namespace System.Data.EntityClient.</p>
<p>O namespace System.Data.EntityClient √© um superset do namespace System.Data, e suas classes operam de forma bem similar. As diferen√ßas se referem ao Entity Framework.</p>
<p>Em todos os cen√°rios de acesso ao banco de dados, uma conex√£o √© necess√°ria. No namespace SqlClient, h√° a classe SqlConnection. Para o EntityClient, a classe de conex√£o √© a <strong>EntityConnection</strong>. Ela tem tr√™s construtores: um vazio (<em>new EntityConnection()</em>), um que recebe uma connection string normal e o terceiro em que voc√™ deve especificar informa√ß√µes (metadados) para o EDM. Para fazer isso, a melhor maneira √© usar a classe <em>EntityConnectionStringBuilder </em>em conjunto com a classe SqlConnectionStringBuilder:</p>
<p><code>String provider = "System.Data.SqlClient";<br />
String serverName = "localhost";<br />
String databaseName = "dbname";</code></p>
<p><code>SqlConnectionStringBuilder connBuilder = new SqlConnectionStringBuilder();<br />
connBuilder.DataSource = serverName;<br />
connBuilder.InitialCatalog = databaseName;</code></p>
<p><code>EntityConnectionStringBuilder efBuilder = new EntityConnectionStringBuilder();<br />
efBuilder.Provider = Provider;<br />
efBuilder.ProviderConnectionString = connBuilder.ToString();<br />
efBuilder.Metadata = @"*csdl, *ssdl, *msl";<br />
EntityConnection Connection = new EntityConnection(efBuilder.ToString());</code></p>
<p>O resto opera de forma bem igual √† uma SqlConnection, como os m√©todos Open, Close e BeginTransaction.</p>
<p>O <strong>EntityCommand</strong> tamb√©m trabalha como o SqlCommand. H√° os m√©todos CreateParameter, ExecuteNonQuery, ExecuteReader e ExecuteScalar, por exemplo, e todos eles funcionam como sugerido. Todos eles tamb√©m t√™m suas vers√µes Async, onde a √∫nica diferen√ßa √© a presen√ßa da propriedade CancellationToken.</p>
<p>H√° tamb√©m a classe <strong>EntityTransaction</strong>, que funciona tamb√©m de forma id√™ntica √† TransactionScope (explicada <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-1-3-implement-transactions/" target="_blank">aqui</a>).</p>
<h4>Fazendo Transa√ß√µes</h4>
<p>H√° duas op√ß√µes para se fazer transa√ß√µes diretamente.</p>
<p>A primeira √© usando a classe <strong>DbTransaction</strong>. Voc√™ a obt√©m pelo DbContext, no m√©todo Database.Connection.BeginTransaction():</p>
<p><code>EntityFrameworkSamplesEntities Context = new EntityFrameworkSamplesEntities();<br />
IDbTransaction TransactionInstance = Context.Database.Connection.BeginTransaction();<br />
try<br />
{<br />
 // Do Something<br />
 Context.SaveChanges();<br />
 TransactionInstance.Commit();<br />
}<br />
catch (EntityCommandExecutionException)<br />
{<br />
 TransactionInstance.Rollback();<br />
}</code></p>
<p>O pr√≥ximo m√©todo, bem mais prov√°vel de se encontrar no exame, √© pela classe <strong>TransactionScope</strong>. A vantagem dela √© que voc√™ s√≥ precisa chamar o m√©todo Complete ap√≥s SaveChanges; n√£o √© necess√°rio nenhum tratamento especial em caso de falha:</p>
<p><code>EntityFrameworkSamplesEntities Context = new EntityFrameworkSamplesEntities();<br />
using (TransactionScope CurrentScope = new TransactionScope())<br />
{<br />
 try<br />
 {<br />
 Context.SaveChanges();<br />
 CurrentScope.Complete();<br />
 }<br />
 catch (EntityCommandExecutionException)<br />
 {<br />
 //Handle the exception as you normally would<br />
 //It won't be committed so transaction wise you're done<br />
 }<br />
 }</code></p>
<p>E isso √© tudo para esse objetivo üôÇ O pr√≥ximo post ser√° sobre o objetivo 2.3, <strong><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-3-query-data-by-using-linq-to-entities/">Query data by using LINQ to Entities</a></strong>.</p>
<p>At√© mais!</p>

				<p><a class="btn btn-default read-more" href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-2-query-and-manipulate-data-by-using-data-provider-for-entity-framework/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 2.2 ‚Äì Query and manipulate data by using Data Provider for Entity Framework">Leia Mais</a></p>

							</div><!-- .entry-content -->
					</div>
	</div>
</article><!-- #post-## -->

			
				
<article id="post-321" class="post-321 post type-post status-publish format-standard hentry category-certificacao tag-70-487">
	<div class="blog-item-wrap">
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-1-query-and-manipulate-data-by-using-the-entity-framework/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 2.1 ‚Äì Query and manipulate data by using the Entity Framework" >
			 				</a>
		<div class="post-inner-content">
			<header class="entry-header page-header">

				<h1 class="entry-title"><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-1-query-and-manipulate-data-by-using-the-entity-framework/" rel="bookmark">Certifica√ß√£o Microsoft 70-487: Objetivo 2.1 ‚Äì Query and manipulate data by using the Entity Framework</a></h1>

								<div class="entry-meta">
					<span class="posted-on"><i class="fa fa-calendar"></i> <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-1-query-and-manipulate-data-by-using-the-entity-framework/" rel="bookmark"><time class="entry-date published" datetime="2016-01-15T03:01:48+00:00">15/01/2016</time><time class="updated" datetime="2016-03-01T16:56:36+00:00">01/03/2016</time></a></span><span class="byline"> <i class="fa fa-user"></i> <span class="author vcard"><a class="url fn n" href="https://edneypitta.github.io/old-blog/author/admin/">Edney Pitta</a></span></span>				<span class="comments-link"><i class="fa fa-comment-o"></i><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-1-query-and-manipulate-data-by-using-the-entity-framework/#respond"><span class="dsq-postid" data-dsqidentifier="321 https://edneypitta.github.io/old-blog/?p=321">Deixe um coment√°rio</span></a></span>
				
				
				</div><!-- .entry-meta -->
							</header><!-- .entry-header -->

						<div class="entry-content">

				<p>Ol√° pessoal! Esse ser√° o post do primeiro objetivo do segundo grande t√≥pico da certifica√ß√£o, o <strong>Querying and manipulating data by using the Entity Framework</strong>. Esse t√≥pico foca especificamente em LINQ e Entity Framework e cobre aproximadamente 20% das quest√µes do exame. Esse primeiro objetivo, <em>Query and manipulate data by using the Entity Framework</em> (que recebe quase o mesmo nome do t√≥pico), cobre aspectos espec√≠ficos do EF e os componentes que o comp√µe. Vamos l√°?</p>
<h2>Fazendo Queries, Updates e Deletes Usando DbContext</h2>
<p>Fazer queries usando DbContext √© bem direto e simples, usando LINQ:</p>
<p><code>var query = (from acct in context.Accounts<br />
 where acct.AccountAlias == "Primary"<br />
 select acct).FirstOrDefault();</code></p>
<p>Ap√≥s uma entidade ser retornada de uma query, voc√™ pode interagir com o objeto como qualquer outro. Voc√™ faz quaisquer modifica√ß√µes necess√°rias e chama o m√©todo SaveChanges do context para fazer um update das informa√ß√µes alteradas.</p>
<p>√â poss√≠vel tamb√©m atualizar um item que voc√™ criou usando o m√©todo Add ou Attach e chamando o mesmo m√©todo SaveChanges para persistir as altera√ß√µes. √â importante entender bem a diferen√ßa entre os dois m√©todos: incluir uma entidade usando Add faz o item ter o EntityState como <em>Added</em>. Pelo objeto n√£o ter valores originais no ObjectStateEntry, quando SaveChanges √© chamado, o contexto vai tentar <strong>inserir</strong> a entidade no banco de dados. Attach, por outro lado, cria o item com o EntityState <em>Unchanged</em>. Ent√£o o momento que voc√™ faz o Attach √© muito importante. Se voc√™ fizer depois de todas as altera√ß√µes, <strong>nada vai acontecer</strong>, pois o EntityState vai continuar como Unchanged. Se voc√™ fizer o Attach e depois fazer as modifica√ß√µes na entidade, a√≠ sim o context vai fazer o update das propriedades no banco na chamada do SaveChanges.</p>
<p>Para deletar uma entidade do banco, voc√™ deve especificar o tipo da entidade usando o m√©todo Set e depois chamar o m√©todo Remove passando uma query. O item ser√° deletado ap√≥s a chamada ao SaveChanges.</p>
<p><code>context.Set<Account>().Remove(query);</code></p>
<h2>Deferred Execution e Lazy Loading</h2>
<p>Esse assunto pode ser bem extenso, por isso vamos simplificar bastante aqui.</p>
<p>Veja o seguinte c√≥digo:</p>
<p><code>var query = from acct in context.Accounts<br />
 where acct.AccountAlias == "Primary"<br />
 select acct;</code></p>
<p>Suponha que no banco de dados h√° 20 registros com o nome da conta Primary. √â l√≥gico pensar que na pr√≥xima linha o count da query ser√° 20, certo? <strong>Errado</strong>. Nesse ponto, nada aconteceu em termos de banco de dados. A ess√™ncia de <em>Deferred Execution</em> (execu√ß√£o adiada) √© que somente quando voc√™ pede o dado, explicitamente referenciando-o, que o acesso ao banco de dados √© de fato feito. O c√≥digo abaixo, por exemplo, potencialmente dispara muitas idas ao banco de dados:</p>
<p><code>var query = from acct in Context.Accounts<br />
 where acct.AccountAlias == "Primary"<br />
 select acct;<br />
foreach (var currentAccount in query)<br />
{<br />
 Console.WriteLine("Current Account Alias: {0}", currentAccount.AccountAlias);<br />
}</code></p>
<p>J√° o c√≥digo abaixo, por exemplo, ao inv√©s de retornar uma cole√ß√£o de itens, retorna somente um valor (count). Como √© imposs√≠vel obter esse valor sem ir ao banco de dados, ao chamar Count (ou qualquer fun√ß√£o Aggregate como Average e Max), o acesso ao banco de dados √© feito imediatamente:</p>
<p><code>var query = (from acct in context.Accounts<br />
 where acct.AccountAlias == "Primary"<br />
 select acct).Count();</code></p>
<p>Resumindo: no conceito de Deferred Execution, usado pelo EF, dados s√≥ s√£o recuperados quando necess√°rio.</p>
<p>O Lazy Loading √© um conceito parecido com o Deferred Execution, mas aplicado para relacionamentos no banco de dados. </p>
<p>Imagine uma estrutura onde um Bank tem v√°rios Customers, um Customer tem v√°rias Accounts, uma Account tem v√°rias Transactions e uma Transaction tem v√°rias TransactionDetails. Ao obter um Customer para uma atualiza√ß√£o simples de dados, voc√™ iria querer que todas as Accounts (com todas as Transactions e as TransactionsDetails) fossem retornadas? Provavelmente n√£o.</p>
<p>As op√ß√µes de Loading s√£o:</p>
<ul>
<li><strong>Lazy Loading</strong>: quando uma query √© executada, somente os dados da entidade alvo s√£o retornados. Por exemplo, se houver um relacionamento entre Account e Contact, uma query para Account retornaria inicialmente os dados da Account. Informa√ß√µes da Contact associada seriam retornadas quando uma NavigationProperty fosse acessada ou se voc√™ explicitamente pedisse;</li>
<li><strong>Eager Loading</strong>: todos os dados relacionados s√£o retornados. Nesse exemplo, ao fazer uma query para uma Account, os dados da Contact j√° seriam retornados. Essencialmente, √© o oposto de Lazy Loading;</li>
<li><strong>Explicit Loading</strong>: quando Lazy Loading est√° desabilitado, voc√™ pode us√°-lo para carregar entidades de forma Lazy explicitamente. O m√©todo Load permite que voc√™ execute queries individualmente.</li>
</ul>
<p>Voc√™ pode achar que Lazy Loading sempre √© a melhor op√ß√£o, mas n√£o se engane. Se voc√™ <strong>sabe </strong> quais dados vai usar, o Lazy Loading pode afetar a performance por fazer v√°rias idas as banco de dados ao inv√©s de uma. Se por outro lado voc√™ n√£o tiver certeza do n√∫mero de requisi√ß√µes ao banco de dados e provavelmente n√£o vai utilizar todos os dados retornados, a√≠ sim o Lazy Loading √© a melhor op√ß√£o.</p>
<p>√â poss√≠vel habilitar ou desabilitar o Lazy Loading visualmente ou por c√≥digo. Pelo Designer, basta ir ao EF Model, depois Properties, e escolher True ou False na propriedade Lazy Loading Enabled. Por c√≥digo, o DbContext possui uma propriedade Configuration.LazyLoadingEnabled: <code>context.Configuration.LazyLoadingEnabled = true;</code>.</p>
<p>D√™ uma olhada no c√≥digo abaixo:</p>
<p><script src="https://gist.github.com/edneypitta/d7d52d6753dfed406347.js"></script></p>
<p>Se voc√™ colocar um breakpoint na linha do primeiro foreach, vai perceber bem a diferen√ßa do Lazy Loading. Caso esteja desabilitado, toda a cascata de relacionamento ser√° carregada na primeira ida ao banco de dados. Caso habilitado, voc√™ vai notar que as propriedades Customers, Transactions e TransactionDetails n√£o ser√£o carregadas. Elas ir√£o sendo carregadas conforme forem usadas (foreach). Algumas outras opera√ß√µes tamb√©m fazem com que os relacionamentos sejam carregados, como ToList, ToArray ou ToDictionary.<br />
√â importante notar tamb√©m que se uma fun√ß√£o Aggregate for chamada, uma query ser√° executada imediatamente para retornar aquele valor. Ent√£o se voc√™ chamar o m√©todo Count de query.Customers e depois iterar pela lista (foreach), duas chamadas ao banco de dados ser√£o feitas. Iterando primeiro (ou chamando o m√©todo ToList), voc√™ j√° saberia o tamanho da lista e n√£o seriam necess√°rias duas chamadas.</p>
<h2>Criando Compiled Queries</h2>
<p>Usando LINQ, o EF cuida de traduzir a query para a linguagem SQL em tempo de execu√ß√£o, o que leva algum tempo. Por isso, o EF suporta <em>compiled queries</em>, onde ele cacheia o SQL de uma determinada query e somente muda os par√¢metros na hora de execut√°-la. A partir do .NET 4.5, isso √© feito automaticamente, mas voc√™ pode ainda fazer esse processo manualmente:</p>
<p><code>static readonly Func<MyObjectContext, string, Person> compiledQuery =<br />
            CompiledQuery.Compile<MyObjectContext, string, Person>(<br />
                (ctx, email) => (from p in ctx.People<br />
                                 where p.EmailAddress == email<br />
                                 select p).FirstOrDefault());</code></p>
<p>E usar a query assim: <code>Person p = compiledQuery.Invoke(context, "foo@bar");</code>. √â importante o m√©todo ser est√°tico para evitar a compila√ß√£o a cada chamada. Outro ponto √© que se a query for modificada, o EF vai precisar recompil√°-la. Ent√£o o ganho de performance ser√° perdido se voc√™ adicionar um Count ou ToList numa query compilada.</p>
<h2>Usando Entity SQL</h2>
<p>O EF permite que voc√™ execute queries SQL diretamente no DbContext, com todo o conhecimento do seu model. Outro benef√≠cio √© o maior controle sobre a query SQL que ser√° executada no banco de dados. Voc√™ pode fazer uso do Entity Framework Object Services assim:</p>
<p><code>var queryString = "SELECT VALUE p " +<br />
 "FROM MyEntities.People AS p " +<br />
 "WHERE p.FirstName='John'";<br />
ObjectQuery<Person> people = context.CreateQuery<Person>(queryString);</code></p>
<p>Outro cen√°rio √© quando voc√™ n√£o precisa do objeto inteiro ou quer trabalhar somente com os valores retornados para ganho de performance. Isso √© efetuado atrav√©s da classe EntityDataReader, bem parecida com a classe DataReader do System.Data. Segue um c√≥digo de exemplo:</p>
<p><script src="https://gist.github.com/edneypitta/6a77be2cfb173d51c053.js"></script></p>
<p>Isso √© tudo para esse objetivo. Obrigado pela leitura e fique de olho no pr√≥ximo post, que ser√° sobre o objetivo 2.2 da certifica√ß√£o Microsoft 70-487: <strong><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-2-query-and-manipulate-data-by-using-data-provider-for-entity-framework/">Query and manipulate data by using Data Provider for Entity Framework</a></strong>.</p>
<p>At√© mais!</p>

				<p><a class="btn btn-default read-more" href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-1-query-and-manipulate-data-by-using-the-entity-framework/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 2.1 ‚Äì Query and manipulate data by using the Entity Framework">Leia Mais</a></p>

							</div><!-- .entry-content -->
					</div>
	</div>
</article><!-- #post-## -->

			
				
<article id="post-298" class="post-298 post type-post status-publish format-standard hentry category-certificacao tag-70-487">
	<div class="blog-item-wrap">
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-1-6-manipulate-xml-data-structures/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 1.6 ‚Äì Manipulate XML data structures" >
			 				</a>
		<div class="post-inner-content">
			<header class="entry-header page-header">

				<h1 class="entry-title"><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-1-6-manipulate-xml-data-structures/" rel="bookmark">Certifica√ß√£o Microsoft 70-487: Objetivo 1.6 ‚Äì Manipulate XML data structures</a></h1>

								<div class="entry-meta">
					<span class="posted-on"><i class="fa fa-calendar"></i> <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-1-6-manipulate-xml-data-structures/" rel="bookmark"><time class="entry-date published" datetime="2016-01-14T01:06:12+00:00">14/01/2016</time><time class="updated" datetime="2016-03-01T16:56:32+00:00">01/03/2016</time></a></span><span class="byline"> <i class="fa fa-user"></i> <span class="author vcard"><a class="url fn n" href="https://edneypitta.github.io/old-blog/author/admin/">Edney Pitta</a></span></span>				<span class="comments-link"><i class="fa fa-comment-o"></i><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-1-6-manipulate-xml-data-structures/#respond"><span class="dsq-postid" data-dsqidentifier="298 https://edneypitta.github.io/old-blog/?p=298">Deixe um coment√°rio</span></a></span>
				
				
				</div><!-- .entry-meta -->
							</header><!-- .entry-header -->

						<div class="entry-content">

				<p>Ol√° pessoal! </p>
<p>Continuando a <a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-developing-microsoft-azure-and-web-services/" target="_blank">s√©rie sobre a certifica√ß√£o Microsoft 70-487</a>, esse post ser√° sobre o objetivo 1.6, <em>Manipulate XML data structures</em>, o √∫ltimo do primeiro t√≥pico da certifica√ß√£o, <em>Accessing data</em>. Vamos l√°?</p>
<h2>Lendo, Filtrando, Criando e Modificando Estruturas XML</h2>
<p>XML √© um arquivo que estrutura dados em formato de texto baseado em elementos e atributos. Elementos s√£o estruturas que representam um componente de dados, enquanto atributos s√£o propriedades dos elementos.</p>
<p>O primeiro componente de um documento XML √© o <em>XML declaration</em>. Esse elemento n√£o √© obrigat√≥rio e geralmente inclui a vers√£o do XML e o encoding:</p>
<p><code>&lt;?xml version="1.0" encoding="utf-8" ?&gt;</code> </p>
<p>Um XML v√°lido tem os seguintes requerimentos:</p>
<ul>
<li>Deve ter somente um elemento raiz;</li>
<li>Elementos que s√£o abertos devem ser fechados na ordem que foram abertos;</li>
<li>Todos os elementos precisam ser v√°lidos ou bem formados.</li>
</ul>
<p>Considere o seguinte XML. Name, FirstName, MiddleInitial e LastName s√£o elementos, enquanto MiddleName √© um atributo do elemento MiddleInitial:</p>
<p><code>&lt;?xml version="1.0" encoding="utf-8" ?&gt;<br />
&lt;Name&gt;<br />
 &lt;FirstName&gt;John&lt;/FirstName&gt;<br />
 &lt;MiddleInitial MiddleName="Quartz"&gt;Q&lt;/MiddleInitial&gt;<br />
 &lt;LastName&gt;Public&lt;/LastName&gt;<br />
&lt;/Name&gt;</code></p>
<p>Existem mais dois elementos que voc√™ deve conhecer para o exame: coment√°rios e namespaces. Coment√°rios s√£o definidos dessa forma:</p>
<p><code>&lt;!-- this is a comment about the Name element. Blah blah blah--&gt;</code></p>
<p>Namespaces servem para identificar quem escreveu o XML, geralmente uma empresa. Voc√™ pode definir o namespace no elemento raiz como o seguinte:</p>
<p><code>xmlns:Prefix="SomeValueUsuallyACompanyUrl"</code></p>
<p><em>xmlns</em> √© a abrevia√ß√£o de XML NameSpace. </p>
<p>Voc√™ pode definir tamb√©m dois namespaces no elemento raiz. Isso √© √∫til quando duas ou mais pessoas (ou empresas) est√£o escrevendo o mesmo XML, talvez com elementos com o mesmo nome. Por exemplo:</p>
<p><code>&lt;DocumentCore xmlns:johnco=&quot;http://www.yourcompany.com/Companies&quot; xmlns:billco=&quot;http://<br />www.mycompany.com/Customers&quot;&gt;<br /> &lt;johnco:Name&gt;<br /> &lt;johnco:Company&gt;JohnCo&lt;/johnco:Company&gt;<br /> &lt;/johnco:Name&gt;<br /> &lt;billco:Name&gt;<br /> &lt;billco:FirstName&gt;John&lt;/billco:FirstName&gt;<br /> &lt;billco:MiddleInitial&gt;Q&lt;/billco:MiddleInitial&gt;<br /> &lt;billco:LastName&gt;Public&lt;/billco:LastName&gt;<br /> &lt;/billco:Name&gt;<br />&lt;/DocumentCore&gt;</code></p>
<p>Outra op√ß√£o √© definir o namespace no n√≠vel de cada elemento:</p>
<p><code>&lt;DocumentCore&gt;<br /> &lt;johnco:Name xmlns:johnco=&quot;http://www.yourcompany.com/Companies&quot;&gt;<br /> &lt;johnco:Company&gt;JohnCo&lt;/johnco:Company&gt;<br /> &lt;/johnco:Name&gt;<br /> &lt;billco:Name xmlns:billco=&quot;http://www.mycompany.com/Customers&quot;&gt;<br /> &lt;billco:FirstName&gt;John&lt;/billco:FirstName&gt;<br /> &lt;billco:MiddleInitial&gt;Q&lt;/billco:MiddleInitial&gt;<br /> &lt;billco:LastName&gt;Public&lt;/billco:LastName&gt;<br /> &lt;/billco:Name&gt;<br />&lt;/DocumentCore&gt;</code></p>
<h2>Manipulando Dados em XML</h2>
<p>Para o exame, voc√™ deve se familiarizar com 5 classes que manipulam XML no .NET Framework: <em>XmlWriter</em>, <em>XmlReader</em>, <em>XmlDocument</em>, <em>XPath </em>e <em>LINQ-to-XML</em> (XElement e XDocument). O exame foca mais em LINQ-to-XML por ser mais recente e elegante, ent√£o d√™ aten√ß√£o especial a esse t√≥pico.</p>
<h4>XmlWriter</h4>
<p>XmlWriter √© uma classe f√°cil, antiga e intuitiva de se entender. Voc√™ obt√©m uma inst√¢ncia pelo m√©todo est√°tico Create passando um nome de arquivo e chama os m√©todos WriteStartDocument, WriteStartElement ou WriteElementString, WriteEndElement e WriteEndDocument. Entenda rapidamente como a classe funciona e o XML gerado:</p>
<p><script src="https://gist.github.com/edneypitta/50ab5e50be3fd99761bb.js"></script></p>
<p><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;<br />&lt;Customers&gt;<br /> &lt;Customer&gt;<br /> &lt;FirstName&gt;John&lt;/FirstName&gt;<br /> &lt;MiddleInitial&gt;Q&lt;/MiddleInitial&gt;<br /> &lt;LastName&gt;Public&lt;/LastName&gt;<br />&lt;/Customer&gt;<br />&lt;Customer&gt;<br /> &lt;FirstName&gt;Bill&lt;/FirstName&gt;<br /> &lt;MiddleInitial&gt;G&lt;/MiddleInitial&gt;<br /> &lt;LastName&gt;Ryan&lt;/LastName&gt;<br />&lt;/Customer&gt;<br />&lt;Customer&gt;<br /> &lt;FirstName&gt;William&lt;/FirstName&gt;<br /> &lt;MiddleInitial&gt;G&lt;/MiddleInitial&gt;<br /> &lt;LastName&gt;Gates&lt;/LastName&gt;<br /> &lt;/Customer&gt;<br />&lt;/Customers&gt;</code></p>
<h4>XmlReader</h4>
<p>XmlReader √© a contraparte do XmlWriter, e √© tamb√©m simples de usar. Voc√™ cria um XmlReader passando o nome do arquivo que quer ler, faz um while chamando o m√©todo Read e faz sua opera√ß√£o olhando para a propriedade NodeType. Uma r√°pida olhada no c√≥digo vai deixar as coisas mais claras:</p>
<p><script src="https://gist.github.com/edneypitta/c881dedae77fc5f78f09.js"></script></p>
<h4>XmlDocument</h4>
<p>XmlDocument √© o &#8220;pai&#8221; dos antigos XmlWriter e XmlReader, ainda mais f√°cil de usar. Para ler um XML, voc√™ instancia um novo XmlDocument, chama o m√©todo Load apontando para um arquivo ou stream, extrai a lista de nodos (elementos) e itera por eles.</p>
<p><script src="https://gist.github.com/edneypitta/fec394611dd3a2df0d28.js"></script></p>
<p>Para escrever um arquivo XML, basta criar elementos com o m√©todo CreateElement e dar AppendChild neles, respeitando a regra de que os elementos abertos primeiro devem ser fechados por √∫ltimo.</p>
<p><script src="https://gist.github.com/edneypitta/aedd2a9c8c8acccd1770.js"></script></p>
<h4>XPath</h4>
<p>XPath, que significa XML Path Language, √© um tipo de query para documentos XML. Voc√™ obt√©m a classe XPathNavigator chamando o m√©todo CreateNavigator de um XmlDocument. </p>
<p>Considere o seguinte XML:</p>
<p><code>&lt;?xml&#x00a0;version=&quot;1.0&quot;&#x00a0;encoding=&quot;utf-8&quot;&#x00a0;?&gt;<br />&lt;People&gt;<br />&#x00a0;&#x00a0;&lt;Person&#x00a0;firstName=&quot;John&quot;&#x00a0;lastName=&quot;Doe&quot;&gt;<br />&#x00a0;&#x00a0;&#x00a0;&#x00a0;&lt;ContactDetals&gt;<br />&#x00a0;&#x00a0;&#x00a0;&#x00a0;&#x00a0;&#x00a0;&lt;EmailAddress&gt;john@unknown.com&lt;/EmailAddress&gt;<br />&#x00a0;&#x00a0;&#x00a0;&#x00a0;&lt;/ContactDetals&gt;<br />&#x00a0;&#x00a0;&lt;/Person&gt;<br />&#x00a0;&#x00a0;&lt;Person&#x00a0;firstName=&quot;Jane&quot;&#x00a0;lastName=&quot;Doe&quot;&gt;<br />&#x00a0;&#x00a0;&#x00a0;&#x00a0;&lt;ContactDetals&gt;<br /> &#x00a0;&#x00a0;&#x00a0;&#x00a0;&#x00a0;&lt;EmailAddress&gt;jane@unknown.com&lt;/EmailAddress&gt;<br />&#x00a0;&#x00a0;&#x00a0;&#x00a0;&#x00a0;&#x00a0;&lt;PhoneNunmber&gt;001122334455&lt;/PhoneNunmber&gt;<br />&#x00a0;&#x00a0;&#x00a0;&#x00a0;&lt;/ContactDetals&gt;<br />&#x00a0;&#x00a0;&lt;/Person&gt;<br />&lt;/People&gt;</code></p>
<p>Para obter os elementos Person pelo firstName, voc√™ usaria o seguinte c√≥digo:</p>
<p><script src="https://gist.github.com/edneypitta/e37b577bfd3564176a98.js"></script></p>
<h4>LINQ-to-XML</h4>
<p>LINQ-to-XML ser√° bastante coberto no exame pois usa bastante os recursos modernos do .NET Framework como m√©todo an√¥nimos, gen√©ricos, tipos nullable e a sem√¢ntica de query LINQ. √â bem importante que voc√™ conhe√ßa bem a sintaxe do LINQ para o exame como um todo.</p>
<p>As classes est√£o no namespace System.Xml.Linq. Uma das mais importantes √© a classe <em>XElement</em>, que tem 5 construtores:</p>
<ul>
<li>public XElement(XName someName);
</li>
<li>public XElement(XElement someElement);
</li>
<li>public XElement(XName someName, Object someValue);
</li>
<li>public XElement(XName someName, params Object[] someValueset);
</li>
<li>public XElement(XStreamingElement other);<br />
/li>
</ul>
<p>Lembra de como voc√™ cria um elemento Customer dentro de Customers com XmlDocument? Veja como se faz com XElement:</p>
<p><code>XElement customers = new XElement("Customers", new XElement("Customer",<br />
 new XElement("FirstName", "John"), new XElement("MiddleInitial", "Q"),<br />
 new XElement("LastName", "Public")));</code></p>
<p>Outra vantagem √© que XElement faz o escape automaticamente de caracteres usados na sem√¢ntica do XML como &lt;, &gt; e &amp;.</p>
<p>H√° tamb√©m a classe <em>XDocument</em>, que representa o documento XML por inteiro. Ela cont√©m as seguintes caracter√≠sticas:</p>
<ul>
<li>Um objeto <em>XDeclaration </em>quer permite a especifica√ß√£o da vers√£o do XML e do encoding;</li>
<li>Um objeto XElement que serve como raiz;</li>
<li>Objetos de <em>XProcessingInstruction</em> que representam instru√ß√µes de processamento do XML;</li>
<li>Objetos de <em>XComment</em> que representam coment√°rios.</li>
</ul>
<p>Voc√™ pode instanciar um XAttribute da seguinte forma: <code>XAttribute sampleAttribute = new XAttribute("FirstName", "John");</code>.</p>
<p>Namespaces, representados pela classe <em>XNamespace </em>, s√£o usados assim:</p>
<p><code>XNamespace billCo = "http://www.billco.com/Samples";<br />
XElement firstNameBillCo = new XElement(billCo + "FirstName", "John");</code></p>
<p>As coisas come√ßam a ficar mais dif√≠ceis nas queries com LINQ, e isso √© uma coisa que &#8220;can&#8217;t be emphasized enough&#8221;: √© <strong>muito</strong> importante saber LINQ e suas nuances, n√£o s√≥ para esse objetivo.</p>
<p>Uma caracter√≠stica √© entender a diferen√ßa entre os m√©todos <em>Descendants </em>e <em>Elements </em>de um XContainer. Considere o seguinte c√≥digo:</p>
<p><script src="https://gist.github.com/edneypitta/afa484f80b713478bb5b.js"></script></p>
<p>O output de ambos os casos √© 3. Inicialmente eles podem parecer id√™nticos, mas eles t√™m uma grande diferen√ßa. O m√©todo Descendants nesse caso procura por elementos Customer em <strong>qualquer n√≠vel abaixo do XContainer que o chamou</strong>, nesse exemplo o Root. J√° o Elements procura por elementos Customer apenas <strong>um n√≠vel abaixo do XContainer</strong>. Nesse caso ele encontra os tr√™s elementos Customer pois o Root √© o elemento Customers. Se a estrutura fosse como abaixo, por exemplo, o m√©todo Elements n√£o encontraria nenhum elemento Customer:</p>
<p><code>&lt;Root&gt;<br />&lt;Customers&gt;<br />&lt;Customer&gt;&lt;FirstName&gt;John&lt;/FirstName&gt;&lt;/Customer&gt;<br /> &lt;Customer&gt;&lt;FirstName&gt;Bill&lt;/FirstName&gt;&lt;/Customer&gt;<br /> &lt;Customer&gt;&lt;FirstName&gt;Joe&lt;/FirstName&gt;&lt;/Customer&gt;<br />&lt;/Customers&gt;<br />&lt;/Root&gt;</code></p>
<h4>Manipula√ß√£o Avan√ßada de XML</h4>
<p>Nessa se√ß√£o do objetivo, a ideia √© ter mais quest√µes de manipula√ß√µes e queries com LINQ-to-XML. </p>
<p>Um ponto a destacar √© que voc√™ deve conhecer a classe <em>XmlConvert</em> para dar escape de caracteres especiais se voc√™ n√£o estiver usando uma classe que faz isso para voc√™, como XElement. XmlConvert √© irm√£ da classe Convert, focada para XML. Ela automaticamente faz o escape de caracteres reservados e prov√™ v√°rios m√©todos de convers√£o para arquivos XML. </p>
<p>A lista abaixo cont√©m os m√©todos n√£o √≥bvios como ToInt32, ToDateTime, etc. e seus comportamentos:</p>
<ul>
<li><strong>DecodeName</strong>: faz o decode de um nome encodado;</li>
<li><strong>EncodeName</strong>: faz o encode de uma string para que possa ser usada como um nome de nodo XML;</li>
<li><strong>EncodeLocalName</strong>: faz o mesmo de EncodeName, com uma diferen√ßa: encoda tamb√©m o caracter &#8220;:&#8221;, assegurando que o nome pode ser usado em elementos que contenham namespace;</li>
<li><strong>EncodeNmToken</strong>: retorna um nome v√°lido para um nodo de acordo com a <em>XML Language Spec</em>;</li>
<li><strong>IsStartNCNameChar</strong>: determina se o par√¢metro n√£o √© o caracter &#8220;:&#8221;;</li>
<li><strong>IsPublicIdChar</strong>: determina se o par√¢metro √© um identificador XML p√∫blico (algumas magic strings que existem por legado);</li>
<li><strong>ToDateTimeOffset</strong>: converte para DateTimeOffset, um DateTime com identificador em rela√ß√£o ao UTC.</li>
</ul>
<p>Segue um c√≥digo de aplica√ß√£o dos m√©todos mais relevantes da classe XmlConvert (DecodeName, EncodeName e EncodeLocalName):</p>
<p><script src="https://gist.github.com/edneypitta/f7c1bfb759cc0d8bce0a.js"></script></p>
<p>Um √∫ltimo ponto desse objetivo como um todo √© que voc√™ pode usar diferentes classes do .NET Framework para lidar com o mesmo XML. Voc√™ pode juntar implementa√ß√µes onde julgar necess√°rio; usar uma metodologia n√£o te for√ßa a us√°-la at√© o fim.</p>
<p>Esse foi o √∫ltimo objetivo do primeiro grande t√≥pico da certifica√ß√£o, <em>Accessing Data</em>. O pr√≥ximo post ser√° sobre o primeiro objetivo do segundo t√≥pico da certifica√ß√£o, <strong><a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-2-1-query-and-manipulate-data-by-using-the-entity-framework/">Querying and manipulating data by using the Entity Framework</a></strong>.</p>
<p>Obrigado pela leitura e at√© mais!</p>

				<p><a class="btn btn-default read-more" href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-1-6-manipulate-xml-data-structures/" title="Certifica√ß√£o Microsoft 70-487: Objetivo 1.6 ‚Äì Manipulate XML data structures">Leia Mais</a></p>

							</div><!-- .entry-content -->
					</div>
	</div>
</article><!-- #post-## -->

			
				<nav class="navigation paging-navigation" role="navigation">
		<h1 class="screen-reader-text">Navega√ß√£o de Posts</h1>
		<div class="nav-links">

						<div class="nav-previous"> <a href="https://edneypitta.github.io/old-blog/page/4/" ><i class="fa fa-chevron-left"></i> Anteriores</a></div>
			
						<div class="nav-next"><a href="https://edneypitta.github.io/old-blog/page/2/" >Pr√≥ximos <i class="fa fa-chevron-right"></i></a> </div>
			
		</div><!-- .nav-links -->
	</nav><!-- .navigation -->
	
		
		</main><!-- #main -->
	</div><!-- #primary -->

</div>
	<div id="secondary" class="widget-area col-sm-12 col-md-4" role="complementary">
		<div class="well">
						<aside id="text-3" class="widget widget_text">			<div class="textwidget"><a href="https://edneypitta.github.io/old-blog/sobre/"><img src="https://edneypitta.github.io/old-blog/wp-content/uploads/2015/08/IMG-20150829-WA00012-e1440915174271-150x150.jpg"  width="150" height="150" class="aligncenter size-thumbnail wp-image-93" style="border-radius: 80px;" />
<h2 style="text-align:center;">Edney Pitta</h2></a>
<div style="text-align: center;">Desenvolvedor de Software @ Lambda3</div>
<div style="margin-top:20px;text-align:center;"><a href="https://edneypitta.github.io/old-blog/sobre/"><button class="btn btn-danger btn-lg " >SOBRE MIM</button></a></div></div>
		</aside><aside id="search-2" class="widget widget_search">
<form role="search" method="get" class="form-search" action="https://edneypitta.github.io/old-blog/">
  <div class="input-group">
  	<label class="screen-reader-text" for="s">Search for:</label>
    <input type="text" class="form-control search-query" placeholder="Procurar&hellip;" value="" name="s" title="Search for:" />
    <span class="input-group-btn">
      <button type="submit" class="btn btn-default" name="submit" id="searchsubmit" value="Search"><span class="glyphicon glyphicon-search"></span></button>
    </span>
  </div>
</form></aside>		<aside id="recent-posts-3" class="widget widget_recent_entries">		<h3 class="widget-title">Posts recentes</h3>		<ul>
					<li>
				<a href="https://edneypitta.github.io/old-blog/migrando-um-projeto-asp-net-core-rc-1-para-rc-2/">Migrando um projeto ASP.NET Core RC 1 para RC 2</a>
						</li>
					<li>
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-486-developing-asp-net-mvc-web-applications/">Certifica√ß√£o Microsoft 70-486: Developing ASP.NET MVC Web Applications</a>
						</li>
					<li>
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-480-programming-in-html5-with-javascript-and-css3/">Certifica√ß√£o Microsoft 70-480: Programming in HTML5 with JavaScript and CSS3</a>
						</li>
					<li>
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-resultado/">Certifica√ß√£o Microsoft 70-487 &#8211; Resultado</a>
						</li>
					<li>
				<a href="https://edneypitta.github.io/old-blog/certificacao-microsoft-70-487-objetivo-5-6-share-assemblies-between-multiple-applications-and-servers/">Certifica√ß√£o Microsoft 70-487: Objetivo 5.6 ‚Äì Share assemblies between multiple applications and servers</a>
						</li>
				</ul>
		</aside>		<aside id="annual_archive_widget-2" class="widget Annual_Archive_Widget"><h3 class="widget-title">Arquivo</h3>	<ul>
		<li><a href='https://edneypitta.github.io/old-blog/2016/06/'>junho 2016</a>&nbsp;(1)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2016/05/'>maio 2016</a>&nbsp;(1)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2016/04/'>abril 2016</a>&nbsp;(1)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2016/03/'>mar√ßo 2016</a>&nbsp;(10)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2016/02/'>fevereiro 2016</a>&nbsp;(11)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2016/01/'>janeiro 2016</a>&nbsp;(10)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2015/12/'>dezembro 2015</a>&nbsp;(3)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2015/11/'>novembro 2015</a>&nbsp;(3)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2015/10/'>outubro 2015</a>&nbsp;(1)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2015/09/'>setembro 2015</a>&nbsp;(5)</li>
	<li><a href='https://edneypitta.github.io/old-blog/2015/08/'>agosto 2015</a>&nbsp;(2)</li>
	</ul>
	</aside>		</div>
	</div><!-- #secondary -->
			</div><!-- close .*-inner (main-content or sidebar, depending if sidebar is used) -->
		</div><!-- close .row -->
	</div><!-- close .container -->
</div><!-- close .site-content -->

	<div id="footer-area">
		<div class="container footer-inner">
			<div class="row">
				
				</div>
		</div>

		<footer id="colophon" class="site-footer" role="contentinfo">
			<div class="site-info container">
				<div class="row">
										<nav role="navigation" class="col-md-6">
						<ul id="menu-social-1" class="nav footer-nav clearfix"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-20"><a href="https://br.linkedin.com/in/edneypitta"><i class="fa fa-linkedin-square"></i></a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-22"><a href="https://www.facebook.com/edneypitta"><i class="fa fa-facebook-square"></i></a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-23"><a href="https://twitter.com/edneypitta"><i class="fa fa-twitter-square"></i></a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-24"><a href="https://edneypitta.github.io/old-blog/feed/"><i class="fa fa-rss"></i></a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-27"><a href="https://edneypitta.github.io/old-blog/sobre/"><i class="fa fa-info-circle"></i></a></li>
</ul>					</nav>
					<div class="copyright col-md-6">
						<a rel="license" href="http://creativecommons.org/licenses/by/2.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/2.0/80x15.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/2.0/">Creative Commons Attribution 2.0 Generic License</a>.						Theme by <a href="http://colorlib.com/" target="_blank">Colorlib</a> Powered by <a href="http://wordpress.org/" target="_blank">WordPress</a>					</div>
				</div>
			</div><!-- .site-info -->
			<div class="scroll-to-top"><i class="fa fa-angle-up"></i></div><!-- .scroll-to-top -->
		</footer><!-- #colophon -->
	</div>
</div><!-- #page -->

<script type='text/javascript' src='https://edneypitta.github.io/old-blog/wp-content/themes/sparkling/inc/js/skip-link-focus-fix.js?ver=20140222'></script>
<script type='text/javascript' src='https://edneypitta.github.io/old-blog/wp-includes/js/wp-embed.min.js?ver=4.8.2'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var countVars = {"disqusShortname":"edneypitta"};
/* ]]> */
</script>
<script type='text/javascript' src='https://edneypitta.github.io/old-blog/wp-content/plugins/disqus-comment-system/media/js/count.js?ver=4.8.2'></script>

</body>
</html>